<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 Inversion of Control 1.2.3.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/messaging.html"><strong>10</strong><span>Message-Driven Microservices</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/commandLineApps.html"><strong>11</strong><span>Standalone Command Line Applications</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configurations.html"><strong>12</strong><span>Configurations</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/languageSupport.html"><strong>13</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/management.html"><strong>14</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>15</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/multitenancy.html"><strong>16</strong><span>Multi-Tenancy</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cli.html"><strong>17</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/appendix.html"><strong>18</strong><span>Appendices</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/quickStart.html">&lt;&lt; <strong>2</strong><span>Quick Start</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span> >></a></div>
                


                <div class="project">
                    <h1>3 Inversion of Control</h1>

                    <p><strong>Version:</strong> 1.2.3.BUILD-SNAPSHOT</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#beans"><strong>3.1</strong><span>Defining Beans</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#how"><strong>3.2</strong><span>How Does it Work?</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#beanContext"><strong>3.3</strong><span>The BeanContext</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#types"><strong>3.4</strong><span>Injectable Container Types</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#qualifiers"><strong>3.5</strong><span>Bean Qualifiers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#scopes"><strong>3.6</strong><span>Scopes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#builtInScopes"><strong>3.6.1</strong><span>Built-In Scopes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#refreshable"><strong>3.6.2</strong><span>Refreshable Scope</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#metaScopes"><strong>3.6.3</strong><span>Scopes on Meta Annotations</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#factories"><strong>3.7</strong><span>Bean Factories</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#conditionalBeans"><strong>3.8</strong><span>Conditional Beans</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#replaces"><strong>3.9</strong><span>Bean Replacement</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#beanConfigurations"><strong>3.10</strong><span>Bean Configurations</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#lifecycle"><strong>3.11</strong><span>Life-Cycle Methods</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#contextEvents"><strong>3.12</strong><span>Context Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#events"><strong>3.13</strong><span>Bean Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#introspection"><strong>3.14</strong><span>Bean Introspection</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#beanValidation"><strong>3.15</strong><span>Bean Validation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#annotationMetadata"><strong>3.16</strong><span>Bean Annotation Metadata</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#springBeans"><strong>3.17</strong><span>Micronaut Beans And Spring</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#android"><strong>3.18</strong><span>Android Support</span></a>
                    </div>
                    
                </div>
                

                
<h1 id="ioc"><a class="anchor" href="#ioc"></a>3 Inversion of Control</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When most developers think of Inversion of Control (also known as Dependency Injection and referred to as such from this point onwards) the Spring Framework comes to mind.</p>
</div>
<div class="paragraph">
<p>Micronaut takes inspiration from Spring, and in fact, the core developers of Micronaut are former SpringSource/Pivotal engineers now working for <a href="https://objectcomputing.com">OCI</a>.</p>
</div>
<div class="paragraph">
<p>Unlike Spring which relies exclusively on runtime reflection and proxies, Micronaut uses compile time data to implement dependency injection.</p>
</div>
<div class="paragraph">
<p>This is a similar approach taken by tools such as Google&#8217;s <a href="https://google.github.io/dagger/">Dagger</a>, which is designed primarily with Android in mind. Micronaut, on the other hand, is designed for building server-side microservices and provides many of the same tools and utilities as Spring but without using reflection or caching excessive amounts of reflection metadata.</p>
</div>
<div class="paragraph">
<p>The goals of the Micronaut IoC container are summarized as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use reflection as a last resort</p>
</li>
<li>
<p>Avoid proxies</p>
</li>
<li>
<p>Optimize start-up time</p>
</li>
<li>
<p>Reduce memory footprint</p>
</li>
<li>
<p>Provide clear, understandable error handling</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the IoC part of Micronaut can be used completely independently of Micronaut itself for whatever application type you may wish to build. To do so all you need to do is configure your build appropriately to include the <code>micronaut-inject-java</code> dependency as an annotation processor. For example with Gradle:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">plugins {
  id "net.ltgt.apt" version "0.18" // <1>
}

...
dependencies {
    annotationProcessor "io.micronaut:micronaut-inject-java:1.2.3.BUILD-SNAPSHOT" // <2>
    compile "io.micronaut:micronaut-inject:1.2.3.BUILD-SNAPSHOT"
    ...
    testAnnotationProcessor "io.micronaut:micronaut-inject-java:1.2.3.BUILD-SNAPSHOT" // <3>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply the Annotation Processing plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Include the minimal dependencies required to perform dependency injection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This is necessary to create beans in the <code>test</code> directory</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the Groovy language you should include <code>micronaut-inject-groovy</code> in the <code>compileOnly</code> and <code>testCompileOnly</code> scopes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The entry point for IoC is then the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> interface, which includes a <code>run</code> method. The following example demonstrates using it:</p>
</div>
<div class="listingblock">
<div class="title">Running the <code>ApplicationContext</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (ApplicationContext context = ApplicationContext.run()) { <i class="conum" data-value="1"></i><b>(1)</b>
    MyBean myBean = context.getBean(MyBean.class); <i class="conum" data-value="2"></i><b>(2)</b>
    // do something with your bean
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Run the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve a bean that has been dependency injected</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example uses Java&#8217;s <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> syntax to ensure the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is cleanly shutdown when the application exits.
</td>
</tr>
</table>
</div>

<h2 id="beans"><a class="anchor" href="#beans"></a>3.1 Defining Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/beans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut implements the <a href="http://javax-inject.github.io/javax-inject/">JSR-330 (javax.inject) - Dependency Injection for Java</a> specification hence to use Micronaut you simply use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/package-summary.html">annotations provided by javax.inject</a>.</p>
</div>
<div class="paragraph">
<p>The following is a simple example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Engine { <b class="conum">(1)</b>
    int getCylinders();
    String start();
}

@Singleton<b class="conum">(2)</b>
public class V8Engine implements Engine {
    public String start() {
        return "Starting V8";
    }

    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    private int cylinders = 8;
}

@Singleton
public class Vehicle {
    private final Engine engine;

    public Vehicle(Engine engine) {<b class="conum">(3)</b>
        this.engine = engine;
    }

    public String start() {
        return engine.start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface Engine { <b class="conum">(1)</b>
    int getCylinders()
    String start()
}

@Singleton <b class="conum">(2)</b>
class V8Engine implements Engine {
    int cylinders = 8

    String start() {
        "Starting V8"
    }
}

@Singleton
class Vehicle {
    final Engine engine

    Vehicle(Engine engine) { <b class="conum">(3)</b>
        this.engine = engine
    }

    String start() {
        engine.start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface Engine {
    <b class="conum">(1)</b>
    val cylinders: Int

    fun start(): String
}

@Singleton<b class="conum">(2)</b>
class V8Engine : Engine {

    override var cylinders = 8
    override fun start(): String {
        return "Starting V8"
    }
}

@Singleton
class Vehicle(private val engine: Engine)<b class="conum">(3)</b>
{

    fun start(): String {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A common <code>Engine</code> interface is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>V8Engine</code> implementation is defined and marked with <code>Singleton</code> scope</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>Engine</code> is injected via constructor injection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform dependency injection simply run the  <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> using the <code>run()</code> method and lookup a bean using <code>getBean(Class)</code>, as per the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Vehicle vehicle = BeanContext.run().getBean(Vehicle.class);
System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Vehicle vehicle = BeanContext.run()
                             .getBean(Vehicle)
println( vehicle.start() )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">val vehicle = BeanContext.run().getBean(Vehicle::class.java)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will automatically discover dependency injection metadata on the classpath and wire the beans together according to injection points you define.</p>
</div>
<div class="paragraph">
<p>Micronaut supports the following types of dependency injection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constructor injection (must be one public constructor or a single contructor annotated with <code>@Inject</code>)</p>
</li>
<li>
<p>Field injection</p>
</li>
<li>
<p>JavaBean property injection</p>
</li>
<li>
<p>Method parameter injection</p>
</li>
</ul>
</div>

<h2 id="how"><a class="anchor" href="#how"></a>3.2 How Does it Work?</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/how.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At this point, you may be wondering how Micronaut performs the above dependency injection without requiring reflection.</p>
</div>
<div class="paragraph">
<p>The key is a set of AST transformations (for Groovy) and annotation processors (for Java) that generate classes that implement the <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> interface.</p>
</div>
<div class="paragraph">
<p>The ASM byte-code library is used to generate classes and because Micronaut knows ahead of time the injection points, there is no need to scan all of the methods, fields, constructors, etc. at runtime like other frameworks such as Spring do.</p>
</div>
<div class="paragraph">
<p>Also since reflection is not used in the construction of the bean, the JVM can inline and optimize the code far better resulting in better runtime performance and reduced memory consumption. This is particularly important for non-singleton scopes where the application performance depends on bean creation performance.</p>
</div>
<div class="paragraph">
<p>In addition, with Micronaut your application startup time and memory consumption is not bound to the size of your codebase in the same way as a framework that uses reflection. Reflection based IoC frameworks load and cache reflection data for every single field, method, and constructor in your code. Thus as your code grows in size so do your memory requirements, whilst with Micronaut this is not the case.</p>
</div>

<h2 id="beanContext"><a class="anchor" href="#beanContext"></a>3.3 The BeanContext</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/beanContext.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> is a container object for all your bean definitions (it also implements <a href="../api/io/micronaut/context/BeanDefinitionRegistry.html">BeanDefinitionRegistry</a>).</p>
</div>
<div class="paragraph">
<p>It is also the point of initialization for Micronaut. Generally speaking however, you don&#8217;t have to interact directly with the <code>BeanContext</code> API and can simply use <code>javax.inject</code> annotations and the annotations defined within <a href="../api/io/micronaut/context/annotation/package-summary.html">io.micronaut.context.annotation</a> package for your dependency injection needs.</p>
</div>

<h2 id="types"><a class="anchor" href="#types"></a>3.4 Injectable Container Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/types.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to being able to inject beans Micronaut natively supports injecting the following types:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Injectable Container Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">java.util.Optional</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Optional</code> of a bean. If the bean doesn&#8217;t exist <code>empty()</code> is injected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html">java.lang.Iterable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Iterable</code> or subtype of <code>Iterable</code> (example <code>List</code>, <code>Collection</code> etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iterable&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">java.util.stream.Stream</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A lazy <code>Stream</code> of beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Array.html">Array</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A native array of beans of a given type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Engine[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Provider.html">Provider</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>javax.inject.Provider</code> if a circular dependency requires it or to instantiate a prototype for each <code>get</code> call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Provider&lt;Engine&gt;</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A prototype bean will have one instance created per place the bean is injected. When a prototype bean is injected as a <code>Provider</code>, each call to <code>get()</code> will create a new instance.
</td>
</tr>
</table>
</div>

<h2 id="qualifiers"><a class="anchor" href="#qualifiers"></a>3.5 Bean Qualifiers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/qualifiers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you have multiple possible implementations for a given interface that you want to inject, you need to use a qualifier.</p>
</div>
<div class="paragraph">
<p>Once again Micronaut leverages JSR-330 and the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> and <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotations to support this use case.</p>
</div>
<div class="sect1">
<h2 id="_qualifying_by_name"><a class="anchor" href="#_qualifying_by_name"></a>Qualifying By Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To qualify by name you can use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotation. For example, consider the following classes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Engine { <b class="conum">(1)</b>
    int getCylinders();
    String start();
}

@Singleton
public class V6Engine implements Engine {  <b class="conum">(2)</b>
    public String start() {
        return "Starting V6";
    }

    public int getCylinders() {
        return 6;
    }
}

@Singleton
public class V8Engine implements Engine {
    public String start() {
        return "Starting V8";
    }

    public int getCylinders() {
        return 8;
    }

}

@Singleton
public class Vehicle {
    private final Engine engine;

    @Inject
    public Vehicle(@Named("v8") Engine engine) {<b class="conum">(4)</b>
        this.engine = engine;
    }

    public String start() {
        return engine.start();<b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface Engine { <b class="conum">(1)</b>
    int getCylinders()
    String start()
}

@Singleton
class V6Engine implements Engine { <b class="conum">(2)</b>
    int cylinders = 6

    String start() {
        "Starting V6"
    }
}

@Singleton
class V8Engine implements Engine { <b class="conum">(3)</b>
    int cylinders = 8

    String start() {
        "Starting V8"
    }
}

@Singleton
class Vehicle {
    final Engine engine

    @Inject Vehicle(@Named('v8') Engine engine) { <b class="conum">(4)</b>
        this.engine = engine
    }

    String start() {
        engine.start() <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface Engine { <b class="conum">(1)</b>
    val cylinders: Int
    fun start(): String
}

@Singleton
class V6Engine : Engine {  <b class="conum">(2)</b>

    override var cylinders: Int = 6

    override fun start(): String {
        return "Starting V6"
    }
}

@Singleton
class V8Engine : Engine {

    override var cylinders: Int = 8

    override fun start(): String {
        return "Starting V8"
    }

}

@Singleton
class Vehicle @Inject
constructor(@param:Named("v8") private val engine: Engine)<b class="conum">(4)</b>
{

    fun start(): String {
        return engine.start()<b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Engine</code> interface defines the common contract</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>V6Engine</code> class is the first implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>V8Engine</code> class is the second implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotation is used to indicate the <code>V8Engine</code> implementation is required</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Calling the start method prints: <code>"Starting V8"</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also declare <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">@Named</a> at the class level of a bean to explicitly define the name of the bean.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qualifying_by_annotation"><a class="anchor" href="#_qualifying_by_annotation"></a>Qualifying By Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to being able to qualify by name, you can build your own qualifiers using the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> annotation. For example, consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Qualifier;
import java.lang.annotation.Retention;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Qualifier
@Retention(RUNTIME)
public @interface V8 {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Qualifier
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Qualifier
@Retention(RUNTIME)
@interface V8 {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Qualifier
import java.lang.annotation.Retention
import java.lang.annotation.RetentionPolicy.RUNTIME

@Qualifier
@Retention(RUNTIME)
annotation class V8</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above annotation is itself annotated with the <code>@Qualifier</code> annotation to designate it as a qualifier. You can then use the annotation at any injection point in your code. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Inject Vehicle(@V8 Engine engine) {
        this.engine = engine;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Inject Vehicle(@V8 Engine engine) {
        this.engine = engine
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject constructor(@V8 val engine: Engine) {</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_primary_and_secondary_beans"><a class="anchor" href="#_primary_and_secondary_beans"></a>Primary and Secondary Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../api/io/micronaut/context/annotation/Primary.html">Primary</a> is a qualifier that indicates that a bean is the primary bean that should be selected in the case of multiple possible interface implementations.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ColorPicker {
    String color();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface ColorPicker {
    String color()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface ColorPicker {
    fun color(): String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given a common interface called <code>ColorPicker</code> that is implemented by multiple classes.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Primary;
import javax.inject.Singleton;

@Primary
@Singleton
class Green implements ColorPicker {

    @Override
    public String color() {
        return "green";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Primary
import javax.inject.Singleton

@Primary
@Singleton
class Green implements ColorPicker {

    @Override
    String color() {
        return "green"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Primary
import javax.inject.Singleton


@Primary
@Singleton
class Green: ColorPicker {
    override fun color(): String {
        return "green"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Green</code> bean is a <code>ColorPicker</code>, but is annotated with <code>@Primary</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;


@Singleton
public class Blue implements ColorPicker {

    @Override
    public String color() {
        return "blue";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton


@Singleton
class Blue implements ColorPicker {

    @Override
    String color() {
        return "blue"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton


@Singleton
class Blue: ColorPicker {
    override fun color(): String {
        return "blue"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Blue</code> bean is also a <code>ColorPicker</code> and hence you have two possible candidates when injecting the <code>ColorPicker</code> interface. Since <code>Green</code> is the primary it will always be favoured.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/testPrimary")
public class TestController {

    protected final ColorPicker colorPicker;

    public TestController(ColorPicker colorPicker) { <b class="conum">(1)</b>
        this.colorPicker = colorPicker;
    }

    @Get
    public String index() {
        return colorPicker.color();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/test")
class TestController {

    protected final ColorPicker colorPicker

    TestController(ColorPicker colorPicker) { <b class="conum">(1)</b>
        this.colorPicker = colorPicker
    }

    @Get
    String index() {
        colorPicker.color()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/test")
class TestController(val colorPicker: ColorPicker) { <b class="conum">(1)</b>

    @Get
    fun index(): String {
        return colorPicker.color()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Although there are two <code>ColorPicker</code> beans, <code>Green</code> gets injected due to the <code>@Primary</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If multiple possible candidates are present and no <code>@Primary</code> is defined then a <a href="../api/io/micronaut/context/exceptions/NonUniqueBeanException.html">NonUniqueBeanException</a> will be thrown.</p>
</div>
<div class="paragraph">
<p>In addition to <code>@Primary</code>, there is also a <a href="../api/io/micronaut/context/annotation/Secondary.html">Secondary</a> annotation which causes the opposite effect and allows de-prioritizing a bean.</p>
</div>
</div>
</div>

<h2 id="scopes"><a class="anchor" href="#scopes"></a>3.6 Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features an extensible bean scoping mechanism based on JSR-330. The following default scopes are supported:</p>
</div>

<h2 id="builtInScopes"><a class="anchor" href="#builtInScopes"></a>3.6.1 Built-In Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes/builtInScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Built-in Scopes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">@Singleton</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Singleton scope indicates only one instance of the bean should exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Context.html">@Context</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context scope indicates that the bean should be created at the same time as the <code>ApplicationContext</code> (eager initialization)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prototype scope indicates that a new instance of the bean is created each time it is injected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Infrastructure.html">@Infrastructure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure scope represents a bean that cannot be overridden or replaced using <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> because it is critical to the functioning of the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/ThreadLocal.html">@ThreadLocal</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ThreadLocal</code> scope is a custom scope that associates a bean per thread via a ThreadLocal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Refreshable</code> scope is a custom scope that allows a bean&#8217;s state to be refreshed via the <code>/refresh</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/http/scope/RequestScope.html">@RequestScope</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestScope</code> scope is a custom scope that indicates a new instance of the bean is created and associated with each HTTP request</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a> annotation is a synonym for <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> because the default scope is prototype.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional scopes can be added by defining a <code>@Singleton</code> bean that implements the <a href="../api/io/micronaut/context/scope/CustomScope.html">CustomScope</a> interface.</p>
</div>
<div class="paragraph">
<p>Note that with Micronaut when starting a <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> by default <code>@Singleton</code> scoped beans are created lazily and on demand. This is by design and to optimize startup time.</p>
</div>
<div class="paragraph">
<p>If this presents a problem for your use case you have the option of using the <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> annotation which binds the lifecycle of your object to the lifecycle of the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>. In other words when the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is started your bean will be created.</p>
</div>
<div class="paragraph">
<p>Alternatively you can annotate any <code>@Singleton</code> scoped bean with <a href="../api/io/micronaut/context/annotation/Parallel.html">@Parallel</a> which allows parallel initialization of your bean without impacting overall startup time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your bean fails to initialize in parallel then the application will be automatically shutdown.
</td>
</tr>
</table>
</div>

<h2 id="refreshable"><a class="anchor" href="#refreshable"></a>3.6.2 Refreshable Scope</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes/refreshable.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">Refreshable</a> scope is a custom scope that allows a beanâ€™s state to be refreshed via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/refresh</code> endpoint.</p>
</li>
<li>
<p>Publication of a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example, illustrates the <code>@Refreshable</code> scope behavior.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Refreshable <b class="conum">(1)</b>
public static class WeatherService {
    private String forecast;

    @PostConstruct
    public void init() {
        forecast = "Scattered Clouds " + new SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(new Date());<b class="conum">(2)</b>
    }

    public String latestForecast() {
        return forecast;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Refreshable <b class="conum">(1)</b>
static class WeatherService {

    String forecast

    @PostConstruct
    void init() {
        forecast = "Scattered Clouds ${new SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(new Date())}" <b class="conum">(2)</b>
    }

    String latestForecast() {
        return forecast
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Refreshable <b class="conum">(1)</b>
open class WeatherService {
    private var forecast: String? = null

    @PostConstruct
    fun init() {
        forecast = "Scattered Clouds " + SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(Date())<b class="conum">(2)</b>
    }

    open fun latestForecast(): String? {
        return forecast
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>WeatherService</code> is annotated with <code>@Refreshable</code> scope which stores an instance until a refresh event is triggered</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>forecast</code> property is set to a fixed value when the bean is created and won&#8217;t change until the bean is refreshed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you invoke the <code>latestForecast()</code> twice, you will see identical responses such as <code>"Scattered Clouds 01/Feb/18 10:29.199"</code>.</p>
</div>
<div class="paragraph">
<p>When the <code>/refresh</code> endpoint is invoked or a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> is published then the instance is invalidated and a new instance is created the next time the object is requested. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">applicationContext.publishEvent(new RefreshEvent());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">applicationContext.publishEvent(new RefreshEvent())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">applicationContext.publishEvent(RefreshEvent())</code></pre>
</div>
</div>

<h2 id="metaScopes"><a class="anchor" href="#metaScopes"></a>3.6.3 Scopes on Meta Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes/metaScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Scopes can be defined on Meta annotations that you can then apply to your classes. Consider the following example meta annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import static java.lang.annotation.RetentionPolicy.RUNTIME;

import io.micronaut.context.annotation.Requires;

import javax.inject.Singleton;
import java.lang.annotation.Documented;
import java.lang.annotation.Retention;

@Requires(classes = Car.class ) <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
public @interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires

import javax.inject.Singleton
import java.lang.annotation.Documented
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Requires(classes = Car.class ) <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
@interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import javax.inject.Singleton


@Requires(classes = [Car::class]) <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
@MustBeDocumented
@Retention(AnnotationRetention.RUNTIME)
annotation class Driver</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The scope declares a requirement on a <code>Car</code> class using <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation is declared as <code>@Singleton</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example above the <code>@Singleton</code> annotation is applied to the <code>@Driver</code> annotation which results in every class that is annotated with <code>@Driver</code> being regarded as singleton.</p>
</div>
<div class="paragraph">
<p>Note that in this case it is not possible to alter the scope when the annotation is applied. For example, the following will not override the scope declared by <code>@Driver</code> and is invalid:</p>
</div>
<div class="listingblock">
<div class="title">Declaring Another Scope</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Driver
@Prototype
class Foo {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish for the scope to be overridable you should instead using the <a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> annotation on <code>@Driver</code> which allows a default scope to be specified if none other is present:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @DefaultScope</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(classes = Car.class )
@DefaultScope(Singleton.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
public @interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Requires(classes = Car.class )
@DefaultScope(Singleton.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
@interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Requires(classes = [Car::class])
@DefaultScope(Singleton::class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
annotation class Driver</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> is used to declare which scope to be used if none is present</td>
</tr>
</table>
</div>

<h2 id="factories"><a class="anchor" href="#factories"></a>3.7 Bean Factories</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/factories.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In many cases, you may want to make available as a bean a class that is not part of your codebase such as those provided by third-party libraries. In this case, you cannot annotate the already compiled class. Instead, you should implement a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a>.</p>
</div>
<div class="paragraph">
<p>A factory is a class annotated with the <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> annotation that provides 1 or more methods annotated with a bean scope annotation. Which annotation you use depends on what scope you want the bean to be in. See the section on <a href="#scopes">bean scopes</a> for more information.</p>
</div>
<div class="paragraph">
<p>The return types of methods annotated with a bean scope annotation are the bean types. This is best illustrated by an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
class CrankShaft {
}

class V8Engine implements Engine {
    private final int cylinders = 8;
    private final CrankShaft crankShaft;

    public V8Engine(CrankShaft crankShaft) {
        this.crankShaft = crankShaft;
    }

    public String start() {
        return "Starting V8";
    }
}

@Factory
class EngineFactory {

    @Singleton
    Engine v8Engine(CrankShaft crankShaft) {
        return new V8Engine(crankShaft);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class CrankShaft {
}

class V8Engine implements Engine {
    final int cylinders = 8
    final CrankShaft crankShaft

    V8Engine(CrankShaft crankShaft) {
        this.crankShaft = crankShaft
    }

    String start() {
        "Starting V8"
    }
}

@Factory
class EngineFactory {

    @Singleton
    Engine v8Engine(CrankShaft crankShaft) {
        new V8Engine(crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
internal class CrankShaft

internal class V8Engine(private val crankShaft: CrankShaft) : Engine {
    private val cylinders = 8

    override fun start(): String {
        return "Starting V8"
    }
}

@Factory
internal class EngineFactory {

    @Singleton
    fun v8Engine(crankShaft: CrankShaft): Engine {
        return V8Engine(crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>V8Engine</code> is built by the <code>EngineFactory</code> class' <code>v8Engine</code> method. Note that you can inject parameters into the method and these parameters will be resolved as beans. The resulting <code>V8Engine</code> bean will be a singleton.</p>
</div>
<div class="paragraph">
<p>A factory can have multiple methods annotated with bean scope annotations, each one returning a distinct bean type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you take this approach, then you should not invoke other bean methods internally within the class. Instead, inject the types via parameters.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To allow the resulting bean to participate in the application context shutdown process, annotate the method with <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> and set the <code>preDestroy</code> argument to the name of the method that should be called to close the bean.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_nullability"><a class="anchor" href="#_nullability"></a>Nullability</h3>
<div class="paragraph">
<p>Factory methods can return null to allow for beans to be created conditionally. The use of <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> should always be the preferred method to conditionally create beans and returning null from a factory method should only be done if using <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> is not possible.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Engine {
    Integer getCylinders();
}

@EachProperty("engines")
public class EngineConfiguration implements Toggleable {

    private boolean enabled = true;
    private Integer cylinders;

    @NotNull
    public Integer getCylinders() {
        return cylinders;
    }

    public void setCylinders(Integer cylinders) {
        this.cylinders = cylinders;
    }

    @Override
    public boolean isEnabled() {
        return enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }

}

@Factory
public class EngineFactory {

    @EachBean(EngineConfiguration.class)
    public Engine buildEngine(EngineConfiguration engineConfiguration) {
        if (engineConfiguration.isEnabled()) {
            return engineConfiguration::getCylinders;
        } else {
            return null;
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface Engine {
    Integer getCylinders()
}

@EachProperty("engines")
class EngineConfiguration implements Toggleable {
    boolean enabled = true
    @NotNull
    Integer cylinders
}

@Factory
class EngineFactory {

    @EachBean(EngineConfiguration)
    Engine buildEngine(EngineConfiguration engineConfiguration) {
        if (engineConfiguration.enabled) {
            (Engine){ -&gt; engineConfiguration.cylinders }
        } else {
            null
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface Engine {
    fun getCylinders(): Int
}

@EachProperty("engines")
class EngineConfiguration : Toggleable {

    val enabled = true

    @NotNull
    val cylinders: Int? = null

    override fun isEnabled(): Boolean {
        return enabled
    }
}

@Factory
class EngineFactory {

    @EachBean(EngineConfiguration::class)
    fun buildEngine(engineConfiguration: EngineConfiguration): Engine? {
        return if (engineConfiguration.isEnabled) {
            object : Engine {
                override fun getCylinders(): Int {
                    return engineConfiguration.cylinders!!
                }
            }
        } else {
            null
        }
    }
}</code></pre>
</div>
</div>
</div>

<h2 id="conditionalBeans"><a class="anchor" href="#conditionalBeans"></a>3.8 Conditional Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/conditionalBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At times you may want a bean to load conditionally based on various potential factors including the classpath, the configuration, the presence of other beans etc.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation provides the ability to define one or many conditions on a bean.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public class JdbcBookService implements BookService {

    DataSource dataSource;

    public JdbcBookService(DataSource dataSource) {
        this.dataSource = dataSource;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
class JdbcBookService implements BookService {

    DataSource dataSource</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
class JdbcBookService(internal var dataSource: DataSource) : BookService {</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above bean defines two requirements. The first indicates that a <code>DataSource</code> bean must be present for the bean to load. The second requirement ensures that the <code>datasource.url</code> property is set before loading the <code>JdbcBookService</code> bean.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Kotlin currently does not support repeatable annotations. Use the <code>@Requirements</code> annotation when multiple requires are needed. For example, <code>@Requirements(Requires(&#8230;&#8203;), Requires(&#8230;&#8203;))</code>. See <a href="https://youtrack.jetbrains.com/issue/KT-12794" class="bare">https://youtrack.jetbrains.com/issue/KT-12794</a> to track this feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have multiple requirements that you find you may need to repeat on multiple beans then you can define a meta-annotation with the requirements:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.PACKAGE, ElementType.TYPE})
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public @interface RequiresJdbc {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.PACKAGE, ElementType.TYPE])
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
@interface RequiresJdbc {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Documented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.CLASS, AnnotationTarget.FILE)
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
annotation class RequiresJdbc</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example an annotation called <code>RequiresJdbc</code> is defined that can then be used on the <code>JdbcBookService</code> instead:</p>
</div>
<div class="listingblock">
<div class="title">Using a meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequiresJdbc
public class JdbcBookService implements BookService {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have multiple beans that need to fulfill a given requirement before loading then you may want to consider a bean configuration group, as explained in the next section.</p>
</div>
<div class="sect1">
<h2 id="_configuration_requirements"><a class="anchor" href="#_configuration_requirements"></a>Configuration Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> annotation is very flexible and can be used for a variety of use cases. The following table summarizes some of the possibilities:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Using @Requires</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Requirement</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one ore more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(classes=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one ore more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missing=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(beans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingBeans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to not be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(notEnv="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(configuration="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingConfigurations="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require particular SDK version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(sdk=Sdk.JAVA, value="1.8")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires classes annotated with the given annotations to be available to the application via package scanning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(entities=javax.persistence.Entity)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property with an optional value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(property="data-source.url")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property to not be part of the configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingProperty="data-source.url")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the presence of one of more files in the file system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(resources="file:/path/to/file")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the presence of one of more classpath resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(resources="classpath:myFile.properties")</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_additional_notes_on_property_requirements"><a class="anchor" href="#_additional_notes_on_property_requirements"></a>Additional Notes on Property Requirements.</h3>
<div class="paragraph">
<p>Adding a requirement on a property has some additional functionality. You can require the property to be a certain value, not be a certain value, and use a default in those checks if its not set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(property="foo") <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(property="foo", value="John") <i class="conum" data-value="2"></i><b>(2)</b>
@Requires(property="foo", value="John", defaultValue="John") <i class="conum" data-value="3"></i><b>(3)</b>
@Requires(property="foo", notEquals="Sally") <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Requires the property to be "yes", "YES", "true", "TRUE", "y" or "Y"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Requires the property to be "John"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Requires the property to be "John" or not set</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Requires the property to not be "Sally" or not set</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_conditional_beans"><a class="anchor" href="#_debugging_conditional_beans"></a>Debugging Conditional Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have multiple conditions and complex requirements it may become difficult to understand why a particular bean has not been loaded.</p>
</div>
<div class="paragraph">
<p>To help resolve issues with conditional beans you can enable debug logging for the <code>io.micronaut.context.condition</code> package which will log the reasons why beans were not loaded.</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="io.micronaut.context.condition" level="DEBUG"/&gt;</code></pre>
</div>
</div>
</div>
</div>

<h2 id="replaces"><a class="anchor" href="#replaces"></a>3.9 Bean Replacement</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/replaces.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>One significant difference between Micronaut&#8217;s Dependency Injection system and Spring is the way beans can be replaced.</p>
</div>
<div class="paragraph">
<p>In a Spring application, beans have names and can effectively be overridden simply by creating a bean with the same name, regardless of the type of the bean. Spring also has the notion of bean registration order, hence in Spring Boot you have <code>@AutoConfigureBefore</code> and <code>@AutoConfigureAfter</code> the control how beans override each other.</p>
</div>
<div class="paragraph">
<p>This strategy leads to difficult to debug problems, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bean loading order changes, leading to unexpected results</p>
</li>
<li>
<p>A bean with the same name overrides another bean with a different type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid these problems, Micronaut&#8217;s DI has no concept of bean names or load order. Beans have a type and a <a href="../api/io/micronaut/context/Qualifier.html">Qualifier</a>. You cannot override a bean of a completely different type with another.</p>
</div>
<div class="paragraph">
<p>A useful benefit of Spring&#8217;s approach is that it allows overriding existing beans to customize behaviour. In order to support the same ability, Micronaut&#8217;s DI provides an explicit <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation, which integrates nicely with support for <a href="#conditionalBeans">Conditional Beans</a> and clearly documents and expresses the intention of the developer.</p>
</div>
<div class="paragraph">
<p>Any existing bean can be replaced by another bean that declares <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a>. For example, consider the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public class JdbcBookService implements BookService {

    DataSource dataSource;

    public JdbcBookService(DataSource dataSource) {
        this.dataSource = dataSource;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
class JdbcBookService implements BookService {

    DataSource dataSource</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
class JdbcBookService(internal var dataSource: DataSource) : BookService {</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a class in <code>src/test/java</code> that replaces this class just for your tests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Replaces(JdbcBookService.class) <b class="conum">(1)</b>
@Singleton
public class MockBookService implements BookService {

    Map&lt;String, Book&gt; bookMap = new LinkedHashMap&lt;&gt;();

    @Override
    public Book findBook(String title) {
        return bookMap.get(title);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Replaces(JdbcBookService.class) <b class="conum">(1)</b>
@Singleton
class MockBookService implements BookService {

    Map&lt;String, Book&gt; bookMap = [:]

    @Override
    Book findBook(String title) {
        bookMap.get(title)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Replaces(JdbcBookService::class) <b class="conum">(1)</b>
@Singleton
class MockBookService : BookService {

    var bookMap: Map&lt;String, Book&gt; = LinkedHashMap()

    override fun findBook(title: String): Book? {
        return bookMap[title]
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>MockBookService</code> declares that it replaces <code>JdbcBookService</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_factory_replacement"><a class="anchor" href="#_factory_replacement"></a>Factory Replacement</h3>
<div class="paragraph">
<p>The <code>@Replaces</code> annotation also supports a <code>factory</code> argument. That argument allows the replacement of factory beans in their entirety or specific types created by the factory.</p>
</div>
<div class="paragraph">
<p>For example, it may be desired to replace all or part of the given factory class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
public class BookFactory {

    @Singleton
    Book novel() {
        return new Book("A Great Novel");
    }

    @Singleton
    TextBook textBook() {
        return new TextBook("Learning 101");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
class BookFactory {

    @Singleton
    Book novel() {
        new Book('A Great Novel')
    }

    @Singleton
    TextBook textBook() {
        new TextBook('Learning 101')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
class BookFactory {

    @Singleton
    internal fun novel(): Book {
        return Book("A Great Novel")
    }

    @Singleton
    internal fun textBook(): TextBook {
        return TextBook("Learning 101")
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
To replace a factory in its entirety, it is necessary that your factory methods match the return types of all of the methods in the replaced factory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, the <code>BookFactory#textBook()</code> will <strong>not</strong> be replaced because this factory does not have a factory method that returns a TextBook.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
@Replaces(factory = BookFactory.class)
public class CustomBookFactory {

    @Singleton
    Book otherNovel() {
        return new Book("An OK Novel");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
@Replaces(factory = BookFactory.class)
class CustomBookFactory {

    @Singleton
    Book otherNovel() {
        new Book('An OK Novel')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
@Replaces(factory = BookFactory::class)
class CustomBookFactory {

    @Singleton
    internal fun otherNovel(): Book {
        return Book("An OK Novel")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It may be the case that you don&#8217;t wish for the factory methods to be replaced, except for a select few. For that use case, you can apply the <code>@Replaces</code> annotation on the method and denote the factory that it should apply to.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
public class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook.class, factory = BookFactory.class)
    TextBook textBook() {
        return new TextBook("Learning 305");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook.class, factory = BookFactory.class)
    TextBook textBook() {
        new TextBook('Learning 305')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook::class, factory = BookFactory::class)
    internal fun textBook(): TextBook {
        return TextBook("Learning 305")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BookFactory#novel()</code> method will not be replaced because the TextBook class is defined in the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_implementation"><a class="anchor" href="#_default_implementation"></a>Default Implementation</h3>
<div class="paragraph">
<p>When exposing an API, it may be desirable for the default implementation of an interface to not be exposed as part of the public API. Doing so would prevent users from being able to replace the implementation because they would not be able to reference the class. The solution is to annotate the interface with <a href="../api/io/micronaut/context/annotation/DefaultImplementation.html">DefaultImplementation</a> to indicate which implementation should be replaced if a user creates a bean that <code>@Replaces(YourInterface.class)</code>.</p>
</div>
<div class="paragraph">
<p>For example consider:</p>
</div>
<div class="paragraph">
<p>A public API contract</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.DefaultImplementation;

@DefaultImplementation(DefaultResponseStrategy.class)
public interface ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.DefaultImplementation

@DefaultImplementation(DefaultResponseStrategy)
interface ResponseStrategy {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.DefaultImplementation

@DefaultImplementation(DefaultResponseStrategy::class)
interface ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default implementation</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;

@Singleton
class DefaultResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton

@Singleton
class DefaultResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton

@Singleton
internal class DefaultResponseStrategy : ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom implementation</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Replaces;
import javax.inject.Singleton;

@Singleton
@Replaces(ResponseStrategy.class)
public class CustomResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Replaces
import javax.inject.Singleton

@Singleton
@Replaces(ResponseStrategy)
class CustomResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Replaces
import javax.inject.Singleton

@Singleton
@Replaces(ResponseStrategy::class)
class CustomResponseStrategy : ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the <code>CustomResponseStrategy</code> will replace the <code>DefaultResponseStrategy</code> because the <a href="../api/io/micronaut/context/annotation/DefaultImplementation.html">DefaultImplementation</a> annotation points to the <code>DefaultResponseStrategy</code>.</p>
</div>
</div>

<h2 id="beanConfigurations"><a class="anchor" href="#beanConfigurations"></a>3.10 Bean Configurations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/beanConfigurations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A bean <a href="../api/io/micronaut/context/annotation/Configuration.html">@Configuration</a> is a grouping of multiple bean definitions within a package.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is applied at the package level and informs Micronaut that the beans defined with the package form a logical grouping.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is typically applied to <code>package-info</code> class. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Configuration
package my.package

import io.micronaut.context.annotation.Configuration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where this grouping becomes useful is when the bean configuration is made conditional via the <code>@Requires</code> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Configuration
@Requires(beans = javax.sql.DataSource)
package my.package</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, all bean definitions within the annotated package will only be loaded and made available if a <code>javax.sql.DataSource</code> bean is present. This allows you to implement conditional auto-configuration of bean definitions.</p>
</div>
<div class="paragraph">
<p>INFO: Java and Kotlin also support this functionality via <code>package-info.java</code>. Kotlin does not support a <code>package-info.kt</code> as of version 1.3.</p>
</div>

<h2 id="lifecycle"><a class="anchor" href="#lifecycle"></a>3.11 Life-Cycle Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/lifecycle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_when_the_context_starts"><a class="anchor" href="#_when_the_context_starts"></a>When The Context Starts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish for a particular method to be invoked when a bean is constructed then you can use the <code>javax.annotation.PostConstruct</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import javax.annotation.PostConstruct <i class="conum" data-value="1"></i><b>(1)</b>
import javax.inject.Singleton

@Singleton
class V8Engine implements Engine {
    int cylinders = 8
    boolean initialized = false <i class="conum" data-value="2"></i><b>(2)</b>

    String start() {
        if(!initialized) throw new IllegalStateException("Engine not initialized!")

        return "Starting V8"
    }

    @PostConstruct <i class="conum" data-value="3"></i><b>(3)</b>
    void initialize() {
        this.initialized = true
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PostConstruct</code> annotation is imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A field is defined that requires initialization</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A method is annotated with <code>@PostConstruct</code> and will be invoked once the object is constructed and fully injected.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_the_context_closes"><a class="anchor" href="#_when_the_context_closes"></a>When The Context Closes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish for a particular method to be invoked when the context is closed then you can use the <code>javax.annotation.PreDestroy</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import javax.annotation.PreDestroy <i class="conum" data-value="1"></i><b>(1)</b>
import java.util.concurrent.atomic.AtomicBoolean
import javax.inject.Singleton

@Singleton
class PreDestroyBean implements AutoCloseable {

    AtomicBoolean stopped = new AtomicBoolean(false)

    @PreDestroy <i class="conum" data-value="2"></i><b>(2)</b>
    @Override
    void close() throws Exception {
        stopped.compareAndSet(false, true)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PreDestroy</code> annotation is imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A method is annotated with <code>@PreDestroy</code> and will be invoked when the context is closed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For factory beans, the <code>preDestroy</code> value in the <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation can be used to tell Micronaut which method to invoke.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Factory

import javax.inject.Singleton

@Factory
class ConnectionFactory {

    @Bean(preDestroy = "stop") <i class="conum" data-value="1"></i><b>(1)</b>
    @Singleton
    Connection connection() {
        new Connection()
    }
}

import java.util.concurrent.atomic.AtomicBoolean

class Connection {

    AtomicBoolean stopped = new AtomicBoolean(false)

    void stop() { <i class="conum" data-value="2"></i><b>(2)</b>
        stopped.compareAndSet(false, true)
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>preDestroy</code> value is set on the annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation value matches the method name</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Just simply implementing the Closeable or AutoCloseable interfaces is not enough to get a bean to close with the context. One of the above methods must be used.
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="contextEvents"><a class="anchor" href="#contextEvents"></a>3.12 Context Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/contextEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports a general event system through the context. The <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> API is used to publish events and the <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> API is used to listen to events. The event system is not limited to the events that Micronaut publishes and can be used for custom events created by the users.</p>
</div>
<div class="sect2">
<h3 id="_publishing_events"><a class="anchor" href="#_publishing_events"></a>Publishing Events</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> API supports events of any type, however all events that Micronaut publishes extend <a href="../api/io/micronaut/context/event/ApplicationEvent.html">ApplicationEvent</a>.</p>
</div>
<div class="paragraph">
<p>To publish an event, obtain an instance of <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> either directly from the context or through dependency injection, and execute the <code>publishEvent</code> method with your event object.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing an Event</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleEvent {
    private String message = "Something happened";

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}

import io.micronaut.context.event.ApplicationEventPublisher;
import javax.inject.Inject;
import javax.inject.Singleton;

@Singleton
public class SampleEventEmitterBean {

    @Inject
    ApplicationEventPublisher eventPublisher;

    public void publishSampleEvent() {
        eventPublisher.publishEvent(new SampleEvent());
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing an Event</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class SampleEvent {
    String message = "Something happened"
}

import io.micronaut.context.event.ApplicationEventPublisher
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class SampleEventEmitterBean {

    @Inject
    ApplicationEventPublisher eventPublisher

    void publishSampleEvent() {
        eventPublisher.publishEvent(new SampleEvent())
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing an Event</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">data class SampleEvent(val message: String = "Something happened")

import io.micronaut.context.event.ApplicationEventPublisher
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class SampleEventEmitterBean {

    @Inject
    internal var eventPublisher: ApplicationEventPublisher? = null

    fun publishSampleEvent() {
        eventPublisher!!.publishEvent(SampleEvent())
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Publishing an event is <strong>synchronous</strong> by default! The <code>publishEvent</code> method will not return until all listeners have been executed. Move this work off to a thread pool if it is time intensive.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_listening_for_events"><a class="anchor" href="#_listening_for_events"></a>Listening for Events</h3>
<div class="paragraph">
<p>To listen to an event, register a bean that implements <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> where the generic type is the type of event the listener should be executed for.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.event.ApplicationEventListener;
import io.micronaut.docs.context.events.SampleEvent;

@Singleton
public class SampleEventListener implements ApplicationEventListener&lt;SampleEvent&gt; {
    private int invocationCounter = 0;

    @Override
    public void onApplicationEvent(SampleEvent event) {
        invocationCounter++;
    }

    public int getInvocationCounter() {
        return invocationCounter;
    }
}

import io.micronaut.context.ApplicationContext;
import io.micronaut.docs.context.events.SampleEventEmitterBean;
import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class SampleEventListenerSpec {

    @Test
    public void testEventListenerIsNotified() {
        ApplicationContext context = ApplicationContext.run();
        SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean.class);
        SampleEventListener listener = context.getBean(SampleEventListener.class);
        assertEquals(0, listener.getInvocationCounter());
        emitter.publishSampleEvent();
        assertEquals(1, listener.getInvocationCounter());
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.event.ApplicationEventListener
import io.micronaut.docs.context.events.SampleEvent

@Singleton
class SampleEventListener implements ApplicationEventListener&lt;SampleEvent&gt; {
    int invocationCounter = 0

    @Override
    void onApplicationEvent(SampleEvent event) {
        invocationCounter++
    }
}

import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import spock.lang.Specification

class SampleEventListenerSpec extends Specification {

    void "test event listener is notified"() {
        given:
        ApplicationContext context = ApplicationContext.run()
        SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean)
        SampleEventListener listener = context.getBean(SampleEventListener)
        assert listener.invocationCounter == 0

        when:
        emitter.publishSampleEvent()

        then:
        listener.invocationCounter == 1
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.event.ApplicationEventListener
import io.micronaut.docs.context.events.SampleEvent

@Singleton
class SampleEventListener : ApplicationEventListener&lt;SampleEvent&gt; {
    var invocationCounter = 0

    override fun onApplicationEvent(event: SampleEvent) {
        invocationCounter++
    }
}

import io.kotlintest.shouldBe
import io.kotlintest.specs.AnnotationSpec
import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean

class SampleEventListenerSpec : AnnotationSpec() {

    @Test
    fun testEventListenerWasNotified() {
        val context = ApplicationContext.run()
        val emitter = context.getBean(SampleEventEmitterBean::class.java)
        val listener = context.getBean(SampleEventListener::class.java)
        listener.invocationCounter.shouldBe(0)
        emitter.publishSampleEvent()
        listener.invocationCounter.shouldBe(1)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/context/event/ApplicationEventListener.html#supports-E-">supports</a> method can be overridden to further clarify events that should be processed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively you can use the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation if you do not wish to specifically implement an interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.docs.context.events.SampleEvent;
import io.micronaut.runtime.event.annotation.EventListener;

@Singleton
public class SampleEventListener {
    private int invocationCounter = 0;

    @EventListener
    public void onSampleEvent(SampleEvent event) {
        invocationCounter++;
    }

    public int getInvocationCounter() {
        return invocationCounter;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener

@Singleton
class SampleEventListener {
    int invocationCounter = 0

    @EventListener
    void onSampleEvent(SampleEvent event) {
        invocationCounter++
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener

@Singleton
class SampleEventListener {
    var invocationCounter = 0

    @EventListener
    internal fun onSampleEvent(event: SampleEvent) {
        invocationCounter++
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your listener performs work that could take a while then you can use the <a href="../api/io/micronaut/scheduling/annotation/Async.html">@Async</a> annotation to run the operation on a separate thread:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.docs.context.events.SampleEvent;
import io.micronaut.runtime.event.annotation.EventListener;
import io.micronaut.scheduling.annotation.Async;

@Singleton
public class SampleEventListener {
    private AtomicInteger invocationCounter = new AtomicInteger(0);

    @EventListener
    @Async
    public void onSampleEvent(SampleEvent event) {
        invocationCounter.getAndIncrement();
    }

    public int getInvocationCounter() {
        return invocationCounter.get();
    }
}

import io.micronaut.context.ApplicationContext;
import io.micronaut.docs.context.events.SampleEventEmitterBean;
import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static java.util.concurrent.TimeUnit.SECONDS;
import static org.awaitility.Awaitility.await;
import static org.hamcrest.Matchers.equalTo;

public class SampleEventListenerSpec {

    @Test
    public void testEventListenerIsNotified() {
        ApplicationContext context = ApplicationContext.run();
        SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean.class);
        SampleEventListener listener = context.getBean(SampleEventListener.class);
        assertEquals(0, listener.getInvocationCounter());
        emitter.publishSampleEvent();
        await().atMost(10, SECONDS).until(listener::getInvocationCounter, equalTo(1));
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener
import io.micronaut.scheduling.annotation.Async

@Singleton
class SampleEventListener {
    AtomicInteger invocationCounter = new AtomicInteger(0)

    @EventListener
    @Async
    void onSampleEvent(SampleEvent event) {
        invocationCounter.getAndIncrement()
    }
}

import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import spock.lang.Specification
import spock.util.concurrent.PollingConditions

class SampleEventListenerSpec extends Specification {

    void "test event listener is notified"() {
        given:
        ApplicationContext context = ApplicationContext.run()
        SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean)
        SampleEventListener listener = context.getBean(SampleEventListener)
        assert listener.invocationCounter.get() == 0

        when:
        emitter.publishSampleEvent()

        then:
        new PollingConditions().eventually {
            listener.invocationCounter.get() == 1
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener
import io.micronaut.scheduling.annotation.Async
import java.util.concurrent.atomic.AtomicInteger

@Singleton
open class SampleEventListener {

    var invocationCounter = AtomicInteger(0)

    @EventListener
    @Async
    open fun onSampleEvent(event: SampleEvent) {
        println("Incrementing invocation counter...")
        invocationCounter.getAndIncrement()
    }
}

import io.kotlintest.eventually
import io.kotlintest.seconds
import io.kotlintest.shouldBe
import io.kotlintest.specs.AnnotationSpec
import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import org.opentest4j.AssertionFailedError

class SampleEventListenerSpec : AnnotationSpec() {

    @Test
//    @Ignore // TODO can't get this to pass on CI, any help is welcome
    fun testEventListenerWasNotified() {
        val context = ApplicationContext.run()
        val emitter = context.getBean(SampleEventEmitterBean::class.java)
        val listener = context.getBean(SampleEventListener::class.java)
        listener.invocationCounter.get().shouldBe(0)
        emitter.publishSampleEvent()

        eventually(5.seconds,  AssertionFailedError::class.java) {
            println("Current value of counter: " + listener.invocationCounter.get())
            listener.invocationCounter.get().shouldBe(1)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event listener will by default run on the <code>scheduled</code> executor. You can configure this thread pool as required in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Scheduled Task Thread Pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    executors:
        scheduled:
            type: scheduled
            core-pool-size: 30</code></pre>
</div>
</div>
</div>

<h2 id="events"><a class="anchor" href="#events"></a>3.13 Bean Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/events.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can hook into the creation of beans using one of the following interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/context/event/BeanInitializedEventListener.html">BeanInitializedEventListener</a> - allows modifying or replacing of a bean after the properties have been set but prior to <code>@PostConstruct</code> event hooks.</p>
</li>
<li>
<p><a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> - allows modifying or replacing of a bean after the bean is fully initialized and all <code>@PostConstruct</code> hooks called.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>BeanInitializedEventListener</code> interface is commonly used in combination with <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> beans. Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class V8Engine implements Engine {
    private final int cylinders = 8;
    private double rodLength; <b class="conum">(1)</b>

    public V8Engine(double rodLength) {
        this.rodLength = rodLength;
    }

    public String start() {
        return "Starting V" + String.valueOf(getCylinders()) + " [rodLength=" + String.valueOf(getRodLength()) + "]";
    }

    public final int getCylinders() {
        return cylinders;
    }

    public double getRodLength() {
        return rodLength;
    }

    public void setRodLength(double rodLength) {
        this.rodLength = rodLength;
    }
}

@Factory
public class EngineFactory {

    private V8Engine engine;
    private double rodLength = 5.7;

    @PostConstruct
    public void initialize() {
        engine = new V8Engine(rodLength); <b class="conum">(2)</b>
    }

    @Singleton
    public Engine v8Engine() {
        return engine;<b class="conum">(3)</b>
    }

    public void setRodLength(double rodLength) {
        this.rodLength = rodLength;
    }
}

@Singleton
public class EngineInitializer implements BeanInitializedEventListener&lt;EngineFactory&gt; { <b class="conum">(4)</b>
    @Override
    public EngineFactory onInitialized(BeanInitializingEvent&lt;EngineFactory&gt; event) {
        EngineFactory engineFactory = event.getBean();
        engineFactory.setRodLength(6.6);<b class="conum">(5)</b>
        return ((EngineFactory) (event.getBean()));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class V8Engine implements Engine {
    final int cylinders = 8
    double rodLength <b class="conum">(1)</b>

    String start() {
        return "Starting V${cylinders} [rodLength=$rodLength]"
    }
}

@Factory
class EngineFactory {
    private V8Engine engine
    double rodLength = 5.7

    @PostConstruct
    void initialize() {
        engine = new V8Engine(rodLength: rodLength) <b class="conum">(2)</b>
    }

    @Singleton
    Engine v8Engine() {
        return engine <b class="conum">(3)</b>
    }
}

@Singleton
class EngineInitializer implements BeanInitializedEventListener&lt;EngineFactory&gt; { <b class="conum">(4)</b>
    @Override
    EngineFactory onInitialized(BeanInitializingEvent&lt;EngineFactory&gt; event) {
        EngineFactory engineFactory = event.bean
        engineFactory.rodLength = 6.6 <b class="conum">(5)</b>
        return event.bean
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class V8Engine(var rodLength: Double) : Engine {  <b class="conum">(1)</b>

    override val cylinders = 8

    override fun start(): String {
        return "Starting V$cylinders [rodLength=$rodLength]"
    }
}

@Factory
class EngineFactory {

    private var engine: V8Engine? = null
    private var rodLength = 5.7

    @PostConstruct
    fun initialize() {
        engine = V8Engine(rodLength) <b class="conum">(2)</b>
    }

    @Singleton
    fun v8Engine(): Engine? {
        return engine<b class="conum">(3)</b>
    }

    fun setRodLength(rodLength: Double) {
        this.rodLength = rodLength
    }
}

@Singleton
class EngineInitializer : BeanInitializedEventListener&lt;EngineFactory&gt; { <b class="conum">(4)</b>
    override fun onInitialized(event: BeanInitializingEvent&lt;EngineFactory&gt;): EngineFactory {
        val engineFactory = event.bean
        engineFactory.setRodLength(6.6)<b class="conum">(5)</b>
        return event.bean as EngineFactory
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>V8Engine</code> class defines a <code>rodLength</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EngineFactory</code> initializes the value of <code>rodLength</code> and creates the instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The created instance is returned as a <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>BeanInitializedEventListener</code> interface is implemented to listen for the initialization of the factory</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Within the <code>onInitialized</code> method the <code>rodLength</code> is overridden prior to the engine being created by the factory bean.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> interface is more typically used to decorate or enhance a fully initialized bean by creating a proxy for example.</p>
</div>

<h2 id="introspection"><a class="anchor" href="#introspection"></a>3.14 Bean Introspection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/introspection.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 1.1, a compilation time replacement for the JDK&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html">Introspector</a> class has been included.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/beans/BeanIntrospector.html">BeanIntrospector</a> and <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> interfaces allow looking up bean introspections that allow you to instantiate and read/write bean properties without using reflection or caching reflective metadata which consumes excessive memory for large beans.</p>
</div>
<div class="sect2">
<h3 id="_making_a_bean_available_for_introspection"><a class="anchor" href="#_making_a_bean_available_for_introspection"></a>Making a Bean Available for Introspection</h3>
<div class="paragraph">
<p>Unlike the JDK&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html">Introspector</a> every class is not automatically available for introspection, to make a class available for introspection you must as a minimum enable Micronaut&#8217;s annotation processor (<code>micronaut-inject-java</code> for Java and Kotlin and <code>micronaut-inject-groovy</code> for Groovy) in your build and ensure you have a runtime time dependency on <code>micronaut-core</code>.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">annotationProcessor <span class="hljs-string">'io.micronaut:micronaut-inject-java:1.2.3.BUILD-SNAPSHOT'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-inject-java&lt;/artifactId&gt;
        &lt;version&gt;1.2.3.BUILD-SNAPSHOT&lt;/version&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin the <code>micronaut-inject-java</code> dependency should be in <code>kapt</code> scope and for Groovy you should have <code>micronaut-inject-groovy</code> in <code>compileOnly</code> scope.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">runtime <span class="hljs-string">'io.micronaut:micronaut-core:1.2.3.BUILD-SNAPSHOT'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-core&lt;/artifactId&gt;
    &lt;version&gt;1.2.3.BUILD-SNAPSHOT&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Once your build is configured you have a few ways to generate introspection data.</p>
</div>
<div class="sect3">
<h4 id="_use_the_code_introspected_code_annotation"><a class="anchor" href="#_use_the_code_introspected_code_annotation"></a>Use the <code>@Introspected</code> Annotation</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation can be used on any class which you want to make available for introspecton, simply annotate the class with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected
public class Person {

    private String name;
    private int age = 18;

    public Person(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import groovy.transform.Canonical
import io.micronaut.core.annotation.Introspected

@Introspected
@Canonical
class Person {

    String name
    int age = 18

    Person(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Introspected

@Introspected
data class Person(var name : String) {
    var age : Int = 18
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once introspection data has been produced at compilation time you can then retrieve it via the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final BeanIntrospection&lt;Person&gt; introspection = BeanIntrospection.getIntrospection(Person.class); <b class="conum">(1)</b>
        Person person = introspection.instantiate("John"); <b class="conum">(2)</b>
        System.out.println("Hello " + person.getName());

        final BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String.class); <b class="conum">(3)</b>
        property.set(person, "Fred"); <b class="conum">(4)</b>
        String name = property.get(person); <b class="conum">(5)</b>
        System.out.println("Hello " + person.getName());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        def introspection = BeanIntrospection.getIntrospection(Person) <b class="conum">(1)</b>
        Person person = introspection.instantiate("John") <b class="conum">(2)</b>
        println("Hello ${person.name}")

        BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String) <b class="conum">(3)</b>
        property.set(person, "Fred") <b class="conum">(4)</b>
        String name = property.get(person) <b class="conum">(5)</b>
        println("Hello ${person.name}")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val introspection = BeanIntrospection.getIntrospection(Person::class.java) <b class="conum">(1)</b>
        val person : Person = introspection.instantiate("John") <b class="conum">(2)</b>
        print("Hello ${person.name}")

        val property : BeanProperty&lt;Person, String&gt; = introspection.getRequiredProperty("name", String::class.java) <b class="conum">(3)</b>
        property.set(person, "Fred") <b class="conum">(4)</b>
        val name = property.get(person) <b class="conum">(5)</b>
        print("Hello ${person.name}")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can retrieve a <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> with the <code>getIntrospection</code> static method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Once you have a <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> you can instantiate a bean with the <code>instantiate</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A <a href="../api/io/micronaut/core/beans/BeanProperty.html">BeanProperty</a> can be retreived from the introspection</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>.. and the <code>set</code> method used to set the property value</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>.. and the <code>get</code> method used to retrieve the property value</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_use_the_code_introspected_code_annotation_on_a_configuration_class"><a class="anchor" href="#_use_the_code_introspected_code_annotation_on_a_configuration_class"></a>Use the <code>@Introspected</code> Annotation on a Configuration Class</h4>
<div class="paragraph">
<p>If the class you wish to introspect is already compiled and not under your control an alternative option is to define a configuration class with the <code>classes</code> member of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation set.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected(classes = Person.class)
public class PersonConfiguration {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.annotation.Introspected

@Introspected(classes = Person)
class PersonConfiguration {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Introspected

@Introspected(classes = [Person::class])
class PersonConfiguration</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the <code>PersonConfiguration</code> class will generate introspections for the <code>Person</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use the <code>packages</code> member of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> which will package scan at compilation time and generate introspections for all classes within a package. Note however this feature is currently regarded as experimental.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_write_a_code_annotationmapper_code_to_introspect_existing_annotations"><a class="anchor" href="#_write_a_code_annotationmapper_code_to_introspect_existing_annotations"></a>Write a <code>AnnotationMapper</code> to Introspect Existing Annotations</h4>
<div class="paragraph">
<p>If there is an existing annotation that you wish to introspect by default you can write an <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a>.</p>
</div>
<div class="paragraph">
<p>An example of this is <a href="https://github.com/micronaut-projects/micronaut-core/blob/master/inject/src/main/java/io/micronaut/inject/beans/visitor/EntityIntrospectedAnnotationMapper.java">EntityIntrospectedAnnotationMapper</a> which ensures all beans annotated with <code>javax.persistence.Entity</code> are introspectable by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>AnnotationMapper</code> should be on the annotation processor classpath.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_beanwrapper_api"><a class="anchor" href="#_the_beanwrapper_api"></a>The BeanWrapper API</h3>
<div class="paragraph">
<p>A <a href="../api/io/micronaut/core/beans/BeanProperty.html">BeanProperty</a> provides raw access to read and write a property value for a given class and does not provide any automatic type conversion.</p>
</div>
<div class="paragraph">
<p>It is expected that the values you pass to the <code>set</code> and <code>get</code> methods match the underlying property type otherwise an exception will occur.</p>
</div>
<div class="paragraph">
<p>To provide additional type conversion smarts the <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> interface allows wrapping an existing bean instance and setting and getting properties from the bean, plus performing type conversion as necessary.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final BeanWrapper&lt;Person&gt; wrapper = BeanWrapper.getWrapper(new Person("Fred")); <b class="conum">(1)</b>

        wrapper.setProperty("age", "20"); <b class="conum">(2)</b>
        int newAge = wrapper.getRequiredProperty("age", int.class); <b class="conum">(3)</b>

        System.out.println("Person's age now " + newAge);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        final BeanWrapper&lt;Person&gt; wrapper = BeanWrapper.getWrapper(new Person("Fred")) <b class="conum">(1)</b>

        wrapper.setProperty("age", "20") <b class="conum">(2)</b>
        int newAge = wrapper.getRequiredProperty("age", Integer) <b class="conum">(3)</b>

        println("Person's age now $newAge")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val wrapper = BeanWrapper.getWrapper(Person("Fred")) <b class="conum">(1)</b>

        wrapper.setProperty("age", "20") <b class="conum">(2)</b>
        val newAge = wrapper.getRequiredProperty("age", Int::class.java) <b class="conum">(3)</b>

        println("Person's age now $newAge")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>getWrapper</code> static method can be used to obtain a <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> for a bean instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can set properties and the <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> will perform type conversion, or throw <a href="../api/io/micronaut/core/convert/exceptions/ConversionErrorException.html">ConversionErrorException</a> if conversion is not possible.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can retrieve a property using <code>getRequiredProperty</code> and request the appropriate type. If the property doesn&#8217;t exist a <a href="../api/io/micronaut/core/beans/exceptions/IntrospectionException.html">IntrospectionException</a> will be thrown and if it cannot be converted a <a href="../api/io/micronaut/core/convert/exceptions/ConversionErrorException.html">ConversionErrorException</a> will be thrown.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jackson_and_bean_introspection"><a class="anchor" href="#_jackson_and_bean_introspection"></a>Jackson and Bean Introspection</h3>
<div class="paragraph">
<p>You can enable bean introspection integration with Jackson for reflection-free JSON serialization and deserialization using the <code>jackson.bean-introspection-module</code> setting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is currently regarded as experimental and may be subject to changes in the future.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Enabling Jackson Bean Introspection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
    bean-introspection-module: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above configuration in place Jackson will be configured to use the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API to read and write property values and construct objects resulting in reflection-free serialization/deserialization which is benefitial from a performance perspective and requires less configuring to operate correctly with runtimes such as GraalVM native.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently only bean properties (private field with public getter/setter) are supported and usage of public fields is not supported.
</td>
</tr>
</table>
</div>
</div>

<h2 id="beanValidation"><a class="anchor" href="#beanValidation"></a>3.15 Bean Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/beanValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 1.2, Micronaut has built-in support for validating beans that are annotated with <code>javax.validation</code> annotations. As a minimum you should include the <code>micronaut-validation</code> module as a compile dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut:micronaut-validation'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Note that Micronaut&#8217;s implementation is not currently fully compliant with the <a href="https://beanvalidation.org/2.0/spec/">Bean Validator specification</a> as the specification heavily relies on reflection-based APIs.</p>
</div>
<div class="paragraph">
<p>The following features are unsupported at this time:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotations on generic argument types since only the Java language supports this feature.</p>
</li>
<li>
<p>Any interaction with the <a href="https://beanvalidation.org/2.0/spec/#constraintmetadata">constraint metadata API</a>, since Micronaut uses already computed compilation time metadata.</p>
</li>
<li>
<p>XML-based configuration</p>
</li>
<li>
<p>Instead of using <code>javax.validation.ConstraintValidator</code> you should use <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> to define custom constraints, which supports validating annotations as compilation time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s implementation includes the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reflection and Runtime Proxy free validation resulting in reduced memory consumption</p>
</li>
<li>
<p>Smaller JAR size since Hibernate Validator adds another 1.4MB</p>
</li>
<li>
<p>Faster startup since Hibernate Validator adds 200ms+ startup overhead</p>
</li>
<li>
<p>Configurability via Annotation Metadata</p>
</li>
<li>
<p>Support for Reactive Bean Validation</p>
</li>
<li>
<p>Support for validating the source AST at compilation time</p>
</li>
<li>
<p>Automatic compatibility with GraalVM native without additional configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you require full Bean Validator 2.0 compliance you can add the <code>micronaut-hibernate-validator</code> module to your classpath, which will replace Micronaut&#8217;s implementation.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut.configuration:micronaut-hibernate-validator'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.configuration&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="sect2">
<h3 id="_validating_bean_methods"><a class="anchor" href="#_validating_bean_methods"></a>Validating Bean Methods</h3>
<div class="paragraph">
<p>You can validate methods of any class declared as a Micronaut bean simply by using the <code>javax.validation</code> annotation as arguments:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;
import javax.validation.constraints.NotBlank;

@Singleton
public class PersonService {
    public void sayHello(@NotBlank String name) {
        System.out.println("Hello " + name);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton
import javax.validation.constraints.NotBlank

@Singleton
class PersonService {

    void sayHello(@NotBlank String name) {
        println "Hello $name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton
import javax.validation.constraints.NotBlank


@Singleton
open class PersonService {
    open fun sayHello(@NotBlank name: String) {
        println("Hello $name")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example declares that the <code>@NotBlank</code> annotation should be validated when executing the <code>sayHello</code> method.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you are using Kotlin the class and method must be declared open so that Micronaut can create a compilation time subclass, alternatively you can annotate the class with <a href="../api/io/micronaut/validation/Validated.html">@Validated</a> and configure the Kotlin <code>all-open</code> plugin to open classes annotated with this type. See the <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html">Compiler plugins</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a validation error occurs a <code>javax.validation.ConstraintViolationException</code> will be thrown. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

import javax.inject.Inject;
import javax.validation.ConstraintViolationException;

@MicronautTest
class PersonServiceSpec {

    @Inject PersonService personService;

    @Test
    void testThatNameIsValidated() {
        final ConstraintViolationException exception =
                assertThrows(ConstraintViolationException.class, () -&gt;
                personService.sayHello("") <b class="conum">(1)</b>
        );

        assertEquals("sayHello.name: must not be blank", exception.getMessage()); <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.test.annotation.MicronautTest
import spock.lang.Specification

import javax.inject.Inject
import javax.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec extends Specification {

    @Inject PersonService personService

    void "test person name is validated"() {
        when:"The sayHello method is called with a blank string"
        personService.sayHello("") <b class="conum">(1)</b>

        then:"A validation error occurs"
        def e = thrown(ConstraintViolationException)
        e.message == "sayHello.name: must not be blank" //  <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.test.annotation.MicronautTest
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.Assertions.*

import javax.inject.Inject
import javax.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec {

    @Inject
    lateinit var personService: PersonService

    @Test
    fun testThatNameIsValidated() {
        val exception = assertThrows(ConstraintViolationException::class.java
        ) { personService.sayHello("") } <b class="conum">(1)</b>

        assertEquals("sayHello.name: must not be blank", exception.message) <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is called with a blank string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An exception occurs</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_data_classes"><a class="anchor" href="#_validating_data_classes"></a>Validating Data Classes</h3>
<div class="paragraph">
<p>If you wish to validate data classes, such as POJOs and so on, typically used in JSON interchange, the class must be annotated with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> (see the previous section on <a href="#introspection">Bean Introspection</a>) or if the class is external be imported by the <code>@Introspected</code> annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Introspected;
import javax.validation.constraints.*;

@Introspected
public class Person {
    private String name;
    @Min(18)
    private int age;

    @NotBlank
    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.annotation.Introspected

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Introspected
class Person {
    @NotBlank
    String name
    @Min(18l)
    int age
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Introspected
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Introspected
data class Person(
    @field:NotBlank var name: String,
    @field:Min(18) var age: Int
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation can be used as a meta-annotation and common annotations like <code>@javax.persistence.Entity</code> are treated as <code>@Introspected</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example defines a class called <code>Person</code> that has 2 properties (<code>name</code> and <code>age</code>) that have constraints applied to them. Note that in Java the annotations can be on the field or the getter and with Kotlin data classes the annotation should target the field.</p>
</div>
<div class="paragraph">
<p>If you wish to validate the class manually then you can inject an instance of <a href="../api/io/micronaut/validation/validator/Validator.html">Validator</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
Validator validator;

@Test
void testThatPersonIsValidWithValidator() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final Set&lt;ConstraintViolation&lt;Person&gt;&gt; constraintViolations = validator.validate(person);

    assertEquals(2, constraintViolations.size()); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Inject Validator validator

void "test person is validated with validator"() {
    when:"The person is validated"
    def constraintViolations = validator.validate(new Person(name: "", age: 10)) <b class="conum">(1)</b>

    then:"A validation error occurs"
    constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var validator: Validator

@Test
fun testThatPersonIsValidWithValidator() {
    val person = Person("", 10)
    val constraintViolations = validator.validate(person)

    assertEquals(2, constraintViolations.size) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The validator is used to validate the person</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively on Bean methods you can use <code>javax.validation.Valid</code> to trigger cascading validation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class PersonService {
    public void sayHello(@Valid Person person) {
        System.out.println("Hello " + person.getName());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class PersonService {
    void sayHello(@Valid Person person) {
        println "Hello $person.name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
open class PersonService {
    open fun sayHello(@Valid person: Person) {
        println("Hello ${person.name}")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonService</code> will now validate the <code>Person</code> class when invoked:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
PersonService personService;

@Test
void testThatPersonIsValid() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    personService.sayHello(person) <b class="conum">(1)</b>
            );

    assertEquals(2, exception.getConstraintViolations().size()); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Inject PersonService personService

void "test person name is validated"() {
    when:"The sayHello method is called with an invalid person"
    personService.sayHello(new Person(name: "", age: 10)) <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var personService: PersonService

@Test
fun testThatPersonIsValid() {
    val person = Person("", 10)
    val exception = assertThrows(ConstraintViolationException::class.java  <b class="conum">(1)</b>
    ) { personService.sayHello(person) }

    assertEquals(2, exception.constraintViolations.size) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A validated method is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_configuration_properties"><a class="anchor" href="#_validating_configuration_properties"></a>Validating Configuration Properties</h3>
<div class="paragraph">
<p>You can also validate the properties of classes that are annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> to ensure configuration is correct.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended that you annotate <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> that features validation with <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> to ensure that the validation occurs at startup time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_defining_additional_constraints"><a class="anchor" href="#_defining_additional_constraints"></a>Defining Additional Constraints</h3>
<div class="paragraph">
<p>To define additional constraints you can define a new annotation, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.validation.Constraint;
import java.lang.annotation.*;

import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = { }) <b class="conum">(1)</b>
public @interface DurationPattern {

    String message() default "invalid duration ({validatedValue})"; <b class="conum">(2)</b>

    /**
     * Defines several constraints on the same element.
     */
    @Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
    @Retention(RUNTIME)
    @Documented
    @interface List {
        DurationPattern[] value(); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.validation.Constraint
import java.lang.annotation.*

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Retention(RUNTIME)
@Constraint(validatedBy = []) <b class="conum">(1)</b>
@interface DurationPattern {
    String message() default "invalid duration ({validatedValue})" <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.validation.Constraint

@Retention(AnnotationRetention.RUNTIME)
@Constraint(validatedBy = []) <b class="conum">(1)</b>
annotation class DurationPattern(
    val message: String = "invalid duration ({validatedValue})" <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation should be annotated with <code>javax.validation.Constraint</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>message</code> template can be provided in a hard coded manner as above. If none is specified Micronaut will try to find a message using <code>ClassName.message</code> using the <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> interface. (optional)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To support repeated annotations you can define a inner annotation (optional).</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add messages and message bundles using the <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> and <a href="../api/io/micronaut/context/i18n/ResourceBundleMessageSource.html">ResourceBundleMessageSource</a> classes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined the annotation you need to implement a <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> that validates the annotation. You can either implement a bean that implements the interace directly or define a factory that returns one or more validators.</p>
</div>
<div class="paragraph">
<p>The latter approach is recommended if you plan to define multiple validators:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Factory;
import io.micronaut.validation.validator.constraints.ConstraintValidator;
import javax.inject.Singleton;

@Factory
public class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, CharSequence&gt; durationPatternValidator() {
        return (value, annotationMetadata, context) -&gt;
                value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.*
import javax.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, CharSequence&gt; durationPatternValidator() {
        return { CharSequence value,
                 AnnotationValue&lt;DurationPattern&gt; annotation,
                 ConstraintValidatorContext context -&gt;
            return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
        } as ConstraintValidator&lt;DurationPattern, CharSequence&gt;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import io.micronaut.validation.validator.constraints.ConstraintValidator
import javax.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    fun durationPatternValidator() : ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
        return ConstraintValidator { value, annotation, context -&gt;
            value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example implements a validator that validates any field, parameter etc. that is annotated with <code>DurationPattern</code>, ensuring that the string can be parsed with <code>java.time.Duration.parse</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generally <code>null</code> is regarded as valid and <code>@NotNull</code> used to constrain a value as not being <code>null</code>. The example above regards <code>null</code> as a valid value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class HolidayService {

    public String startHoliday(@NotBlank String person,
                        @DurationPattern String duration) {
        final Duration d = Duration.parse(duration);
        return "Person " + person + " is off on holiday for " + d.toMinutes() + " minutes";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class HolidayService {

    String startHoliday(@NotBlank String person,
                        @DurationPattern String duration) {
        final Duration d = Duration.parse(duration)
        return "Person $person is off on holiday for ${d.toMinutes()} minutes"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
open class HolidayService {

    open fun startHoliday( @NotBlank person: String,
                           @DurationPattern duration: String): String {
        val d = Duration.parse(duration)
        val mins = d.toMinutes()
        return "Person $person is off on holiday for $mins minutes"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the above examples validates the <code>duration</code> parameter you can define a test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject HolidayService holidayService;

@Test
void testCustomValidator() {
    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    holidayService.startHoliday("Fred", "junk")
            );

    assertEquals("startHoliday.duration: invalid duration (junk)", exception.getMessage()); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void "test test custom validator"() {
    when:"A custom validator is used"
    holidayService.startHoliday("Fred", "junk") <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.message == "startHoliday.duration: invalid duration (junk)" //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var holidayService: HolidayService

@Test
fun testCustomValidator() {
    val exception = assertThrows(ConstraintViolationException::class.java
    ) { holidayService.startHoliday("Fred", "junk") }

    assertEquals("startHoliday.duration: invalid duration (junk)", exception.message) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validating_annotations_at_compilation_time"><a class="anchor" href="#_validating_annotations_at_compilation_time"></a>Validating Annotations at Compilation Time</h3>
<div class="paragraph">
<p>You can use Micronaut&#8217;s validator to validate annotation usages at compilation time. To do so you should include <code>micronaut-validation</code> in the annotation processor classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">annotationProcessor <span class="hljs-string">'io.micronaut:micronaut-validation'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Once this is done Micronaut will at compilation validate annotation values that are themselves annotated with <code>javax.validation</code>. For example consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.lang.annotation.*;

@Retention(RetentionPolicy.RUNTIME)
public @interface TimeOff {
    @DurationPattern
    String duration();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import java.lang.annotation.*

@Retention(RetentionPolicy.RUNTIME)
@interface TimeOff {
    @DurationPattern
    String duration()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Retention(AnnotationRetention.RUNTIME)
annotation class TimeOff(
    @DurationPattern val duration: String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your attempt to use <code>@TimeOff(duration="junk")</code> in your source Micronaut will fail compilation due to the value of <code>duration</code> violating the <code>DurationPattern</code> constraint.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>duration</code> is a property placeholder such as <code>@TimeOff(duration="${my.value}")</code> then validation handling will be deferred until runtime.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that if you wish to allow use of a custom <code>ConstraintValidator</code> at compilation time you should instead define the validator as a class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.AnnotationValue;
import io.micronaut.validation.validator.constraints.*;
import javax.annotation.*;

public class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    public boolean isValid(
            @Nullable CharSequence value,
            @Nonnull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @Nonnull ConstraintValidatorContext context) {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.*
import javax.annotation.*

class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    boolean isValid(
            @Nullable CharSequence value,
            @Nonnull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @Nonnull ConstraintValidatorContext context) {
        return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.*

class DurationPatternValidator : ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    override fun isValid(
            value: CharSequence?,
            annotationMetadata: AnnotationValue&lt;DurationPattern&gt;,
            context: ConstraintValidatorContext): Boolean {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a <code>META-INF/services/io.micronaut.validation.validator.constraints.ConstraintValidator</code> file that references the class.</p>
</li>
<li>
<p>The class should be public and feature a zero argument public constructor</p>
</li>
<li>
<p>The class should be placed on the annotation processor classpath of the project that is to be validated.</p>
</li>
</ul>
</div>
</div>

<h2 id="annotationMetadata"><a class="anchor" href="#annotationMetadata"></a>3.16 Bean Annotation Metadata</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/annotationMetadata.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The methods provided by Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AnnotatedElement.html">AnnotatedElement</a> API in general don&#8217;t provide the ability to introspect annotations without loading the annotations themselves, nor do they provide any ability to introspect annotation stereotypes (Often called meta-annotations, an annotation stereotype is where an annotation is annotated with another annotation, essentially inheriting its behaviour).</p>
</div>
<div class="paragraph">
<p>To solve this problem many frameworks produce runtime metadata or perform expensive reflection to analyze the annotations of a class.</p>
</div>
<div class="paragraph">
<p>Micronaut instead produces this annotation metadata at compile time, avoiding expensive reflection and saving on memory.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> API can be used to obtain a reference to a <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> which implements the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> interface.</p>
</div>
<div class="paragraph">
<p>For example the following code will obtain all bean definitions annotated with a particular stereotype:</p>
</div>
<div class="listingblock">
<div class="title">Lookup Bean Definitions by Stereotype</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BeanContext beanContext = ... // obtain the bean context
Collection&lt;BeanDefinition&gt; definitions =
    beanContext.getBeanDefinitions(Qualifiers.byStereotype(Controller.class))

for(BeanDefinition definition : definitions) {
    AnnotationValue&lt;Controller&gt; controllerAnn = definition.getAnnotation(Controller.class);
    // do something with the annotation
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will find all <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> annotated with <code>@Controller</code> regardless whether <code>@Controller</code> is used directly or inherited via an annotation stereotype.</p>
</div>
<div class="paragraph">
<p>Note that the <code>getAnnotation</code> method and the variations of the method return a <a href="../api/io/micronaut/core/annotation/AnnotationValue.html">AnnotationValue</a> type and not a Java annotation. This is by design, and you should generally try to work with this API when reading annotation values, the reason being that synthesizing a proxy implementation is worse from a performance and memory consumption perspective.</p>
</div>
<div class="paragraph">
<p>If you absolutely require a reference to an annotation instance you can use the <code>synthesize</code> method, which will create a runtime proxy that implements the annotation interface:</p>
</div>
<div class="listingblock">
<div class="title">Synthesizing Annotation Instances</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Controller controllerAnn = definition.synthesize(Controller.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is not recommended however, as it requires reflection and increases memory consumption due to the use of runtime created proxies and should be used as a last resort (for example if you need an instance of the annotation to integrate with a third party library).</p>
</div>
<div class="sect2">
<h3 id="_aliasing_mapping_annotations"><a class="anchor" href="#_aliasing_mapping_annotations"></a>Aliasing / Mapping Annotations</h3>
<div class="paragraph">
<p>There are times when you may want to alias the value of an annotation member to the value of another annotation member. To do this you can use the <a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a> annotation to alias the value of one member to the value of another.</p>
</div>
<div class="paragraph">
<p>A common use case is for example when an annotation defines the <code>value()</code> member, but also supports other members. For example the <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation:</p>
</div>
<div class="listingblock">
<div class="title">The @Client Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public @interface Client {

    /**
     * @return The URL or service ID of the remote service
     */
    @AliasFor(member = "id") <i class="conum" data-value="1"></i><b>(1)</b>
    String value() default "";

    /**
     * @return The ID of the client
     */
    @AliasFor(member = "value") <i class="conum" data-value="2"></i><b>(2)</b>
    String id() default "";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>value</code> member also sets the <code>id</code> member</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>id</code> member also sets the <code>value</code> member</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With these aliases in place, regardless whether you define <code>@Client("foo")</code> or <code>@Client(id="foo")</code> both the <code>value</code> and <code>id</code> members are always set, making it much easier to parse and deal with the annotation.</p>
</div>
<div class="paragraph">
<p>If you do not have control over the annotation then another approach is to use a <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a>. To create a <code>AnnotationMapper</code> you must following the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a> interface</p>
</li>
<li>
<p>Define a <code>META-INF/services/io.micronaut.inject.annotation.AnnotationMapper</code> file referencing the implementation class</p>
</li>
<li>
<p>Add the JAR file containing the implementation to the <code>annotationProcessor</code> classpath (<code>kapt</code> for Kotlin)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because <code>AnnotationMapper</code> implementations need to be on the annotation processor classpath they should generally be in a project that includes few external dependencies to avoid polluting the annotation processor classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example the  <code>AnnotationMapper</code> that improves the introspection capabilities of JPA entities</p>
</div>
<div class="listingblock">
<div class="title">PermitAllAnnotationMapper Mapper Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class EntityIntrospectedAnnotationMapper implements NamedAnnotationMapper {
    @Nonnull
    @Override
    public String getName() {
        return "javax.persistence.Entity";
    }

    @Override
    public List&lt;AnnotationValue&lt;?&gt;&gt; map(AnnotationValue&lt;Annotation&gt; annotation, VisitorContext visitorContext) { <i class="conum" data-value="1"></i><b>(1)</b>
        final AnnotationValueBuilder&lt;Introspected&gt; builder = AnnotationValue.builder(Introspected.class)
                // don't bother with transients properties
                .member("excludedAnnotations", "javax.persistence.Transient"); <i class="conum" data-value="2"></i><b>(2)</b>
        return Collections.singletonList(
                builder.build()
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>map</code> method receives a <a href="../api/io/micronaut/core/annotation/AnnotationValue.html">AnnotationValue</a> with the values for the annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more annotations can be returned, in this case <code>@Transient</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example above implements the <a href="../api/io/micronaut/inject/annotation/NamedAnnotationMapper.html">NamedAnnotationMapper</a> interface which allows for annotations to be mixed with runtime code. If you want to operate against a concrete annotation type then you should use <a href="../api/io/micronaut/inject/annotation/TypedAnnotationMapper.html">TypedAnnotationMapper</a> instead, though note it requires the annotation class itself to be on the annotation processor classpath.
</td>
</tr>
</table>
</div>
</div>

<h2 id="springBeans"><a class="anchor" href="#springBeans"></a>3.17 Micronaut Beans And Spring</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/springBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/spring/beans/MicronautBeanProcessor.html">MicronautBeanProcessor</a>
class is a <code>BeanFactoryPostProcessor</code> which will add Micronaut beans to a
Spring Application Context.  An instance of <code>MicronautBeanProcessor</code> should
be added to the Spring Application Context.  <code>MicronautBeanProcessor</code> requires
a constructor parameter which represents a list of the types of
Micronaut beans which should be added the Spring Application Context.  The
processor may be used in any Spring application.  As an example, a Grails 3
application could take advantage of <code>MicronautBeanProcessor</code> to add all of the
Micronaut HTTP Client beans to the Spring Application Context with something
like the folowing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">// grails-app/conf/spring/resources.groovy
import io.micronaut.spring.beans.MicronautBeanProcessor
import io.micronaut.http.client.annotation.Client

beans = {
    httpClientBeanProcessor MicronautBeanProcessor, Client
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple types may be specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">// grails-app/conf/spring/resources.groovy
import io.micronaut.spring.beans.MicronautBeanProcessor
import io.micronaut.http.client.annotation.Client
import com.sample.Widget

beans = {
    httpClientBeanProcessor MicronautBeanProcessor, [Client, Widget]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a non-Grails application something similar may be specified using
any of Spring&#8217;s bean definition styles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Configuration
class ByAnnotationTypeConfig {

    @Bean
    MicronautBeanProcessor beanProcessor() {
        new MicronautBeanProcessor(Prototype, Singleton)
    }
}</code></pre>
</div>
</div>

<h2 id="android"><a class="anchor" href="#android"></a>3.18 Android Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/android.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut dependency injection is based on annotation processors and doesn&#8217;t rely on reflection, it can be used on Android when using the Android plugin 3.0.0 or above.</p>
</div>
<div class="paragraph">
<p>This allows you to use the same application framework for both your Android client and server implementation.</p>
</div>
<div class="sect1">
<h2 id="_configuring_your_android_build"><a class="anchor" href="#_configuring_your_android_build"></a>Configuring Your Android Build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started you must add the Micronaut annotation processors to the processor classpath using the <code>annotationProcessor</code> dependency configuration.</p>
</div>
<div class="paragraph">
<p>The Micronaut <code>micronaut-inject-java</code> dependency should be included in both the <code>annotationProcessor</code> and <code>compileOnly</code> scopes of your Android build configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Android build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    ...
    annotationProcessor "io.micronaut:micronaut-inject-java:1.2.3.BUILD-SNAPSHOT"
    compileOnly "io.micronaut:micronaut-inject-java:1.2.3.BUILD-SNAPSHOT"
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>lint</code> as part of your build you may also need to disable the invalid packages check since Android includes a hard coded check that regards the <code>javax.inject</code> package as invalid unless you are using Dagger:</p>
</div>
<div class="listingblock">
<div class="title">Configure lint within build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">android {
    ...
    lintOptions {
        lintOptions { warning 'InvalidPackage' }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information on <a href="https://developer.android.com/studio/build/gradle-plugin-3-0-0-migration.html#annotationProcessor_config">configuring annotations processors</a> in the Android documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut <code>inject-java</code> dependency uses <a href="https://developer.android.com/studio/write/java8-support.html">Android Java 8 support</a> features.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_dependency_injection"><a class="anchor" href="#_enabling_dependency_injection"></a>Enabling Dependency Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have configured the classpath correctly, the next step is start the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates creating a subclass of <a href="https://developer.android.com/reference/android/app/Application.html">android.app.Application</a> for that purpose:</p>
</div>
<div class="listingblock">
<div class="title">Example Android Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import android.app.Activity;
import android.app.Application;
import android.os.Bundle;

import io.micronaut.context.ApplicationContext;
import io.micronaut.context.env.Environment;

public class BaseApplication extends Application { <i class="conum" data-value="1"></i><b>(1)</b>

    private ApplicationContext ctx;

    public BaseApplication() {
        super();
    }

    @Override
    public void onCreate() {
        super.onCreate();
        ctx = ApplicationContext.run(MainActivity.class, Environment.ANDROID); <i class="conum" data-value="2"></i><b>(2)</b>
        registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() { <i class="conum" data-value="3"></i><b>(3)</b>
            @Override
            public void onActivityCreated(Activity activity, Bundle bundle) {
                ctx.inject(activity);
            }
            ... // shortened for brevity, it is not necessary to implement other methods
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend the <code>android.app.Application</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Run the <code>ApplicationContext</code> with the <code>ANDROID</code> environment</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To allow dependency injection of Android <code>Activity</code> instances register a <code>ActivityLifecycleCallbacks</code> instance</td>
</tr>
</table>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/quickStart.html">&lt;&lt; <strong>2</strong><span>Quick Start</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
