plugins {
    id 'java'
    id 'java-library'
    id 'maven-publish'
}

repositories {
    mavenCentral()
    mavenLocal()
    jcenter()
    maven { url "https://repo.grails.org/grails/core" }
    maven { url "https://dl.bintray.com/micronaut/core-releases-local" }
    maven { url "https://oss.jfrog.org/artifactory/oss-snapshot-local" }
}

boolean micronautSnapshot = rootProject.version.toString().endsWith("-SNAPSHOT")

dependencies {
    implementation enforcedPlatform(project(":bom"))

    for (dep in bomVersions) {
        def info = dep.value
        def versionExpr = info.version
        api platform("$info.group:$info.name:$versionExpr")
    }

    for (dep in dependencyVersions) {
        def info = dep.value
        // don't include snapshots
        if (info.version.toString().endsWith("-SNAPSHOT") && !micronautSnapshot) {
            continue
        }

        def versionExpr = dep.value.version

        if (info.name) {
            implementation "$info.group:$info.name:$versionExpr"
        }
        if (info.modules) {
            for (m in info.modules) {
                implementation "$info.group:$m:$versionExpr"
            }
        }
    }
}

task validateBom() {
        configurations.each { cfg ->
            if (cfg.isCanBeResolved()) {
                logger.quiet "Resolving configuration ${cfg.name}"
                cfg.resolve()
            }
        }
}