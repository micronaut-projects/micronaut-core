<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#ioc"><strong>3</strong><span>Inversion of Control</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#config"><strong>4</strong><span>Application Configuration</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#aop"><strong>5</strong><span>Aspect Oriented Programming</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#httpServer"><strong>6</strong><span>The HTTP Server</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#httpClient"><strong>7</strong><span>The HTTP Client</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#cloud"><strong>8</strong><span>Cloud Native Features</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#serverlessFunctions"><strong>9</strong><span>Serverless Functions</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#messaging"><strong>10</strong><span>Message-Driven Microservices</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#commandLineApps"><strong>11</strong><span>Standalone Command Line Applications</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#configurations"><strong>12</strong><span>Configurations</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#languageSupport"><strong>13</strong><span>Language Support</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#management"><strong>14</strong><span>Management &amp; Monitoring</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#security"><strong>15</strong><span>Security</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#multitenancy"><strong>16</strong><span>Multi-Tenancy</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#cli"><strong>17</strong><span>Micronaut CLI</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#i18n"><strong>18</strong><span>Internationalization</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#appendix"><strong>19</strong><span>Appendices</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-whatsNew"><a href="#whatsNew"><strong>1.1</strong><span>What's New?</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-upgrading"><a href="#upgrading"><strong>1.2</strong><span>Upgrading to Micronaut 2.x</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-quickStart"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-buildCLI"><a href="#buildCLI"><strong>2.1</strong><span>Build/Install the CLI</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-creatingServer"><a href="#creatingServer"><strong>2.2</strong><span>Creating a Server Application</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-ideSetup"><a href="#ideSetup"><strong>2.3</strong><span>Setting up an IDE</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-ideaSetup"><a href="#ideaSetup"><strong>2.3.1</strong><span>IntelliJ IDEA</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-eclipseSetup"><a href="#eclipseSetup"><strong>2.3.2</strong><span>Eclipse</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-vsCodeSetup"><a href="#vsCodeSetup"><strong>2.3.3</strong><span>Visual Studio Code</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-creatingClient"><a href="#creatingClient"><strong>2.4</strong><span>Creating a Client</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-deployingApp"><a href="#deployingApp"><strong>2.5</strong><span>Deploying the Application</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-ioc"><a href="#ioc"><strong>3</strong><span>Inversion of Control</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beans"><a href="#beans"><strong>3.1</strong><span>Defining Beans</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-how"><a href="#how"><strong>3.2</strong><span>How Does it Work?</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beanContext"><a href="#beanContext"><strong>3.3</strong><span>The BeanContext</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-types"><a href="#types"><strong>3.4</strong><span>Injectable Container Types</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-qualifiers"><a href="#qualifiers"><strong>3.5</strong><span>Bean Qualifiers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-scopes"><a href="#scopes"><strong>3.6</strong><span>Scopes</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-builtInScopes"><a href="#builtInScopes"><strong>3.6.1</strong><span>Built-In Scopes</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-eagerInit"><a href="#eagerInit"><strong>3.6.1.1</strong><span>Eager Initialization of Singletons</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-refreshable"><a href="#refreshable"><strong>3.6.2</strong><span>Refreshable Scope</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-metaScopes"><a href="#metaScopes"><strong>3.6.3</strong><span>Scopes on Meta Annotations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-factories"><a href="#factories"><strong>3.7</strong><span>Bean Factories</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-conditionalBeans"><a href="#conditionalBeans"><strong>3.8</strong><span>Conditional Beans</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-replaces"><a href="#replaces"><strong>3.9</strong><span>Bean Replacement</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beanConfigurations"><a href="#beanConfigurations"><strong>3.10</strong><span>Bean Configurations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-lifecycle"><a href="#lifecycle"><strong>3.11</strong><span>Life-Cycle Methods</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-contextEvents"><a href="#contextEvents"><strong>3.12</strong><span>Context Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-events"><a href="#events"><strong>3.13</strong><span>Bean Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-introspection"><a href="#introspection"><strong>3.14</strong><span>Bean Introspection</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beanValidation"><a href="#beanValidation"><strong>3.15</strong><span>Bean Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-annotationMetadata"><a href="#annotationMetadata"><strong>3.16</strong><span>Bean Annotation Metadata</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-springBeans"><a href="#springBeans"><strong>3.17</strong><span>Micronaut Beans And Spring</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-android"><a href="#android"><strong>3.18</strong><span>Android Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-config"><a href="#config"><strong>4</strong><span>Application Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-environments"><a href="#environments"><strong>4.1</strong><span>The Environment</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-propertySource"><a href="#propertySource"><strong>4.2</strong><span>Externalized Configuration with PropertySources</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-valueAnnotation"><a href="#valueAnnotation"><strong>4.3</strong><span>Configuration Injection</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-configurationProperties"><a href="#configurationProperties"><strong>4.4</strong><span>Configuration Properties</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-customTypeConverter"><a href="#customTypeConverter"><strong>4.5</strong><span>Custom Type Converters</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-eachProperty"><a href="#eachProperty"><strong>4.6</strong><span>Using @EachProperty to Drive Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-eachBean"><a href="#eachBean"><strong>4.7</strong><span>Using @EachBean to Drive Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-immutableConfig"><a href="#immutableConfig"><strong>4.8</strong><span>Immutable Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jmx"><a href="#jmx"><strong>4.9</strong><span>JMX Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-aop"><a href="#aop"><strong>5</strong><span>Aspect Oriented Programming</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-aroundAdvice"><a href="#aroundAdvice"><strong>5.1</strong><span>Around Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-introductionAdvice"><a href="#introductionAdvice"><strong>5.2</strong><span>Introduction Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-adapterAdvice"><a href="#adapterAdvice"><strong>5.3</strong><span>Method Adapter Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-validation"><a href="#validation"><strong>5.4</strong><span>Validation Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-caching"><a href="#caching"><strong>5.5</strong><span>Cache Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-retry"><a href="#retry"><strong>5.6</strong><span>Retry Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-scheduling"><a href="#scheduling"><strong>5.7</strong><span>Scheduled Tasks</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-springAop"><a href="#springAop"><strong>5.8</strong><span>Bridging Spring AOP</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-httpServer"><a href="#httpServer"><strong>6</strong><span>The HTTP Server</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-runningServer"><a href="#runningServer"><strong>6.1</strong><span>Running the Embedded Server</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-runningSpecificPort"><a href="#runningSpecificPort"><strong>6.2</strong><span>Running Server on a Specific Port</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-routing"><a href="#routing"><strong>6.3</strong><span>HTTP Routing</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-binding"><a href="#binding"><strong>6.4</strong><span>Simple Request Binding</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hostResolution"><a href="#hostResolution"><strong>6.5</strong><span>Host Resolution</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientIpAddress"><a href="#clientIpAddress"><strong>6.6</strong><span>Client IP Address</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-requestResponse"><a href="#requestResponse"><strong>6.7</strong><span>The HttpRequest and HttpResponse</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-statusAnnotation"><a href="#statusAnnotation"><strong>6.8</strong><span>Response Status</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-producesAnnotation"><a href="#producesAnnotation"><strong>6.9</strong><span>Response Content-Type</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-consumesAnnotation"><a href="#consumesAnnotation"><strong>6.10</strong><span>Accepted Request Content-Type</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-reactiveServer"><a href="#reactiveServer"><strong>6.11</strong><span>Reactive HTTP Request Processing</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-bodyAnnotation"><a href="#bodyAnnotation"><strong>6.11.1</strong><span>Using the @Body Annotation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-reactiveResponses"><a href="#reactiveResponses"><strong>6.11.2</strong><span>Reactive Responses</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jsonBinding"><a href="#jsonBinding"><strong>6.12</strong><span>JSON Binding with Jackson</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-datavalidation"><a href="#datavalidation"><strong>6.13</strong><span>Data Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-staticResources"><a href="#staticResources"><strong>6.14</strong><span>Serving Static Resources</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-errorHandling"><a href="#errorHandling"><strong>6.15</strong><span>Error Handling</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-apiVersioning"><a href="#apiVersioning"><strong>6.16</strong><span>API Versioning</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-formData"><a href="#formData"><strong>6.17</strong><span>Handling Form Data</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serverIO"><a href="#serverIO"><strong>6.18</strong><span>Writing Response Data</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-uploads"><a href="#uploads"><strong>6.19</strong><span>File Uploads</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-transfers"><a href="#transfers"><strong>6.20</strong><span>File Transfers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-filters"><a href="#filters"><strong>6.21</strong><span>HTTP Filters</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-sessions"><a href="#sessions"><strong>6.22</strong><span>HTTP Sessions</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-sse"><a href="#sse"><strong>6.23</strong><span>Server Sent Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-websocket"><a href="#websocket"><strong>6.24</strong><span>WebSocket Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-websocketServer"><a href="#websocketServer"><strong>6.24.1</strong><span>Using @ServerWebSocket</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-websocketClient"><a href="#websocketClient"><strong>6.24.2</strong><span>Using @ClientWebSocket</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-http2Server"><a href="#http2Server"><strong>6.25</strong><span>HTTP/2 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serverEvents"><a href="#serverEvents"><strong>6.26</strong><span>Server Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serverConfiguration"><a href="#serverConfiguration"><strong>6.27</strong><span>Configuring the HTTP Server</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-threadPools"><a href="#threadPools"><strong>6.27.1</strong><span>Configuring Server Thread Pools</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-nettyPipeline"><a href="#nettyPipeline"><strong>6.27.2</strong><span>Configuring the Netty Pipeline</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-cors"><a href="#cors"><strong>6.27.3</strong><span>Configuring CORS</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-https"><a href="#https"><strong>6.27.4</strong><span>Securing the Server with HTTPS</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-dualProtocol"><a href="#dualProtocol"><strong>6.27.5</strong><span>Enabling HTTP and HTTPS</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-accessLogger"><a href="#accessLogger"><strong>6.27.6</strong><span>Enabling Access Logger</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-views"><a href="#views"><strong>6.28</strong><span>Server Side View Rendering</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-openapi"><a href="#openapi"><strong>6.29</strong><span>OpenAPI / Swagger Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-graphql"><a href="#graphql"><strong>6.30</strong><span>GraphQL Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-httpClient"><a href="#httpClient"><strong>7</strong><span>The HTTP Client</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-lowLevelHttpClient"><a href="#lowLevelHttpClient"><strong>7.1</strong><span>Using the Low-Level HTTP Client</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientBasics"><a href="#clientBasics"><strong>7.1.1</strong><span>Sending your first HTTP request</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientPostRequests"><a href="#clientPostRequests"><strong>7.1.2</strong><span>Posting a Request Body</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientUploads"><a href="#clientUploads"><strong>7.1.3</strong><span>Multipart Client Uploads</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientStreaming"><a href="#clientStreaming"><strong>7.1.4</strong><span>Streaming JSON over HTTP</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientConfiguration"><a href="#clientConfiguration"><strong>7.1.5</strong><span>Configuring HTTP clients</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-lowLevelClientError"><a href="#lowLevelClientError"><strong>7.1.6</strong><span>Error Responses</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-bindErrors"><a href="#bindErrors"><strong>7.1.7</strong><span>Bind Errors</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-proxyClient"><a href="#proxyClient"><strong>7.2</strong><span>Proxying Requests with ProxyHttpClient</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientAnnotation"><a href="#clientAnnotation"><strong>7.3</strong><span>Declarative HTTP Clients with @Client</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientParameters"><a href="#clientParameters"><strong>7.3.1</strong><span>Customizing Parameter Binding</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientAnnotationStreaming"><a href="#clientAnnotationStreaming"><strong>7.3.2</strong><span>Streaming with @Client</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientError"><a href="#clientError"><strong>7.3.3</strong><span>Error Responses</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientHeaders"><a href="#clientHeaders"><strong>7.3.4</strong><span>Customizing Request Headers</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientJackson"><a href="#clientJackson"><strong>7.3.5</strong><span>Customizing Jackson Settings</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientRetry"><a href="#clientRetry"><strong>7.3.6</strong><span>Retry and Circuit Breaker</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientFallback"><a href="#clientFallback"><strong>7.3.7</strong><span>Client Fallbacks</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-netflixHystrix"><a href="#netflixHystrix"><strong>7.3.8</strong><span>Netflix Hystrix Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientFilter"><a href="#clientFilter"><strong>7.4</strong><span>HTTP Client Filters</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientSample"><a href="#clientSample"><strong>7.5</strong><span>HTTP Client Sample</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-cloud"><a href="#cloud"><strong>8</strong><span>Cloud Native Features</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-cloudConfiguration"><a href="#cloudConfiguration"><strong>8.1</strong><span>Cloud Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfiguration"><a href="#distributedConfiguration"><strong>8.1.1</strong><span>Distributed Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationConsul"><a href="#distributedConfigurationConsul"><strong>8.1.2</strong><span>HashiCorp Consul Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationVault"><a href="#distributedConfigurationVault"><strong>8.1.3</strong><span>HashiCorp Vault Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationSpringCloud"><a href="#distributedConfigurationSpringCloud"><strong>8.1.4</strong><span>Spring Cloud Config Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationAwsParameterStore"><a href="#distributedConfigurationAwsParameterStore"><strong>8.1.5</strong><span>AWS Parameter Store Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationOracleCloudVault"><a href="#distributedConfigurationOracleCloudVault"><strong>8.1.6</strong><span>Oracle Cloud Vault Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serviceDiscovery"><a href="#serviceDiscovery"><strong>8.2</strong><span>Service Discovery</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryConsul"><a href="#serviceDiscoveryConsul"><strong>8.2.1</strong><span>Consul Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryEureka"><a href="#serviceDiscoveryEureka"><strong>8.2.2</strong><span>Eureka Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryKubernetes"><a href="#serviceDiscoveryKubernetes"><strong>8.2.3</strong><span>Kubernetes Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryRoute53"><a href="#serviceDiscoveryRoute53"><strong>8.2.4</strong><span>AWS Route 53 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryManual"><a href="#serviceDiscoveryManual"><strong>8.2.5</strong><span>Manual Service Discovery Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientSideLoadBalancing"><a href="#clientSideLoadBalancing"><strong>8.3</strong><span>Client Side Load Balancing</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-netflixRibbon"><a href="#netflixRibbon"><strong>8.3.1</strong><span>Netflix Ribbon Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-distributedTracing"><a href="#distributedTracing"><strong>8.4</strong><span>Distributed Tracing</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-zipkin"><a href="#zipkin"><strong>8.4.1</strong><span>Tracing with Zipkin</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jaeger"><a href="#jaeger"><strong>8.4.2</strong><span>Tracing with Jaeger</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-serverlessFunctions"><a href="#serverlessFunctions"><strong>9</strong><span>Serverless Functions</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-awsLambda"><a href="#awsLambda"><strong>9.1</strong><span>AWS Lambda</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-gcpFunction"><a href="#gcpFunction"><strong>9.2</strong><span>Google Cloud Function</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-gcpCloudRun"><a href="#gcpCloudRun"><strong>9.3</strong><span>Google Cloud Run</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-azureFunction"><a href="#azureFunction"><strong>9.4</strong><span>Azure Function</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-messaging"><a href="#messaging"><strong>10</strong><span>Message-Driven Microservices</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-kafka"><a href="#kafka"><strong>10.1</strong><span>Kafka Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-rabbitmq"><a href="#rabbitmq"><strong>10.2</strong><span>RabbitMQ Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-nats"><a href="#nats"><strong>10.3</strong><span>Nats.io Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-commandLineApps"><a href="#commandLineApps"><strong>11</strong><span>Standalone Command Line Applications</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-picocli"><a href="#picocli"><strong>11.1</strong><span>Picocli Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-configurations"><a href="#configurations"><strong>12</strong><span>Configurations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-reactiveConfigs"><a href="#reactiveConfigs"><strong>12.1</strong><span>Configurations for Reactive Programming</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-rxjava3"><a href="#rxjava3"><strong>12.1.1</strong><span>RxJava 3 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-reactor"><a href="#reactor"><strong>12.1.2</strong><span>Reactor Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-rxjava1"><a href="#rxjava1"><strong>12.1.3</strong><span>RxJava 1 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-dataAccess"><a href="#dataAccess"><strong>12.2</strong><span>Configurations for Data Access</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-sqlSupport"><a href="#sqlSupport"><strong>12.2.1</strong><span>Configuring a SQL Data Source</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-hibernateSupport"><a href="#hibernateSupport"><strong>12.2.2</strong><span>Configuring Hibernate</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-mongoSupport"><a href="#mongoSupport"><strong>12.2.3</strong><span>Configuring MongoDB</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-neo4jSupport"><a href="#neo4jSupport"><strong>12.2.4</strong><span>Configuring Neo4j</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-postgresSupport"><a href="#postgresSupport"><strong>12.2.5</strong><span>Configuring Postgres</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-redisSupport"><a href="#redisSupport"><strong>12.2.6</strong><span>Configuring Redis</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-cassandraSupport"><a href="#cassandraSupport"><strong>12.2.7</strong><span>Configuring Cassandra</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-liquibaseSupport"><a href="#liquibaseSupport"><strong>12.2.8</strong><span>Configuring Liquibase</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-flywaySupport"><a href="#flywaySupport"><strong>12.2.9</strong><span>Configuring Flyway</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-languageSupport"><a href="#languageSupport"><strong>13</strong><span>Language Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-java"><a href="#java"><strong>13.1</strong><span>Micronaut for Java</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-java9"><a href="#java9"><strong>13.1.1</strong><span>Using Micronaut with Java 9+</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-incrementalannotationgradle"><a href="#incrementalannotationgradle"><strong>13.1.2</strong><span>Incremental Annotation Processing with Gradle</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-lombok"><a href="#lombok"><strong>13.1.3</strong><span>Using Project Lombok</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-ide"><a href="#ide"><strong>13.1.4</strong><span>Configuring an IDE</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-retainparameternames"><a href="#retainparameternames"><strong>13.1.5</strong><span>Retaining Parameter Names</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-groovy"><a href="#groovy"><strong>13.2</strong><span>Micronaut for Groovy</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-kotlin"><a href="#kotlin"><strong>13.3</strong><span>Micronaut for Kotlin</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-kaptintellij"><a href="#kaptintellij"><strong>13.3.1</strong><span>Kotlin, Kapt and IntelliJ</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-gradlekapt"><a href="#gradlekapt"><strong>13.3.2</strong><span>Incremental Annotation Processing with Gradle and Kapt</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-openandaop"><a href="#openandaop"><strong>13.3.3</strong><span>Kotlin and AOP Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-kotlinretainparamnames"><a href="#kotlinretainparamnames"><strong>13.3.4</strong><span>Kotlin and Retaining Parameter Names</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-coroutines"><a href="#coroutines"><strong>13.3.5</strong><span>Coroutines Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-graal"><a href="#graal"><strong>13.4</strong><span>Micronaut for GraalVM</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-graalServices"><a href="#graalServices"><strong>13.4.1</strong><span>Microservices as GraalVM native images</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-graalFAQ"><a href="#graalFAQ"><strong>13.4.2</strong><span>GraalVM and Micronaut FAQ</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-management"><a href="#management"><strong>14</strong><span>Management &amp; Monitoring</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-buildingEndpoints"><a href="#buildingEndpoints"><strong>14.1</strong><span>Creating Endpoints</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointAnnotation"><a href="#endpointAnnotation"><strong>14.1.1</strong><span>The Endpoint Annotation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointMethod"><a href="#endpointMethod"><strong>14.1.2</strong><span>Endpoint Methods</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointSensitivity"><a href="#endpointSensitivity"><strong>14.1.3</strong><span>Endpoint Sensitivity</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointConfiguration"><a href="#endpointConfiguration"><strong>14.1.4</strong><span>Endpoint Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-providedEndpoints"><a href="#providedEndpoints"><strong>14.2</strong><span>Built-In Endpoints</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-beansEndpoint"><a href="#beansEndpoint"><strong>14.2.1</strong><span>The Beans Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-infoEndpoint"><a href="#infoEndpoint"><strong>14.2.2</strong><span>The Info Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-healthEndpoint"><a href="#healthEndpoint"><strong>14.2.3</strong><span>The Health Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-metricsEndpoint"><a href="#metricsEndpoint"><strong>14.2.4</strong><span>The Metrics Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-refreshEndpoint"><a href="#refreshEndpoint"><strong>14.2.5</strong><span>The Refresh Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-routesEndpoint"><a href="#routesEndpoint"><strong>14.2.6</strong><span>The Routes Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-loggersEndpoint"><a href="#loggersEndpoint"><strong>14.2.7</strong><span>The Loggers Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-cachesEndpoint"><a href="#cachesEndpoint"><strong>14.2.8</strong><span>The Caches Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-stopEndpoint"><a href="#stopEndpoint"><strong>14.2.9</strong><span>The Server Stop Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-environmentEndpoint"><a href="#environmentEndpoint"><strong>14.2.10</strong><span>The Environment Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-security"><a href="#security"><strong>15</strong><span>Security</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-multitenancy"><a href="#multitenancy"><strong>16</strong><span>Multi-Tenancy</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-multitenancyGorm"><a href="#multitenancyGorm"><strong>16.1</strong><span>Multi-Tenancy GORM</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-cli"><a href="#cli"><strong>17</strong><span>Micronaut CLI</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-createProject"><a href="#createProject"><strong>17.1</strong><span>Creating a Project</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-profiles"><a href="#profiles"><strong>17.2</strong><span>Profiles</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-comparingVersions"><a href="#comparingVersions"><strong>17.2.1</strong><span>Comparing Versions</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-features"><a href="#features"><strong>17.3</strong><span>Features</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-commands"><a href="#commands"><strong>17.4</strong><span>Commands</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-reloading"><a href="#reloading"><strong>17.5</strong><span>Reloading</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-automaticRestart"><a href="#automaticRestart"><strong>17.5.1</strong><span>Automatic Restart</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jrebel"><a href="#jrebel"><strong>17.5.2</strong><span>JRebel</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-gradleReload"><a href="#gradleReload"><strong>17.5.3</strong><span>Recompiling with Gradle</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-ideReload"><a href="#ideReload"><strong>17.5.4</strong><span>Recompiling with an IDE</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-proxy"><a href="#proxy"><strong>17.6</strong><span>Proxy Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-i18n"><a href="#i18n"><strong>18</strong><span>Internationalization</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-bundle"><a href="#bundle"><strong>18.1</strong><span>Resource Bundles</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-appendix"><a href="#appendix"><strong>19</strong><span>Appendices</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-faq"><a href="#faq"><strong>19.1</strong><span>Frequently Asked Questions (FAQ)</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-usingsnapshots"><a href="#usingsnapshots"><strong>19.2</strong><span>Using Snapshots</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-problems"><a href="#problems"><strong>19.3</strong><span>Common Problems</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-breaks"><a href="#breaks"><strong>19.4</strong><span>Breaking Changes</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut</h1>
        <p></p>
        <p>Natively Cloud Native</p>
        <p><strong>Version:</strong> <select style='max-width: 200px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option value='https://docs.micronaut.io/snapshot/guide/index.html'>SNAPSHOT</option><option selected='selected' value='https://docs.micronaut.io/2.1.0/guide/index.html'>2.1.0</option><option value='https://docs.micronaut.io/2.0.3/guide/index.html'>2.0.3</option><option value='https://docs.micronaut.io/2.0.2/guide/index.html'>2.0.2</option><option value='https://docs.micronaut.io/2.0.1/guide/index.html'>2.0.1</option><option value='https://docs.micronaut.io/2.0.0/guide/index.html'>2.0.0</option><option value='https://docs.micronaut.io/2.0.0.RC2/guide/index.html'>2.0.0.RC2</option><option value='https://docs.micronaut.io/2.0.0.RC1/guide/index.html'>2.0.0.RC1</option><option value='https://docs.micronaut.io/2.0.0.M3/guide/index.html'>2.0.0.M3</option><option value='https://docs.micronaut.io/2.0.0.M2/guide/index.html'>2.0.0.M2</option><option value='https://docs.micronaut.io/2.0.0.M1/guide/index.html'>2.0.0.M1</option><option value='https://docs.micronaut.io/1.3.7/guide/index.html'>1.3.7</option><option value='https://docs.micronaut.io/1.3.6/guide/index.html'>1.3.6</option><option value='https://docs.micronaut.io/1.3.5/guide/index.html'>1.3.5</option><option value='https://docs.micronaut.io/1.3.4/guide/index.html'>1.3.4</option><option value='https://docs.micronaut.io/1.3.3/guide/index.html'>1.3.3</option><option value='https://docs.micronaut.io/1.3.2/guide/index.html'>1.3.2</option><option value='https://docs.micronaut.io/1.3.1/guide/index.html'>1.3.1</option><option value='https://docs.micronaut.io/1.3.0/guide/index.html'>1.3.0</option><option value='https://docs.micronaut.io/1.3.0.RC1/guide/index.html'>1.3.0.RC1</option><option value='https://docs.micronaut.io/1.3.0.M2/guide/index.html'>1.3.0.M2</option><option value='https://docs.micronaut.io/1.3.0.M1/guide/index.html'>1.3.0.M1</option><option value='https://docs.micronaut.io/1.3.0.TEST/guide/index.html'>1.3.0.TEST</option><option value='https://docs.micronaut.io/1.2.11/guide/index.html'>1.2.11</option><option value='https://docs.micronaut.io/1.2.10/guide/index.html'>1.2.10</option><option value='https://docs.micronaut.io/1.2.9/guide/index.html'>1.2.9</option><option value='https://docs.micronaut.io/1.2.8/guide/index.html'>1.2.8</option><option value='https://docs.micronaut.io/1.2.7/guide/index.html'>1.2.7</option><option value='https://docs.micronaut.io/1.2.6/guide/index.html'>1.2.6</option><option value='https://docs.micronaut.io/1.2.5/guide/index.html'>1.2.5</option><option value='https://docs.micronaut.io/1.2.4/guide/index.html'>1.2.4</option></select></p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is a modern, JVM-based, full stack Java framework designed for building modular, easily testable JVM applications with support for Java, Kotlin and the Groovy language.</p>
</div>
<div class="paragraph">
<p>Micronaut is developed by the creators of the Grails framework and takes inspiration from lessons learnt over the years building real-world applications from monoliths to microservices using Spring, Spring Boot and Grails.</p>
</div>
<div class="paragraph">
<p>Micronaut aims to provide all the tools necessary to build JVM applications including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency Injection and Inversion of Control (IoC)</p>
</li>
<li>
<p>Aspect Oriented Programming (AOP)</p>
</li>
<li>
<p>Sensible Defaults and Auto-Configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With Micronaut you can build Message-Driven Applications, Command Line Applications, HTTP Servers and more whilst for Microservices in particular Micronaut also provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed Configuration</p>
</li>
<li>
<p>Service Discovery</p>
</li>
<li>
<p>HTTP Routing</p>
</li>
<li>
<p>Client-Side Load Balancing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the same time Micronaut aims to avoid the downsides of frameworks like Spring, Spring Boot and Grails by providing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast startup time</p>
</li>
<li>
<p>Reduced memory footprint</p>
</li>
<li>
<p>Minimal use of reflection</p>
</li>
<li>
<p>Minimal use of proxies</p>
</li>
<li>
<p>No runtime bytecode generation</p>
</li>
<li>
<p>Easy Unit Testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Historically, frameworks such as Spring and Grails were not designed to run in scenarios such as server-less functions, Android apps, or low memory-footprint microservices. In contrast, Micronaut is designed to be suitable for all of these scenarios.</p>
</div>
<div class="paragraph">
<p>This goal is achieved through the use of Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/Processor.html">annotation processors</a>, which are usable on any JVM language that supports them, as well as an HTTP Server and Client built on <a href="https://netty.io/">Netty</a>. In order to provide a similar programming model to Spring and Grails, these annotation processors precompile the necessary metadata in order to perform DI, define AOP proxies and configure your application to run in a low-memory environment.</p>
</div>
<div class="paragraph">
<p>Many of the APIs within Micronaut are heavily inspired by Spring and Grails. This is by design, and aids in bringing developers up to speed quickly.</p>
</div>

<h2 id="whatsNew"><a class="anchor" href="#whatsNew"></a>1.1 What's New?</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/introduction/whatsNew.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut 2.1.0 includes the following changes:</p>
</div>
<div class="sect2">
<h3 id="_core_features">Core Features</h3>
<div class="sect3">
<h4 id="_introspections_for_jdk_14_records">Introspections for JDK 14 Records</h4>
<div class="paragraph">
<p>It is now possible to define <a href="#introspection">bean introspections</a> on JDK 14+ record types (note these currently require the <code>enablepreview</code> flag to the compiler and JVM).</p>
</div>
</div>
<div class="sect3">
<h4 id="_default_environment">Default Environment</h4>
<div class="paragraph">
<p>Micronaut 2.1 introduces the concept of a default environment. One or more default environments can be set and they will apply if no other environments are explicitly specified. See the <a href="#environments">environments documentation</a> for information on how to use this new feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="_order_annotation">@Order Annotation</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/Order.html">@Order</a> annotation has been added to support supplying bean order for factory methods or for those who prefer the use of annotations over the <a href="../api/io/micronaut/core/order/Ordered.html">Ordered</a> interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kotlin_1_4">Kotlin 1.4</h4>
<div class="paragraph">
<p>Micronaut now ships with Kotlin 1.4 for those users using Kotlin.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_features">Build Features</h3>
<div class="sect3">
<h4 id="_new_gradle_plugin">New Gradle Plugin</h4>
<div class="paragraph">
<p>A new Gradle plugin is available that provides a more expressive way to define a Micronaut application and includes awesome new features for GraalVM Native Image and Docker. The minimum required build to build a Micronaut application is now:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Minimal Gradle Build</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">plugins {
     id 'io.micronaut.application' version '{version}'
}
repositories {
    jcenter()
    mavenCentral()
}

micronaut {
    version = "2.1.0" // The Micronaut Version
    runtime "netty" // Using the Netty runtime
}
mainClassName = "example.Application" // Your main class</code></pre>
</div>
</div>
<div class="paragraph">
<p>Building a Native Image is then as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew nativeImage</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whilst building a docker image using GraalVM Native Image can be done with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew dockerBuildNative

# Or to push a native image to a Docker registry
$ ./gradlew dockerPushNative</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_features">Web Features</h3>
<div class="sect3">
<h4 id="_client_binding_api">Client Binding API</h4>
<div class="paragraph">
<p>A new API has been created to allow for binding declarative HTTP client method arguments to an HTTP request. See the <a href="#clientParameters">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_websocket_improvements">Websocket Improvements</h4>
<div class="paragraph">
<p>Query parameters are now respected and bindable in the Micronaut websocket support.</p>
</div>
</div>
<div class="sect3">
<h4 id="_httpresponse_improvements">HttpResponse Improvements</h4>
<div class="paragraph">
<p>Cookies in HTTP responses from the client side are now retrievable on the HttpResponse. These are the cookies found in the <code>Set-Cookie</code> header.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cloud_features">Cloud Features</h3>
<div class="sect3">
<h4 id="_support_for_oracle_cloud_sdk">Support for Oracle Cloud SDK</h4>
<div class="paragraph">
<p>A new GraalVM Native Image compatible <a href="https://micronaut-projects.github.io/micronaut-oracle-cloud/latest/guide/">module for Oracle Cloud SDK</a> has been added allowing you to use any part of the Oracle Cloud SDK with Native Image and also enhancing the SDK with RxJava 2 support.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_oracle_function">Support for Oracle Function</h4>
<div class="paragraph">
<p>Support has been added for building <a href="https://micronaut-projects.github.io/micronaut-oracle-cloud/latest/guide/#functions">Oracle Functions</a> deployable to Oracle Cloud including the ability to compute the functions in native images using GraalVM.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_google_pub_sub">Support for Google Pub/Sub</h4>
<div class="paragraph">
<p>Thanks to <a href="https://github.com/viniciusccarvalho">Vinicius Carvalho</a> at Google, Micronaut now features dedicated support for <a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#pubsub">Google Pub/Sub</a> for seamless messaging in Google Cloud.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_google_cloud_log_format">Support for Google Cloud Log Format</h4>
<div class="paragraph">
<p>Thanks to <a href="https://github.com/viniciusccarvalho">Vinicius Carvalho</a> at Google, Micronaut can now <a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#logging">output logs in the official JSON format</a> supported by Stackdriver on Google Cloud</p>
</div>
</div>
<div class="sect3">
<h4 id="_liveness_readiness_probes">Liveness/Readiness Probes</h4>
<div class="paragraph">
<p>Micronaut&#8217;s <code>/health</code> endpoint now allows you to distinguish liveness and readiness probes at the URIs <code>/health/liveness</code> and <code>/health/readiness</code>. Micronaut Launch&#8217;s Kubernetes support has been updated to generate a Kubenetes descriptor that is configured to with these probe endpoints by default.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_upgrades">Module Upgrades</h3>
<div class="ulist">
<ul>
<li>
<p>Micronaut AWS <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut Acme <code>2.0.0</code></p>
</li>
<li>
<p>Micronaut Azure <code>2.0.1</code></p>
</li>
<li>
<p>Micronaut Cache <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut Cassandra <code>3.0.0</code></p>
</li>
<li>
<p>Micronaut Data <code>2.0.0</code></p>
</li>
<li>
<p>Micronaut Elasticsearch <code>2.0.1</code></p>
</li>
<li>
<p>Micronaut Flyway <code>2.1.1</code></p>
</li>
<li>
<p>Micronaut GCP <code>3.2.1</code></p>
</li>
<li>
<p>Micronaut GraphQL <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut Groovy <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut gRPC <code>2.0.5</code></p>
</li>
<li>
<p>Micronaut Ignite <code>1.0.0.RC1</code></p>
</li>
<li>
<p>Micronaut Kafka <code>3.0.0</code></p>
</li>
<li>
<p>Micronaut Kotlin <code>2.1.1</code></p>
</li>
<li>
<p>Micronaut Liquibase <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut Micrometer <code>3.0.1</code></p>
</li>
<li>
<p>Micronaut Mongo <code>DB 3.0.0</code></p>
</li>
<li>
<p>Micronaut Neo4j <code>4.0.0</code></p>
</li>
<li>
<p>Micronaut Open <code>API 2.1.0</code></p>
</li>
<li>
<p>Micronaut Oracle <code>Cloud 1.0.0</code></p>
</li>
<li>
<p>Micronaut Picocli <code>3.0.0</code></p>
</li>
<li>
<p>Micronaut RabbitMQ <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut Redis <code>3.0.0</code></p>
</li>
<li>
<p>Micronaut Security <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut Servlet <code>2.0.0</code></p>
</li>
<li>
<p>Micronaut Sql <code>3.1.0</code></p>
</li>
<li>
<p>Micronaut Test <code>2.1.0</code></p>
</li>
<li>
<p>Micronaut Xml <code>2.0.0</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_upgrades">Dependency Upgrades</h3>
<div class="ulist">
<ul>
<li>
<p>Commons Dbcp <code>2.8.0</code></p>
</li>
<li>
<p>Dekorate <code>1.0.3</code></p>
</li>
<li>
<p>Elasticsearch <code>7.8.1</code></p>
</li>
<li>
<p>Flyway <code>6.5.4</code></p>
</li>
<li>
<p>gRPC <code>1.32.1</code></p>
</li>
<li>
<p>Hibernate <code>5.4.21.Final</code></p>
</li>
<li>
<p>Ignite <code>2.8.1</code></p>
</li>
<li>
<p>JUnit <code>5.7.0</code></p>
</li>
<li>
<p>Kotlin <code>1.4.10</code></p>
</li>
<li>
<p>Ktor <code>1.4.0</code></p>
</li>
<li>
<p>Liquibase <code>3.10.2</code></p>
</li>
<li>
<p>MSSQL Driver <code>8.4.1.jre8</code></p>
</li>
<li>
<p>MariaDB Driver <code>2.6.2</code></p>
</li>
<li>
<p>Micrometer <code>1.5.5</code></p>
</li>
<li>
<p>Mongo Driver <code>4.1.0</code></p>
</li>
<li>
<p>Mongo Reactive Driver <code>4.1.0</code></p>
</li>
<li>
<p>Neo4j Driver <code>4.1.1</code></p>
</li>
<li>
<p>Netty <code>4.1.52.Final</code></p>
</li>
<li>
<p>Picocli <code>4.5.1</code></p>
</li>
<li>
<p>Postgres Driver <code>42.2.16</code></p>
</li>
<li>
<p>Redis Lettuce <code>5.3.4.RELEASE</code></p>
</li>
<li>
<p>Tomcat Jdbc <code>9.0.38</code></p>
</li>
</ul>
</div>
</div>

<h2 id="upgrading"><a class="anchor" href="#upgrading"></a>1.2 Upgrading to Micronaut 2.x</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/introduction/upgrading.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This section covers the steps required to upgrade a Micronaut 2.0 application to Micronaut 2.1.</p>
</div>
<div class="sect2">
<h3 id="_new_group_ids">New Group IDs</h3>
<div class="paragraph">
<p>Some dependencies have new Maven Group IDs so you may need to update your dependency. The following table summarizes changes to group IDs:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Updated Maven Group IDs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Previous ID</th>
<th class="tableblock halign-left valign-top">New ID</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:micronaut-openapi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.openapi:micronaut-openapi</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_mandatory_upgrade_for_netty_tcnative">Mandatory upgrade for Netty tcnative</h3>
<div class="paragraph">
<p>Due to a new <a href="https://github.com/netty/netty/pull/10407">SSL default value introduced in Netty 4.1.52</a>, if you are using tcnative you need to update it to at least <code>2.0.33.Final</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_breaking_changes">Other Breaking Changes</h3>
<div class="paragraph">
<p>If the above cases don&#8217;t cover your use case see the section on <a href="#breaks">Breaking Changes</a> for a list of other changes that are regarded as breaking in this release.</p>
</div>
</div>

<h1 id="quickStart"><a class="anchor" href="#quickStart"></a>2 Quick Start</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following sections will walk you through a Quick start on how to use Micronaut to setup a basic "Hello World" application.</p>
</div>
<div class="paragraph">
<p>Before getting started ensure you have a Java 8 or above SDK installed and it is recommended having a suitable IDE such as IntelliJ IDEA.</p>
</div>
<div class="paragraph">
<p>To follow the Quick Start it is also recommended that you have the Micronaut CLI installed.</p>
</div>

<h2 id="buildCLI"><a class="anchor" href="#buildCLI"></a>2.1 Build/Install the CLI</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/buildCLI.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The best way to install Micronaut on Unix systems is with <a href="http://sdkman.io/">SDKMAN</a> which greatly simplifies installing and managing multiple Micronaut versions.</p>
</div>
<div class="paragraph">
<p>To see all the available installation methods, check the <a href="https://micronaut-projects.github.io/micronaut-starter/latest/guide/#installation">Micronaut Starter documentation</a>.</p>
</div>

<h2 id="creatingServer"><a class="anchor" href="#creatingServer"></a>2.2 Creating a Server Application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/creatingServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although not required to use Micronaut, the Micronaut CLI is the quickest way to create a new server application.</p>
</div>
<div class="paragraph">
<p>Using the CLI you can create a new Micronaut application in either Groovy, Java or Kotlin (the default is Java).</p>
</div>
<div class="paragraph">
<p>The following command creates a new "Hello World" server application in Java with a Gradle build:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The applications generated via our CLI come with Gradle or Maven wrappers, so its not even necessary to have Gradle or Maven installed on your machine to begin running the applications. Simply use the <code>mvnw</code> or <code>gradlew</code> command, as explained further below.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can supply <code>--build maven</code> if you wish to create a Maven based build instead
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command will create a new Java application in a directory called <code>hello-world</code> featuring a Gradle build. The application can be run with <code>./gradlew run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run
&gt; Task :run
[main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 972ms. Server Running: http://localhost:28933</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have created a Maven based project, use <code>./mvnw mn:run</code> instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Windows the ./ before commands is not needed
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the Micronaut HTTP server is configured to run on port 8080. See the section <a href="#runningSpecificPort">Running Server on a Specific Port</a> in the user guide for more options.</p>
</div>
<div class="paragraph">
<p>In order to create a service that responds to "Hello World" you first need a controller. The following is an example of a controller:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello") <b class="conum">(1)</b>
public class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    public String index() {
        return "Hello World"; <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller('/hello') <b class="conum">(1)</b>
class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    String index() {
        'Hello World' <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello") <b class="conum">(1)</b>
class HelloController {

    @Get(produces = [MediaType.TEXT_PLAIN]) <b class="conum">(2)</b>
    fun index(): String {
        return "Hello World" <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/hello</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation is used to map the <code>index</code> method to all requests that use an HTTP <code>GET</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A String "Hello World" is returned as the result</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Java, place the previous file in <code>src/main/java/hello/world</code>.<br>
If you are using Groovy, place the previous file in <code>src/main/groovy/hello/world</code>.<br>
If you are using Kotlin, place the previous file in <code>src/main/kotlin/hello/world</code>.</p>
</div>
<div class="paragraph">
<p>If you start the application and send a request to the <code>/hello</code> URI then the text "Hello World" is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:8080/hello
Hello World</code></pre>
</div>
</div>

<h2 id="ideSetup"><a class="anchor" href="#ideSetup"></a>2.3 Setting up an IDE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/ideSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The application created in the previous section contains a "main class" located in <code>src/main/java</code> that looks like the following:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String... args) {
        Micronaut.run Application.class
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.run(Application.javaClass)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the class that is run when running the application via Gradle or via deployment. You can also run the main class directly within your IDE if it is configured correctly.</p>
</div>

<h2 id="ideaSetup"><a class="anchor" href="#ideaSetup"></a>2.3.1 IntelliJ IDEA</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/ideSetup/ideaSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To import a Micronaut project into IntelliJ IDEA simply open the <code>build.gradle</code> or <code>pom.xml</code> file and follow the instructions to import the project.</p>
</div>
<div class="paragraph">
<p>For IntelliJ IDEA if you plan to use the IntelliJ compiler then you should enable annotation processing under the "Build, Execution, Deployment &#8594; Compiler &#8594; Annotation Processors" by ticking the "Enable annotation processing" checkbox:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/intellij-annotation-processors.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>Once you have enabled annotation processing in IntelliJ you can run the application and tests directly within the IDE without the need of an external build tool such as Gradle or Maven.</p>
</div>

<h2 id="eclipseSetup"><a class="anchor" href="#eclipseSetup"></a>2.3.2 Eclipse</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/ideSetup/eclipseSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you wish to use Eclipse IDE, it is recommended you import your Micronaut project into Eclipse using either <a href="https://projects.eclipse.org/projects/tools.buildship">Gradle BuildShip</a> for Gradle or <a href="http://www.eclipse.org/m2e/">M2Eclipse</a> for Maven.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut requires Eclipse IDE 4.9 or above
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_eclipse_and_gradle">Eclipse and Gradle</h3>
<div class="paragraph">
<p>Once you have setup Eclipse 4.9 or above with <a href="https://projects.eclipse.org/projects/tools.buildship">Gradle BuildShip</a> first run the <code>gradle eclipse</code> task from the root of your project then import the project by selecting <code>File &#8594; Import</code> then choosing <code>Gradle &#8594; Existing Gradle Project</code> and navigating to the root directory of your project (where the <code>build.gradle</code> is located).</p>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse_and_maven">Eclipse and Maven</h3>
<div class="paragraph">
<p>For Eclipse 4.9 and above with Maven you need the following Eclipse plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.eclipse.org/m2e/">M2Eclipse for Maven</a></p>
</li>
<li>
<p><a href="https://github.com/jbosstools/m2e-apt">Maven integration with Eclipse JDT Annotation Processor Toolkit</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once installed you need to import the project by selecting <code>File &#8594; Import</code> then choosing <code>Maven &#8594; Existing Maven Project</code> and navigating to the root directory of your project (where the <code>pom.xml</code> is located).</p>
</div>
<div class="paragraph">
<p>You should then enable annotation processing by opening <code>Eclipse &#8594; Preferences</code> and navigating to <code>Maven &#8594; Annotation Processing</code> and selecting the option <code>Automatically configure JDT APT</code>.</p>
</div>
</div>

<h2 id="vsCodeSetup"><a class="anchor" href="#vsCodeSetup"></a>2.3.3 Visual Studio Code</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/ideSetup/vsCodeSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut can be setup within Visual Studio Code. You will need to first install the The <a href="https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack">Java Extension Pack</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also optionally install <a href="https://marketplace.visualstudio.com/items?itemName=Pivotal.vscode-spring-boot">STS</a> to enable code completion for <code>application.yml</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Gradle prior to opening the project in VSC you should run the following command from a terminal window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew eclipse</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the extension pack is installed and if you have setup <a href="https://code.visualstudio.com/docs/setup/mac">terminal integration</a> just type <code>code .</code> in any project directory and the project will be automatically setup.</p>
</div>

<h2 id="creatingClient"><a class="anchor" href="#creatingClient"></a>2.4 Creating a Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/creatingClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Micronaut includes both an <a href="#httpServer">HTTP server</a> and an <a href="#httpClient">HTTP client</a>. A <a href="#lowLevelHttpClient">low-level HTTP client</a> is provided out of the box which you can use to test the <code>HelloController</code> created in the previous section.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Property;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import javax.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class HelloControllerSpec {
    @Inject
    EmbeddedServer server; <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client; <b class="conum">(2)</b>

    @Test
    void testHelloWorldResponse() {
        String response = client.toBlocking() <b class="conum">(3)</b>
                .retrieve(HttpRequest.GET("/hello"));
        assertEquals("Hello World", response); //) <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.annotation.MicronautTest
import spock.lang.Specification
import javax.inject.Inject

@MicronautTest
class HelloControllerSpec extends Specification {
    @Inject
    EmbeddedServer embeddedServer <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client <b class="conum">(2)</b>

    void "test hello world response"() {
        expect:
            client.toBlocking() <b class="conum">(3)</b>
                    .retrieve(HttpRequest.GET('/hello')) == "Hello World" <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Property
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import javax.inject.Inject

@MicronautTest
class HelloControllerSpec {

    @Inject
    lateinit var server: EmbeddedServer <b class="conum">(1)</b>

    @Inject
    @field:Client("/")
    lateinit var client: HttpClient <b class="conum">(2)</b>

    @Test
    fun testHelloWorldResponse() {
        val rsp: String = client.toBlocking() <b class="conum">(3)</b>
                .retrieve("/hello")
        assertEquals("Hello World", rsp) <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> is configured as a shared test field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> instance shared field is also defined</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The test using the <code>toBlocking()</code> method to make a blocking call</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>retrieve</code> method returns the response of the controller as a <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to a low-level client, Micronaut features a <a href="#clientAnnotation">declarative, compile-time HTTP client</a>, powered by the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>To create a client, simply create an interface annotated with <code>@Client</code>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Single;

@Client("/hello") <b class="conum">(1)</b>
public interface HelloClient {

    @Get(consumes = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    Single&lt;String&gt; hello(); <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Single

@Client("/hello") <b class="conum">(1)</b>
interface HelloClient {

    @Get(consumes = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    Single&lt;String&gt; hello() <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Single

@Client("/hello") <b class="conum">(1)</b>
interface HelloClient {

    @Get(consumes = [MediaType.TEXT_PLAIN]) <b class="conum">(2)</b>
    fun hello(): Single&lt;String&gt;  <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Client</code> annotation is used with value that is a relative path to the current server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The same <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation used on the server is used to define the client mapping</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> is returned with the value read from the server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To test the <code>HelloClient</code> simply retrieve it from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> associated with the server:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.test.annotation.MicronautTest;
import javax.inject.Inject;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest <b class="conum">(1)</b>
public class HelloClientSpec  {

    @Inject
    HelloClient client; <b class="conum">(2)</b>

    @Test
    public void testHelloWorldResponse(){
        assertEquals("Hello World", client.hello().blockingGet());<b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.test.annotation.MicronautTest
import spock.lang.Specification

import javax.inject.Inject

@MicronautTest <b class="conum">(1)</b>
class HelloClientSpec extends Specification {

    @Inject HelloClient client <b class="conum">(2)</b>


    void "test hello world response"() {
        expect:
        client.hello().blockingGet() == "Hello World" <b class="conum">(3)</b>
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Property
import io.micronaut.test.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import javax.inject.Inject

@MicronautTest <b class="conum">(1)</b>
class HelloClientSpec {

    @Inject
    lateinit var client: HelloClient <b class="conum">(2)</b>

    @Test
    fun testHelloWorldResponse() {
        assertEquals("Hello World", client.hello().blockingGet())<b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@MicronautTest</code> annotation is used to define the test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>HelloClient</code> is injected from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The client is invoked using RxJava&#8217;s <code>blockingGet</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation produces an implementation automatically for you at compile time without the need to use proxies or runtime reflection.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is very flexible. See the section on the <a href="#httpClient">Micronaut HTTP Client</a> for more information.</p>
</div>

<h2 id="deployingApp"><a class="anchor" href="#deployingApp"></a>2.5 Deploying the Application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/quickStart/deployingApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy a Micronaut application you create a runnable JAR file by running <code>./gradlew assemble</code> or <code>./mvnw package</code>.</p>
</div>
<div class="paragraph">
<p>The constructed JAR file can then be executed with <code>java -jar</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -jar build/libs/hello-world-all.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The runnable JAR can also easily be packaged within a Docker container or deployed to any Cloud infrastructure that supports runnable JAR  files.</p>
</div>

<h1 id="ioc"><a class="anchor" href="#ioc"></a>3 Inversion of Control</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When most developers think of Inversion of Control (also known as Dependency Injection and referred to as such from this point onwards) the Spring Framework comes to mind.</p>
</div>
<div class="paragraph">
<p>Micronaut takes inspiration from Spring, and in fact, the core developers of Micronaut are former SpringSource/Pivotal engineers now working for <a href="https://objectcomputing.com">OCI</a>.</p>
</div>
<div class="paragraph">
<p>Unlike Spring which relies exclusively on runtime reflection and proxies, Micronaut uses compile time data to implement dependency injection.</p>
</div>
<div class="paragraph">
<p>This is a similar approach taken by tools such as Google&#8217;s <a href="https://google.github.io/dagger/">Dagger</a>, which is designed primarily with Android in mind. Micronaut, on the other hand, is designed for building server-side microservices and provides many of the same tools and utilities as Spring but without using reflection or caching excessive amounts of reflection metadata.</p>
</div>
<div class="paragraph">
<p>The goals of the Micronaut IoC container are summarized as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use reflection as a last resort</p>
</li>
<li>
<p>Avoid proxies</p>
</li>
<li>
<p>Optimize start-up time</p>
</li>
<li>
<p>Reduce memory footprint</p>
</li>
<li>
<p>Provide clear, understandable error handling</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the IoC part of Micronaut can be used completely independently of Micronaut itself for whatever application type you may wish to build. To do so all you need to do is configure your build appropriately to include the <code>micronaut-inject-java</code> dependency as an annotation processor. For example with Gradle:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">plugins {
  id "com.diffplug.eclipse.apt" version "3.22.0" // <1>
}

...
dependencies {
    annotationProcessor("io.micronaut:micronaut-inject-java:2.1.0") // <2>
    implementation("io.micronaut:micronaut-inject:2.1.0")
    ...
    testAnnotationProcessor("io.micronaut:micronaut-inject-java:2.1.0") // <3>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply <code>com.diffplug.eclipse.apt</code> Gradle plugin which modifes Eclipse projects to include gradle annotationProcessor dependencies</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Include the minimal dependencies required to perform dependency injection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This is necessary to create beans in the <code>test</code> directory</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the Groovy language you should include <code>micronaut-inject-groovy</code> in the <code>compileOnly</code> and <code>testCompileOnly</code> scopes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The entry point for IoC is then the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> interface, which includes a <code>run</code> method. The following example demonstrates using it:</p>
</div>
<div class="listingblock">
<div class="title">Running the <code>ApplicationContext</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (ApplicationContext context = ApplicationContext.run()) { <i class="conum" data-value="1"></i><b>(1)</b>
    MyBean myBean = context.getBean(MyBean.class); <i class="conum" data-value="2"></i><b>(2)</b>
    // do something with your bean
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Run the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve a bean that has been dependency injected</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example uses Java&#8217;s <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> syntax to ensure the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is cleanly shutdown when the application exits.
</td>
</tr>
</table>
</div>

<h2 id="beans"><a class="anchor" href="#beans"></a>3.1 Defining Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/beans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A bean is an object that has its lifecycle controlled by the Micronaut IoC container. That lifecycle may include creation, execution, and destruction. Micronaut implements the <a href="http://javax-inject.github.io/javax-inject/">JSR-330 (javax.inject) - Dependency Injection for Java</a> specification hence to use Micronaut you simply use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/package-summary.html">annotations provided by javax.inject</a>.</p>
</div>
<div class="paragraph">
<p>The following is a simple example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Engine { <b class="conum">(1)</b>
    int getCylinders();
    String start();
}

@Singleton<b class="conum">(2)</b>
public class V8Engine implements Engine {
    @Override
    public String start() {
        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    private int cylinders = 8;
}

@Singleton
public class Vehicle {
    private final Engine engine;

    public Vehicle(Engine engine) {<b class="conum">(3)</b>
        this.engine = engine;
    }

    public String start() {
        return engine.start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface Engine { <b class="conum">(1)</b>
    int getCylinders()
    String start()
}

@Singleton <b class="conum">(2)</b>
class V8Engine implements Engine {
    int cylinders = 8

    @Override
    String start() {
        "Starting V8"
    }
}

@Singleton
class Vehicle {
    final Engine engine

    Vehicle(Engine engine) { <b class="conum">(3)</b>
        this.engine = engine
    }

    String start() {
        engine.start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface Engine {
    <b class="conum">(1)</b>
    val cylinders: Int

    fun start(): String
}

@Singleton<b class="conum">(2)</b>
class V8Engine : Engine {

    override var cylinders = 8
    override fun start(): String {
        return "Starting V8"
    }
}

@Singleton
class Vehicle(private val engine: Engine)<b class="conum">(3)</b>
{

    fun start(): String {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A common <code>Engine</code> interface is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>V8Engine</code> implementation is defined and marked with <code>Singleton</code> scope</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>Engine</code> is injected via constructor injection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform dependency injection simply run the  <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> using the <code>run()</code> method and lookup a bean using <code>getBean(Class)</code>, as per the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final BeanContext context = BeanContext.run();
Vehicle vehicle = context.getBean(Vehicle.class);
System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def context = BeanContext.run()
Vehicle vehicle = context.getBean(Vehicle)
println( vehicle.start() )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">val context = BeanContext.run()
val vehicle = context.getBean(Vehicle::class.java)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will automatically discover dependency injection metadata on the classpath and wire the beans together according to injection points you define.</p>
</div>
<div class="paragraph">
<p>Micronaut supports the following types of dependency injection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constructor injection (must be one public constructor or a single contructor annotated with <code>@Inject</code>)</p>
</li>
<li>
<p>Field injection</p>
</li>
<li>
<p>JavaBean property injection</p>
</li>
<li>
<p>Method parameter injection</p>
</li>
</ul>
</div>

<h2 id="how"><a class="anchor" href="#how"></a>3.2 How Does it Work?</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/how.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At this point, you may be wondering how Micronaut performs the above dependency injection without requiring reflection.</p>
</div>
<div class="paragraph">
<p>The key is a set of AST transformations (for Groovy) and annotation processors (for Java) that generate classes that implement the <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> interface.</p>
</div>
<div class="paragraph">
<p>The ASM byte-code library is used to generate classes and because Micronaut knows ahead of time the injection points, there is no need to scan all of the methods, fields, constructors, etc. at runtime like other frameworks such as Spring do.</p>
</div>
<div class="paragraph">
<p>Also since reflection is not used in the construction of the bean, the JVM can inline and optimize the code far better resulting in better runtime performance and reduced memory consumption. This is particularly important for non-singleton scopes where the application performance depends on bean creation performance.</p>
</div>
<div class="paragraph">
<p>In addition, with Micronaut your application startup time and memory consumption is not bound to the size of your codebase in the same way as a framework that uses reflection. Reflection based IoC frameworks load and cache reflection data for every single field, method, and constructor in your code. Thus as your code grows in size so do your memory requirements, whilst with Micronaut this is not the case.</p>
</div>

<h2 id="beanContext"><a class="anchor" href="#beanContext"></a>3.3 The BeanContext</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/beanContext.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> is a container object for all your bean definitions (it also implements <a href="../api/io/micronaut/context/BeanDefinitionRegistry.html">BeanDefinitionRegistry</a>).</p>
</div>
<div class="paragraph">
<p>It is also the point of initialization for Micronaut. Generally speaking however, you don&#8217;t have to interact directly with the <code>BeanContext</code> API and can simply use <code>javax.inject</code> annotations and the annotations defined within <a href="../api/io/micronaut/context/annotation/package-summary.html">io.micronaut.context.annotation</a> package for your dependency injection needs.</p>
</div>

<h2 id="types"><a class="anchor" href="#types"></a>3.4 Injectable Container Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/types.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to being able to inject beans Micronaut natively supports injecting the following types:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Injectable Container Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">java.util.Optional</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Optional</code> of a bean. If the bean doesn&#8217;t exist <code>empty()</code> is injected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html">java.lang.Iterable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Iterable</code> or subtype of <code>Iterable</code> (example <code>List</code>, <code>Collection</code> etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iterable&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">java.util.stream.Stream</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A lazy <code>Stream</code> of beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Array.html">Array</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A native array of beans of a given type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Engine[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Provider.html">Provider</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>javax.inject.Provider</code> if a circular dependency requires it or to instantiate a prototype for each <code>get</code> call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Provider&lt;Engine&gt;</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A prototype bean will have one instance created per place the bean is injected. When a prototype bean is injected as a <code>Provider</code>, each call to <code>get()</code> will create a new instance.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_collection_ordering">Collection Ordering</h3>
<div class="paragraph">
<p>When injecting a collection of beans, they will not be ordered by default. To allow for the beans to be ordered, implement the <a href="../api/io/micronaut/core/order/Ordered.html">Ordered</a> interface. If the requested bean type does not implement <a href="../api/io/micronaut/core/ordere/Ordered.html">Ordered</a>, then the <a href="../api/io/micronaut/core/annotation/Order.html">@Order</a> annotation will be searched for on any beans.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/Order.html">@Order</a> annotation is especially useful for ordering beans created by factories where the bean type is a class in a third party library. In this example, both <code>LowRateLimit</code> and <code>HighRateLimit</code> implement the <code>RateLimit</code> interface.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory with @Order</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Factory;
import io.micronaut.core.annotation.Order;

import javax.inject.Singleton;
import java.time.Duration;

@Factory
public class RateLimitsFactory {

    @Singleton
    @Order(20)
    LowRateLimit rateLimit2() {
        return new LowRateLimit(Duration.ofMinutes(50), 100);
    }

    @Singleton
    @Order(10)
    HighRateLimit rateLimit1() {
        return new HighRateLimit(Duration.ofMinutes(50), 1000);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory with @Order</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.Order

import javax.inject.Singleton
import java.time.Duration

@Factory
class RateLimitsFactory {

    @Singleton
    @Order(20)
    LowRateLimit rateLimit2() {
        new LowRateLimit(Duration.ofMinutes(50), 100);
    }

    @Singleton
    @Order(10)
    HighRateLimit rateLimit1() {
        new HighRateLimit(Duration.ofMinutes(50), 1000);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory with @Order</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.Order
import java.time.Duration
import javax.inject.Singleton

@Factory
class RateLimitsFactory {

    @Singleton
    @Order(20)
    fun rateLimit2(): LowRateLimit {
        return LowRateLimit(Duration.ofMinutes(50), 100)
    }

    @Singleton
    @Order(10)
    fun rateLimit1(): HighRateLimit {
        return HighRateLimit(Duration.ofMinutes(50), 1000)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a collection of <code>RateLimit</code> beans are requested from the context, they will be returned in ascending order based on the value supplied in the annotation.</p>
</div>
</div>

<h2 id="qualifiers"><a class="anchor" href="#qualifiers"></a>3.5 Bean Qualifiers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/qualifiers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you have multiple possible implementations for a given interface that you want to inject, you need to use a qualifier.</p>
</div>
<div class="paragraph">
<p>Once again Micronaut leverages JSR-330 and the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> and <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotations to support this use case.</p>
</div>
<div class="sect1">
<h2 id="_qualifying_by_name">Qualifying By Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To qualify by name you can use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotation. For example, consider the following classes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Engine { <b class="conum">(1)</b>
    int getCylinders();
    String start();
}

@Singleton
public class V6Engine implements Engine {  <b class="conum">(2)</b>
    @Override
    public String start() {
        return "Starting V6";
    }

    @Override
    public int getCylinders() {
        return 6;
    }
}

@Singleton
public class V8Engine implements Engine {
    @Override
    public String start() {
        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return 8;
    }

}

@Singleton
public class Vehicle {
    private final Engine engine;

    @Inject
    public Vehicle(@Named("v8") Engine engine) {<b class="conum">(4)</b>
        this.engine = engine;
    }

    public String start() {
        return engine.start();<b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface Engine { <b class="conum">(1)</b>
    int getCylinders()
    String start()
}

@Singleton
class V6Engine implements Engine { <b class="conum">(2)</b>
    int cylinders = 6

    @Override
    String start() {
        "Starting V6"
    }
}

@Singleton
class V8Engine implements Engine { <b class="conum">(3)</b>
    int cylinders = 8

    @Override
    String start() {
        "Starting V8"
    }
}

@Singleton
class Vehicle {
    final Engine engine

    @Inject Vehicle(@Named('v8') Engine engine) { <b class="conum">(4)</b>
        this.engine = engine
    }

    String start() {
        engine.start() <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface Engine { <b class="conum">(1)</b>
    val cylinders: Int
    fun start(): String
}

@Singleton
class V6Engine : Engine {  <b class="conum">(2)</b>

    override var cylinders: Int = 6

    override fun start(): String {
        return "Starting V6"
    }
}

@Singleton
class V8Engine : Engine {

    override var cylinders: Int = 8

    override fun start(): String {
        return "Starting V8"
    }

}

@Singleton
class Vehicle @Inject
constructor(@param:Named("v8") private val engine: Engine)<b class="conum">(4)</b>
{

    fun start(): String {
        return engine.start()<b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Engine</code> interface defines the common contract</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>V6Engine</code> class is the first implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>V8Engine</code> class is the second implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">javax.inject.Named</a> annotation is used to indicate the <code>V8Engine</code> implementation is required</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Calling the start method prints: <code>"Starting V8"</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut is capable of injecting <code>V8Engine</code> in the previous example, because:</p>
</div>
<div class="paragraph">
<p><code>@Named</code> qualifier value (<code>v8</code>) + type being injected simple name (<code>Engine</code>) == (case insensitive) == The simple name of a bean of type <code>Engine</code> (<code>V8Engine</code>)</p>
</div>
<div class="paragraph">
<p>You can also declare <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">@Named</a> at the class level of a bean to explicitly define the name of the bean.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qualifying_by_annotation">Qualifying By Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to being able to qualify by name, you can build your own qualifiers using the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> annotation. For example, consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Qualifier;
import java.lang.annotation.Retention;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Qualifier
@Retention(RUNTIME)
public @interface V8 {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Qualifier
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Qualifier
@Retention(RUNTIME)
@interface V8 {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Qualifier
import java.lang.annotation.Retention
import java.lang.annotation.RetentionPolicy.RUNTIME

@Qualifier
@Retention(RUNTIME)
annotation class V8</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above annotation is itself annotated with the <code>@Qualifier</code> annotation to designate it as a qualifier. You can then use the annotation at any injection point in your code. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Inject Vehicle(@V8 Engine engine) {
        this.engine = engine;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Inject Vehicle(@V8 Engine engine) {
        this.engine = engine
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject constructor(@V8 val engine: Engine) {</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_primary_and_secondary_beans">Primary and Secondary Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../api/io/micronaut/context/annotation/Primary.html">Primary</a> is a qualifier that indicates that a bean is the primary bean that should be selected in the case of multiple possible interface implementations.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ColorPicker {
    String color();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface ColorPicker {
    String color()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface ColorPicker {
    fun color(): String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given a common interface called <code>ColorPicker</code> that is implemented by multiple classes.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Primary;
import javax.inject.Singleton;

@Primary
@Singleton
class Green implements ColorPicker {

    @Override
    public String color() {
        return "green";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Primary
import javax.inject.Singleton

@Primary
@Singleton
class Green implements ColorPicker {

    @Override
    String color() {
        return "green"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Primary
import javax.inject.Singleton


@Primary
@Singleton
class Green: ColorPicker {
    override fun color(): String {
        return "green"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Green</code> bean is a <code>ColorPicker</code>, but is annotated with <code>@Primary</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;


@Singleton
public class Blue implements ColorPicker {

    @Override
    public String color() {
        return "blue";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton


@Singleton
class Blue implements ColorPicker {

    @Override
    String color() {
        return "blue"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton


@Singleton
class Blue: ColorPicker {
    override fun color(): String {
        return "blue"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Blue</code> bean is also a <code>ColorPicker</code> and hence you have two possible candidates when injecting the <code>ColorPicker</code> interface. Since <code>Green</code> is the primary it will always be favoured.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/testPrimary")
public class TestController {

    protected final ColorPicker colorPicker;

    public TestController(ColorPicker colorPicker) { <b class="conum">(1)</b>
        this.colorPicker = colorPicker;
    }

    @Get
    public String index() {
        return colorPicker.color();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/test")
class TestController {

    protected final ColorPicker colorPicker

    TestController(ColorPicker colorPicker) { <b class="conum">(1)</b>
        this.colorPicker = colorPicker
    }

    @Get
    String index() {
        colorPicker.color()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/test")
class TestController(val colorPicker: ColorPicker) { <b class="conum">(1)</b>

    @Get
    fun index(): String {
        return colorPicker.color()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Although there are two <code>ColorPicker</code> beans, <code>Green</code> gets injected due to the <code>@Primary</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If multiple possible candidates are present and no <code>@Primary</code> is defined then a <a href="../api/io/micronaut/context/exceptions/NonUniqueBeanException.html">NonUniqueBeanException</a> will be thrown.</p>
</div>
<div class="paragraph">
<p>In addition to <code>@Primary</code>, there is also a <a href="../api/io/micronaut/context/annotation/Secondary.html">Secondary</a> annotation which causes the opposite effect and allows de-prioritizing a bean.</p>
</div>
</div>
</div>

<h2 id="scopes"><a class="anchor" href="#scopes"></a>3.6 Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/scopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features an extensible bean scoping mechanism based on JSR-330. The following default scopes are supported:</p>
</div>

<h2 id="builtInScopes"><a class="anchor" href="#builtInScopes"></a>3.6.1 Built-In Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/scopes/builtInScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Built-in Scopes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">@Singleton</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Singleton scope indicates only one instance of the bean should exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Context.html">@Context</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context scope indicates that the bean should be created at the same time as the <code>ApplicationContext</code> (eager initialization)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prototype scope indicates that a new instance of the bean is created each time it is injected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Infrastructure.html">@Infrastructure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure scope represents a bean that cannot be overridden or replaced using <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> because it is critical to the functioning of the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/ThreadLocal.html">@ThreadLocal</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ThreadLocal</code> scope is a custom scope that associates a bean per thread via a ThreadLocal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Refreshable</code> scope is a custom scope that allows a bean&#8217;s state to be refreshed via the <code>/refresh</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/http/scope/RequestScope.html">@RequestScope</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestScope</code> scope is a custom scope that indicates a new instance of the bean is created and associated with each HTTP request</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a> annotation is a synonym for <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> because the default scope is prototype.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional scopes can be added by defining a <code>@Singleton</code> bean that implements the <a href="../api/io/micronaut/context/scope/CustomScope.html">CustomScope</a> interface.</p>
</div>
<div class="paragraph">
<p>Note that with Micronaut when starting an <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> by default <code>@Singleton</code> scoped beans are created lazily and on demand. This is by design and to optimize startup time.</p>
</div>
<div class="paragraph">
<p>If this presents a problem for your use case you have the option of using the <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> annotation which binds the lifecycle of your object to the lifecycle of the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>. In other words when the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is started your bean will be created.</p>
</div>
<div class="paragraph">
<p>Alternatively you can annotate any <code>@Singleton</code> scoped bean with <a href="../api/io/micronaut/context/annotation/Parallel.html">@Parallel</a> which allows parallel initialization of your bean without impacting overall startup time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your bean fails to initialize in parallel then the application will be automatically shutdown.
</td>
</tr>
</table>
</div>

<h2 id="eagerInit"><a class="anchor" href="#eagerInit"></a>3.6.1.1 Eager Initialization of Singletons</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/scopes/builtInScopes/eagerInit.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Eager initialization of <code>@Singleton</code> beans maybe desirable in certain scenarios, such as on AWS Lambda where more CPU resources are assigned to Lamdba construction than execution.</p>
</div>
<div class="paragraph">
<p>You can specify whether you want to initialize eagerly <code>@Singleton</code> scoped beans using the <a href="../api/io/micronaut/context/scope/ApplicationContextBuilder.html">ApplicationContextBuilder</a> interface:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Eager Initialization of Singletons</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Application {

    public static void main(String[] args) {
        Micronaut.build(args)
            .eagerInitSingletons(true) <i class="conum" data-value="1"></i><b>(1)</b>
            .mainClass(Application.class)
            .start();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting eager init to true initializes all singletons</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you use Micronaut in environments such as <a href="#serverlessFunctions">Serverless Functions</a>, you will not have an Application class and instead you extend a Micronaut provided class. In those cases, Micronaut provides methods which you can override to enhance the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a></p>
</div>
<div class="listingblock">
<div class="title">Override of newApplicationContextBuilder()</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyFunctionHandler extends MicronautRequestHandler&lt;APIGatewayProxyRequestEvent, APIGatewayProxyResponseEvent&gt; {
...
    @Nonnull
    @Override
    protected ApplicationContextBuilder newApplicationContextBuilder() {
        ApplicationContextBuilder builder = super.newApplicationContextBuilder();
        builder.eagerInitSingletons(true);
        return builder;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="../api/io/micronaut/context/annotation/ConfigurationReader.html">@ConfigurationReader</a> beans such as <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a>  or <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> are singleton beans. If you want to eager init configuration, but keep other <code>@Singleton</code> scoped beans creation lazy, use <code>eagerInitConfiguration</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Eager Initialization of Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Application {

    public static void main(String[] args) {
        Micronaut.build(args)
            .eagerInitConfiguration(true) <i class="conum" data-value="1"></i><b>(1)</b>
            .mainClass(Application.class)
            .start();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting eager init to true initializes all configuration reader beans.</td>
</tr>
</table>
</div>

<h2 id="refreshable"><a class="anchor" href="#refreshable"></a>3.6.2 Refreshable Scope</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/scopes/refreshable.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">Refreshable</a> scope is a custom scope that allows a beans state to be refreshed via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/refresh</code> endpoint.</p>
</li>
<li>
<p>Publication of a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example, illustrates the <code>@Refreshable</code> scope behavior.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Refreshable <b class="conum">(1)</b>
public static class WeatherService {
    private String forecast;

    @PostConstruct
    public void init() {
        forecast = "Scattered Clouds " + new SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(new Date());<b class="conum">(2)</b>
    }

    public String latestForecast() {
        return forecast;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Refreshable <b class="conum">(1)</b>
static class WeatherService {

    String forecast

    @PostConstruct
    void init() {
        forecast = "Scattered Clouds ${new SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(new Date())}" <b class="conum">(2)</b>
    }

    String latestForecast() {
        return forecast
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Refreshable <b class="conum">(1)</b>
open class WeatherService {
    private var forecast: String? = null

    @PostConstruct
    fun init() {
        forecast = "Scattered Clouds " + SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(Date())<b class="conum">(2)</b>
    }

    open fun latestForecast(): String? {
        return forecast
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>WeatherService</code> is annotated with <code>@Refreshable</code> scope which stores an instance until a refresh event is triggered</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>forecast</code> property is set to a fixed value when the bean is created and won&#8217;t change until the bean is refreshed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you invoke the <code>latestForecast()</code> twice, you will see identical responses such as <code>"Scattered Clouds 01/Feb/18 10:29.199"</code>.</p>
</div>
<div class="paragraph">
<p>When the <code>/refresh</code> endpoint is invoked or a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> is published then the instance is invalidated and a new instance is created the next time the object is requested. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">applicationContext.publishEvent(new RefreshEvent());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">applicationContext.publishEvent(new RefreshEvent())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">applicationContext.publishEvent(RefreshEvent())</code></pre>
</div>
</div>

<h2 id="metaScopes"><a class="anchor" href="#metaScopes"></a>3.6.3 Scopes on Meta Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/scopes/metaScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Scopes can be defined on Meta annotations that you can then apply to your classes. Consider the following example meta annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import static java.lang.annotation.RetentionPolicy.RUNTIME;

import io.micronaut.context.annotation.Requires;

import javax.inject.Singleton;
import java.lang.annotation.Documented;
import java.lang.annotation.Retention;

@Requires(classes = Car.class ) <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
public @interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires

import javax.inject.Singleton
import java.lang.annotation.Documented
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Requires(classes = Car.class ) <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
@interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import javax.inject.Singleton


@Requires(classes = [Car::class]) <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
@MustBeDocumented
@Retention(AnnotationRetention.RUNTIME)
annotation class Driver</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The scope declares a requirement on a <code>Car</code> class using <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation is declared as <code>@Singleton</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example above the <code>@Singleton</code> annotation is applied to the <code>@Driver</code> annotation which results in every class that is annotated with <code>@Driver</code> being regarded as singleton.</p>
</div>
<div class="paragraph">
<p>Note that in this case it is not possible to alter the scope when the annotation is applied. For example, the following will not override the scope declared by <code>@Driver</code> and is invalid:</p>
</div>
<div class="listingblock">
<div class="title">Declaring Another Scope</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Driver
@Prototype
class Foo {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish for the scope to be overridable you should instead use the <a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> annotation on <code>@Driver</code> which allows a default scope to be specified if none other is present:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @DefaultScope</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(classes = Car.class )
@DefaultScope(Singleton.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
public @interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Requires(classes = Car.class )
@DefaultScope(Singleton.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
@interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Requires(classes = [Car::class])
@DefaultScope(Singleton::class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
annotation class Driver</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> is used to declare which scope to be used if none is present</td>
</tr>
</table>
</div>

<h2 id="factories"><a class="anchor" href="#factories"></a>3.7 Bean Factories</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/factories.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In many cases, you may want to make available as a bean a class that is not part of your codebase such as those provided by third-party libraries. In this case, you cannot annotate the already compiled class. Instead, you should implement a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a>.</p>
</div>
<div class="paragraph">
<p>A factory is a class annotated with the <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> annotation that provides 1 or more methods annotated with a bean scope annotation. Which annotation you use depends on what scope you want the bean to be in. See the section on <a href="#scopes">bean scopes</a> for more information.</p>
</div>
<div class="paragraph">
<p>The return types of methods annotated with a bean scope annotation are the bean types. This is best illustrated by an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
class CrankShaft {
}

class V8Engine implements Engine {
    private final int cylinders = 8;
    private final CrankShaft crankShaft;

    public V8Engine(CrankShaft crankShaft) {
        this.crankShaft = crankShaft;
    }

    @Override
    public String start() {
        return "Starting V8";
    }
}

@Factory
class EngineFactory {

    @Singleton
    Engine v8Engine(CrankShaft crankShaft) {
        return new V8Engine(crankShaft);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class CrankShaft {
}

class V8Engine implements Engine {
    final int cylinders = 8
    final CrankShaft crankShaft

    V8Engine(CrankShaft crankShaft) {
        this.crankShaft = crankShaft
    }

    @Override
    String start() {
        "Starting V8"
    }
}

@Factory
class EngineFactory {

    @Singleton
    Engine v8Engine(CrankShaft crankShaft) {
        new V8Engine(crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
internal class CrankShaft

internal class V8Engine(private val crankShaft: CrankShaft) : Engine {
    private val cylinders = 8

    override fun start(): String {
        return "Starting V8"
    }
}

@Factory
internal class EngineFactory {

    @Singleton
    fun v8Engine(crankShaft: CrankShaft): Engine {
        return V8Engine(crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>V8Engine</code> is built by the <code>EngineFactory</code> class' <code>v8Engine</code> method. Note that you can inject parameters into the method and these parameters will be resolved as beans. The resulting <code>V8Engine</code> bean will be a singleton.</p>
</div>
<div class="paragraph">
<p>A factory can have multiple methods annotated with bean scope annotations, each one returning a distinct bean type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you take this approach, then you should not invoke other bean methods internally within the class. Instead, inject the types via parameters.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To allow the resulting bean to participate in the application context shutdown process, annotate the method with <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> and set the <code>preDestroy</code> argument to the name of the method that should be called to close the bean.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_programmatically_disabling_beans">Programmatically Disabling Beans</h3>
<div class="paragraph">
<p>Factory methods can return throw <a href="../api/io/micronaut/context/exceptions/DisabledBeanException.html">DisabledBeanException</a> to allow for beans to be disabled conditionally. The use of <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> should always be the preferred method to conditionally create beans and throwing an exception a factory method should only be done if using <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> is not possible.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Engine {
    Integer getCylinders();
}

@EachProperty("engines")
public class EngineConfiguration implements Toggleable {

    private boolean enabled = true;
    private Integer cylinders;

    @NotNull
    public Integer getCylinders() {
        return cylinders;
    }

    public void setCylinders(Integer cylinders) {
        this.cylinders = cylinders;
    }

    @Override
    public boolean isEnabled() {
        return enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }

}

@Factory
public class EngineFactory {

    @EachBean(EngineConfiguration.class)
    public Engine buildEngine(EngineConfiguration engineConfiguration) {
        if (engineConfiguration.isEnabled()) {
            return engineConfiguration::getCylinders;
        } else {
            throw new DisabledBeanException("Engine configuration disabled");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">interface Engine {
    Integer getCylinders()
}

@EachProperty("engines")
class EngineConfiguration implements Toggleable {
    boolean enabled = true
    @NotNull
    Integer cylinders
}

@Factory
class EngineFactory {

    @EachBean(EngineConfiguration)
    Engine buildEngine(EngineConfiguration engineConfiguration) {
        if (engineConfiguration.enabled) {
            (Engine){ -&gt; engineConfiguration.cylinders }
        } else {
            throw new DisabledBeanException("Engine configuration disabled")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">interface Engine {
    fun getCylinders(): Int
}

@EachProperty("engines")
class EngineConfiguration : Toggleable {

    val enabled = true

    @NotNull
    val cylinders: Int? = null

    override fun isEnabled(): Boolean {
        return enabled
    }
}

@Factory
class EngineFactory {

    @EachBean(EngineConfiguration::class)
    fun buildEngine(engineConfiguration: EngineConfiguration): Engine? {
        return if (engineConfiguration.isEnabled) {
            object : Engine {
                override fun getCylinders(): Int {
                    return engineConfiguration.cylinders!!
                }
            }
        } else {
            throw DisabledBeanException("Engine configuration disabled")
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_injection_point">Injection Point</h3>
<div class="paragraph">
<p>A common use case with factories is to take advantage of annotation metadata from the point at which an object is injected such that behaviour can be modified based on said metadata.</p>
</div>
<div class="paragraph">
<p>Consider an annotation such as the following:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Documented
@Retention(RUNTIME)
@Target(ElementType.PARAMETER)
public @interface Cylinders {
    int value() default 8;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Documented
@Retention(RUNTIME)
@Target(ElementType.PARAMETER)
@interface Cylinders {
    int value() default 8
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@MustBeDocumented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.VALUE_PARAMETER)
annotation class Cylinders(val value: Int = 8)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above annotation could be used to customize the type of engine we want to inject into a vehicle at the point at which the injection point is defined:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
class Vehicle {
    private final Engine engine;
    Vehicle(@Cylinders(6) Engine engine) {
        this.engine = engine;
    }

    String start() {
        return engine.start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class Vehicle {
    private final Engine engine
    Vehicle(@Cylinders(6) Engine engine) {
        this.engine = engine
    }

    String start() {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
internal class Vehicle(@param:Cylinders(6) private val engine: Engine) {
    fun start(): String {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>Vehicle</code> class specifies an annotation value of <code>@Cylinders(6)</code> indicating an <code>Engine</code> of six cylinders is needed.</p>
</div>
<div class="paragraph">
<p>To implement this use case you can define a factory that accepts the <a href="../api/io/micronaut/inject/InjectionPoint.html">InjectionPoint</a> instance which can be used to analyze the annotation values defined:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
class EngineFactory {

    @Prototype
    Engine v8Engine(InjectionPoint&lt;?&gt; injectionPoint, CrankShaft crankShaft) { <b class="conum">(1)</b>
        final int cylinders = injectionPoint
                .getAnnotationMetadata()
                .intValue(Cylinders.class).orElse(8); <b class="conum">(2)</b>
        switch (cylinders) { <b class="conum">(3)</b>
            case 6:
                return new V6Engine(crankShaft);
            case 8:
                return new V8Engine(crankShaft);
            default:
                throw new IllegalArgumentException("Unsupported number of cylinders specified: " + cylinders);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
class EngineFactory {

    @Prototype
    Engine v8Engine(InjectionPoint&lt;?&gt; injectionPoint, CrankShaft crankShaft) { <b class="conum">(1)</b>
        final int cylinders = injectionPoint
                .getAnnotationMetadata()
                .intValue(Cylinders.class).orElse(8) <b class="conum">(2)</b>
        switch (cylinders) { <b class="conum">(3)</b>
            case 6:
                return new V6Engine(crankShaft)
            case 8:
                return new V8Engine(crankShaft)
            default:
                throw new IllegalArgumentException("Unsupported number of cylinders specified: $cylinders")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
internal class EngineFactory {

    @Prototype
    fun v8Engine(injectionPoint: InjectionPoint&lt;*&gt;, crankShaft: CrankShaft): Engine { <b class="conum">(1)</b>
        val cylinders = injectionPoint
                .annotationMetadata
                .intValue(Cylinders::class.java).orElse(8) <b class="conum">(2)</b>
        return when (cylinders) { <b class="conum">(3)</b>
            6 -&gt; V6Engine(crankShaft)
            8 -&gt; V8Engine(crankShaft)
            else -&gt; throw IllegalArgumentException("Unsupported number of cylinders specified: $cylinders")
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The factory method defines a parameter of type <a href="../api/io/micronaut/inject/InjectionPoint.html">InjectionPoint</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation metadata is used to obtain the value of the <code>@Cylinder</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The value is used to construct an engine, throwing an exception if an engine cannot be constructed.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to note that the factory is declared as <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a> scope so that the method is invoked for each injection point. If the <code>V8Engine</code> and <code>V6Engine</code> types are required to be singletons then the factory should use a map to ensure the objects are only constructed once.
</td>
</tr>
</table>
</div>
</div>

<h2 id="conditionalBeans"><a class="anchor" href="#conditionalBeans"></a>3.8 Conditional Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/conditionalBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At times you may want a bean to load conditionally based on various potential factors including the classpath, the configuration, the presence of other beans etc.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation provides the ability to define one or many conditions on a bean.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public class JdbcBookService implements BookService {

    DataSource dataSource;

    public JdbcBookService(DataSource dataSource) {
        this.dataSource = dataSource;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
class JdbcBookService implements BookService {

    DataSource dataSource</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
class JdbcBookService(internal var dataSource: DataSource) : BookService {</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above bean defines two requirements. The first indicates that a <code>DataSource</code> bean must be present for the bean to load. The second requirement ensures that the <code>datasource.url</code> property is set before loading the <code>JdbcBookService</code> bean.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Kotlin currently does not support repeatable annotations. Use the <code>@Requirements</code> annotation when multiple requires are needed. For example, <code>@Requirements(Requires(&#8230;&#8203;), Requires(&#8230;&#8203;))</code>. See <a href="https://youtrack.jetbrains.com/issue/KT-12794" class="bare">https://youtrack.jetbrains.com/issue/KT-12794</a> to track this feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have multiple requirements that you find you may need to repeat on multiple beans then you can define a meta-annotation with the requirements:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.PACKAGE, ElementType.TYPE})
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public @interface RequiresJdbc {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.PACKAGE, ElementType.TYPE])
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
@interface RequiresJdbc {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Documented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.CLASS, AnnotationTarget.FILE)
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
annotation class RequiresJdbc</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example an annotation called <code>RequiresJdbc</code> is defined that can then be used on the <code>JdbcBookService</code> instead:</p>
</div>
<div class="listingblock">
<div class="title">Using a meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequiresJdbc
public class JdbcBookService implements BookService {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have multiple beans that need to fulfill a given requirement before loading then you may want to consider a bean configuration group, as explained in the next section.</p>
</div>
<div class="sect1">
<h2 id="_configuration_requirements">Configuration Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> annotation is very flexible and can be used for a variety of use cases. The following table summarizes some of the possibilities:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Using @Requires</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Requirement</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one ore more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(classes=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one ore more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missing=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(beans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingBeans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to not be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(notEnv="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(configuration="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingConfigurations="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require particular SDK version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(sdk=Sdk.JAVA, value="1.8")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires classes annotated with the given annotations to be available to the application via package scanning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(entities=javax.persistence.Entity)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property with an optional value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(property="data-source.url")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property to not be part of the configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingProperty="data-source.url")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one or more files in the file system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(resources="file:/path/to/file")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one or more classpath resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(resources="classpath:myFile.properties")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the current operating system to be in the list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(os={Requires.Family.WINDOWS})</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the current operating system to <strong>not</strong> be in the list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(notOs={Requires.Family.WINDOWS})</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_additional_notes_on_property_requirements">Additional Notes on Property Requirements.</h3>
<div class="paragraph">
<p>Adding a requirement on a property has some additional functionality. You can require the property to be a certain value, not be a certain value, and use a default in those checks if its not set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(property="foo") <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(property="foo", value="John") <i class="conum" data-value="2"></i><b>(2)</b>
@Requires(property="foo", value="John", defaultValue="John") <i class="conum" data-value="3"></i><b>(3)</b>
@Requires(property="foo", notEquals="Sally") <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Requires the property to be set</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Requires the property to be "John"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Requires the property to be "John" or not set</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Requires the property to not be "Sally" or not set</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_conditional_beans">Debugging Conditional Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have multiple conditions and complex requirements it may become difficult to understand why a particular bean has not been loaded.</p>
</div>
<div class="paragraph">
<p>To help resolve issues with conditional beans you can enable debug logging for the <code>io.micronaut.context.condition</code> package which will log the reasons why beans were not loaded.</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="io.micronaut.context.condition" level="DEBUG"/&gt;</code></pre>
</div>
</div>
</div>
</div>

<h2 id="replaces"><a class="anchor" href="#replaces"></a>3.9 Bean Replacement</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/replaces.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>One significant difference between Micronaut&#8217;s Dependency Injection system and Spring is the way beans can be replaced.</p>
</div>
<div class="paragraph">
<p>In a Spring application, beans have names and can effectively be overridden simply by creating a bean with the same name, regardless of the type of the bean. Spring also has the notion of bean registration order, hence in Spring Boot you have <code>@AutoConfigureBefore</code> and <code>@AutoConfigureAfter</code> that control how beans override each other.</p>
</div>
<div class="paragraph">
<p>This strategy leads to difficult to debug problems, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bean loading order changes, leading to unexpected results</p>
</li>
<li>
<p>A bean with the same name overrides another bean with a different type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid these problems, Micronaut&#8217;s DI has no concept of bean names or load order. Beans have a type and a <a href="../api/io/micronaut/context/Qualifier.html">Qualifier</a>. You cannot override a bean of a completely different type with another.</p>
</div>
<div class="paragraph">
<p>A useful benefit of Spring&#8217;s approach is that it allows overriding existing beans to customize behaviour. In order to support the same ability, Micronaut&#8217;s DI provides an explicit <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation, which integrates nicely with support for <a href="#conditionalBeans">Conditional Beans</a> and clearly documents and expresses the intention of the developer.</p>
</div>
<div class="paragraph">
<p>Any existing bean can be replaced by another bean that declares <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a>. For example, consider the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public class JdbcBookService implements BookService {

    DataSource dataSource;

    public JdbcBookService(DataSource dataSource) {
        this.dataSource = dataSource;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
class JdbcBookService implements BookService {

    DataSource dataSource</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
class JdbcBookService(internal var dataSource: DataSource) : BookService {</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a class in <code>src/test/java</code> that replaces this class just for your tests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Replaces(JdbcBookService.class) <b class="conum">(1)</b>
@Singleton
public class MockBookService implements BookService {

    Map&lt;String, Book&gt; bookMap = new LinkedHashMap&lt;&gt;();

    @Override
    public Book findBook(String title) {
        return bookMap.get(title);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Replaces(JdbcBookService.class) <b class="conum">(1)</b>
@Singleton
class MockBookService implements BookService {

    Map&lt;String, Book&gt; bookMap = [:]

    @Override
    Book findBook(String title) {
        bookMap.get(title)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Replaces(JdbcBookService::class) <b class="conum">(1)</b>
@Singleton
class MockBookService : BookService {

    var bookMap: Map&lt;String, Book&gt; = LinkedHashMap()

    override fun findBook(title: String): Book? {
        return bookMap[title]
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>MockBookService</code> declares that it replaces <code>JdbcBookService</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_factory_replacement">Factory Replacement</h3>
<div class="paragraph">
<p>The <code>@Replaces</code> annotation also supports a <code>factory</code> argument. That argument allows the replacement of factory beans in their entirety or specific types created by the factory.</p>
</div>
<div class="paragraph">
<p>For example, it may be desired to replace all or part of the given factory class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
public class BookFactory {

    @Singleton
    Book novel() {
        return new Book("A Great Novel");
    }

    @Singleton
    TextBook textBook() {
        return new TextBook("Learning 101");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
class BookFactory {

    @Singleton
    Book novel() {
        new Book('A Great Novel')
    }

    @Singleton
    TextBook textBook() {
        new TextBook('Learning 101')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
class BookFactory {

    @Singleton
    internal fun novel(): Book {
        return Book("A Great Novel")
    }

    @Singleton
    internal fun textBook(): TextBook {
        return TextBook("Learning 101")
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
To replace a factory in its entirety, it is necessary that your factory methods match the return types of all of the methods in the replaced factory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, the <code>BookFactory#textBook()</code> will <strong>not</strong> be replaced because this factory does not have a factory method that returns a TextBook.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
@Replaces(factory = BookFactory.class)
public class CustomBookFactory {

    @Singleton
    Book otherNovel() {
        return new Book("An OK Novel");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
@Replaces(factory = BookFactory.class)
class CustomBookFactory {

    @Singleton
    Book otherNovel() {
        new Book('An OK Novel')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
@Replaces(factory = BookFactory::class)
class CustomBookFactory {

    @Singleton
    internal fun otherNovel(): Book {
        return Book("An OK Novel")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It may be the case that you don&#8217;t wish for the factory methods to be replaced, except for a select few. For that use case, you can apply the <code>@Replaces</code> annotation on the method and denote the factory that it should apply to.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
public class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook.class, factory = BookFactory.class)
    TextBook textBook() {
        return new TextBook("Learning 305");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook.class, factory = BookFactory.class)
    TextBook textBook() {
        new TextBook('Learning 305')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook::class, factory = BookFactory::class)
    internal fun textBook(): TextBook {
        return TextBook("Learning 305")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BookFactory#novel()</code> method will not be replaced because the TextBook class is defined in the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_implementation">Default Implementation</h3>
<div class="paragraph">
<p>When exposing an API, it may be desirable for the default implementation of an interface to not be exposed as part of the public API. Doing so would prevent users from being able to replace the implementation because they would not be able to reference the class. The solution is to annotate the interface with <a href="../api/io/micronaut/context/annotation/DefaultImplementation.html">DefaultImplementation</a> to indicate which implementation should be replaced if a user creates a bean that <code>@Replaces(YourInterface.class)</code>.</p>
</div>
<div class="paragraph">
<p>For example consider:</p>
</div>
<div class="paragraph">
<p>A public API contract</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.DefaultImplementation;

@DefaultImplementation(DefaultResponseStrategy.class)
public interface ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.DefaultImplementation

@DefaultImplementation(DefaultResponseStrategy)
interface ResponseStrategy {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.DefaultImplementation

@DefaultImplementation(DefaultResponseStrategy::class)
interface ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default implementation</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;

@Singleton
class DefaultResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton

@Singleton
class DefaultResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton

@Singleton
internal class DefaultResponseStrategy : ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom implementation</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Replaces;
import javax.inject.Singleton;

@Singleton
@Replaces(ResponseStrategy.class)
public class CustomResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Replaces
import javax.inject.Singleton

@Singleton
@Replaces(ResponseStrategy)
class CustomResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Replaces
import javax.inject.Singleton

@Singleton
@Replaces(ResponseStrategy::class)
class CustomResponseStrategy : ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the <code>CustomResponseStrategy</code> will replace the <code>DefaultResponseStrategy</code> because the <a href="../api/io/micronaut/context/annotation/DefaultImplementation.html">DefaultImplementation</a> annotation points to the <code>DefaultResponseStrategy</code>.</p>
</div>
</div>

<h2 id="beanConfigurations"><a class="anchor" href="#beanConfigurations"></a>3.10 Bean Configurations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/beanConfigurations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A bean <a href="../api/io/micronaut/context/annotation/Configuration.html">@Configuration</a> is a grouping of multiple bean definitions within a package.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is applied at the package level and informs Micronaut that the beans defined with the package form a logical grouping.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is typically applied to <code>package-info</code> class. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Configuration
package my.package

import io.micronaut.context.annotation.Configuration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where this grouping becomes useful is when the bean configuration is made conditional via the <code>@Requires</code> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Configuration
@Requires(beans = javax.sql.DataSource)
package my.package</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, all bean definitions within the annotated package will only be loaded and made available if a <code>javax.sql.DataSource</code> bean is present. This allows you to implement conditional auto-configuration of bean definitions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java and Kotlin also support this functionality via <code>package-info.java</code>. Kotlin does not support a <code>package-info.kt</code> as of version 1.3.
</td>
</tr>
</table>
</div>

<h2 id="lifecycle"><a class="anchor" href="#lifecycle"></a>3.11 Life-Cycle Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/lifecycle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_when_the_context_starts">When The Context Starts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish for a particular method to be invoked when a bean is constructed then you can use the <code>javax.annotation.PostConstruct</code> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.annotation.PostConstruct; <b class="conum">(1)</b>
import javax.inject.Singleton;

@Singleton
public class V8Engine implements Engine {
    private int cylinders = 8;
    private boolean initialized = false; <b class="conum">(2)</b>

    @Override
    public String start() {
        if(!initialized) {
            throw new IllegalStateException("Engine not initialized!");
        }

        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return cylinders;
    }

    public boolean isIntialized() {
        return this.initialized;
    }

    @PostConstruct <b class="conum">(3)</b>
    public void initialize() {
        this.initialized = true;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.annotation.PostConstruct <b class="conum">(1)</b>
import javax.inject.Singleton

@Singleton
class V8Engine implements Engine {
    int cylinders = 8
    boolean initialized = false <b class="conum">(2)</b>

    @Override
    String start() {
        if(!initialized) throw new IllegalStateException("Engine not initialized!")

        return "Starting V8"
    }

    @PostConstruct <b class="conum">(3)</b>
    void initialize() {
        this.initialized = true
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.annotation.PostConstruct
import javax.inject.Singleton


@Singleton
class V8Engine : Engine {
    override val cylinders = 8
    var isIntialized = false
        private set <b class="conum">(2)</b>

    override fun start(): String {
        check(isIntialized) { "Engine not initialized!" }

        return "Starting V8"
    }

    @PostConstruct <b class="conum">(3)</b>
    fun initialize() {
        this.isIntialized = true
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PostConstruct</code> annotation is imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A field is defined that requires initialization</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A method is annotated with <code>@PostConstruct</code> and will be invoked once the object is constructed and fully injected.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_the_context_closes">When The Context Closes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish for a particular method to be invoked when the context is closed then you can use the <code>javax.annotation.PreDestroy</code> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.annotation.PreDestroy; <b class="conum">(1)</b>
import javax.inject.Singleton;
import java.util.concurrent.atomic.AtomicBoolean;

@Singleton
public class PreDestroyBean implements AutoCloseable {

    AtomicBoolean stopped = new AtomicBoolean(false);

    @PreDestroy <b class="conum">(2)</b>
    @Override
    public void close() throws Exception {
        stopped.compareAndSet(false, true);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.annotation.PreDestroy <b class="conum">(1)</b>
import java.util.concurrent.atomic.AtomicBoolean
import javax.inject.Singleton

@Singleton
class PreDestroyBean implements AutoCloseable {

    AtomicBoolean stopped = new AtomicBoolean(false)

    @PreDestroy <b class="conum">(2)</b>
    @Override
    void close() throws Exception {
        stopped.compareAndSet(false, true)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.annotation.PreDestroy
import javax.inject.Singleton
import java.util.concurrent.atomic.AtomicBoolean

@Singleton
class PreDestroyBean : AutoCloseable {

    internal var stopped = AtomicBoolean(false)

    @PreDestroy <b class="conum">(2)</b>
    @Throws(Exception::class)
    override fun close() {
        stopped.compareAndSet(false, true)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PreDestroy</code> annotation is imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A method is annotated with <code>@PreDestroy</code> and will be invoked when the context is closed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For factory beans, the <code>preDestroy</code> value in the <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation can be used to tell Micronaut which method to invoke.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Bean;
import io.micronaut.context.annotation.Factory;

import javax.inject.Singleton;

@Factory
public class ConnectionFactory {

    @Bean(preDestroy = "stop") <b class="conum">(1)</b>
    @Singleton
    public Connection connection() {
        return new Connection();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Factory

import javax.inject.Singleton

@Factory
class ConnectionFactory {

    @Bean(preDestroy = "stop") <b class="conum">(1)</b>
    @Singleton
    Connection connection() {
        new Connection()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Factory

import javax.inject.Singleton

@Factory
class ConnectionFactory {

    @Bean(preDestroy = "stop") <b class="conum">(1)</b>
    @Singleton
    fun connection(): Connection {
        return Connection()
    }
}</code></pre>
</div>
</div>
<hr>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.util.concurrent.atomic.AtomicBoolean;

public class Connection {

    AtomicBoolean stopped = new AtomicBoolean(false);

    public void stop() { <b class="conum">(2)</b>
        stopped.compareAndSet(false, true);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import java.util.concurrent.atomic.AtomicBoolean

class Connection {

    AtomicBoolean stopped = new AtomicBoolean(false)

    void stop() { <b class="conum">(2)</b>
        stopped.compareAndSet(false, true)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import java.util.concurrent.atomic.AtomicBoolean

class Connection {

    internal var stopped = AtomicBoolean(false)

    fun stop() { <b class="conum">(2)</b>
        stopped.compareAndSet(false, true)
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>preDestroy</code> value is set on the annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation value matches the method name</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Just simply implementing the Closeable or AutoCloseable interfaces is not enough to get a bean to close with the context. One of the above methods must be used.
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="contextEvents"><a class="anchor" href="#contextEvents"></a>3.12 Context Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/contextEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports a general event system through the context. The <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> API is used to publish events and the <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> API is used to listen to events. The event system is not limited to the events that Micronaut publishes and can be used for custom events created by the users.</p>
</div>
<div class="sect2">
<h3 id="_publishing_events">Publishing Events</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> API supports events of any type, however all events that Micronaut publishes extend <a href="../api/io/micronaut/context/event/ApplicationEvent.html">ApplicationEvent</a>.</p>
</div>
<div class="paragraph">
<p>To publish an event, obtain an instance of <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> either directly from the context or through dependency injection, and execute the <code>publishEvent</code> method with your event object.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing an Event</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleEvent {
    private String message = "Something happened";

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}

import io.micronaut.context.event.ApplicationEventPublisher;
import javax.inject.Inject;
import javax.inject.Singleton;

@Singleton
public class SampleEventEmitterBean {

    @Inject
    ApplicationEventPublisher eventPublisher;

    public void publishSampleEvent() {
        eventPublisher.publishEvent(new SampleEvent());
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing an Event</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class SampleEvent {
    String message = "Something happened"
}

import io.micronaut.context.event.ApplicationEventPublisher
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class SampleEventEmitterBean {

    @Inject
    ApplicationEventPublisher eventPublisher

    void publishSampleEvent() {
        eventPublisher.publishEvent(new SampleEvent())
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing an Event</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">data class SampleEvent(val message: String = "Something happened")

import io.micronaut.context.event.ApplicationEventPublisher
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class SampleEventEmitterBean {

    @Inject
    internal var eventPublisher: ApplicationEventPublisher? = null

    fun publishSampleEvent() {
        eventPublisher!!.publishEvent(SampleEvent())
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Publishing an event is <strong>synchronous</strong> by default! The <code>publishEvent</code> method will not return until all listeners have been executed. Move this work off to a thread pool if it is time intensive.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_listening_for_events">Listening for Events</h3>
<div class="paragraph">
<p>To listen to an event, register a bean that implements <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> where the generic type is the type of event the listener should be executed for.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.event.ApplicationEventListener;
import io.micronaut.docs.context.events.SampleEvent;

@Singleton
public class SampleEventListener implements ApplicationEventListener&lt;SampleEvent&gt; {
    private int invocationCounter = 0;

    @Override
    public void onApplicationEvent(SampleEvent event) {
        invocationCounter++;
    }

    public int getInvocationCounter() {
        return invocationCounter;
    }
}

import io.micronaut.context.ApplicationContext;
import io.micronaut.docs.context.events.SampleEventEmitterBean;
import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class SampleEventListenerSpec {

    @Test
    public void testEventListenerIsNotified() {
        try (ApplicationContext context = ApplicationContext.run()) {
            SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean.class);
            SampleEventListener listener = context.getBean(SampleEventListener.class);
            assertEquals(0, listener.getInvocationCounter());
            emitter.publishSampleEvent();
            assertEquals(1, listener.getInvocationCounter());
        }

    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.event.ApplicationEventListener
import io.micronaut.docs.context.events.SampleEvent

@Singleton
class SampleEventListener implements ApplicationEventListener&lt;SampleEvent&gt; {
    int invocationCounter = 0

    @Override
    void onApplicationEvent(SampleEvent event) {
        invocationCounter++
    }
}

import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import spock.lang.Specification

class SampleEventListenerSpec extends Specification {

    void "test event listener is notified"() {
        given:
        ApplicationContext context = ApplicationContext.run()
        SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean)
        SampleEventListener listener = context.getBean(SampleEventListener)
        assert listener.invocationCounter == 0

        when:
        emitter.publishSampleEvent()

        then:
        listener.invocationCounter == 1

        cleanup:
        context.close()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.event.ApplicationEventListener
import io.micronaut.docs.context.events.SampleEvent

@Singleton
class SampleEventListener : ApplicationEventListener&lt;SampleEvent&gt; {
    var invocationCounter = 0

    override fun onApplicationEvent(event: SampleEvent) {
        invocationCounter++
    }
}

import io.kotlintest.shouldBe
import io.kotlintest.specs.AnnotationSpec
import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean

class SampleEventListenerSpec : AnnotationSpec() {

    @Test
    fun testEventListenerWasNotified() {
        val context = ApplicationContext.run()
        val emitter = context.getBean(SampleEventEmitterBean::class.java)
        val listener = context.getBean(SampleEventListener::class.java)
        listener.invocationCounter.shouldBe(0)
        emitter.publishSampleEvent()
        listener.invocationCounter.shouldBe(1)

        context.close()
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/context/event/ApplicationEventListener.html#supports-E-">supports</a> method can be overridden to further clarify events that should be processed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively you can use the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation if you do not wish to specifically implement an interface or utilize one of the built in events like <a href="../api/io/micronaut/context/event/StartupEvent.html">StartupEvent</a> and <a href="../api/io/micronaut/context/event/ShutdownEvent.html">ShutdownEvent</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.docs.context.events.SampleEvent;
import io.micronaut.context.event.StartupEvent;
import io.micronaut.context.event.ShutdownEvent;
import io.micronaut.runtime.event.annotation.EventListener;

@Singleton
public class SampleEventListener {
    private int invocationCounter = 0;

    @EventListener
    public void onSampleEvent(SampleEvent event) {
        invocationCounter++;
    }

    @EventListener
    public void onStartupEvent(StartupEvent event) {
        // startup logic here
    }

    @EventListener
    public void onShutdownEvent(ShutdownEvent event) {
        // shutdown logic here
    }

    public int getInvocationCounter() {
        return invocationCounter;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.context.event.StartupEvent
import io.micronaut.context.event.ShutdownEvent
import io.micronaut.runtime.event.annotation.EventListener

@Singleton
class SampleEventListener {
    int invocationCounter = 0

    @EventListener
    void onSampleEvent(SampleEvent event) {
        invocationCounter++
    }

    @EventListener
    void onStartupEvent(StartupEvent event) {
        // startup logic here
    }

    @EventListener
    void onShutdownEvent(ShutdownEvent event) {
        // shutdown logic here
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.context.event.StartupEvent
import io.micronaut.context.event.ShutdownEvent
import io.micronaut.runtime.event.annotation.EventListener

@Singleton
class SampleEventListener {
    var invocationCounter = 0

    @EventListener
    internal fun onSampleEvent(event: SampleEvent) {
        invocationCounter++
    }

    @EventListener
    internal fun onStartupEvent(event: StartupEvent) {
        // startup logic here
    }

    @EventListener
    internal fun onShutdownEvent(event: ShutdownEvent) {
        // shutdown logic here
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your listener performs work that could take a while then you can use the <a href="../api/io/micronaut/scheduling/annotation/Async.html">@Async</a> annotation to run the operation on a separate thread:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.docs.context.events.SampleEvent;
import io.micronaut.runtime.event.annotation.EventListener;
import io.micronaut.scheduling.annotation.Async;

@Singleton
public class SampleEventListener {
    private AtomicInteger invocationCounter = new AtomicInteger(0);

    @EventListener
    @Async
    public void onSampleEvent(SampleEvent event) {
        invocationCounter.getAndIncrement();
    }

    public int getInvocationCounter() {
        return invocationCounter.get();
    }
}

import io.micronaut.context.ApplicationContext;
import io.micronaut.docs.context.events.SampleEventEmitterBean;
import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static java.util.concurrent.TimeUnit.SECONDS;
import static org.awaitility.Awaitility.await;
import static org.hamcrest.Matchers.equalTo;

public class SampleEventListenerSpec {

    @Test
    public void testEventListenerIsNotified() {
        try (ApplicationContext context = ApplicationContext.run()) {
            SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean.class);
            SampleEventListener listener = context.getBean(SampleEventListener.class);
            assertEquals(0, listener.getInvocationCounter());
            emitter.publishSampleEvent();
            await().atMost(10, SECONDS).until(listener::getInvocationCounter, equalTo(1));
        }
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener
import io.micronaut.scheduling.annotation.Async

@Singleton
class SampleEventListener {
    AtomicInteger invocationCounter = new AtomicInteger(0)

    @EventListener
    @Async
    void onSampleEvent(SampleEvent event) {
        invocationCounter.getAndIncrement()
    }
}

import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import spock.lang.Specification
import spock.util.concurrent.PollingConditions

class SampleEventListenerSpec extends Specification {

    void "test event listener is notified"() {
        given:
        ApplicationContext context = ApplicationContext.run()
        SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean)
        SampleEventListener listener = context.getBean(SampleEventListener)
        assert listener.invocationCounter.get() == 0

        when:
        emitter.publishSampleEvent()

        then:
        new PollingConditions().eventually {
            listener.invocationCounter.get() == 1
        }

        cleanup:
        context.close()

    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener
import io.micronaut.scheduling.annotation.Async
import java.util.concurrent.atomic.AtomicInteger

@Singleton
open class SampleEventListener {

    var invocationCounter = AtomicInteger(0)

    @EventListener
    @Async
    open fun onSampleEvent(event: SampleEvent) {
        println("Incrementing invocation counter...")
        invocationCounter.getAndIncrement()
    }
}

import io.kotlintest.eventually
import io.kotlintest.seconds
import io.kotlintest.shouldBe
import io.kotlintest.specs.AnnotationSpec
import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import org.opentest4j.AssertionFailedError

class SampleEventListenerSpec : AnnotationSpec() {

    @Test
//    @Ignore // TODO can't get this to pass on CI, any help is welcome
    fun testEventListenerWasNotified() {
        val context = ApplicationContext.run()
        val emitter = context.getBean(SampleEventEmitterBean::class.java)
        val listener = context.getBean(SampleEventListener::class.java)
        listener.invocationCounter.get().shouldBe(0)
        emitter.publishSampleEvent()

        eventually(5.seconds,  AssertionFailedError::class.java) {
            println("Current value of counter: " + listener.invocationCounter.get())
            listener.invocationCounter.get().shouldBe(1)
        }

        context.close()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event listener will by default run on the <code>scheduled</code> executor. You can configure this thread pool as required in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Scheduled Task Thread Pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    executors:
        scheduled:
            type: scheduled
            core-pool-size: 30</code></pre>
</div>
</div>
</div>

<h2 id="events"><a class="anchor" href="#events"></a>3.13 Bean Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/events.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can hook into the creation of beans using one of the following interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/context/event/BeanInitializedEventListener.html">BeanInitializedEventListener</a> - allows modifying or replacing of a bean after the properties have been set but prior to <code>@PostConstruct</code> event hooks.</p>
</li>
<li>
<p><a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> - allows modifying or replacing of a bean after the bean is fully initialized and all <code>@PostConstruct</code> hooks called.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>BeanInitializedEventListener</code> interface is commonly used in combination with <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> beans. Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class V8Engine implements Engine {
    private final int cylinders = 8;
    private double rodLength; <b class="conum">(1)</b>

    public V8Engine(double rodLength) {
        this.rodLength = rodLength;
    }

    @Override
    public String start() {
        return "Starting V" + String.valueOf(getCylinders()) + " [rodLength=" + String.valueOf(getRodLength()) + "]";
    }

    @Override
    public final int getCylinders() {
        return cylinders;
    }

    public double getRodLength() {
        return rodLength;
    }

    public void setRodLength(double rodLength) {
        this.rodLength = rodLength;
    }
}

@Factory
public class EngineFactory {

    private V8Engine engine;
    private double rodLength = 5.7;

    @PostConstruct
    public void initialize() {
        engine = new V8Engine(rodLength); <b class="conum">(2)</b>
    }

    @Singleton
    public Engine v8Engine() {
        return engine;<b class="conum">(3)</b>
    }

    public void setRodLength(double rodLength) {
        this.rodLength = rodLength;
    }
}

@Singleton
public class EngineInitializer implements BeanInitializedEventListener&lt;EngineFactory&gt; { <b class="conum">(4)</b>
    @Override
    public EngineFactory onInitialized(BeanInitializingEvent&lt;EngineFactory&gt; event) {
        EngineFactory engineFactory = event.getBean();
        engineFactory.setRodLength(6.6);<b class="conum">(5)</b>
        return engineFactory;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class V8Engine implements Engine {
    final int cylinders = 8
    double rodLength <b class="conum">(1)</b>

    @Override
    String start() {
        return "Starting V${cylinders} [rodLength=$rodLength]"
    }
}

@Factory
class EngineFactory {
    private V8Engine engine
    double rodLength = 5.7

    @PostConstruct
    void initialize() {
        engine = new V8Engine(rodLength: rodLength) <b class="conum">(2)</b>
    }

    @Singleton
    Engine v8Engine() {
        return engine <b class="conum">(3)</b>
    }
}

@Singleton
class EngineInitializer implements BeanInitializedEventListener&lt;EngineFactory&gt; { <b class="conum">(4)</b>
    @Override
    EngineFactory onInitialized(BeanInitializingEvent&lt;EngineFactory&gt; event) {
        EngineFactory engineFactory = event.bean
        engineFactory.rodLength = 6.6 <b class="conum">(5)</b>
        return event.bean
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class V8Engine(var rodLength: Double) : Engine {  <b class="conum">(1)</b>

    override val cylinders = 8

    override fun start(): String {
        return "Starting V$cylinders [rodLength=$rodLength]"
    }
}

@Factory
class EngineFactory {

    private var engine: V8Engine? = null
    private var rodLength = 5.7

    @PostConstruct
    fun initialize() {
        engine = V8Engine(rodLength) <b class="conum">(2)</b>
    }

    @Singleton
    fun v8Engine(): Engine? {
        return engine<b class="conum">(3)</b>
    }

    fun setRodLength(rodLength: Double) {
        this.rodLength = rodLength
    }
}

@Singleton
class EngineInitializer : BeanInitializedEventListener&lt;EngineFactory&gt; { <b class="conum">(4)</b>
    override fun onInitialized(event: BeanInitializingEvent&lt;EngineFactory&gt;): EngineFactory {
        val engineFactory = event.bean
        engineFactory.setRodLength(6.6)<b class="conum">(5)</b>
        return event.bean as EngineFactory
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>V8Engine</code> class defines a <code>rodLength</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EngineFactory</code> initializes the value of <code>rodLength</code> and creates the instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The created instance is returned as a <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>BeanInitializedEventListener</code> interface is implemented to listen for the initialization of the factory</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Within the <code>onInitialized</code> method the <code>rodLength</code> is overridden prior to the engine being created by the factory bean.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> interface is more typically used to decorate or enhance a fully initialized bean by creating a proxy for example.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Bean event listeners are initialized <strong>before</strong> type converters. If your event listener relies on type conversion either by relying on a configuration properties bean or by any other mechanism, you may see errors related to type conversion.
</td>
</tr>
</table>
</div>

<h2 id="introspection"><a class="anchor" href="#introspection"></a>3.14 Bean Introspection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/introspection.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 1.1, a compilation time replacement for the JDK&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html">Introspector</a> class has been included.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/beans/BeanIntrospector.html">BeanIntrospector</a> and <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> interfaces allow looking up bean introspections that allow you to instantiate and read/write bean properties without using reflection or caching reflective metadata which consumes excessive memory for large beans.</p>
</div>
<div class="sect2">
<h3 id="_making_a_bean_available_for_introspection">Making a Bean Available for Introspection</h3>
<div class="paragraph">
<p>Unlike the JDK&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html">Introspector</a> every class is not automatically available for introspection, to make a class available for introspection you must as a minimum enable Micronaut&#8217;s annotation processor (<code>micronaut-inject-java</code> for Java and Kotlin and <code>micronaut-inject-groovy</code> for Groovy) in your build and ensure you have a runtime time dependency on <code>micronaut-core</code>.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-inject-java:2.1.0")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-inject-java&lt;/artifactId&gt;
        &lt;version&gt;2.1.0&lt;/version&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin the <code>micronaut-inject-java</code> dependency should be in <code>kapt</code> scope and for Groovy you should have <code>micronaut-inject-groovy</code> in <code>compileOnly</code> scope.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut:micronaut-core:2.1.0")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-core&lt;/artifactId&gt;
    &lt;version&gt;2.1.0&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Once your build is configured you have a few ways to generate introspection data.</p>
</div>
<div class="sect3">
<h4 id="_use_the_code_introspected_code_annotation">Use the <code>@Introspected</code> Annotation</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation can be used on any class which you want to make available for introspection, simply annotate the class with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected
public class Person {

    private String name;
    private int age = 18;

    public Person(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import groovy.transform.Canonical
import io.micronaut.core.annotation.Introspected

@Introspected
@Canonical
class Person {

    String name
    int age = 18

    Person(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Introspected

@Introspected
data class Person(var name : String) {
    var age : Int = 18
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once introspection data has been produced at compilation time you can then retrieve it via the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final BeanIntrospection&lt;Person&gt; introspection = BeanIntrospection.getIntrospection(Person.class); <b class="conum">(1)</b>
        Person person = introspection.instantiate("John"); <b class="conum">(2)</b>
        System.out.println("Hello " + person.getName());

        final BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String.class); <b class="conum">(3)</b>
        property.set(person, "Fred"); <b class="conum">(4)</b>
        String name = property.get(person); <b class="conum">(5)</b>
        System.out.println("Hello " + person.getName());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        def introspection = BeanIntrospection.getIntrospection(Person) <b class="conum">(1)</b>
        Person person = introspection.instantiate("John") <b class="conum">(2)</b>
        println("Hello ${person.name}")

        BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String) <b class="conum">(3)</b>
        property.set(person, "Fred") <b class="conum">(4)</b>
        String name = property.get(person) <b class="conum">(5)</b>
        println("Hello ${person.name}")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val introspection = BeanIntrospection.getIntrospection(Person::class.java) <b class="conum">(1)</b>
        val person : Person = introspection.instantiate("John") <b class="conum">(2)</b>
        print("Hello ${person.name}")

        val property : BeanProperty&lt;Person, String&gt; = introspection.getRequiredProperty("name", String::class.java) <b class="conum">(3)</b>
        property.set(person, "Fred") <b class="conum">(4)</b>
        val name = property.get(person) <b class="conum">(5)</b>
        print("Hello ${person.name}")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can retrieve a <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> with the <code>getIntrospection</code> static method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Once you have a <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> you can instantiate a bean with the <code>instantiate</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A <a href="../api/io/micronaut/core/beans/BeanProperty.html">BeanProperty</a> can be retreived from the introspection</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>.. and the <code>set</code> method used to set the property value</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>.. and the <code>get</code> method used to retrieve the property value</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_constructor_methods">Constructor Methods</h4>
<div class="paragraph">
<p>For classes with multiple constructors, it is possible to inform Micronaut which constructor should be used to instantiate the class. Apply the <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation to which constructor to be used.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Creator;
import io.micronaut.core.annotation.Introspected;

import javax.annotation.concurrent.Immutable;

@Introspected
@Immutable
public class Vehicle {

    private final String make;
    private final String model;
    private final int axels;

    public Vehicle(String make, String model) {
        this(make, model, 2);
    }

    @Creator <b class="conum">(1)</b>
    public Vehicle(String make, String model, int axels) {
        this.make = make;
        this.model = model;
        this.axels = axels;
    }

    public String getMake() {
        return make;
    }

    public String getModel() {
        return model;
    }

    public int getAxels() {
        return axels;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Vehicle {

    private final String make
    private final String model
    private final int axels

    Vehicle(String make, String model) {
        this(make, model, 2)
    }

    @Creator <b class="conum">(1)</b>
    Vehicle(String make, String model, int axels) {
        this.make = make
        this.model = model
        this.axels = axels
    }

    String getMake() {
        make
    }

    String getModel() {
        model
    }

    int getAxels() {
        axels
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Vehicle @Creator constructor(val make: String, val model: String, val axels: Int) { <b class="conum">(1)</b>

    constructor(make: String, model: String) : this(make, model, 2) {}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation is used to denote which constructor should be used</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This class has no default constructor so calls to instantiate without arguments will throw an <a href="../api/io/micronaut/core/reflect/exception/InstantiationException.html">InstantiationException</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_static_creator_methods">Static Creator Methods</h4>
<div class="paragraph">
<p>For the use case of static methods being used to instantiate the class, the <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation can be applied to those methods to allow for the introspection to execute the method.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Creator;
import io.micronaut.core.annotation.Introspected;

import javax.annotation.concurrent.Immutable;

@Introspected
@Immutable
public class Business {

    private String name;

    private Business(String name) {
        this.name = name;
    }

    @Creator <b class="conum">(1)</b>
    public static Business forName(String name) {
        return new Business(name);
    }

    public String getName() {
        return name;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Business {

    private String name

    private Business(String name) {
        this.name = name
    }

    @Creator <b class="conum">(1)</b>
    static Business forName(String name) {
        new Business(name)
    }

    String getName() {
        name
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Business private constructor(val name: String) {
    companion object {

        @Creator <b class="conum">(1)</b>
        fun forName(name: String): Business {
            return Business(name)
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation is applied to the static method which will be used to instantiate the class</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There can be multiple "creator" methods annotated. If one exists without arguments, that will be used as the default construction method. The first method with arguments will be used as the primary construction method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_enums">Enums</h4>
<div class="paragraph">
<p>It is possible to introspect enums as well. Simply add the annotation to the enum and it can be constructed through the standard <code>valueOf</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_the_code_introspected_code_annotation_on_a_configuration_class">Use the <code>@Introspected</code> Annotation on a Configuration Class</h4>
<div class="paragraph">
<p>If the class you wish to introspect is already compiled and not under your control an alternative option is to define a configuration class with the <code>classes</code> member of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation set.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected(classes = Person.class)
public class PersonConfiguration {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.annotation.Introspected

@Introspected(classes = Person)
class PersonConfiguration {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Introspected

@Introspected(classes = [Person::class])
class PersonConfiguration</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the <code>PersonConfiguration</code> class will generate introspections for the <code>Person</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use the <code>packages</code> member of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> which will package scan at compilation time and generate introspections for all classes within a package. Note however this feature is currently regarded as experimental.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_write_an_code_annotationmapper_code_to_introspect_existing_annotations">Write an <code>AnnotationMapper</code> to Introspect Existing Annotations</h4>
<div class="paragraph">
<p>If there is an existing annotation that you wish to introspect by default you can write an <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a>.</p>
</div>
<div class="paragraph">
<p>An example of this is <a href="https://github.com/micronaut-projects/micronaut-core/blob/master/inject/src/main/java/io/micronaut/inject/beans/visitor/EntityIntrospectedAnnotationMapper.java">EntityIntrospectedAnnotationMapper</a> which ensures all beans annotated with <code>javax.persistence.Entity</code> are introspectable by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>AnnotationMapper</code> should be on the annotation processor classpath.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_beanwrapper_api">The BeanWrapper API</h3>
<div class="paragraph">
<p>A <a href="../api/io/micronaut/core/beans/BeanProperty.html">BeanProperty</a> provides raw access to read and write a property value for a given class and does not provide any automatic type conversion.</p>
</div>
<div class="paragraph">
<p>It is expected that the values you pass to the <code>set</code> and <code>get</code> methods match the underlying property type otherwise an exception will occur.</p>
</div>
<div class="paragraph">
<p>To provide additional type conversion smarts the <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> interface allows wrapping an existing bean instance and setting and getting properties from the bean, plus performing type conversion as necessary.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final BeanWrapper&lt;Person&gt; wrapper = BeanWrapper.getWrapper(new Person("Fred")); <b class="conum">(1)</b>

        wrapper.setProperty("age", "20"); <b class="conum">(2)</b>
        int newAge = wrapper.getRequiredProperty("age", int.class); <b class="conum">(3)</b>

        System.out.println("Person's age now " + newAge);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        final BeanWrapper&lt;Person&gt; wrapper = BeanWrapper.getWrapper(new Person("Fred")) <b class="conum">(1)</b>

        wrapper.setProperty("age", "20") <b class="conum">(2)</b>
        int newAge = wrapper.getRequiredProperty("age", Integer) <b class="conum">(3)</b>

        println("Person's age now $newAge")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val wrapper = BeanWrapper.getWrapper(Person("Fred")) <b class="conum">(1)</b>

        wrapper.setProperty("age", "20") <b class="conum">(2)</b>
        val newAge = wrapper.getRequiredProperty("age", Int::class.java) <b class="conum">(3)</b>

        println("Person's age now $newAge")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>getWrapper</code> static method can be used to obtain a <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> for a bean instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can set properties and the <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> will perform type conversion, or throw <a href="../api/io/micronaut/core/convert/exceptions/ConversionErrorException.html">ConversionErrorException</a> if conversion is not possible.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can retrieve a property using <code>getRequiredProperty</code> and request the appropriate type. If the property doesn&#8217;t exist a <a href="../api/io/micronaut/core/beans/exceptions/IntrospectionException.html">IntrospectionException</a> will be thrown and if it cannot be converted a <a href="../api/io/micronaut/core/convert/exceptions/ConversionErrorException.html">ConversionErrorException</a> will be thrown.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jackson_and_bean_introspection">Jackson and Bean Introspection</h3>
<div class="paragraph">
<p>Jackson is configured to use the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API to read and write property values and construct objects resulting in reflection-free serialization/deserialization which is benefitial from a performance perspective and requires less configuring to operate correctly with runtimes such as GraalVM native.</p>
</div>
<div class="paragraph">
<p>This feature is enabled by default, you can disable it by setting the <code>jackson.bean-introspection-module</code> configuration to <code>false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently only bean properties (private field with public getter/setter) are supported and usage of public fields is not supported.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is currently regarded as experimental and may be subject to changes in the future.
</td>
</tr>
</table>
</div>
</div>

<h2 id="beanValidation"><a class="anchor" href="#beanValidation"></a>3.15 Bean Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/beanValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 1.2, Micronaut has built-in support for validating beans that are annotated with <code>javax.validation</code> annotations. As a minimum you should include the <code>micronaut-validation</code> module as a compile dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Note that Micronaut&#8217;s implementation is not currently fully compliant with the <a href="https://beanvalidation.org/2.0/spec/">Bean Validator specification</a> as the specification heavily relies on reflection-based APIs.</p>
</div>
<div class="paragraph">
<p>The following features are unsupported at this time:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotations on generic argument types since only the Java language supports this feature.</p>
</li>
<li>
<p>Any interaction with the <a href="https://beanvalidation.org/2.0/spec/#constraintmetadata">constraint metadata API</a>, since Micronaut uses already computed compilation time metadata.</p>
</li>
<li>
<p>XML-based configuration</p>
</li>
<li>
<p>Instead of using <code>javax.validation.ConstraintValidator</code> you should use <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> (io.micronaut.validation.validator.constraints.ConstraintValidator) to define custom constraints, which supports validating annotations at compilation time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s implementation includes the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reflection and Runtime Proxy free validation resulting in reduced memory consumption</p>
</li>
<li>
<p>Smaller JAR size since Hibernate Validator adds another 1.4MB</p>
</li>
<li>
<p>Faster startup since Hibernate Validator adds 200ms+ startup overhead</p>
</li>
<li>
<p>Configurability via Annotation Metadata</p>
</li>
<li>
<p>Support for Reactive Bean Validation</p>
</li>
<li>
<p>Support for validating the source AST at compilation time</p>
</li>
<li>
<p>Automatic compatibility with GraalVM native without additional configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you require full Bean Validator 2.0 compliance you can add the <code>micronaut-hibernate-validator</code> module to your classpath, which will replace Micronaut&#8217;s implementation.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.beanvalidation:micronaut-hibernate-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.beanvalidation&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="sect2">
<h3 id="_validating_bean_methods">Validating Bean Methods</h3>
<div class="paragraph">
<p>You can validate methods of any class declared as a Micronaut bean simply by using the <code>javax.validation</code> annotation as arguments:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;
import javax.validation.constraints.NotBlank;

@Singleton
public class PersonService {
    public void sayHello(@NotBlank String name) {
        System.out.println("Hello " + name);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton
import javax.validation.constraints.NotBlank

@Singleton
class PersonService {

    void sayHello(@NotBlank String name) {
        println "Hello $name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton
import javax.validation.constraints.NotBlank


@Singleton
open class PersonService {
    open fun sayHello(@NotBlank name: String) {
        println("Hello $name")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example declares that the <code>@NotBlank</code> annotation should be validated when executing the <code>sayHello</code> method.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you are using Kotlin the class and method must be declared open so that Micronaut can create a compilation time subclass, alternatively you can annotate the class with <a href="../api/io/micronaut/validation/Validated.html">@Validated</a> and configure the Kotlin <code>all-open</code> plugin to open classes annotated with this type. See the <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html">Compiler plugins</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a validation error occurs a <code>javax.validation.ConstraintViolationException</code> will be thrown. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

import javax.inject.Inject;
import javax.validation.ConstraintViolationException;

@MicronautTest
class PersonServiceSpec {

    @Inject PersonService personService;

    @Test
    void testThatNameIsValidated() {
        final ConstraintViolationException exception =
                assertThrows(ConstraintViolationException.class, () -&gt;
                personService.sayHello("") <b class="conum">(1)</b>
        );

        assertEquals("sayHello.name: must not be blank", exception.getMessage()); <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.test.annotation.MicronautTest
import spock.lang.Specification

import javax.inject.Inject
import javax.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec extends Specification {

    @Inject PersonService personService

    void "test person name is validated"() {
        when:"The sayHello method is called with a blank string"
        personService.sayHello("") <b class="conum">(1)</b>

        then:"A validation error occurs"
        def e = thrown(ConstraintViolationException)
        e.message == "sayHello.name: must not be blank" //  <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.test.annotation.MicronautTest
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.Assertions.*

import javax.inject.Inject
import javax.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec {

    @Inject
    lateinit var personService: PersonService

    @Test
    fun testThatNameIsValidated() {
        val exception = assertThrows(ConstraintViolationException::class.java
        ) { personService.sayHello("") } <b class="conum">(1)</b>

        assertEquals("sayHello.name: must not be blank", exception.message) <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is called with a blank string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An exception occurs</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_data_classes">Validating Data Classes</h3>
<div class="paragraph">
<p>If you wish to validate data classes, such as POJOs and so on, typically used in JSON interchange, the class must be annotated with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> (see the previous section on <a href="#introspection">Bean Introspection</a>) or, if the class is external, be imported by the <code>@Introspected</code> annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.annotation.Introspected;
import javax.validation.constraints.*;

@Introspected
public class Person {
    private String name;
    @Min(18)
    private int age;

    @NotBlank
    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.annotation.Introspected

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Introspected
class Person {
    @NotBlank
    String name
    @Min(18l)
    int age
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.Introspected
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Introspected
data class Person(
    @field:NotBlank var name: String,
    @field:Min(18) var age: Int
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation can be used as a meta-annotation and common annotations like <code>@javax.persistence.Entity</code> are treated as <code>@Introspected</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example defines a class called <code>Person</code> that has 2 properties (<code>name</code> and <code>age</code>) that have constraints applied to them. Note that in Java the annotations can be on the field or the getter and with Kotlin data classes the annotation should target the field.</p>
</div>
<div class="paragraph">
<p>If you wish to validate the class manually then you can inject an instance of <a href="../api/io/micronaut/validation/validator/Validator.html">Validator</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
Validator validator;

@Test
void testThatPersonIsValidWithValidator() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final Set&lt;ConstraintViolation&lt;Person&gt;&gt; constraintViolations = validator.validate(person);  <b class="conum">(1)</b>

    assertEquals(2, constraintViolations.size()); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Inject Validator validator

void "test person is validated with validator"() {
    when:"The person is validated"
    def constraintViolations = validator.validate(new Person(name: "", age: 10)) <b class="conum">(1)</b>

    then:"A validation error occurs"
    constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var validator: Validator

@Test
fun testThatPersonIsValidWithValidator() {
    val person = Person("", 10)
    val constraintViolations = validator.validate(person)  <b class="conum">(1)</b>

    assertEquals(2, constraintViolations.size) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The validator is used to validate the person</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively on Bean methods you can use <code>javax.validation.Valid</code> to trigger cascading validation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class PersonService {
    public void sayHello(@Valid Person person) {
        System.out.println("Hello " + person.getName());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class PersonService {
    void sayHello(@Valid Person person) {
        println "Hello $person.name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
open class PersonService {
    open fun sayHello(@Valid person: Person) {
        println("Hello ${person.name}")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonService</code> will now validate the <code>Person</code> class when invoked:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
PersonService personService;

@Test
void testThatPersonIsValid() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    personService.sayHello(person) <b class="conum">(1)</b>
            );

    assertEquals(2, exception.getConstraintViolations().size()); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Inject PersonService personService

void "test person name is validated"() {
    when:"The sayHello method is called with an invalid person"
    personService.sayHello(new Person(name: "", age: 10)) <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var personService: PersonService

@Test
fun testThatPersonIsValid() {
    val person = Person("", 10)
    val exception = assertThrows(ConstraintViolationException::class.java  <b class="conum">(1)</b>
    ) { personService.sayHello(person) }

    assertEquals(2, exception.constraintViolations.size) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A validated method is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_configuration_properties">Validating Configuration Properties</h3>
<div class="paragraph">
<p>You can also validate the properties of classes that are annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> to ensure configuration is correct.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended that you annotate <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> that features validation with <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> to ensure that the validation occurs at startup time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_defining_additional_constraints">Defining Additional Constraints</h3>
<div class="paragraph">
<p>To define additional constraints you can define a new annotation, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.validation.Constraint;
import java.lang.annotation.*;

import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = { }) <b class="conum">(1)</b>
public @interface DurationPattern {

    String message() default "invalid duration ({validatedValue})"; <b class="conum">(2)</b>

    /**
     * Defines several constraints on the same element.
     */
    @Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
    @Retention(RUNTIME)
    @Documented
    @interface List {
        DurationPattern[] value(); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.validation.Constraint
import java.lang.annotation.*

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Retention(RUNTIME)
@Constraint(validatedBy = []) <b class="conum">(1)</b>
@interface DurationPattern {
    String message() default "invalid duration ({validatedValue})" <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.validation.Constraint

@Retention(AnnotationRetention.RUNTIME)
@Constraint(validatedBy = []) <b class="conum">(1)</b>
annotation class DurationPattern(
    val message: String = "invalid duration ({validatedValue})" <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation should be annotated with <code>javax.validation.Constraint</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>message</code> template can be provided in a hard coded manner as above. If none is specified Micronaut will try to find a message using <code>ClassName.message</code> using the <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> interface. (optional)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To support repeated annotations you can define a inner annotation (optional).</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add messages and message bundles using the <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> and <a href="../api/io/micronaut/context/i18n/ResourceBundleMessageSource.html">ResourceBundleMessageSource</a> classes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined the annotation you need to implement a <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> that validates the annotation. You can either implement a bean that implements the interface directly or define a factory that returns one or more validators.</p>
</div>
<div class="paragraph">
<p>The latter approach is recommended if you plan to define multiple validators:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Factory;
import io.micronaut.validation.validator.constraints.ConstraintValidator;
import javax.inject.Singleton;

@Factory
public class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, CharSequence&gt; durationPatternValidator() {
        return (value, annotationMetadata, context) -&gt;
                value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.*
import javax.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, CharSequence&gt; durationPatternValidator() {
        return { CharSequence value,
                 AnnotationValue&lt;DurationPattern&gt; annotation,
                 ConstraintValidatorContext context -&gt;
            return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
        } as ConstraintValidator&lt;DurationPattern, CharSequence&gt;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import io.micronaut.validation.validator.constraints.ConstraintValidator
import javax.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    fun durationPatternValidator() : ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
        return ConstraintValidator { value, annotation, context -&gt;
            value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example implements a validator that validates any field, parameter etc. that is annotated with <code>DurationPattern</code>, ensuring that the string can be parsed with <code>java.time.Duration.parse</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generally <code>null</code> is regarded as valid and <code>@NotNull</code> used to constrain a value as not being <code>null</code>. The example above regards <code>null</code> as a valid value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class HolidayService {

    public String startHoliday(@NotBlank String person,
                        @DurationPattern String duration) {
        final Duration d = Duration.parse(duration);
        return "Person " + person + " is off on holiday for " + d.toMinutes() + " minutes";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class HolidayService {

    String startHoliday(@NotBlank String person,
                        @DurationPattern String duration) {
        final Duration d = Duration.parse(duration)
        return "Person $person is off on holiday for ${d.toMinutes()} minutes"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
open class HolidayService {

    open fun startHoliday( @NotBlank person: String,
                           @DurationPattern duration: String): String {
        val d = Duration.parse(duration)
        val mins = d.toMinutes()
        return "Person $person is off on holiday for $mins minutes"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the above examples validates the <code>duration</code> parameter you can define a test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject HolidayService holidayService;

@Test
void testCustomValidator() {
    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    holidayService.startHoliday("Fred", "junk")   <b class="conum">(1)</b>
            );

    assertEquals("startHoliday.duration: invalid duration (junk)", exception.getMessage()); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void "test test custom validator"() {
    when:"A custom validator is used"
    holidayService.startHoliday("Fred", "junk") <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.message == "startHoliday.duration: invalid duration (junk)" //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var holidayService: HolidayService

@Test
fun testCustomValidator() {
    val exception = assertThrows(ConstraintViolationException::class.java
    ) { holidayService.startHoliday("Fred", "junk") }   <b class="conum">(1)</b>

    assertEquals("startHoliday.duration: invalid duration (junk)", exception.message) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A validated method is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>THe constraint violations are verified</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_annotations_at_compilation_time">Validating Annotations at Compilation Time</h3>
<div class="paragraph">
<p>You can use Micronaut&#8217;s validator to validate annotation usages at compilation time. To do so you should include <code>micronaut-validation</code> in the annotation processor classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Once this is done Micronaut will at compilation validate annotation values that are themselves annotated with <code>javax.validation</code>. For example consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.lang.annotation.*;

@Retention(RetentionPolicy.RUNTIME)
public @interface TimeOff {
    @DurationPattern
    String duration();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import java.lang.annotation.*

@Retention(RetentionPolicy.RUNTIME)
@interface TimeOff {
    @DurationPattern
    String duration()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Retention(AnnotationRetention.RUNTIME)
annotation class TimeOff(
    @DurationPattern val duration: String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your attempt to use <code>@TimeOff(duration="junk")</code> in your source Micronaut will fail compilation due to the value of <code>duration</code> violating the <code>DurationPattern</code> constraint.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>duration</code> is a property placeholder such as <code>@TimeOff(duration="${my.value}")</code> then validation handling will be deferred until runtime.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that if you wish to allow use of a custom <code>ConstraintValidator</code> at compilation time you should instead define the validator as a class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import edu.umd.cs.findbugs.annotations.NonNull;
import edu.umd.cs.findbugs.annotations.Nullable;
import io.micronaut.core.annotation.AnnotationValue;
import io.micronaut.validation.validator.constraints.*;

public class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    public boolean isValid(
            @Nullable CharSequence value,
            @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @NonNull ConstraintValidatorContext context) {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import edu.umd.cs.findbugs.annotations.NonNull
import edu.umd.cs.findbugs.annotations.Nullable
import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.*

class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    boolean isValid(
            @Nullable CharSequence value,
            @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @NonNull ConstraintValidatorContext context) {
        return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.*

class DurationPatternValidator : ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    override fun isValid(
            value: CharSequence?,
            annotationMetadata: AnnotationValue&lt;DurationPattern&gt;,
            context: ConstraintValidatorContext): Boolean {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a <code>META-INF/services/io.micronaut.validation.validator.constraints.ConstraintValidator</code> file that references the class.</p>
</li>
<li>
<p>The class should be public and feature a zero argument public constructor</p>
</li>
<li>
<p>The class should be placed on the annotation processor classpath of the project that is to be validated.</p>
</li>
</ul>
</div>
</div>

<h2 id="annotationMetadata"><a class="anchor" href="#annotationMetadata"></a>3.16 Bean Annotation Metadata</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/annotationMetadata.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The methods provided by Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AnnotatedElement.html">AnnotatedElement</a> API in general don&#8217;t provide the ability to introspect annotations without loading the annotations themselves, nor do they provide any ability to introspect annotation stereotypes (Often called meta-annotations, an annotation stereotype is where an annotation is annotated with another annotation, essentially inheriting its behaviour).</p>
</div>
<div class="paragraph">
<p>To solve this problem many frameworks produce runtime metadata or perform expensive reflection to analyze the annotations of a class.</p>
</div>
<div class="paragraph">
<p>Micronaut instead produces this annotation metadata at compile time, avoiding expensive reflection and saving on memory.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> API can be used to obtain a reference to a <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> which implements the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> interface.</p>
</div>
<div class="paragraph">
<p>For example the following code will obtain all bean definitions annotated with a particular stereotype:</p>
</div>
<div class="listingblock">
<div class="title">Lookup Bean Definitions by Stereotype</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BeanContext beanContext = ... // obtain the bean context
Collection&lt;BeanDefinition&gt; definitions =
    beanContext.getBeanDefinitions(Qualifiers.byStereotype(Controller.class))

for(BeanDefinition definition : definitions) {
    AnnotationValue&lt;Controller&gt; controllerAnn = definition.getAnnotation(Controller.class);
    // do something with the annotation
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will find all <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> 's annotated with <code>@Controller</code> regardless whether <code>@Controller</code> is used directly or inherited via an annotation stereotype.</p>
</div>
<div class="paragraph">
<p>Note that the <code>getAnnotation</code> method and the variations of the method return an <a href="../api/io/micronaut/core/annotation/AnnotationValue.html">AnnotationValue</a> type and not a Java annotation. This is by design, and you should generally try to work with this API when reading annotation values, the reason being that synthesizing a proxy implementation is worse from a performance and memory consumption perspective.</p>
</div>
<div class="paragraph">
<p>If you absolutely require a reference to an annotation instance you can use the <code>synthesize</code> method, which will create a runtime proxy that implements the annotation interface:</p>
</div>
<div class="listingblock">
<div class="title">Synthesizing Annotation Instances</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Controller controllerAnn = definition.synthesize(Controller.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is not recommended however, as it requires reflection and increases memory consumption due to the use of runtime created proxies and should be used as a last resort (for example if you need an instance of the annotation to integrate with a third party library).</p>
</div>
<div class="sect2">
<h3 id="_aliasing_mapping_annotations">Aliasing / Mapping Annotations</h3>
<div class="paragraph">
<p>There are times when you may want to alias the value of an annotation member to the value of another annotation member. To do this you can use the <a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a> annotation to alias the value of one member to the value of another.</p>
</div>
<div class="paragraph">
<p>A common use case is for example when an annotation defines the <code>value()</code> member, but also supports other members. For example the <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation:</p>
</div>
<div class="listingblock">
<div class="title">The @Client Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public @interface Client {

    /**
     * @return The URL or service ID of the remote service
     */
    @AliasFor(member = "id") <i class="conum" data-value="1"></i><b>(1)</b>
    String value() default "";

    /**
     * @return The ID of the client
     */
    @AliasFor(member = "value") <i class="conum" data-value="2"></i><b>(2)</b>
    String id() default "";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>value</code> member also sets the <code>id</code> member</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>id</code> member also sets the <code>value</code> member</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With these aliases in place, regardless whether you define <code>@Client("foo")</code> or <code>@Client(id="foo")</code> both the <code>value</code> and <code>id</code> members are always set, making it much easier to parse and deal with the annotation.</p>
</div>
<div class="paragraph">
<p>If you do not have control over the annotation then another approach is to use an <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a>. To create an <code>AnnotationMapper</code> you must perform the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a> interface</p>
</li>
<li>
<p>Define a <code>META-INF/services/io.micronaut.inject.annotation.AnnotationMapper</code> file referencing the implementation class</p>
</li>
<li>
<p>Add the JAR file containing the implementation to the <code>annotationProcessor</code> classpath (<code>kapt</code> for Kotlin)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because <code>AnnotationMapper</code> implementations need to be on the annotation processor classpath they should generally be in a project that includes few external dependencies to avoid polluting the annotation processor classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example the  <code>AnnotationMapper</code> that improves the introspection capabilities of JPA entities</p>
</div>
<div class="listingblock">
<div class="title">EntityIntrospectedAnnotationMapper Mapper Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class EntityIntrospectedAnnotationMapper implements NamedAnnotationMapper {
    @NonNull
    @Override
    public String getName() {
        return "javax.persistence.Entity";
    }

    @Override
    public List&lt;AnnotationValue&lt;?&gt;&gt; map(AnnotationValue&lt;Annotation&gt; annotation, VisitorContext visitorContext) { <i class="conum" data-value="1"></i><b>(1)</b>
        final AnnotationValueBuilder&lt;Introspected&gt; builder = AnnotationValue.builder(Introspected.class)
                // don't bother with transients properties
                .member("excludedAnnotations", "javax.persistence.Transient"); <i class="conum" data-value="2"></i><b>(2)</b>
        return Collections.singletonList(
                builder.build()
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>map</code> method receives a <a href="../api/io/micronaut/core/annotation/AnnotationValue.html">AnnotationValue</a> with the values for the annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more annotations can be returned, in this case <code>@Transient</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example above implements the <a href="../api/io/micronaut/inject/annotation/NamedAnnotationMapper.html">NamedAnnotationMapper</a> interface which allows for annotations to be mixed with runtime code. If you want to operate against a concrete annotation type then you should use <a href="../api/io/micronaut/inject/annotation/TypedAnnotationMapper.html">TypedAnnotationMapper</a> instead, though note it requires the annotation class itself to be on the annotation processor classpath.
</td>
</tr>
</table>
</div>
</div>

<h2 id="springBeans"><a class="anchor" href="#springBeans"></a>3.17 Micronaut Beans And Spring</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/springBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut has integrations with Spring in several forms. See the <a href="https://micronaut-projects.github.io/micronaut-spring/latest/guide">Micronaut Spring Documentation</a> for more information.</p>
</div>

<h2 id="android"><a class="anchor" href="#android"></a>3.18 Android Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/ioc/android.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut dependency injection is based on annotation processors and doesn&#8217;t rely on reflection, it can be used on Android when using the Android plugin 3.0.0 or above.</p>
</div>
<div class="paragraph">
<p>This allows you to use the same application framework for both your Android client and server implementation.</p>
</div>
<div class="sect1">
<h2 id="_configuring_your_android_build">Configuring Your Android Build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started you must add the Micronaut annotation processors to the processor classpath using the <code>annotationProcessor</code> dependency configuration.</p>
</div>
<div class="paragraph">
<p>The Micronaut <code>micronaut-inject-java</code> dependency should be included in both the <code>annotationProcessor</code> and <code>compileOnly</code> scopes of your Android build configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Android build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    ...
    annotationProcessor "io.micronaut:micronaut-inject-java:2.1.0"
    compileOnly "io.micronaut:micronaut-inject-java:2.1.0"
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>lint</code> as part of your build you may also need to disable the invalid packages check since Android includes a hard coded check that regards the <code>javax.inject</code> package as invalid unless you are using Dagger:</p>
</div>
<div class="listingblock">
<div class="title">Configure lint within build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">android {
    ...
    lintOptions {
        lintOptions { warning 'InvalidPackage' }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information on <a href="https://developer.android.com/studio/build/gradle-plugin-3-0-0-migration.html#annotationProcessor_config">configuring annotations processors</a> in the Android documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut <code>inject-java</code> dependency uses <a href="https://developer.android.com/studio/write/java8-support.html">Android Java 8 support</a> features.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_dependency_injection">Enabling Dependency Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have configured the classpath correctly, the next step is start the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates creating a subclass of <a href="https://developer.android.com/reference/android/app/Application.html">android.app.Application</a> for that purpose:</p>
</div>
<div class="listingblock">
<div class="title">Example Android Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import android.app.Activity;
import android.app.Application;
import android.os.Bundle;

import io.micronaut.context.ApplicationContext;
import io.micronaut.context.env.Environment;

public class BaseApplication extends Application { <i class="conum" data-value="1"></i><b>(1)</b>

    private ApplicationContext ctx;

    public BaseApplication() {
        super();
    }

    @Override
    public void onCreate() {
        super.onCreate();
        ctx = ApplicationContext.run(MainActivity.class, Environment.ANDROID); <i class="conum" data-value="2"></i><b>(2)</b>
        registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() { <i class="conum" data-value="3"></i><b>(3)</b>
            @Override
            public void onActivityCreated(Activity activity, Bundle bundle) {
                ctx.inject(activity);
            }
            ... // shortened for brevity, it is not necessary to implement other methods
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend the <code>android.app.Application</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Run the <code>ApplicationContext</code> with the <code>ANDROID</code> environment</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To allow dependency injection of Android <code>Activity</code> instances register a <code>ActivityLifecycleCallbacks</code> instance</td>
</tr>
</table>
</div>
</div>
</div>

<h1 id="config"><a class="anchor" href="#config"></a>4 Application Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Configuration in Micronaut takes inspiration from both Spring Boot and Grails, integrating configuration properties from multiple sources directly into the core IoC container.</p>
</div>
<div class="paragraph">
<p>Configuration can by default be provided in either Java properties, YAML, JSON or Groovy files. The convention is to search for a file called <code>application.yml</code>, <code>application.properties</code>, <code>application.json</code> or <code>application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>In addition, just like Spring and Grails, Micronaut allows overriding any property via system properties or environment variables.</p>
</div>
<div class="paragraph">
<p>Each source of configuration is modeled with the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> interface and the mechanism is extensible allowing the implementation of additional <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> implementations.</p>
</div>

<h2 id="environments"><a class="anchor" href="#environments"></a>4.1 The Environment</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/environments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The application environment is modelled by the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface, which allows specifying one or many unique environment names when creating an <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run("test", "android");
        Environment environment = applicationContext.getEnvironment();

        assertTrue(environment.getActiveNames().contains("test"));
        assertTrue(environment.getActiveNames().contains("android"));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        ApplicationContext applicationContext = ApplicationContext.run("test", "android")
        Environment environment = applicationContext.getEnvironment()

        then:
        environment.getActiveNames().contains("test")
        environment.getActiveNames().contains("android")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run("test", "android")
        val environment = applicationContext.getEnvironment()

        assertTrue(environment.getActiveNames().contains("test"))
        assertTrue(environment.getActiveNames().contains("android"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The active environment names serve the purpose of allowing loading different configuration files depending on the environment and also using the <a href="../api/io/micronaut//context/annotation/Requires.html">@Requires</a> annotation to conditionally load beans or bean <a href="../api/io/micronaut//context/annotation/Configuration.html">@Configuration</a> packages.</p>
</div>
<div class="paragraph">
<p>In addition, Micronaut will attempt to detect the current environments. For example within a Spock or JUnit test the <a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a> environment will be automatically active.</p>
</div>
<div class="paragraph">
<p>Additional active environments can be specified using the <code>micronaut.environments</code> system property or the <code>MICRONAUT_ENVIRONMENTS</code> environment variable. These can be specified as a comma separated list. For example:</p>
</div>
<div class="listingblock">
<div class="title">Specifying environments</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -Dmicronaut.environments=foo,bar -jar myapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above activates environments called <code>foo</code> and <code>bar</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the Cloud environment names are also detected. See the section on <a href="#cloudConfiguration">Cloud Configuration</a> for more information.</p>
</div>
<div class="sect1">
<h2 id="_environment_priority">Environment Priority</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut will load property sources based off the environments specified, and if the same property key exists in multiple property sources specific to an environment, the environment order determines which value will be used.</p>
</div>
<div class="paragraph">
<p>Micronaut uses the following hierarchy for environment processing (lowest priority to highest priority):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deduced environments</p>
</li>
<li>
<p>Environments from the <code>micronaut.environments</code> system property</p>
</li>
<li>
<p>Environments from the <code>MICRONAUT_ENVIRONMENTS</code> environment variable</p>
</li>
<li>
<p>Environments specified explicitly through the application context builder</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This also applies to <code>@MicronautTest(environments = )</code>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_disabling_environment_detection">Disabling Environment Detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The automatic detection of environments can be disabled setting the <code>micronaut.env.deduction</code> system property or the <code>MICRONAUT_ENV_DEDUCTION</code> environment variable to <code>false</code>. This will prevent Micronaut from detecting current environments, while still using any environments that are specifically provided as shown above.</p>
</div>
<div class="listingblock">
<div class="title">Disabling environment detection via system property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$  java -Dmicronaut.env.deduction=false -jar myapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can disable environment deduction using the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a>'s <code>deduceEnvironment</code> method when setting up your application.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void testDisableEnvironmentDeductionViaBuilder() {
        ApplicationContext ctx = ApplicationContext.builder().deduceEnvironment(false).start();
        assertFalse(ctx.getEnvironment().getActiveNames().contains(Environment.TEST));
        ctx.close();
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    void "test disable environment deduction via builder"() {
        when:
        ApplicationContext ctx = ApplicationContext.builder().deduceEnvironment(false).start()

        then:
        !ctx.environment.activeNames.contains(Environment.TEST)

        cleanup:
        ctx.close()
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    "test disable environment deduction via builder"() {
        val ctx = ApplicationContext.builder().deduceEnvironment(false).start()
        assertFalse(ctx.environment.activeNames.contains(Environment.TEST))
        ctx.close()
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_default_environment">Default Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut supports the concept of one or many default environments. A default environment is one that is only applied if no other environments are explicitly specified. Environments can be explicitly specified either through the application context builder <code>Micronaut.build().environments(&#8230;&#8203;)</code>, through the <code>micronaut.environments</code> system property, or the <code>MICRONAUT_ENVIRONMENTS</code> environment variable. If an environment is configured through any of the above means, the default environment will <strong>not</strong> be applied.</p>
</div>
<div class="paragraph">
<p>To set the default environments, modify your application main method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static void main(String[] args) {
    Micronaut.build(args)
            .mainClass(Application.class)
            .defaultEnvironments("dev")
            .start();
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="propertySource"><a class="anchor" href="#propertySource"></a>4.2 Externalized Configuration with PropertySources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/propertySource.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Additional <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances can be added to the environment prior to initializing the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run(
                PropertySource.of(
                        "test",
                        CollectionUtils.mapOf(
                            "micronaut.server.host", "foo",
                            "micronaut.server.port", 8080
                        )
                ),
                "test", "android");
        Environment environment = applicationContext.getEnvironment();

        assertEquals(
                "foo",
                environment.getProperty("micronaut.server.host", String.class).orElse("localhost")
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        ApplicationContext applicationContext = ApplicationContext.run(
                PropertySource.of(
                        "test",
                        [
                            "micronaut.server.host": "foo",
                            "micronaut.server.port": 8080
                        ]
                ),
                "test", "android")
        Environment environment = applicationContext.getEnvironment()

        then:
        "foo" == environment.getProperty("micronaut.server.host", String.class).orElse("localhost")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run(
                PropertySource.of(
                        "test",
                        mapOf(
                                "micronaut.server.host" to "foo",
                                "micronaut.server.port" to 8080
                        )
                ),
                "test", "android")
        val environment = applicationContext.getEnvironment()

        assertEquals(
                "foo",
                environment.getProperty("micronaut.server.host", String::class.java).orElse("localhost")
        )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource.of</a> method can be used to create a <code>ProperySource</code> from a map of values.</p>
</div>
<div class="paragraph">
<p>Alternatively one can register a <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> by creating a <code>META-INF/services/io.micronaut.context.env.PropertySourceLoader</code> containing a reference to the class name of the <code>PropertySourceLoader</code>.</p>
</div>
<div class="sect2">
<h3 id="_included_propertysource_loaders">Included PropertySource Loaders</h3>
<div class="paragraph">
<p>Micronaut by default contains <code>PropertySourceLoader</code> implementations that load properties from the given locations and priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Command line arguments</p>
</li>
<li>
<p>Properties from <code>SPRING_APPLICATION_JSON</code> (for Spring compatibility)</p>
</li>
<li>
<p>Properties from <code>MICRONAUT_APPLICATION_JSON</code></p>
</li>
<li>
<p>Java System Properties</p>
</li>
<li>
<p>OS environment variables</p>
</li>
<li>
<p>Configuration files loaded in order from the system property 'micronaut.config.files' or the environment variable <code>MICRONAUT_CONFIG_FILES</code>. The value can be a comma separated list of paths with the last file having precedence. The files can be referenced from the file system as a path or the classpath with a <code>classpath:</code> prefix.</p>
</li>
<li>
<p>Environment-specific properties from <code>application-{environment}.{extension}</code></p>
</li>
<li>
<p>Application-specific properties from <code>application.{extension}</code></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>.properties</code>, <code>.json</code>, <code>.yml</code> are supported out of the box. For Groovy users <code>.groovy</code> is supported as well.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_supplying_configuration_via_command_line">Supplying Configuration via Command Line</h3>
<div class="paragraph">
<p>Configuration can be supplied at the command line using Gradle or our Maven plugin. For example:</p>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run --args="-endpoints.health.enabled=true -config.property=test"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run -Dmn.appArgs="-endpoints.health.enabled=true -config.property=test"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order for the configuration to be apart of the context, the args from the main method must be passed to the context builder. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class, args); // passing args
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_property_value_placeholders">Property Value Placeholders</h3>
<div class="paragraph">
<p>Micronaut includes a property placeholder syntax which can be used to reference configuration properties both within configuration values and with any Micronaut annotation (see <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> and the section on <a href="#valueAnnotation">Configuration Injection</a>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Programmatic usage is also possible via the <a href="../api/io/micronaut/context/env/PropertyPlaceholderResolver.html">PropertyPlaceholderResolver</a> interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic syntax is to wrap a reference to a property in <code>${&#8230;&#8203;}</code>. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Defining Property Placeholders</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
    endpoint: http://${micronaut.server.host}:${micronaut.server.port}/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example embeds references to the <code>micronaut.server.host</code> and <code>micronaut.server.port</code> properties.</p>
</div>
<div class="paragraph">
<p>You can specify default values by defining a value after the <code>:</code> character. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using Default Values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
    endpoint: http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will default to <code>localhost</code> and port <code>8080</code> if no value is found (rather than throwing an exception). Note that if default value itself contains a <code>:</code> character, you should escape it using back ticks:</p>
</div>
<div class="listingblock">
<div class="title">Using Backticks</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
    endpoint: ${server.address:`http://localhost:8080`}/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example tries to read a <code>server.address</code> property otherwise fallbacks back to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>, since the address has a <code>:</code> character we have to escape it with back ticks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_property_value_binding">Property Value Binding</h3>
<div class="paragraph">
<p>Note that these property references should always be in kebab case (lowercase and hyphen-separated) when placing references in code or in placeholder values. For example, you should use <code>micronaut.server.default-charset</code> and not <code>micronaut.server.defaultCharset</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut still allows specifying the latter in configuration, but normalizes the properties into kebab case form to optimize memory consumption and reduce complexity when resolving properties. The following table summarizes how properties are normalized from different sources:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Property Value Normalization</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Properties</th>
<th class="tableblock halign-left valign-top">Property Source</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myApp.myStuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.myStuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myApp.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MYAPP_MYSTUFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myapp.mystuff</code>, <code>myapp-mystuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment Variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MY_APP_MY_STUFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my.app.my.stuff</code>, <code>my.app.my-stuff</code>, <code>my.app-my.stuff</code>, <code>my.app-my-stuff</code>, <code>my-app.my.stuff</code>, <code>my-app.my-stuff</code>, <code>my-app-my.stuff</code>, <code>my-app-my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment Variable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Environment variables are given special treatment to allow the definition of environment variables to be more flexible. Note that there is no way to reference an environment variable with camel-case.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Because the number of properties generated is exponential based on the number of <code>_</code> characters in the environment variable, it is recommended to refine which, if any, environment variables are included in configuration if the number of environment variables with a large number of underscores is high.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To control how environment properties participate in configuration, call the respective methods on the <code>Micronaut</code> builder.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.build(args)
                .mainClass(Application.class)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String[] args) {
        Micronaut.build()
                .mainClass(Application)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.build(null)
                .mainClass(Application::class.java)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start()
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration above does not have any impact on property placeholders. It is still possible to reference an environment variable in a placeholder regardless of whether environment configuration is disabled, or even if the specific property is explicitly excluded.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_random_properties">Using Random Properties</h3>
<div class="paragraph">
<p>You can use <code>random</code> values by using the following properties.  These can be used in configuration files as variables like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: myapplication
    instance:
      id: ${random.shortuuid}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Random Values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An available random port number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.shortuuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID of only 10 chars in length (Note: As this isn&#8217;t full UUID, collision COULD occur)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID with dashes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.uuid2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID without dashes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_fail_fast_property_injection">Fail Fast Property Injection</h3>
<div class="paragraph">
<p>For beans that inject required properties, the injection and potential failure will not occur until the bean is requested. To verify at startup that the properties exist and can be injected, the bean can be annotated with <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a>. Context scoped beans will be injected at startup time and thus will fail at startup time if any required properties are missing or could not be converted to the required type.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To maintain a fast startup time, it is recommended to use this feature as sparingly as possible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_log_levels_with_properties">Controlling Log Levels with Properties</h3>
<div class="paragraph">
<p>Log levels can be configured via properties defined in <code>application.yml</code> (and environment variables) with the <code>log.level</code> prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logger:
    levels:
        foo.bar: ERROR</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the ability to control log levels via config is controlled via the <a href="../api/io/micronaut/logging/LoggingSystem.html">LoggingSystem</a> interface. Currently Micronaut ships with a single implementation that allows setting log levels for the Logback library. If another library is chosen you should provide a bean that implements this interface.</p>
</div>
</div>

<h2 id="valueAnnotation"><a class="anchor" href="#valueAnnotation"></a>4.3 Configuration Injection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/valueAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can inject configuration values into beans with Micronaut using the <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> annotation.</p>
</div>
<div class="sect2">
<h3 id="_using_the_code_value_code_annotation">Using the <code>@Value</code> Annotation</h3>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;

@Singleton
public class EngineImpl implements Engine {

    @Value("${my.engine.cylinders:6}") <b class="conum">(1)</b>
    protected int cylinders;

    @Override
    public int getCylinders() {
        return this.cylinders;
    }

    @Override
    public String start() {<b class="conum">(2)</b>
        return "Starting V" + getCylinders() + " Engine";
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton

@Singleton
class EngineImpl implements Engine {

    @Value('${my.engine.cylinders:6}') <b class="conum">(1)</b>
    protected int cylinders

    @Override
    int getCylinders() {
        this.cylinders
    }

    @Override
    String start() { <b class="conum">(2)</b>
        "Starting V${cylinders} Engine"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton

@Singleton
class EngineImpl : Engine {

    @Value("\${my.engine.cylinders:6}") <b class="conum">(1)</b>
    override var cylinders: Int = 0
        protected set

    override fun start(): String {<b class="conum">(2)</b>
        return "Starting V$cylinders Engine"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Value</code> annotation accepts a string that can have embedded placeholder values (the default value can be provided by specifying a value after the colon <code>:</code> character).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The injected value can then be used within code.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>@Value</code> can also be used to inject a static value, for example the following will inject the number 10:</p>
</div>
<div class="listingblock">
<div class="title">Static @Value Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("10")
int number;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However it is definitely more useful when used to compose injected values combining static content and placeholders. For example to setup a URL:</p>
</div>
<div class="listingblock">
<div class="title">Placeholders with @Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("http://${my.host}:${my.port}")
URL url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the URL is constructed from 2 placeholder properties that must be present in configuration: <code>my.host</code> and <code>my.port</code>.</p>
</div>
<div class="paragraph">
<p>Remember that to specify a default value in a placeholder expression, you should use the colon <code>:</code> character, however if the default you are trying to specify has a colon then you should escape the value with back ticks. For example:</p>
</div>
<div class="listingblock">
<div class="title">Placeholders with @Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("${my.url:`http://foo.com`}")
URL url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is nothing special about <code>@Value</code> itself regarding the resolution of property value placeholders.</p>
</div>
<div class="paragraph">
<p>Due to Micronaut&#8217;s extensive support for annotation metadata you can in fact use property placeholder expressions on any annotation. For example, to make the path of a <code>@Controller</code> configurable you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("${hello.controller.path:/hello}")
class HelloController {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case if <code>hello.controller.path</code> is specified in configuration then the controller will be mapped to the path specified otherwise it will be mapped to <code>/hello</code>.</p>
</div>
<div class="paragraph">
<p>You can also make the target server for <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> configurable (although service discovery approaches are often better), for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("${my.server.url:`http://localhost:8080`}")
interface HelloClient {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the property <code>my.server.url</code> can be used to configure the client otherwise the client will fallback to a localhost address.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_code_property_code_annotation">Using the <code>@Property</code> Annotation</h3>
<div class="paragraph">
<p>Recall that the <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> annotation receives a String value which is a mix of static content and placeholder expressions. This can lead to confusion if you attempt to do the following:</p>
</div>
<div class="listingblock">
<div class="title">Incorrect usage of <code>@Value</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("my.url")
String url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case the value <code>my.url</code> will be injected and set to the <code>url</code> field and <strong>not</strong> the value of the <code>my.url</code> property from your application configuration, this is because <code>@Value</code> only resolves placeholders within the value specified to it.</p>
</div>
<div class="paragraph">
<p>If you wish to inject a specific property name then you may be better off using <a href="../api/io/micronaut/context/annotation/Property.html">@Property</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Property;

import javax.inject.Inject;
import javax.inject.Singleton;

@Singleton
public class Engine {

    @Property(name = "my.engine.cylinders") <b class="conum">(1)</b>
    protected int cylinders; <b class="conum">(2)</b>

    private String manufacturer;

    public int getCylinders() {
        return cylinders;
    }

    public String getManufacturer() {
        return manufacturer;
    }

    @Inject
    public void setManufacturer(@Property(name = "my.engine.manufacturer") String manufacturer) { <b class="conum">(3)</b>
        this.manufacturer = manufacturer;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Property

import javax.inject.Singleton

@Singleton
class Engine {

    @Property(name = "my.engine.cylinders") <b class="conum">(1)</b>
    protected int cylinders <b class="conum">(2)</b>

    @Property(name = "my.engine.manufacturer") <b class="conum">(3)</b>
    String manufacturer

    int getCylinders() {
        cylinders
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Property

import javax.inject.Inject
import javax.inject.Singleton


@Singleton
class Engine {

    @field:Property(name = "my.engine.cylinders") <b class="conum">(1)</b>
    protected var cylinders: Int = 0 <b class="conum">(2)</b>

    @set:Inject
    @setparam:Property(name = "my.engine.manufacturer") <b class="conum">(3)</b>
    var manufacturer: String? = null

    fun cylinders(): Int {
        return cylinders
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>my.engine.cylinders</code> property will be resolved from configuration and injected directly into the field.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fields subjected to injection should never be private otherwise expensive reflection must be used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@Property</code> annotation is used to inject through the setter</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because it is not possible to define a default value with <code>@Property</code>, if the value doesn&#8217;t exist or cannot be converted to the required type, the bean instantiation will fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above will instead inject the value of the <code>my.url</code> property resolved from application configuration. If the property can not be found in configuration, an exception will be thrown. As with other types of injection, the injection point can also be annotated with <code>@Nullable</code> to make the injection optional.</p>
</div>
<div class="paragraph">
<p>You can also use this feature to resolve sub maps. For example, consider the following configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>application.yml</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
    default:
        name: 'mydb'
jpa:
    default:
        properties:
            hibernate:
                hbm2ddl:
                    auto: update
                show_sql: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to resolve a flattened map containing only the properties starting with <code>hibernate</code> then you can do so with <code>@Property</code>, for example:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@Property</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(name = "jpa.default.properties")
Map&lt;String, String&gt; jpaProperties;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The injected map will contain the keys <code>hibernate.hbm2ddl.auto</code> and <code>hibernate.show_sql</code> and their values.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/core/convert/format/MapFormat.html">@MapFormat</a> annotation can be used to customize the injected map depending whether you want nested keys, flat keys and it allows customization of the key style via the <a href="../api/io/micronaut/core/naming/conventions/StringConvention.html">StringConvention</a> enum.
</td>
</tr>
</table>
</div>
</div>

<h2 id="configurationProperties"><a class="anchor" href="#configurationProperties"></a>4.4 Configuration Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/configurationProperties.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can create type safe configuration by creating classes that are annotated with
 <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut will produce a reflection-free <code>@ConfigurationProperties</code> bean and will also at compile time calculate the property paths to evaluate, greatly improving the speed and efficiency of loading <code>@ConfigurationProperties</code>.</p>
</div>
<div class="paragraph">
<p>An example of a configuration class can be seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
public class EngineConfig {
    public String getManufacturer() {
        return manufacturer;
    }

    public void setManufacturer(String manufacturer) {
        this.manufacturer = manufacturer;
    }

    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    public CrankShaft getCrankShaft() {
        return crankShaft;
    }

    public void setCrankShaft(CrankShaft crankShaft) {
        this.crankShaft = crankShaft;
    }

    @NotBlank <b class="conum">(2)</b>
    private String manufacturer = "Ford"; <b class="conum">(3)</b>
    @Min(1L)
    private int cylinders;
    private CrankShaft crankShaft = new CrankShaft();

    @ConfigurationProperties("crank-shaft")
    public static class CrankShaft { <b class="conum">(4)</b>
        public Optional&lt;Double&gt; getRodLength() {
            return rodLength;
        }

        public void setRodLength(Optional&lt;Double&gt; rodLength) {
            this.rodLength = rodLength;
        }

        private Optional&lt;Double&gt; rodLength = Optional.empty(); <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties('my.engine') <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank <b class="conum">(2)</b>
    String manufacturer = "Ford" <b class="conum">(3)</b>

    @Min(1L)
    int cylinders
    CrankShaft crankShaft = new CrankShaft()

    @ConfigurationProperties('crank-shaft')
    static class CrankShaft { <b class="conum">(4)</b>
        Optional&lt;Double&gt; rodLength = Optional.empty() <b class="conum">(5)</b>
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import java.util.*

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank <b class="conum">(2)</b>
    var manufacturer = "Ford" <b class="conum">(3)</b>
    @Min(1L)
    var cylinders: Int = 0
    var crankShaft = CrankShaft()

    @ConfigurationProperties("crank-shaft")
    class CrankShaft { <b class="conum">(4)</b>
        var rodLength: Optional&lt;Double&gt; = Optional.empty() <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <code>javax.validation</code> to validate the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default values can be assigned to the property</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Static inner classes can provided nested configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional configuration values can be wrapped in a <code>java.util.Optional</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have prepared a type safe configuration it can simply be injected into your objects like any other bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class EngineImpl implements Engine {
    private final EngineConfig config;

    public EngineImpl(EngineConfig config) {<b class="conum">(1)</b>
        this.config = config;
    }

    @Override
    public int getCylinders() {
        return config.getCylinders();
    }

    @Override
    public String start() {<b class="conum">(2)</b>
        return getConfig().getManufacturer() + " Engine Starting V" + getConfig().getCylinders() +
                " [rodLength=" + getConfig().getCrankShaft().getRodLength().orElse(6.0d) + "]";
    }

    public final EngineConfig getConfig() {
        return config;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class EngineImpl implements Engine {
    final EngineConfig config

    EngineImpl(EngineConfig config) { <b class="conum">(1)</b>
        this.config = config
    }

    @Override
    int getCylinders() {
        config.cylinders
    }

    @Override
    String start() { <b class="conum">(2)</b>
        "${config.manufacturer} Engine Starting V${config.cylinders} [rodLength=${config.crankShaft.rodLength.orElse(6.0d)}]"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
class EngineImpl(val config: EngineConfig) : Engine {<b class="conum">(1)</b>

    override val cylinders: Int
        get() = config.cylinders

    override fun start(): String {<b class="conum">(2)</b>
        return "${config.manufacturer} Engine Starting V${config.cylinders} [rodLength=${config.crankShaft.rodLength.orElse(6.0)}]"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EngineConfig</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the configuration properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration values can then be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        LinkedHashMap&lt;String, Object&gt; map = new LinkedHashMap(1);
        map.put("my.engine.cylinders", "8");
        ApplicationContext applicationContext = ApplicationContext.run(map, "test");

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                ['my.engine.cylinders': '8'],
                "test"
        )

        Vehicle vehicle = applicationContext
                .getBean(Vehicle)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val map = mapOf( "my.engine.cylinders" to "8")
        val applicationContext = ApplicationContext.run(map, "test")

        val vehicle = applicationContext.getBean(Vehicle::class.java)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Ford Engine Starting V8 [rodLength=6.0]"</code></p>
</div>
<div class="paragraph">
<p>Note for more complex configurations you can structure <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans through inheritance.</p>
</div>
<div class="paragraph">
<p>For example creating a subclass of <code>EngineConfig</code> with <code>@ConfigurationProperties('bar')</code> will resolve all properties under the path <code>my.engine.bar</code>.</p>
</div>
<div class="sect1">
<h2 id="_includes_excludes">Includes / Excludes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the cases where the configuration properties class is inheriting properties from a parent class, it may be desirable to exclude properties from the parent class. The <code>includes</code> and <code>excludes</code> members of the <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation allow for that functionality. The list applies to both local properties and inherited properties.</p>
</div>
<div class="paragraph">
<p>The names supplied to the includes/excludes list should be the "property" name. For example if a setter method is injected, the property name is the de-capitalized setter name (<code>setConnectionTimeout</code> &#8594; <code>connectionTimeout</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_property_type_conversion">Property Type Conversion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When resolving properties Micronaut will use the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> bean to convert properties. You can register additional converters for types not supported by micronaut by defining beans that implement the <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> interface.</p>
</div>
<div class="paragraph">
<p>Micronaut features some built-in conversions that are useful, which are detailed below.</p>
</div>
<div class="sect2">
<h3 id="_duration_conversion">Duration Conversion</h3>
<div class="paragraph">
<p>Durations can be specified by appending the unit with a number. Supported units are <code>s</code>, <code>ms</code>, <code>m</code> etc. The following table summarizes examples:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Duration Conversion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 milliseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 hours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10ns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 nanoseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PT15M</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration of 15 minutes using ISO-8601 format</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example to configure the default HTTP client read timeout:</p>
</div>
<div class="listingblock">
<div class="title">Using Duration Values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-timeout: 15s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_list_array_conversion">List / Array Conversion</h3>
<div class="paragraph">
<p>Lists and arrays can be specified in Java properties files as comma-separated values or in YAML using native YAML lists. The generic types are used to convert the values. For example in YAML:</p>
</div>
<div class="listingblock">
<div class="title">Specifying lists or arrays in YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">my:
    app:
        integers:
            - 1
            - 2
        urls:
            - http://foo.com
            - http://bar.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in Java properties file format:</p>
</div>
<div class="listingblock">
<div class="title">Specifying lists or arrays in Java properties comma-separated</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">my.app.integers=1,2
my.app.urls=http://foo.com,http://bar.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can use an index:</p>
</div>
<div class="listingblock">
<div class="title">Specifying lists or arrays in Java properties using index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">my.app.integers[0]=1
my.app.integers[1]=2</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the above example configurations you can define properties to bind to with the target type supplied via generics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Integer&gt; integers;
List&lt;URL&gt; urls;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_readable_bytes">Readable Bytes</h3>
<div class="paragraph">
<p>You can annotate any setter parameter with <a href="../api/io/micronaut/core/convert/format/ReadableBytes.html">@ReadableBytes</a> to allow the value to be set using a shorthand syntax for specifying bytes, kilobytes etc. For example the following is taken from <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@ReadableBytes</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setMaxContentLength(@ReadableBytes int maxContentLength) {
    this.maxContentLength = maxContentLength;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above in place you can set <code>micronaut.http.client.max-content-length</code> using the following values:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. @ReadableBytes Conversion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10mb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 megabytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10kb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 kilobytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10gb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 gigabytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A raw byte length</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_formatting_dates">Formatting Dates</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/convert/format/Format.html">@Format</a> annotation can be used on any setter to allow the date format to be specified when binding <code>java.time</code> date objects.</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@Format</code> for Dates</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setMyDate(@Format("yyyy-MM-dd") LocalDate date) {
    this.myDate = date;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_builder">Configuration Builder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many existing frameworks and tools already use builder-style classes to construct configuration.</p>
</div>
<div class="paragraph">
<p>To support the ability for a builder style class to be populated with configuration values, the <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">@ConfigurationBuilder</a> annotation can be used. <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">ConfigurationBuilder</a> can be added to a field or method in a class annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Since there is no consistent way to define builders in the Java world, one or more method prefixes can be specified in the annotation to support builder methods like <code>withXxx</code> or <code>setXxx</code>. If the builder methods have no prefix, assign an empty string to the parameter.</p>
</div>
<div class="paragraph">
<p>A configuration prefix can also be specified to tell Micronaut where to look for configuration values. By default, the builder methods will use the configuration prefix defined at the class level <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationBuilder;
import io.micronaut.context.annotation.ConfigurationProperties;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
class EngineConfig {

    @ConfigurationBuilder(prefixes = "with") <b class="conum">(2)</b>
    EngineImpl.Builder builder = EngineImpl.builder();

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "crank-shaft") <b class="conum">(3)</b>
    CrankShaft.Builder crankShaft = CrankShaft.builder();

    private SparkPlug.Builder sparkPlug = SparkPlug.builder();

    SparkPlug.Builder getSparkPlug() { return this.sparkPlug; }

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "spark-plug") <b class="conum">(4)</b>
    void setSparkPlug(SparkPlug.Builder sparkPlug) {
        this.sparkPlug = sparkPlug;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationBuilder
import io.micronaut.context.annotation.ConfigurationProperties

@ConfigurationProperties('my.engine') <b class="conum">(1)</b>
class EngineConfig {

    @ConfigurationBuilder(prefixes = "with") <b class="conum">(2)</b>
    EngineImpl.Builder builder = EngineImpl.builder()

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "crank-shaft") <b class="conum">(3)</b>
    CrankShaft.Builder crankShaft = CrankShaft.builder()

    SparkPlug.Builder sparkPlug = SparkPlug.builder()

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "spark-plug") <b class="conum">(4)</b>
    void setSparkPlug(SparkPlug.Builder sparkPlug) {
        this.sparkPlug = sparkPlug
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationBuilder
import io.micronaut.context.annotation.ConfigurationProperties

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
internal class EngineConfig {
    @ConfigurationBuilder(prefixes = ["with"])  <b class="conum">(2)</b>
    val builder = EngineImpl.builder()

    @ConfigurationBuilder(prefixes = ["with"], configurationPrefix = "crank-shaft") <b class="conum">(3)</b>
    val crankShaft = CrankShaft.builder()

    @set:ConfigurationBuilder(prefixes = ["with"], configurationPrefix = "spark-plug") <b class="conum">(4)</b>
    var sparkPlug = SparkPlug.builder()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first builder can be configured without the class configuration prefix; it will inherit from the above.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The second builder can be configured with the class configuration prefix + the <code>configurationPrefix</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The third builder demonstrates that the annotation can be applied to a method as well as a property.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, only builder methods that take a single argument are supported. To support methods with no arguments, set the <code>allowZeroArgs</code> parameter of the annotation to true.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just like in the previous example, we can construct an <code>EngineImpl</code>. Since we are using a builder, a factory class can be used to build the engine from the builder.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Factory;

import javax.inject.Singleton;

@Factory
class EngineFactory {

    @Singleton
    EngineImpl buildEngine(EngineConfig engineConfig) {
        return engineConfig.builder.build(engineConfig.crankShaft, engineConfig.getSparkPlug());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Factory

import javax.inject.Singleton

@Factory
class EngineFactory {

    @Singleton
    EngineImpl buildEngine(EngineConfig engineConfig) {
        engineConfig.builder.build(engineConfig.crankShaft, engineConfig.sparkPlug)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import javax.inject.Singleton

@Factory
internal class EngineFactory {

    @Singleton
    fun buildEngine(engineConfig: EngineConfig): EngineImpl {
        return engineConfig.builder.build(engineConfig.crankShaft, engineConfig.sparkPlug)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The engine that was returned can then be injected anywhere an engine is depended on.</p>
</div>
<div class="paragraph">
<p>Configuration values can be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        HashMap&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
        properties.put("my.engine.cylinders"             ,"4");
        properties.put("my.engine.manufacturer"          , "Subaru");
        properties.put("my.engine.crank-shaft.rod-length", 4);
        properties.put("my.engine.spark-plug.name"       , "6619 LFR6AIX");
        properties.put("my.engine.spark-plug.type"       , "Iridium");
        properties.put("my.engine.spark-plug.companyName", "NGK");
        ApplicationContext applicationContext = ApplicationContext.run(properties, "test");

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                ['my.engine.cylinders'             : '4',
                 'my.engine.manufacturer'          : 'Subaru',
                 'my.engine.crank-shaft.rod-length': 4,
                 'my.engine.spark-plug.name'       : '6619 LFR6AIX',
                 'my.engine.spark-plug.type'       : 'Iridium',
                 'my.engine.spark-plug.companyName': 'NGK'
                ],
                "test"
        )

        Vehicle vehicle = applicationContext
                .getBean(Vehicle)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run(
                mapOf(
                        "my.engine.cylinders" to "4",
                        "my.engine.manufacturer" to "Subaru",
                        "my.engine.crank-shaft.rod-length" to 4,
                        "my.engine.spark-plug.name" to "6619 LFR6AIX",
                        "my.engine.spark-plug.type" to "Iridium",
                        "my.engine.spark-plug.company" to "NGK"
                ),
                "test"
        )

        val vehicle = applicationContext.getBean(Vehicle::class.java)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Subaru Engine Starting V4 [rodLength=4.0, sparkPlug=Iridium(NGK 6619 LFR6AIX)]"</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mapformat">MapFormat</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For some use cases it may be desirable to accept a map of arbitrary configuration properties that can be supplied to a bean, especially if the bean represents a third-party API where not all of the possible configuration properties are known by the developer. For example, a datasource may accept a map of configuration properties specific to a particular database driver, allowing the user to specify any desired options in the map without coding every single property explicitly.</p>
</div>
<div class="paragraph">
<p>For this purpose, the <a href="../api/io/micronaut/core/convert/format/MapFormat.html">MapFormat</a> annotation allows you to bind a map to a single configuration property, and specify whether to accept a flat map of keys to values, or a nested map (where the values may be additional maps].</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import javax.validation.constraints.Min;
import java.util.Map;
import io.micronaut.core.convert.format.MapFormat;

@ConfigurationProperties("my.engine")
public class EngineConfig {
    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    public Map&lt;Integer, String&gt; getSensors() {
        return sensors;
    }

    public void setSensors(Map&lt;Integer, String&gt; sensors) {
        this.sensors = sensors;
    }

    @Min(1L)
    private int cylinders;
    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) <b class="conum">(1)</b>
    private Map&lt;Integer, String&gt; sensors;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties
import javax.validation.constraints.Min
import io.micronaut.core.convert.format.MapFormat

@ConfigurationProperties('my.engine')
class EngineConfig {

    @Min(1L)
    int cylinders

    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) <b class="conum">(1)</b>
    Map&lt;Integer, String&gt; sensors

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import javax.validation.constraints.Min
import io.micronaut.core.convert.format.MapFormat

@ConfigurationProperties("my.engine")
class EngineConfig {

    @Min(1L)
    var cylinders: Int = 0
    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) <b class="conum">(1)</b>
    var sensors: Map&lt;Int, String&gt;? = null
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the <code>transformation</code> argument to the annotation; possible values are <code>MapTransformation.FLAT</code> (for flat maps) and <code>MapTransformation.NESTED</code> (for nested maps)</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class EngineImpl implements Engine {
    @Override
    public Map getSensors() {
        return config.getSensors();
    }

    @Override
    public String start() {
        return "Engine Starting V" + getConfig().getCylinders() + " [sensors=" + getSensors().size() + "]";
    }

    public EngineConfig getConfig() {
        return config;
    }

    public void setConfig(EngineConfig config) {
        this.config = config;
    }

    @Inject
    private EngineConfig config;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class EngineImpl implements Engine {

    @Inject EngineConfig config

    @Override
    Map getSensors() {
        config.sensors
    }

    @Override
    String start() {
        "Engine Starting V${config.cylinders} [sensors=${sensors.size()}]"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
class EngineImpl : Engine {
    override val sensors: Map&lt;*, *&gt;?
        get() = config!!.sensors

    @Inject
    var config: EngineConfig? = null

    override fun start(): String {
        return "Engine Starting V${config!!.cylinders} [sensors=${sensors!!.size}]"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now a map of properties can be supplied to the <code>my.engine.sensors</code> configuration property.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        LinkedHashMap&lt;String, Object&gt; map = new LinkedHashMap(2);
        map.put("my.engine.cylinders", "8");
        LinkedHashMap&lt;Integer, String&gt; map1 = new LinkedHashMap(2);
        map1.put(0, "thermostat");
        map1.put(1, "fuel pressure");
        map.put("my.engine.sensors", map1);
        ApplicationContext applicationContext = ApplicationContext.run(map, "test");

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        DefaultGroovyMethods.println(this, vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                ['my.engine.cylinders': '8', 'my.engine.sensors': [0: 'thermostat', 1: 'fuel pressure']],
                "test"
        )

        Vehicle vehicle = applicationContext
                .getBean(Vehicle)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val subMap = mapOf(
                0 to "thermostat",
                1 to "fuel pressure"
        )
        val map = mapOf(
                "my.engine.cylinders" to "8",
                "my.engine.sensors" to subMap
        )
        val applicationContext = ApplicationContext.run(map, "test")

        val vehicle = applicationContext.getBean(Vehicle::class.java)
        DefaultGroovyMethods.println(this, vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Engine Starting V8 [sensors=2]"</code></p>
</div>
</div>
</div>

<h2 id="customTypeConverter"><a class="anchor" href="#customTypeConverter"></a>4.5 Custom Type Converters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/customTypeConverter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features a built in type conversion mechanism that is extensible. To add additional type converters you register beans of type <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use one of the built-in converters (Map to an Object) or create your own.</p>
</div>
<div class="paragraph">
<p>Consider the following <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">ConfigurationProperties</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
public class MyConfigurationProperties {
    public LocalDate getUpdatedAt() {
        return this.updatedAt;
    }

    public static final String PREFIX = "myapp";
    protected LocalDate updatedAt;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
class MyConfigurationProperties {
    public static final String PREFIX = "myapp"
    protected LocalDate updatedAt

    LocalDate getUpdatedAt() {
        return this.updatedAt
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
class MyConfigurationProperties {
    var updatedAt: LocalDate? = null
        protected set

    companion object {
        const val PREFIX = "myapp"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type <code>MyConfigurationProperties</code> features a property called <code>updatedAt</code> which is of type <a href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html">LocalDate</a>.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s say you want to allow binding to this property from a map via configuration:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    private static ApplicationContext ctx;

    @BeforeClass
    public static void setupCtx() {
        ctx = ApplicationContext.run(
                new LinkedHashMap&lt;String, Object&gt;() {{
                    put("myapp.updatedAt", <b class="conum">(1)</b>
                            new LinkedHashMap&lt;String, Integer&gt;() {{
                                put("day", 28);
                                put("month", 10);
                                put("year", 1982);
                            }}
                    );
                }}
        );
    }

    @AfterClass
    public static void teardownCtx() {
        if(ctx != null) {
            ctx.stop();
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @AutoCleanup
    @Shared
    ApplicationContext ctx = ApplicationContext.run(
            "myapp.updatedAt": [day: 28, month: 10, year: 1982]  <b class="conum">(1)</b>
    )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    lateinit var ctx: ApplicationContext

    @BeforeEach
    fun setup() {
        ctx = ApplicationContext.run(
                mapOf(
                        "myapp.updatedAt" to mapOf( <b class="conum">(1)</b>
                                "day" to 28,
                                "month" to 10,
                                "year" to 1982
                        )
                )
        )
    }

    @AfterEach
    fun teardown() {
        ctx?.close()
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note how we match the <code>myapp</code> prefix and <code>updatedAt</code> property name in our <code>MyConfigurationProperties</code> class above</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This won&#8217;t work by default, since there is no built in conversion from <code>Map</code> to <code>LocalDate</code>. To resolve this you can define a custom <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.convert.ConversionContext;
import io.micronaut.core.convert.ConversionService;
import io.micronaut.core.convert.TypeConverter;

import javax.inject.Singleton;
import java.time.DateTimeException;
import java.time.LocalDate;
import java.util.Map;
import java.util.Optional;

@Singleton
public class MapToLocalDateConverter implements TypeConverter&lt;Map, LocalDate&gt; { <b class="conum">(1)</b>
    @Override
    public Optional&lt;LocalDate&gt; convert(Map propertyMap, Class&lt;LocalDate&gt; targetType, ConversionContext context) {
        Optional&lt;Integer&gt; day = ConversionService.SHARED.convert(propertyMap.get("day"), Integer.class);
        Optional&lt;Integer&gt; month = ConversionService.SHARED.convert(propertyMap.get("month"), Integer.class);
        Optional&lt;Integer&gt; year = ConversionService.SHARED.convert(propertyMap.get("year"), Integer.class);
        if (day.isPresent() &amp;&amp; month.isPresent() &amp;&amp; year.isPresent()) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())); <b class="conum">(2)</b>
            } catch (DateTimeException e) {
                context.reject(propertyMap, e); <b class="conum">(3)</b>
                return Optional.empty();
            }

        }

        return Optional.empty();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.convert.TypeConverter

import javax.inject.Singleton
import java.time.DateTimeException
import java.time.LocalDate

@Singleton
class MapToLocalDateConverter implements TypeConverter&lt;Map, LocalDate&gt; { <b class="conum">(1)</b>
    @Override
    Optional&lt;LocalDate&gt; convert(Map propertyMap, Class&lt;LocalDate&gt; targetType, ConversionContext context) {
        Optional&lt;Integer&gt; day = ConversionService.SHARED.convert(propertyMap.get("day"), Integer.class)
        Optional&lt;Integer&gt; month = ConversionService.SHARED.convert(propertyMap.get("month"), Integer.class)
        Optional&lt;Integer&gt; year = ConversionService.SHARED.convert(propertyMap.get("year"), Integer.class)
        if (day.isPresent() &amp;&amp; month.isPresent() &amp;&amp; year.isPresent()) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())) <b class="conum">(2)</b>
            } catch (DateTimeException e) {
                context.reject(propertyMap, e) <b class="conum">(3)</b>
                return Optional.empty()
            }
        }
        return Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.convert.TypeConverter

import javax.inject.Singleton
import java.time.DateTimeException
import java.time.LocalDate
import java.util.Optional

@Singleton
class MapToLocalDateConverter : TypeConverter&lt;Map&lt;*, *&gt;, LocalDate&gt; { <b class="conum">(1)</b>
    override fun convert(propertyMap: Map&lt;*, *&gt;, targetType: Class&lt;LocalDate&gt;, context: ConversionContext): Optional&lt;LocalDate&gt; {
        val day = ConversionService.SHARED.convert(propertyMap["day"], Int::class.java)
        val month = ConversionService.SHARED.convert(propertyMap["month"], Int::class.java)
        val year = ConversionService.SHARED.convert(propertyMap["year"], Int::class.java)
        if (day.isPresent &amp;&amp; month.isPresent &amp;&amp; year.isPresent) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())) <b class="conum">(2)</b>
            } catch (e: DateTimeException) {
                context.reject(propertyMap, e) <b class="conum">(3)</b>
                return Optional.empty()
            }

        }

        return Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class implements <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> which takes two generic arguments. The type you are converting from and the type you are converting to</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The implementation delegate to the default shared conversion service to convert the parts of the map that make the day, month and year into a <code>LocalDate</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If an exception occurs you can call <code>reject(..)</code> which propagates additional information to the container if something goes wrong during binding</td>
</tr>
</table>
</div>

<h2 id="eachProperty"><a class="anchor" href="#eachProperty"></a>4.6 Using @EachProperty to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/eachProperty.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation is great for a single configuration class, but sometimes you want multiple instances each with their own distinct configuration. That is where <a href="../api/io/micronaut/context/annotation/EachProperty.html">EachProperty</a> comes in.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> annotation will create a <code>ConfigurationProperties</code> bean for each sub-property within the given property. As an example consider the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Parameter;
import io.micronaut.context.annotation.EachProperty;

@EachProperty("test.datasource")  <b class="conum">(1)</b>
public class DataSourceConfiguration {

    private final String name;
    private URI url = new URI("localhost");

    public DataSourceConfiguration(@Parameter String name) <b class="conum">(2)</b>
            throws URISyntaxException {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public URI getUrl() { <b class="conum">(3)</b>
        return url;
    }

    public void setUrl(URI url) {
        this.url = url;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@EachProperty("test.datasource")
<b class="conum">(1)</b>
class DataSourceConfiguration {

    final String name
    URI url = new URI("localhost")

    DataSourceConfiguration(@Parameter String name) <b class="conum">(2)</b>
            throws URISyntaxException {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@EachProperty("test.datasource")  <b class="conum">(1)</b>
class DataSourceConfiguration <b class="conum">(2)</b>
@Throws(URISyntaxException::class)
constructor(@param:Parameter val name: String) {
    <b class="conum">(3)</b>
    var url = URI("localhost")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EachProperty</code> annotation defines the property name that should be handled.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Parameter</code> annotation can be used to inject the name of the sub-property that defines the name of the bean (which is also the bean qualifier)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each property of the bean is bound to configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above <code>DataSourceConfiguration</code> defines a <code>url</code> property to configure one or many hypothetical data sources of some sort. The URLs themselves can be configured using any of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances evaluated to Micronaut:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run(PropertySource.of(
                "test",
                CollectionUtils.mapOf(
                        "test.datasource.one.url", "jdbc:mysql://localhost/one",
                        "test.datasource.two.url", "jdbc:mysql://localhost/two")

        ));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    ApplicationContext applicationContext = ApplicationContext.run(PropertySource.of(
            "test",
            [
                    "test.datasource.one.url": "jdbc:mysql://localhost/one",
                    "test.datasource.two.url": "jdbc:mysql://localhost/two"
            ]
    ))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run(PropertySource.of(
                "test",
                mapOf(
                        "test.datasource.one.url" to "jdbc:mysql://localhost/one",
                        "test.datasource.two.url" to "jdbc:mysql://localhost/two"
                )
        ))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example two data sources (called <code>one</code> and <code>two</code>) are defined under the <code>test.datasource</code> prefix defined earlier in the <code>@EachProperty</code> annotation. Each of these configuration entries triggers the creation of a new <code>DataSourceConfiguration</code> bean such that the following test succeeds:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Collection&lt;DataSourceConfiguration&gt; beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration.class);
        assertEquals(2, beansOfType.size()); <b class="conum">(1)</b>

        DataSourceConfiguration firstConfig = applicationContext.getBean(
                DataSourceConfiguration.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        );

        assertEquals(
                new URI("jdbc:mysql://localhost/one"),
                firstConfig.getUrl()
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Collection&lt;DataSourceConfiguration&gt; beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration.class)
        assertEquals(2, beansOfType.size()) <b class="conum">(1)</b>

        DataSourceConfiguration firstConfig = applicationContext.getBean(
                DataSourceConfiguration.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )

        then:
        new URI("jdbc:mysql://localhost/one") == firstConfig.getUrl()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration::class.java)
        assertEquals(2, beansOfType.size.toLong()) <b class="conum">(1)</b>

        val firstConfig = applicationContext.getBean(
                DataSourceConfiguration::class.java,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )

        assertEquals(
                URI("jdbc:mysql://localhost/one"),
                firstConfig.url
        )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All beans of type <code>DataSourceConfiguration</code> can be retrieved using <code>getBeansOfType</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Individual beans can be achieved by using the <code>byName</code> qualifier.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_list_based_binding">List Based Binding</h3>
<div class="paragraph">
<p>The default behavior of <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> is to bind from a map style of configuration where the key is the named qualifier of the bean and the value is the data to bind from. For cases where map style configuration doesn&#8217;t make sense, it is possible to inform Micronaut the class should be bound from a list. Simply set the <code>list</code> member on the annotation to true.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@EachProperty List Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.docs.config.env;

import io.micronaut.context.annotation.EachProperty;
import io.micronaut.context.annotation.Parameter;
import io.micronaut.core.order.Ordered;

import java.time.Duration;

@EachProperty(value = "ratelimits", list = true) <b class="conum">(1)</b>
public class RateLimitsConfiguration implements Ordered { <b class="conum">(2)</b>

    private final Integer index;
    private Duration period;
    private Integer limit;

    RateLimitsConfiguration(@Parameter Integer index) { <b class="conum">(3)</b>
        this.index = index;
    }

    @Override
    public int getOrder() {
        return index;
    }

    public Duration getPeriod() {
        return period;
    }

    public void setPeriod(Duration period) {
        this.period = period;
    }

    public Integer getLimit() {
        return limit;
    }

    public void setLimit(Integer limit) {
        this.limit = limit;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@EachProperty List Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.docs.config.env

import io.micronaut.context.annotation.EachProperty
import io.micronaut.context.annotation.Parameter
import io.micronaut.core.order.Ordered

import java.time.Duration

@EachProperty(value = "ratelimits", list = true) <b class="conum">(1)</b>
class RateLimitsConfiguration implements Ordered { <b class="conum">(2)</b>

    private final Integer index
    Duration period
    Integer limit

    RateLimitsConfiguration(@Parameter Integer index) { <b class="conum">(3)</b>
        this.index = index
    }

    @Override
    int getOrder() {
        index
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@EachProperty List Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.docs.config.env

import io.micronaut.context.annotation.EachProperty
import io.micronaut.context.annotation.Parameter
import io.micronaut.core.order.Ordered
import java.time.Duration

@EachProperty(value = "ratelimits", list = true) <b class="conum">(1)</b>
class RateLimitsConfiguration
    constructor(@param:Parameter private val index: Int) <b class="conum">(3)</b>
    : Ordered { <b class="conum">(2)</b>

    var period: Duration? = null
    var limit: Int? = null

    override fun getOrder(): Int {
        return index
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>list</code> member of the annotation is set to true</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implement <code>Ordered</code> if order matters when retrieving the beans</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The index is injected into the constructor</td>
</tr>
</table>
</div>
</div>

<h2 id="eachBean"><a class="anchor" href="#eachBean"></a>4.7 Using @EachBean to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/eachBean.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> is a great way to drive dynamic configuration, but typically you want to inject that configuration into another bean that depends on it. Injecting a single instance with a hard coded qualifier is not a great solution, hence <code>@EachProperty</code> is typically used in combination with <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory <b class="conum">(1)</b>
public class DataSourceFactory {

    @EachBean(DataSourceConfiguration.class) <b class="conum">(2)</b>
    DataSource dataSource(DataSourceConfiguration configuration) { <b class="conum">(3)</b>
        URI url = configuration.getUrl();
        return new DataSource(url);
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory <b class="conum">(1)</b>
class DataSourceFactory {

    @EachBean(DataSourceConfiguration.class) <b class="conum">(2)</b>
    DataSource dataSource(DataSourceConfiguration configuration) { <b class="conum">(3)</b>
        URI url = configuration.getUrl()
        return new DataSource(url)
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory <b class="conum">(1)</b>
class DataSourceFactory {

    @EachBean(DataSourceConfiguration::class) <b class="conum">(2)</b>
    internal fun dataSource(configuration: DataSourceConfiguration): DataSource { <b class="conum">(3)</b>
        val url = configuration.url
        return DataSource(url)
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above example defines a bean <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> that will create instances of <code>javax.sql.DataSource</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a> annotation is used to indicate that a new <code>DataSource</code> bean should be created for each <code>DataSourceConfiguration</code> defined in the previous section.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>DataSourceConfiguration</code> instance is injected as a method argument and used to drive the configuration of each <code>javax.sql.DataSource</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>@EachBean</code> requires that the parent bean has a <code>@Named</code> qualifier, since the qualifier is inherited by each bean created by <code>@EachBean</code>.</p>
</div>
<div class="paragraph">
<p>In other words, to retrieve the <code>DataSource</code> created by <code>test.datasource.one</code> you can do:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Collection&lt;DataSource&gt; beansOfType = applicationContext.getBeansOfType(DataSource.class);
        assertEquals(2, beansOfType.size()); <b class="conum">(1)</b>

        DataSource firstConfig = applicationContext.getBean(
                DataSource.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Collection&lt;DataSource&gt; beansOfType = applicationContext.getBeansOfType(DataSource.class)
        assertEquals(2, beansOfType.size()) <b class="conum">(1)</b>

        DataSource firstConfig = applicationContext.getBean(
                DataSource.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val beansOfType = applicationContext.getBeansOfType(DataSource::class.java)
        assertEquals(2, beansOfType.size.toLong()) <b class="conum">(1)</b>

        val firstConfig = applicationContext.getBean(
                DataSource::class.java,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We demonstrate here that there are indeed two data sources. How can we get one in particular?</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By using <code>Qualifiers.byName("one")</code>, we can select which of the two beans we&#8217;d like to reference.</td>
</tr>
</table>
</div>

<h2 id="immutableConfig"><a class="anchor" href="#immutableConfig"></a>4.8 Immutable Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/immutableConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.3, Micronaut supports the definition of immutable configuration.</p>
</div>
<div class="paragraph">
<p>There are two ways to define immutable configuration. The preferred way is to define an interface that is annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import io.micronaut.core.bind.annotation.Bindable;
import javax.validation.constraints.*;
import java.util.Optional;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
public interface EngineConfig {

    @Bindable(defaultValue = "Ford") <b class="conum">(2)</b>
    @NotBlank <b class="conum">(3)</b>
    String getManufacturer();

    @Min(1L)
    int getCylinders();

    @NotNull
    CrankShaft getCrankShaft(); <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    interface CrankShaft { <b class="conum">(5)</b>
        Optional&lt;Double&gt; getRodLength(); <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable
import javax.validation.constraints.*


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
interface EngineConfig {

    @Bindable(defaultValue = "Ford") <b class="conum">(2)</b>
    @NotBlank <b class="conum">(3)</b>
    String getManufacturer()

    @Min(1L)
    int getCylinders()

    @NotNull
    CrankShaft getCrankShaft() <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    static interface CrankShaft { <b class="conum">(5)</b>
        Optional&lt;Double&gt; getRodLength() <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable
import javax.validation.constraints.*
import java.util.Optional


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
interface EngineConfig {

    @get:Bindable(defaultValue = "Ford") <b class="conum">(2)</b>
    @get:NotBlank <b class="conum">(3)</b>
    val manufacturer: String

    @get:Min(1L)
    val cylinders: Int

    @get:NotNull
    val crankShaft: CrankShaft <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    interface CrankShaft { <b class="conum">(5)</b>
        val rodLength: Double? <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation takes the configuration prefix and is declared on an interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a> to set a default value if you want</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Validation annotations can be used too</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can also specify references to other <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can nest immutable configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional configuration can be indicated by returning an <code>Optional</code> or specifying <code>@Nullable</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case what Micronaut does is provide a compilation time implementation that delegates all getters to call the <code>getProperty(..)</code> method of the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface.</p>
</div>
<div class="paragraph">
<p>This has the advantage that if the application&#8217;s configuration is <a href="#refreshable">refreshed</a> (for example by invoking the <code>/refresh</code> endpoint) then the injected interface will automatically see the new values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you try to specify any other abstract method other than a getter a compilation error will occur (default methods are supported).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative way to implement immutable configuration is to define a class and use the <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a> annotation on a constructor of a <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> or <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> bean.</p>
</div>
<div class="paragraph">
<p>An example of an immutable configuration class can be seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.*;
import io.micronaut.core.bind.annotation.Bindable;
import edu.umd.cs.findbugs.annotations.Nullable;
import javax.validation.constraints.*;
import java.util.Optional;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
public class EngineConfig {

    private final String manufacturer;
    private final int cylinders;
    private final CrankShaft crankShaft;

    @ConfigurationInject <b class="conum">(2)</b>
    public EngineConfig(
            @Bindable(defaultValue = "Ford") @NotBlank String manufacturer, <b class="conum">(3)</b>
            @Min(1L) int cylinders, <b class="conum">(4)</b>
            @NotNull CrankShaft crankShaft) {
        this.manufacturer = manufacturer;
        this.cylinders = cylinders;
        this.crankShaft = crankShaft;
    }

    public String getManufacturer() {
        return manufacturer;
    }

    public int getCylinders() {
        return cylinders;
    }

    public CrankShaft getCrankShaft() {
        return crankShaft;
    }

    @ConfigurationProperties("crank-shaft")
    public static class CrankShaft { <b class="conum">(5)</b>
        private final Double rodLength; <b class="conum">(6)</b>

        @ConfigurationInject
        public CrankShaft(@Nullable Double rodLength) {
            this.rodLength = rodLength;
        }

        public Optional&lt;Double&gt; getRodLength() {
            return Optional.ofNullable(rodLength);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.*
import io.micronaut.core.bind.annotation.Bindable
import javax.annotation.Nullable
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank
import javax.validation.constraints.NotNull


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
class EngineConfig {

    private final String manufacturer
    private final int cylinders
    private final CrankShaft crankShaft

    @ConfigurationInject <b class="conum">(2)</b>
    EngineConfig(
                  @Bindable(defaultValue = "Ford") @NotBlank String manufacturer, <b class="conum">(3)</b>
                  @Min(1L) int cylinders, <b class="conum">(4)</b>
                  @NotNull CrankShaft crankShaft) {
        this.manufacturer = manufacturer
        this.cylinders = cylinders
        this.crankShaft = crankShaft
    }

    String getManufacturer() {
        return manufacturer
    }

    int getCylinders() {
        return cylinders
    }

    CrankShaft getCrankShaft() {
        return crankShaft
    }

    @ConfigurationProperties("crank-shaft")
    static class CrankShaft { <b class="conum">(5)</b>
        private final Double rodLength <b class="conum">(6)</b>

        @ConfigurationInject
        CrankShaft(@Nullable Double rodLength) {
            this.rodLength = rodLength
        }

        Optional&lt;Double&gt; getRodLength() {
            return Optional.ofNullable(rodLength)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.*
import io.micronaut.core.bind.annotation.Bindable
import javax.validation.constraints.*
import java.util.Optional


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
data class EngineConfig @ConfigurationInject <b class="conum">(2)</b>
    constructor(
        @Bindable(defaultValue = "Ford") @NotBlank <b class="conum">(3)</b>
        val manufacturer: String,
        @Min(1L) <b class="conum">(4)</b>
        val cylinders: Int,
        @NotNull val crankShaft: CrankShaft) {

    @ConfigurationProperties("crank-shaft")
    data class CrankShaft @ConfigurationInject
    constructor(<b class="conum">(5)</b>
            private val rodLength: Double? <b class="conum">(6)</b>
    ) {

        fun getRodLength(): Optional&lt;Double&gt; {
            return Optional.ofNullable(rodLength)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a>  annotation is defined on the constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a> to set a default value if you want</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Validation annotations can be used too</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can nest immutable configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional configuration can be indicated with <code>@Nullable</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a> annotation provides a hint to Micronaut to prioritize binding values from configuration instead of injecting beans.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using this approach if you want the configuration to be refreshable then you must add the <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a> annotation to the class as well. This allows the bean to be re-created in the case of a <a href="#refreshable">runtime configuration refresh event</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are a few exceptions to this rule. Micronaut will not perform configuration binding for a parameter if one of these conditions is met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The parameter is annotated with <code>@Value</code> (explicit binding)</p>
</li>
<li>
<p>The parameter is annotated with <code>@Property</code> (explicit binding)</p>
</li>
<li>
<p>The parameter is annotated with <code>@Parameter</code> (parameterized bean handling)</p>
</li>
<li>
<p>The type of the parameter is annotated with a bean scope (such as <code>@Singleton</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you have prepared a type safe configuration it can simply be injected into your objects like any other bean:</p>
</div>

<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EngineConfig</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the configuration properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration values can then be supplied when running the application. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run(CollectionUtils.mapOf(
                "my.engine.cylinders", "8",
                "my.engine.crank-shaft.rod-length", "7.0"
        ));

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                "my.engine.cylinders": "8",
                "my.engine.crank-shaft.rod-length": "7.0"
        )

        Vehicle vehicle = applicationContext.getBean(Vehicle.class)
        System.out.println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val map = mapOf(
                "my.engine.cylinders" to "8",
                "my.engine.crank-shaft.rod-length" to "7.0"
        )
        val applicationContext = ApplicationContext.run(map)

        val vehicle = applicationContext.getBean(Vehicle::class.java)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Ford Engine Starting V8 [rodLength=7B.0]"</code></p>
</div>

<h2 id="jmx"><a class="anchor" href="#jmx"></a>4.9 JMX Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/config/jmx.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut provides basic support for JMX.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://micronaut-projects.github.io/micronaut-jmx/latest/guide/">documentation</a> for the micronaut-jmx project.</p>
</div>

<h1 id="aop"><a class="anchor" href="#aop"></a>5 Aspect Oriented Programming</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Aspect-Oriented Programming (AOP) historically has had many incarnations and some very complicated implementations. Generally AOP can be thought of as a way to define cross cutting concerns (logging, transactions, tracing etc.) separate from application code in the form of aspects that define advice.</p>
</div>
<div class="paragraph">
<p>There are typically two forms of advice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Around Advice - decorates a method or class</p>
</li>
<li>
<p>Introduction Advice - introduces new behaviour to a class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In modern Java applications declaring advice typically takes the form of an annotation. The most well-known annotation advice in the Java world is probably <code>@Transactional</code> which is used to demarcate transaction boundaries in Spring and Grails applications.</p>
</div>
<div class="paragraph">
<p>The disadvantage of traditional approaches to AOP is the heavy reliance on runtime proxy creation and reflection, which slows application performance, makes debugging harder and increases memory consumption.</p>
</div>
<div class="paragraph">
<p>Micronaut tries to address these concerns by providing a simple compile time AOP API that does not use reflection.</p>
</div>

<h2 id="aroundAdvice"><a class="anchor" href="#aroundAdvice"></a>5.1 Around Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/aroundAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The most common type of advice you may want to apply is "Around" advice, which essentially allows you to decorate a methods behaviour.</p>
</div>
<div class="sect1">
<h2 id="_writing_around_advice">Writing Around Advice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step to defining Around advice is to implement a <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a>. For example the following interceptor disallows parameters with <code>null</code> values:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.aop.*;
import io.micronaut.core.type.MutableArgumentValue;

import javax.inject.Singleton;
import java.util.*;

@Singleton
public class NotNullInterceptor implements MethodInterceptor&lt;Object, Object&gt; { <b class="conum">(1)</b>
    @Override
    public Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        Optional&lt;Map.Entry&lt;String, MutableArgumentValue&lt;?&gt;&gt;&gt; nullParam = context.getParameters()
            .entrySet()
            .stream()
            .filter(entry -&gt; {
                MutableArgumentValue&lt;?&gt; argumentValue = entry.getValue();
                return Objects.isNull(argumentValue.getValue());
            })
            .findFirst(); <b class="conum">(2)</b>
        if (nullParam.isPresent()) {
            throw new IllegalArgumentException("Null parameter [" + nullParam.get().getKey() + "] not allowed"); <b class="conum">(3)</b>
        } else {
            return context.proceed(); <b class="conum">(4)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.aop.MethodInterceptor
import io.micronaut.aop.MethodInvocationContext
import io.micronaut.core.type.MutableArgumentValue

import javax.inject.Singleton

@Singleton
class NotNullInterceptor implements MethodInterceptor&lt;Object, Object&gt; { <b class="conum">(1)</b>
    @Override
    Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        Optional&lt;Map.Entry&lt;String, MutableArgumentValue&lt;?&gt;&gt;&gt; nullParam = context.getParameters()
            .entrySet()
            .stream()
            .filter({entry -&gt;
                MutableArgumentValue&lt;?&gt; argumentValue = entry.getValue()
                return Objects.isNull(argumentValue.getValue())
            })
            .findFirst() <b class="conum">(2)</b>
        if (nullParam.isPresent()) {
            throw new IllegalArgumentException("Null parameter [" + nullParam.get().getKey() + "] not allowed") <b class="conum">(3)</b>
        } else {
            return context.proceed() <b class="conum">(4)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.aop.MethodInterceptor
import io.micronaut.aop.MethodInvocationContext
import io.micronaut.core.type.MutableArgumentValue

import javax.inject.Singleton
import java.util.Objects
import java.util.Optional


@Singleton
class NotNullInterceptor : MethodInterceptor&lt;Any, Any&gt; { <b class="conum">(1)</b>
    override fun intercept(context: MethodInvocationContext&lt;Any, Any&gt;): Any {
        val nullParam = context.parameters
                .entries
                .stream()
                .filter { entry -&gt;
                    val argumentValue = entry.value
                    Objects.isNull(argumentValue.value)
                }
                .findFirst() <b class="conum">(2)</b>
        return if (nullParam.isPresent) {
            throw IllegalArgumentException("Null parameter [" + nullParam.get().key + "] not allowed") <b class="conum">(3)</b>
        } else {
            context.proceed() <b class="conum">(4)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An interceptor implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The passed <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> is used to find the first parameter that is <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If a <code>null</code> parameter is found an exception is thrown</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise <a href="../api/io/micronaut/aop/InvocationContext.html#proceed--">proceed()</a> is called to proceed with the method invocation.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut AOP interceptors use no reflection which improves performance and reducing stack trace sizes, thus improving debugging.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To put the new <code>MethodInterceptor</code> to work the next step is to define an annotation that will trigger the <code>MethodInterceptor</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Type;
import io.micronaut.aop.Around;
import java.lang.annotation.*;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Retention(RUNTIME) <b class="conum">(1)</b>
@Target({ElementType.TYPE, ElementType.METHOD}) <b class="conum">(2)</b>
@Around <b class="conum">(3)</b>
@Type(NotNullInterceptor.class) <b class="conum">(4)</b>
public @interface NotNull {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.aop.Around
import io.micronaut.context.annotation.Type

import java.lang.annotation.Documented
import java.lang.annotation.ElementType
import java.lang.annotation.Retention
import java.lang.annotation.Target

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Documented
@Retention(RUNTIME) <b class="conum">(1)</b>
@Target([ElementType.TYPE, ElementType.METHOD]) <b class="conum">(2)</b>
@Around <b class="conum">(3)</b>
@Type(NotNullInterceptor.class) <b class="conum">(4)</b>
@interface NotNull {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.aop.Around
import io.micronaut.context.annotation.Type

import java.lang.annotation.Documented
import java.lang.annotation.Retention

import java.lang.annotation.RetentionPolicy.RUNTIME


@Documented
@Retention(RUNTIME) <b class="conum">(1)</b>
@Target(AnnotationTarget.CLASS, AnnotationTarget.FILE, AnnotationTarget.FUNCTION, AnnotationTarget.PROPERTY_GETTER, AnnotationTarget.PROPERTY_SETTER) <b class="conum">(2)</b>
@Around <b class="conum">(3)</b>
@Type(NotNullInterceptor::class) <b class="conum">(4)</b>
annotation class NotNull</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The retention policy of the annotation should be <code>RUNTIME</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generally you want to be able to apply advice at the class or method level so the target types are <code>TYPE</code> and <code>METHOD</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/aop/Around.html">Around</a> annotation is added to tell Micronaut that the annotation is Around advice</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Type.html">@Type</a> annotation is used to configure which type implements the advice (in this case the previously defined <code>NotNullInterceptor</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the interceptor and annotation implemented you can then simply apply the annotation to the target classes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class NotNullExample {

    @NotNull
    void doWork(String taskName) {
        System.out.println("Doing job: " + taskName);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class NotNullExample {

    @NotNull
    void doWork(String taskName) {
        println("Doing job: " + taskName)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
open class NotNullExample {

    @NotNull
    open fun doWork(taskName: String?) {
        println("Doing job: $taskName")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever the type <code>NotNullExample</code> is injected into any class, a compile time generated proxy will instead be injected that decorates the appropriate method calls with the <code>@NotNull</code> advice defined earlier. You can verify that the advice works by writing a test. The following test uses a JUnit <code>ExpectedException</code> rule to verify the appropriate exception is thrown when an argument is <code>null</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Rule
    public ExpectedException thrown = ExpectedException.none();

    @Test
    public void testNotNull() {
        try (ApplicationContext applicationContext = ApplicationContext.run()) {
            NotNullExample exampleBean = applicationContext.getBean(NotNullExample.class);

            thrown.expect(IllegalArgumentException.class);
            thrown.expectMessage("Null parameter [taskName] not allowed");

            exampleBean.doWork(null);
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    void "test not null"() {
        when:
        ApplicationContext applicationContext = ApplicationContext.run()
        NotNullExample exampleBean = applicationContext.getBean(NotNullExample.class)

        exampleBean.doWork(null)

        then:
        IllegalArgumentException ex = thrown()
        ex.message == 'Null parameter [taskName] not allowed'

        cleanup:
        applicationContext.close()
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Test
    fun testNotNull() {
        val applicationContext = ApplicationContext.run()
        val exampleBean = applicationContext.getBean(NotNullExample::class.java)

        val exception = shouldThrow&lt;IllegalArgumentException&gt; {
            exampleBean.doWork(null)
        }
        exception.message shouldBe "Null parameter [taskName] not allowed"
        applicationContext.close()
    }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Micronaut injection is done at compile time, generally the advice should be packaged in a dependent JAR file that is on the classpath when the above test is compiled and should not be in the same codebase since you don&#8217;t want the test to be compiled before the advice itself is compiled.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_proxy_generation">Customizing Proxy Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default behaviour of the <a href="../api/io/micronaut/aop/Around.html">Around</a> annotation is to generate a proxy at compile time that is a subclass of the class being proxied. In other words, in the previous example a compile time subclass of the <code>NotNullExample</code> class will be produced where methods that are proxied are decorated with interceptor handling and the original behaviour is invoked via a call to <code>super</code>.</p>
</div>
<div class="paragraph">
<p>This behaviour is more efficient as only one instance of the bean is required, however depending on the use case you are trying to implement you may wish to alter this behaviour and the <code>@Around</code> annotation supports various attributes that allow you to alter this behaviour including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyTarget</code> (defaults to <code>false</code>) - If set to <code>true</code> instead of a subclass that calls <code>super</code>, the proxy will delegate to the original bean instance</p>
</li>
<li>
<p><code>hotswap</code> (defaults to <code>false</code>) - Same as <code>proxyTarget=true</code>, but in addition the proxy will implement <a href="../api/io/micronaut/aop/HotSwappableInterceptedProxy.html">HotSwappableInterceptedProxy</a> which wraps each method call in a <code>ReentrantReadWriteLock</code> and allows swapping the target instance at runtime.</p>
</li>
<li>
<p><code>lazy</code> (defaults to <code>false</code>) - By default Micronaut will eagerly intialize the proxy target when the proxy is created. If set to <code>true</code> the proxy target will instead be resolved lazily for each method call.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aop_advice_on_factory_beans">AOP Advice on @Factory Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The semantics of AOP advice when applied to <a href="#factories">Bean Factories</a> differs to regular beans, with the following rules applying:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>AOP advice applied at the class level of a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> bean will apply the advice to the factory itself and not to any beans defined with the <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> annotation.</p>
</li>
<li>
<p>AOP advice applied on a method annotated with a bean scope will apply the AOP advice to the bean that the factory produces.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Consider the following two examples:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the type level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Timed
@Factory
public class MyFactory {

    @Prototype
    public MyBean myBean() {
        return new MyBean();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the type level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Timed
@Factory
class MyFactory {

    @Prototype
    MyBean myBean() {
        return new MyBean()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the type level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Timed
@Factory
open class MyFactory {

    @Prototype
    open fun myBean(): MyBean {
        return MyBean()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will log the time it takes to create the <code>MyBean</code> bean.</p>
</div>
<div class="paragraph">
<p>Now consider this example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the method level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory
public class MyFactory {

    @Prototype
    @Timed
    public MyBean myBean() {
        return new MyBean();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the method level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory
class MyFactory {

    @Prototype
    @Timed
    MyBean myBean() {
        return new MyBean()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the method level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory
open class MyFactory {

    @Prototype
    @Timed
    open fun myBean(): MyBean {
        return MyBean()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will log the time it takes to execute all of the public methods of the <code>MyBean</code> bean, but not the bean creation.</p>
</div>
<div class="paragraph">
<p>The rationale for this behaviour is that you may at times wish to apply advice to a factory and at other times apply advice to the bean produced by the factory.</p>
</div>
<div class="paragraph">
<p>Note that there is currently no way to apply advice at the method level to a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> bean and all advice for factories must be applied at the type level. You can control which methods have advice applied by defining methods as non-public (non-public methods do not have advice applied).</p>
</div>
</div>
</div>

<h2 id="introductionAdvice"><a class="anchor" href="#introductionAdvice"></a>5.2 Introduction Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/introductionAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Introduction advice is distinct from Around advice in that it involves providing an implementation instead of decorating.</p>
</div>
<div class="paragraph">
<p>Examples of introduction advice include things like <a href="http://gorm.grails.org">GORM</a> or <a href="http://projects.spring.io/spring-data">Spring Data</a> that will both automatically implement persistence logic for you.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is another example of introduction advice where Micronaut will, at compile time, implement HTTP client interfaces for you.</p>
</div>
<div class="paragraph">
<p>The way you implement Introduction advice is very similar to how you implement Around advice.</p>
</div>
<div class="paragraph">
<p>You start off by defining an annotation that will power the introduction advice. As an example, say you want to implement advice that will return a stubbed value for every method in an interface (a common requirement in testing frameworks). Consider the following <code>@Stub</code> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import static java.lang.annotation.RetentionPolicy.RUNTIME;

import io.micronaut.aop.Introduction;
import io.micronaut.context.annotation.Bean;
import io.micronaut.context.annotation.Type;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

@Introduction <b class="conum">(1)</b>
@Type(StubIntroduction.class) <b class="conum">(2)</b>
@Bean <b class="conum">(3)</b>
@Documented
@Retention(RUNTIME)
@Target({ElementType.TYPE, ElementType.ANNOTATION_TYPE, ElementType.METHOD})
public @interface Stub {
    String value() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.aop.Introduction
import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Type

import java.lang.annotation.Documented
import java.lang.annotation.ElementType
import java.lang.annotation.Retention
import java.lang.annotation.Target

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Introduction <b class="conum">(1)</b>
@Type(StubIntroduction.class) <b class="conum">(2)</b>
@Bean <b class="conum">(3)</b>
@Documented
@Retention(RUNTIME)
@Target([ElementType.TYPE, ElementType.ANNOTATION_TYPE, ElementType.METHOD])
@interface Stub {
    String value() default ""
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.aop.Introduction
import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Type

import java.lang.annotation.Documented
import java.lang.annotation.Retention

import java.lang.annotation.RetentionPolicy.RUNTIME


@Introduction <b class="conum">(1)</b>
@Type(StubIntroduction::class) <b class="conum">(2)</b>
@Bean <b class="conum">(3)</b>
@Documented
@Retention(RUNTIME)
@Target(AnnotationTarget.CLASS, AnnotationTarget.FILE, AnnotationTarget.ANNOTATION_CLASS, AnnotationTarget.FUNCTION, AnnotationTarget.PROPERTY_GETTER, AnnotationTarget.PROPERTY_SETTER)
annotation class Stub(val value: String = "")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The introduction advice is annotated with <a href="../api/io/micronaut/aop/Introduction.html">Introduction</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Type.html">Type</a> annotation is used to refer to the implementor of the advice. In this case <code>StubIntroduction</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation is added so that all types annotated with <code>@Stub</code> become beans</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>StubIntroduction</code> class referred to in the previous example must then implement the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface, just like around advice.</p>
</div>
<div class="paragraph">
<p>The following is an example implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubIntroduction</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.aop.*;
import javax.inject.Singleton;

@Singleton
public class StubIntroduction implements MethodInterceptor&lt;Object,Object&gt; { <b class="conum">(1)</b>

    @Override
    public Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        return context.getValue( <b class="conum">(2)</b>
                Stub.class,
                context.getReturnType().getType()
        ).orElse(null); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubIntroduction</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.aop.MethodInterceptor
import io.micronaut.aop.MethodInvocationContext

import javax.inject.Singleton

@Singleton
class StubIntroduction implements MethodInterceptor&lt;Object,Object&gt; { <b class="conum">(1)</b>

    @Override
    Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        return context.getValue( <b class="conum">(2)</b>
                Stub.class,
                context.getReturnType().getType()
        ).orElse(null) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubIntroduction</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.aop.MethodInterceptor
import io.micronaut.aop.MethodInvocationContext

import javax.inject.Singleton


@Singleton
class StubIntroduction : MethodInterceptor&lt;Any, Any&gt; { <b class="conum">(1)</b>

    override fun intercept(context: MethodInvocationContext&lt;Any, Any&gt;): Any? {
        return context.getValue&lt;Any&gt;( <b class="conum">(2)</b>
                Stub::class.java,
                context.returnType.type
        ).orElse(null) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is annotated with <code>@Singleton</code> and implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>@Stub</code> annotation is read from the context and an attempt made to convert the value to the return type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Otherwise <code>null</code> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To now use this introduction advice in an application you simply annotate your abstract classes or interfaces with <code>@Stub</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubExample</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Stub
public interface StubExample {

    @Stub("10")
    int getNumber();

    LocalDateTime getDate();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubExample</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Stub
interface StubExample {

    @Stub("10")
    int getNumber()

    LocalDateTime getDate()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubExample</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Stub
interface StubExample {

    @get:Stub("10")
    val number: Int

    val date: LocalDateTime?
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All abstract methods will delegate to the <code>StubIntroduction</code> class to be implemented.</p>
</div>
<div class="paragraph">
<p>The following test demonstrates the behaviour or <code>StubIntroduction</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">            StubExample stubExample = applicationContext.getBean(StubExample.class);

            assertEquals(10, stubExample.getNumber());
            assertNull(stubExample.getDate());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        StubExample stubExample = applicationContext.getBean(StubExample.class)

        then:
        stubExample.getNumber() == 10
        stubExample.getDate() == null</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val stubExample = applicationContext.getBean(StubExample::class.java)

        stubExample.number.toLong().shouldBe(10)
        stubExample.date.shouldBe(null)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if the introduction advice cannot implement the method the <code>proceed</code> method of the <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> should be called. This gives the opportunity for other introduction advice interceptors to implement the method, otherwise a <code>UnsupportedOperationException</code> will be thrown if no advice can implement the method.</p>
</div>
<div class="paragraph">
<p>In addition, if multiple introduction advice are present you may wish to override the <code>getOrder()</code> method of <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> to control the priority of advise.</p>
</div>
<div class="paragraph">
<p>The following sections cover core advice types that are built into Micronaut and provided by the framework.</p>
</div>

<h2 id="adapterAdvice"><a class="anchor" href="#adapterAdvice"></a>5.3 Method Adapter Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/adapterAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are sometimes cases where you want to introduce a new bean based on the presence of an annotation on a method. An example of this case is the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation which for each method annotated with <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> produces an implementation of <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> that invokes the annotated method.</p>
</div>
<div class="paragraph">
<p>For example the following snippet will run the logic contained within the method when the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> starts up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.event.StartupEvent;
import io.micronaut.runtime.event.annotation.EventListener;
...

@EventListener
void onStartup(StartupEvent event) {
    // startup logic here
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The presence of the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation causes Micronaut to create a new class that implements the <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> and invokes the <code>onStartup</code> method defined in the bean above.</p>
</div>
<div class="paragraph">
<p>The actual implementation of the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> is trivial, it simply uses the <a href="../api/io/micronaut/aop/Adapter.html">@Adapter</a> annotation to specify which SAM (single abstract method) type it adapts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.Adapter;
import io.micronaut.context.event.ApplicationEventListener;
import io.micronaut.core.annotation.Indexed;

import java.lang.annotation.*;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Retention(RUNTIME)
@Target({ElementType.ANNOTATION_TYPE, ElementType.METHOD})
@Adapter(ApplicationEventListener.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Indexed(ApplicationEventListener.class)
public @interface EventListener {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/aop/Adapter.html">@Adapter</a> annotation is used to indicate which SAM type to adapt. In this case <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut will also automatically align the generic types for the SAM interface if they are specified.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using this mechanism you can define custom annotations that use the <a href="../api/io/micronaut/aop/Adapter.html">@Adapter</a> annotation and a SAM interface to automatically implement beans for you at compile time.</p>
</div>

<h2 id="validation"><a class="anchor" href="#validation"></a>5.4 Validation Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/validation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Validation advice is one of the most common advice types you are likely to want to incorporate into your application.</p>
</div>
<div class="paragraph">
<p>Validation advice is built on <a href="https://beanvalidation.org/2.0/spec/">Bean Validation JSR 380</a>.</p>
</div>
<div class="paragraph">
<p>JSR 380 is a specification of the Java API for bean validation which ensures that the
properties of a bean meet specific criteria, using <code>javax.validation</code> annotations such as <code>@NotNull</code>, <code>@Min</code>, and <code>@Max</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut provides native support for the <code>javax.validation</code> annotations with the <code>micronaut-validation</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Or full JSR 380 compliance with the <code>micronaut-hibernate-validator</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-hibernate-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#beanValidation">Bean Validation</a> for more information on how to apply validation rules to your bean classes.</p>
</div>

<h2 id="caching"><a class="anchor" href="#caching"></a>5.5 Cache Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/caching.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Similar to Spring and Grails, Micronaut provides a set of caching annotations within the <a href="../api/io/micronaut/cache/package-summary.html">io.micronaut.cache</a> package.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/cache/CacheManager.html">CacheManager</a> interface allows different cache implementations to be plugged in as necessary.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/cache/SyncCache.html">SyncCache</a> interface provides a synchronous API for caching, whilst the <a href="../api/io/micronaut/cache/AsyncCache.html">AsyncCache</a> API allows non-blocking operation.</p>
</div>
<div class="sect1">
<h2 id="_cache_annotations">Cache Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following cache annotations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/cache/annotation/Cacheable.html">@Cacheable</a> - Indicates a method is cacheable within the given cache name</p>
</li>
<li>
<p><a href="../api/io/micronaut/cache/annotation/CachePut.html">@CachePut</a> - Indicates that the return value of a method invocation should be cached. Unlike <code>@Cacheable</code> the original operation is never skipped.</p>
</li>
<li>
<p><a href="../api/io/micronaut/cache/annotation/CacheInvalidate.html">@CacheInvalidate</a> - Indicates the invocation of a method should cause the invalidation of one or many caches.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By using one of the annotations the <a href="../api/io/micronaut/cache/interceptor/CacheInterceptor.html">CacheInterceptor</a> is activated which in the case of <code>@Cacheable</code> will cache the return result of the method.</p>
</div>
<div class="paragraph">
<p>If the return type of the method is a non-blocking type (either <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> or an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> the emitted result will be cached.</p>
</div>
<div class="paragraph">
<p>In addition if the underlying Cache implementation supports non-blocking cache operations then cache values will be read from the cache without blocking, resulting in the ability to implement completely non-blocking cache operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_caches">Configuring Caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default <a href="https://github.com/ben-manes/caffeine">Caffeine</a> is used for cache definitions which can be configured via application configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Cache Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    caches:
        my-cache:
            maximum-size: 20</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will configure a cache called "my-cache" with a maximum size of 20.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Naming Caches</div>
<div class="paragraph">
<p>Names of caches under <code>micronaut.caches</code> should be defined in kebab case (lowercase and hyphen seperated), if camel case is used the names are normalized to kebab case. So for example specifing <code>myCache</code> will become <code>my-cache</code>. The kebab case form should be used when referencing caches in the <a href="../api/io/micronaut/cache/annotation/Cacheable.html">@Cacheable</a> annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure a weigher to be used with the <code>maximumWeight</code> configuration, create a bean that implements <code>io.micronaut.caffeine.cache.Weigher</code>. To associate a given weigher with only a specific cache, annotate the bean with <code>@Named(&lt;cache name&gt;)</code>. Weighers without a named qualifier will apply to all caches that don&#8217;t have a named weigher. If no beans are found, a default implementation will be used.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/guide/configurationreference.html#io.micronaut.cache.caffeine.DefaultCacheConfiguration">configuration reference</a> for all available configuration options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_cache_creation">Dynamic Cache Creation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For use cases where caches cannot be configured ahead of time, a <a href="../api/io/micronaut/cache/DynamicCacheManager.html">DynamicCacheManager</a> bean can be registered. When a cache is attempted to be retrieved that was not predefined, the dynamic cache manager will be invoked to return a cache.</p>
</div>
<div class="paragraph">
<p>By default, if there is no other dynamic cache manager defined in the application, Micronaut registers an instance of <a href="../api/io/micronaut/cache/DefaultDynamicCacheManager.html">DefaultDynamicCacheManager</a> that will create Caffeine caches with default values.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_cache_implementations">Other Cache Implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/guide/index.html">Micronaut Cache</a> project for more
information.</p>
</div>
</div>
</div>

<h2 id="retry"><a class="anchor" href="#retry"></a>5.6 Retry Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/retry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems and Microservice environments, failure is something you have to plan for and it is pretty common to want to attempt to retry an operation if it fails. If first you don&#8217;t succeed try again!</p>
</div>
<div class="paragraph">
<p>With this in mind Micronaut comes with a <a href="../api/io/micronaut/retry/annotation/Retryable.html">Retryable</a> annotation out of the box that is integrated into the container.</p>
</div>
<div class="sect1">
<h2 id="_simple_retry">Simple Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest form of retry is just to add the <code>@Retryable</code> annotation to any type or method. The default behaviour of <code>@Retryable</code> is to retry 3 times with an exponential delay of 1 second between each retry. (first attempt with 1s delay, second attempt with 2s delay, third attempt with 3s delay)</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Simple Retry Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Retryable
    public List&lt;Book&gt; listBooks() {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Simple Retry Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Retryable
    List&lt;Book&gt; listBooks() {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Simple Retry Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Retryable
    open fun listBooks(): List&lt;Book&gt; {
        // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above example if the <code>listBooks()</code> method throws a RuntimeException it will be retried until the maximum number of attempts is reached.</p>
</div>
<div class="paragraph">
<p>The <code>multiplier</code> value of the <code>@Retryable</code> annotation can be used to configure a multiplier used to calculate the delay between retries, thus allowing exponential retry support.</p>
</div>
<div class="paragraph">
<p>Note also that the <code>@Retryable</code> annotation can be applied on interfaces and the behaviour will be inherited through annotation metadata. The implication of this is that <code>@Retryable</code> can be used in combination with <a href="#introductionAdvice">Introduction Advice</a> such as the HTTP <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>To customize retry behaviour you can set the <code>attempts</code> and <code>delay</code> members, For example to configure 5 attempts with a 2 second delay:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Retryable( attempts = "5",
                delay = "2s" )
    public Book findBook(String title) {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Retryable( attempts = "5",
                delay = "2s" )
    Book findBook(String title) {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Retryable(attempts = "5", delay = "2s")
    open fun findBook(title: String): Book {
        // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how both <code>attempts</code> and <code>delay</code> are defined as strings. This is to support configurability through annotation metadata. For example you can allow the retry policy to be configured using property placeholder resolution:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Retryable( attempts = "${book.retry.attempts:3}",
                delay = "${book.retry.delay:1s}" )
    public Book getBook(String title) {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Retryable( attempts = "\${book.retry.attempts:3}",
            delay = "\${book.retry.delay:1s}")
    Book getBook(String title) {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Retryable(attempts = "\${book.retry.attempts:3}", delay = "\${book.retry.delay:1s}")
    open fun getBook(title: String): Book {
        // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above in place if <code>book.retry.attempts</code> is specified in configuration it wil be bound the value of the <code>attempts</code> member of the <code>@Retryable</code> annotation via annotation metadata.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactive_retry">Reactive Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>@Retryable</code> advice can also be applied to methods that return reactive types, such as an RxJava <code>Flowable</code>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Retryable
    public Flowable&lt;Book&gt; streamBooks() {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Retryable
    Flowable&lt;Book&gt; streamBooks() {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Retryable
    open fun streamBooks(): Flowable&lt;Book&gt; {
        // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>@Retryable</code> advice will apply the retry policy to the reactive type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_circuit_breaker">Circuit Breaker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Microservice environment retry is useful, but in some cases excessive retries can overwhelm the system as clients repeatedly re-attempt failing operations.</p>
</div>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern">Circuit Breaker</a> pattern is designed to resolve this issue by essentially allowing a certain number of failing requests and then opening a circuit that remains open for a period before allowing any additional retry attempts.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">CircuitBreaker</a> annotation is a variation of the <code>@Retryable</code> annotation that supports a <code>reset</code> member that indicates how long the circuit should remain open before it is reset (the default is 20 seconds).</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @CircuitBreaker(reset = "30s")
    public List&lt;Book&gt; findBooks() {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @CircuitBreaker(reset = "30s")
    List&lt;Book&gt; findBooks() {
        // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @CircuitBreaker(reset = "30s")
    open fun findBooks(): List&lt;Book&gt; {
        // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will retry to <code>findBooks</code> method 3 times and then open the circuit for 30 seconds, rethrowing the original exception and preventing potential downstream traffic such as HTTP requests and I/O operations flooding the system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bean_creation_retry">Bean Creation Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned previously, <code>@Retryable</code> advice is integrated right at the container level. This is useful as it is common problem in Microservices and environments like Docker where there may be a delay in services becoming available.</p>
</div>
<div class="paragraph">
<p>The following snippet is taken from the Neo4j driver support and demonstrates how bean creation can be wrapped in retry support:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory <i class="conum" data-value="1"></i><b>(1)</b>
public class Neo4jDriverFactory {
    ...
    @Retryable(ServiceUnavailableException.class) <i class="conum" data-value="2"></i><b>(2)</b>
    @Bean(preDestroy = "close")
    public Driver buildDriver() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A factory bean is created that defines methods that create beans</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Retryable</code> annotation is used to catch <code>ServiceUnavailableException</code> and retry creating the driver before failing startup.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retry_events">Retry Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/retry/event/RetryEventListener.html">RetryEventListener</a> instances as beans in order to listen for <a href="../api/io/micronaut/retry/event/RetryEvent.html">RetryEvent</a> events that are published every time an operation is retried.</p>
</div>
<div class="paragraph">
<p>In addition, you can register event listeners for <a href="../api/io/micronaut/retry/event/CircuitOpenEvent.html">CircuitOpenEvent</a>, when a circuit breaker circuit is opened, or <a href="../api/io/micronaut/retry/event/CircuitClosedEvent.html">CircuitClosedEvent</a> for when a circuit is closed.</p>
</div>
</div>
</div>

<h2 id="scheduling"><a class="anchor" href="#scheduling"></a>5.7 Scheduled Tasks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/scheduling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like Spring and Grails, Micronaut features a <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation that can be used for scheduling background tasks.</p>
</div>
<div class="sect1">
<h2 id="_using_the_scheduled_annotation">Using the @Scheduled Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation can be added to any method of a bean and you should set either the <code>fixedRate</code>, <code>fixedDelay</code> or <code>cron</code> members.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that the scope of the bean has an impact on behaviour. a <code>@Singleton</code> bean will share state (the fields of the instance) each time the scheduled method is executed, while for a <code>@Prototype</code> bean a new instance is created for each execution.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_scheduling_at_a_fixed_rate">Scheduling at a Fixed Rate</h3>
<div class="paragraph">
<p>To schedule a task at a fixed rate, use the <code>fixedRate</code> member. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Scheduled(fixedRate = "5m")
    void everyFiveMinutes() {
        System.out.println("Executing everyFiveMinutes()");
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Scheduled(fixedRate = "5m")
    void everyFiveMinutes() {
        System.out.println("Executing everyFiveMinutes()")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Scheduled(fixedRate = "5m")
    internal fun everyFiveMinutes() {
        println("Executing everyFiveMinutes()")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task above will execute every 5 minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_with_a_fixed_delay">Scheduling with a Fixed Delay</h3>
<div class="paragraph">
<p>To schedule a task so that it runs 5 minutes after the termination of the previous task use the <code>fixedDelay</code> member. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Scheduled(fixedDelay = "5m")
    void fiveMinutesAfterLastExecution() {
        System.out.println("Executing fiveMinutesAfterLastExecution()");
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Scheduled(fixedDelay = "5m")
    void fiveMinutesAfterLastExecution() {
        System.out.println("Executing fiveMinutesAfterLastExecution()")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Scheduled(fixedDelay = "5m")
    internal fun fiveMinutesAfterLastExecution() {
        println("Executing fiveMinutesAfterLastExecution()")
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_a_cron_task">Scheduling a Cron Task</h3>
<div class="paragraph">
<p>To schedule a <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> task use the <code>cron</code> member:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Cron Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Scheduled(cron = "0 15 10 ? * MON" )
    void everyMondayAtTenFifteenAm() {
        System.out.println("Executing everyMondayAtTenFifteenAm()");
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Cron Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Scheduled(cron = "0 15 10 ? * MON" )
    void everyMondayAtTenFifteenAm() {
        System.out.println("Executing everyMondayAtTenFifteenAm()")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Cron Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Scheduled(cron = "0 15 10 ? * MON")
    internal fun everyMondayAtTenFifteenAm() {
        println("Executing everyMondayAtTenFifteenAm()")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will run the task every Monday morning at 10:15AM for the time zone of the server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_with_only_an_initial_delay">Scheduling with only an Initial Delay</h3>
<div class="paragraph">
<p>To schedule a task so that it runs a single time after the server starts, use the <code>initialDelay</code> member:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initial Delay Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Scheduled(initialDelay = "1m" )
    void onceOneMinuteAfterStartup() {
        System.out.println("Executing onceOneMinuteAfterStartup()");
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initial Delay Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Scheduled(initialDelay = "1m" )
    void onceOneMinuteAfterStartup() {
        System.out.println("Executing onceOneMinuteAfterStartup()")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initial Delay Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Scheduled(initialDelay = "1m")
    internal fun onceOneMinuteAfterStartup() {
        println("Executing onceOneMinuteAfterStartup()")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will only run a single time 1 minute after the server starts.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programmatically_scheduling_tasks">Programmatically Scheduling Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to programmatically schedule tasks, then you can use the <a href="../api/io/micronaut/scheduling/TaskScheduler.html">TaskScheduler</a> bean which can be injected as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Inject
    @Named(TaskExecutors.SCHEDULED)
    TaskScheduler taskScheduler;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Inject
    @Named(TaskExecutors.SCHEDULED)
    TaskScheduler taskScheduler</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Inject
    @Named(TaskExecutors.SCHEDULED)
    lateinit var taskScheduler: TaskScheduler</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_scheduled_tasks_with_annotation_metadata">Configuring Scheduled Tasks with Annotation Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to make your application&#8217;s tasks configurable then you can use annotation metadata and property placeholder configuration to do so. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Allow tasks to be configured</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Scheduled( fixedRate = "${my.task.rate:5m}",
                initialDelay = "${my.task.delay:1m}" )
    void configuredTask() {
        System.out.println("Executing configuredTask()");
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Allow tasks to be configured</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Scheduled( fixedRate = "\${my.task.rate:5m}",
                initialDelay = "\${my.task.delay:1m}" )
    void configuredTask() {
        System.out.println("Executing configuredTask()")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Allow tasks to be configured</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Scheduled(fixedRate = "\${my.task.rate:5m}",
            initialDelay = "\${my.task.delay:1m}")
    internal fun configuredTask() {
        println("Executing configuredTask()")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example allows the task execution frequency to be configured with the property <code>my.task.rate</code> and the initial delay to be configured with the property <code>my.task.delay</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_scheduled_task_thread_pool">Configuring the Scheduled Task Thread Pool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tasks executed by <code>@Scheduled</code> are by default run on a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html">ScheduledExecutorService</a> that is configured to have twice the number of threads as available processors.</p>
</div>
<div class="paragraph">
<p>You can configure this thread pool as desired using <code>application.yml</code>, for example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Scheduled Task Thread Pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    executors:
        scheduled:
            type: scheduled
            core-pool-size: 30</code></pre>
</div>
</div>
<a id="io.micronaut.scheduling.executor.UserExecutorConfiguration" href="#io.micronaut.scheduling.executor.UserExecutorConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/scheduling/executor/UserExecutorConfiguration.html">UserExecutorConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the executor name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.n-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/scheduling/executor/ExecutorType.html">ExecutorType</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the executor type. Default value (<a href="../api/io/micronaut/scheduling/executor/ExecutorType.html#SCHEDULED">SCHEDULED</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.parallelism</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the parallelism for <a href="../api/io/micronaut/scheduling/executor/ExecutorType.html#WORK_STEALING">WORK_STEALING</a>. Default value (Number of processors available to the Java virtual machine).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.core-pool-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the core pool size for <a href="../api/io/micronaut/scheduling/executor/ExecutorType.html#SCHEDULED">SCHEDULED</a>. Default value (2 * Number of processors available to the Java virtual machine).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.thread-factory-class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the thread factory class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.number-of-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of threads for <a href="../api/io/micronaut/scheduling/executor/ExecutorType.html#FIXED">FIXED</a>. Default value (2 * Number of processors available to the Java virtual machine).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_handling_exceptions">Handling Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default Micronaut includes a <a href="../api/io/micronaut/scheduling/DefaultTaskExceptionHandler.html">DefaultTaskExceptionHandler</a> bean that implements the <a href="../api/io/micronaut/scheduling/TaskExceptionHandler.html">TaskExceptionHandler</a> and simply logs the exception if an error occurs invoking a scheduled task.</p>
</div>
<div class="paragraph">
<p>If you have custom requirements you can replace this bean with a custom implementation (for example if you wish to send an email or shutdown context to fail fast). To do so simply write your own <a href="../api/io/micronaut/scheduling/TaskExceptionHandler.html">TaskExceptionHandler</a> and annotate it with <code>@Replaces(DefaultTaskExceptionHandler.class)</code>.</p>
</div>
</div>
</div>

<h2 id="springAop"><a class="anchor" href="#springAop"></a>5.8 Bridging Spring AOP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/aop/springAop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although Micronaut&#8217;s design is based on a compile time approach and does not rely on Spring dependency injection, there is still a lot of value in the Spring ecosystem that does not depend directly on the Spring container.</p>
</div>
<div class="paragraph">
<p>You may wish to use existing Spring projects within Micronaut and configure beans to be used within Micronaut.</p>
</div>
<div class="paragraph">
<p>You may also wish to leverage existing AOP advice from Spring. One example of this is Spring&#8217;s support for declarative transactions with <code>@Transactional</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut provides support for Spring based transaction management without requiring Spring itself. You simply need to add the <code>spring</code> module to your application dependencies:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-spring")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-spring&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use Micronaut&#8217;s <a href="#hibernateSupport">Hibernate support</a> you already get this dependency and a <code>HibernateTransactionManager</code> is configured for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is done by defining a Micronaut <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> annotation that uses <a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a> in a manner that every time you set a value with <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> it aliases the value to equivalent value in Spring&#8217;s version of <code>@Transactional</code>.</p>
</div>
<div class="paragraph">
<p>The benefit here is you can use Micronaut&#8217;s compile-time, reflection free AOP to declare programmatic Spring transactions. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @Transactional</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.spring.tx.annotation.*;
...

@Transactional
public Book saveBook(String title) {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut&#8217;s version of <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> is also annotated with <a href="../api/io/micronaut/core/annotation/Blocking.html">@Blocking</a> ensuring that all methods annotated with use the I/O thread pool when executing within the HTTP server
</td>
</tr>
</table>
</div>

<h1 id="httpServer"><a class="anchor" href="#httpServer"></a>6 The HTTP Server</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI&#8217;s <code>create-app</code> command, the <code>http-server</code> dependency is included by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut includes both non-blocking HTTP server and client APIs based on <a href="https://netty.io">Netty</a>.</p>
</div>
<div class="paragraph">
<p>The design of the HTTP server in Micronaut is optimized for interchanging messages between Microservices, typically in JSON, and is not intended as a full server-side MVC framework. For example, there is currently no support for server-side views or features typical of a traditional server-side MVC framework.</p>
</div>
<div class="paragraph">
<p>The goal of the HTTP server is to make it as easy as possible to expose APIs that can be consumed by HTTP clients, whatever language they may be written in. To use the HTTP server you must have the <code>http-server-netty</code> dependency on your classpath.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-http-server-netty")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-http-server-netty&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>A "Hello World" server application can be seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello") <b class="conum">(1)</b>
public class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    public String index() {
        return "Hello World"; <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller('/hello') <b class="conum">(1)</b>
class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    String index() {
        'Hello World' <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello") <b class="conum">(1)</b>
class HelloController {

    @Get(produces = [MediaType.TEXT_PLAIN]) <b class="conum">(2)</b>
    fun index(): String {
        return "Hello World" <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/hello</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method will respond to a GET request to <code>/hello</code> and returns a response with a <code>text/plain</code> content type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>By defining method called <code>index</code>, by convention the method is exposed via the <code>/hello</code> URI</td>
</tr>
</table>
</div>

<h2 id="runningServer"><a class="anchor" href="#runningServer"></a>6.1 Running the Embedded Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/runningServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the server simply create an <code>Application</code> class with a <code>static void main</code> method. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String... args) {
        Micronaut.run Application.class
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.run(Application.javaClass)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the application from a unit test you can use the <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Property;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import javax.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class HelloControllerSpec {
    @Inject
    EmbeddedServer server; <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client; <b class="conum">(2)</b>

    @Test
    void testHelloWorldResponse() {
        String response = client.toBlocking() <b class="conum">(3)</b>
                .retrieve(HttpRequest.GET("/hello"));
        assertEquals("Hello World", response); //) <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.annotation.MicronautTest
import spock.lang.Specification
import javax.inject.Inject

@MicronautTest
class HelloControllerSpec extends Specification {
    @Inject
    EmbeddedServer embeddedServer <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client <b class="conum">(2)</b>

    void "test hello world response"() {
        expect:
            client.toBlocking() <b class="conum">(3)</b>
                    .retrieve(HttpRequest.GET('/hello')) == "Hello World" <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Property
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import javax.inject.Inject

@MicronautTest
class HelloControllerSpec {

    @Inject
    lateinit var server: EmbeddedServer <b class="conum">(1)</b>

    @Inject
    @field:Client("/")
    lateinit var client: HttpClient <b class="conum">(2)</b>

    @Test
    fun testHelloWorldResponse() {
        val rsp: String = client.toBlocking() <b class="conum">(3)</b>
                .retrieve("/hello")
        assertEquals("Hello World", rsp) <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>EmbeddedServer</code> is run and Spock&#8217;s <code>@AutoCleanup</code> annotation ensures the server is stopped after the specification completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EmbeddedServer</code> interface provides the <code>URL</code> of the server under test which runs on a random port.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The test uses the Micronaut http client to make the call</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>retrieve</code> method returns the response of the controller as a <code>String</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Without explicit port configuration, the port will be 8080, unless the application is run under the <code>test</code> environment. In that case the port will be random. When the application context is started from the context of a test class, the test environment is added automatically.
</td>
</tr>
</table>
</div>

<h2 id="runningSpecificPort"><a class="anchor" href="#runningSpecificPort"></a>6.2 Running Server on a Specific Port</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/runningSpecificPort.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default the server runs on port 8080. However, you can set the server to run on a specific port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    port: 8086</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is also possible to be configured from an environment variable: <code>MICRONAUT_SERVER_PORT=8086</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run on a random port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    port: -1</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If an explicit port is set, that may cause tests to fail because multiple servers are starting simultaneously on the same port. To prevent that, set the port to be random in the test environment configuration.
</td>
</tr>
</table>
</div>

<h2 id="routing"><a class="anchor" href="#routing"></a>6.3 HTTP Routing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/routing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation used in the previous section is one of <a href="../api/io/micronaut/http/annotation/package-summary.html">several annotations</a> that allow you to control the construction of HTTP routes.</p>
</div>
<div class="sect1">
<h2 id="_uri_paths">URI Paths</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The value of the <code>@Controller</code> annotation is a <a href="https://tools.ietf.org/html/rfc6570">RFC-6570 URI template</a> you can therefore embed URI variables within the path using the syntax defined by the URI template specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many other frameworks, including Spring, implement the URI template specification
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The actual implementation is handled by the <a href="../api/io/micronaut/http/uri/UriMatchTemplate.html">UriMatchTemplate</a> class, which extends <a href="../api/io/micronaut/http/uri/UriTemplate.html">UriTemplate</a>.</p>
</div>
<div class="paragraph">
<p>You can use this class explicitly within your application to build URIs. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        UriMatchTemplate template = UriMatchTemplate.of("/hello/{name}");

        assertTrue(template.match("/hello/John").isPresent()); <b class="conum">(1)</b>
        assertEquals("/hello/John", template.expand(  <b class="conum">(2)</b>
                Collections.singletonMap("name", "John")
        ));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        given:
        UriMatchTemplate template = UriMatchTemplate.of("/hello/{name}")

        expect:
        template.match("/hello/John").isPresent() <b class="conum">(1)</b>
        template.expand(["name": "John"]) == "/hello/John" <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val template = UriMatchTemplate.of("/hello/{name}")

        assertTrue(template.match("/hello/John").isPresent) <b class="conum">(1)</b>
        assertEquals("/hello/John", template.expand(mapOf("name" to "John")))  <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>match</code> method can be used to match a path</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>expand</code> method can be used to expand a template into a URI.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have a requirement to build paths to include in your responses you can use <a href="../api/io/micronaut/http/uri/UriTemplate.html">UriTemplate</a> to do so.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uri_path_variables">URI Path Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>URI variables can be referenced via method arguments. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.PathVariable;

@Controller("/issues") <b class="conum">(1)</b>
public class IssuesController {

    @Get("/{number}") <b class="conum">(2)</b>
    public String issue(@PathVariable Integer number) { <b class="conum">(3)</b>
        return "Issue # " + number + "!"; <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.PathVariable

@Controller("/issues") <b class="conum">(1)</b>
class IssuesController {

    @Get("/{number}") <b class="conum">(2)</b>
    String issue(@PathVariable Integer number) { <b class="conum">(3)</b>
        "Issue # " + number + "!" <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.PathVariable

@Controller("/issues") <b class="conum">(1)</b>
class IssuesController {

    @Get("/{number}") <b class="conum">(2)</b>
    fun issue(@PathVariable number: Int): String { <b class="conum">(3)</b>
        return "Issue # $number!" <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Controller</code> annotation is specified with a base URI of <code>/issues</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Get.html">Get</a> annotation is used to map the method to an HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> with a URI variable embedded in the URI called <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The method argument can be optionally annotated with <a href="../api/io/micronaut/http/annotation/PathVariable.html">PathVariable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The value of the URI variable is referenced in the implementation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut will map the URI <code>/issues/{number}</code> for the above controller. We can assert this is the case by writing a set of unit tests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.ApplicationContext;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.exceptions.HttpClientResponseException;
import io.micronaut.runtime.server.EmbeddedServer;
import org.junit.AfterClass;
import org.junit.BeforeClass;
import org.junit.Test;
import org.junit.jupiter.api.Assertions;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

public class IssuesControllerTest {

    private static EmbeddedServer server;
    private static HttpClient client;

    @BeforeClass <b class="conum">(1)</b>
    public static void setupServer() {
        server = ApplicationContext.run(EmbeddedServer.class);
        client = server
                    .getApplicationContext()
                    .createBean(HttpClient.class, server.getURL());
    }

    @AfterClass <b class="conum">(2)</b>
    public static void stopServer() {
        if(server != null) {
            server.stop();
        }
        if(client != null) {
            client.stop();
        }
    }

    @Test
    public void testIssue() throws Exception {
        String body = client.toBlocking().retrieve("/issues/12"); <b class="conum">(3)</b>

        assertNotNull(body);
        assertEquals("Issue # 12!", body); <b class="conum">(4)</b>
    }

    @Test
    public void testShowWithInvalidInteger() {
        HttpClientResponseException e =Assertions.assertThrows(HttpClientResponseException.class, () -&gt;
                client.toBlocking().exchange("/issues/hello"));

        assertEquals(400, e.getStatus().getCode()); <b class="conum">(5)</b>
    }

    @Test
    public void testIssueWithoutNumber() {
        HttpClientResponseException e = Assertions.assertThrows(HttpClientResponseException.class, () -&gt;
                client.toBlocking().exchange("/issues/"));

        assertEquals(404, e.getStatus().getCode()); <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.ApplicationContext
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.exceptions.HttpClientResponseException
import io.micronaut.runtime.server.EmbeddedServer
import spock.lang.AutoCleanup
import spock.lang.Shared
import spock.lang.Specification

class IssuesControllerTest extends Specification {

    @Shared
    @AutoCleanup <b class="conum">(2)</b>
    EmbeddedServer embeddedServer = ApplicationContext.run(EmbeddedServer) <b class="conum">(1)</b>

    @Shared
    @AutoCleanup <b class="conum">(2)</b>
    HttpClient client = HttpClient.create(embeddedServer.URL) <b class="conum">(1)</b>

    void "test issue"() {
        when:
        String body = client.toBlocking().retrieve("/issues/12") <b class="conum">(3)</b>

        then:
        body != null
        body == "Issue # 12!" <b class="conum">(4)</b>
    }

    void "/issues/{number} with an invalid Integer number responds 400"() {
        when:
        client.toBlocking().exchange("/issues/hello")

        then:
        HttpClientResponseException e = thrown(HttpClientResponseException)
        e.status.code == 400 <b class="conum">(5)</b>
    }

    void "/issues/{number} without number responds 404"() {
        when:
        client.toBlocking().exchange("/issues/")

        then:
        HttpClientResponseException e = thrown(HttpClientResponseException)
        e.status.code == 404 <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.ApplicationContext
import io.micronaut.http.client.exceptions.HttpClientResponseException
import io.micronaut.runtime.server.EmbeddedServer
import io.kotlintest.shouldBe
import io.kotlintest.shouldNotBe
import io.kotlintest.shouldThrow
import io.kotlintest.specs.StringSpec
import io.micronaut.http.client.RxHttpClient

class IssuesControllerTest: StringSpec() {

    val embeddedServer = autoClose( <b class="conum">(2)</b>
            ApplicationContext.run(EmbeddedServer::class.java) <b class="conum">(1)</b>
    )

    val client = autoClose( <b class="conum">(2)</b>
            embeddedServer.applicationContext.createBean(RxHttpClient::class.java, embeddedServer.getURL()) <b class="conum">(1)</b>
    )

    init {
        "test issue" {
            val body = client.toBlocking().retrieve("/issues/12") <b class="conum">(3)</b>

            body shouldNotBe null
            body shouldBe "Issue # 12!" <b class="conum">(4)</b>
        }

        "test issue with invalid integer" {
            val e = shouldThrow&lt;HttpClientResponseException&gt; { client.toBlocking().exchange&lt;Any&gt;("/issues/hello") }

            e.status.code shouldBe 400 <b class="conum">(5)</b>
        }

        "test issue without number" {
            val e = shouldThrow&lt;HttpClientResponseException&gt; { client.toBlocking().exchange&lt;Any&gt;("/issues/") }

            e.status.code shouldBe 404 <b class="conum">(6)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The embedded server and http client is being started</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The server and client will be cleaned up after all of the tests have finished</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The tests sends a request to the URI <code>/issues/12</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>And then asserts the response is "Issue # 12"</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Another test asserts a 400 response is returned when an invalid number is sent in the URL</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Another test asserts a 404 response is returned when no number is provided in the URL. The variable being present is required in order for the route to be executed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the URI template in the previous example requires that the <code>number</code> variable is specified. You can specify optional URI templates with the syntax: <code>/issues{/number}</code> and by annotating the <code>number</code> parameter with <code>@Nullable</code>.</p>
</div>
<div class="paragraph">
<p>The following table provides some examples of URI templates and what they match:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. URI Template Matching</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Matching URI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple match</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id:2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable of 2 characters max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code> or <code>/books</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/book{/id:[a-zA-Z]+}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable with regex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{?max,offset}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional query parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books?max=10&amp;offset=10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/path:.*}{.ext}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regex path match with extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo/bar.xml</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_uri_reserved_character_matching">URI Reserved Character Matching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default URI variables as defined by the <a href="https://tools.ietf.org/html/rfc6570">RFC-6570 URI template</a> spec cannot include reserved characters such as <code>/</code>, <code>?</code> etc.</p>
</div>
<div class="paragraph">
<p>If you wish to match or expand entire paths then this can be problematic. As per <a href="https://tools.ietf.org/html/rfc6570#section-3.2.3">section 3.2.3 of the specification</a>, you can use reserved expansion or matching using the <code>+</code> operator.</p>
</div>
<div class="paragraph">
<p>For example the URI <code>/books/{+path}</code> will match both <code>/books/foo</code> and <code>/books/foo/bar</code> since the <code>+</code> indicates that the variable <code>path</code> should include reserved characters (in this case <code>/</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_annotations">Routing Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example used the <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation to add method that accepted HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> requests. The following tables summarizes the available annotations and how they map to the different HTTP methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. HTTP Routing Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">HTTP Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Delete.html">@Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#DELETE">DELETE</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Get.html">@Get</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Head.html">@Head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#HEAD">HEAD</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Options.html">@Options</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#OPTIONS">OPTIONS</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Patch.html">@Patch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PATCH">PATCH</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Put.html">@Put</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PUT">PUT</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Post.html">@Post</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#POST">POST</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Trace.html">@Trace</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#TRACE">TRACE</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of the method annotations default to <code>/</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_uris">Multiple URIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each of the routing annotations support multiple URI templates. For each template, a route will be created. This feature is useful for example to change the path of the API and leaving the existing path as is for backwards compatibility. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello")
public class BackwardCompatibleController {

    @Get(uris = {"/{name}", "/person/{name}"}) <b class="conum">(1)</b>
    public String hello(String name) { <b class="conum">(2)</b>
        return "Hello, " + name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello")
class BackwardCompatibleController {

    @Get(uris = ["/{name}", "/person/{name}"]) <b class="conum">(1)</b>
    String hello(String name) { <b class="conum">(2)</b>
        "Hello, " + name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/hello")
class BackwardCompatibleController {

    @Get(uris = ["/{name}", "/person/{name}"]) <b class="conum">(1)</b>
    fun hello(name: String): String { <b class="conum">(2)</b>
        return "Hello, $name"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify multiple templates</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Bind to the template arguments as normal</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Route validation is more complicated with multiple templates. If a variable that would normally be required does not exist in all templates, then that variable is considered optional since it may not exist for every execution of the method.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_routes_programmatically">Building Routes Programmatically</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you prefer to not use annotations and declare all of your routes in code then never fear, Micronaut has a flexible <a href="../api/io/micronaut/web/router/RouteBuilder.html">RouteBuilder</a> API that makes it a breeze to define routes programmatically.</p>
</div>
<div class="paragraph">
<p>To start off with you should subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a> and then simply inject the controller you wish to route to into the method and define your routes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.ExecutionHandleLocator;
import io.micronaut.web.router.DefaultRouteBuilder;
import javax.inject.Inject;
import javax.inject.Singleton;

@Singleton
public class MyRoutes extends DefaultRouteBuilder { <b class="conum">(1)</b>

    public MyRoutes(ExecutionHandleLocator executionHandleLocator, UriNamingStrategy uriNamingStrategy) {
        super(executionHandleLocator, uriNamingStrategy);
    }

    @Inject
    void issuesRoutes(IssuesController issuesController) { <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController, "issue", Integer.class); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.web.router.GroovyRouteBuilder

import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class MyRoutes extends GroovyRouteBuilder { <b class="conum">(1)</b>

    MyRoutes(ExecutionHandleLocator executionHandleLocator, UriNamingStrategy uriNamingStrategy, ConversionService&lt;?&gt; conversionService) {
        super(executionHandleLocator, uriNamingStrategy, conversionService)
    }

    @Inject
    void issuesRoutes(IssuesController issuesController) { <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController.&amp;issue) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.ExecutionHandleLocator
import io.micronaut.web.router.DefaultRouteBuilder
import io.micronaut.web.router.RouteBuilder

import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class MyRoutes(executionHandleLocator: ExecutionHandleLocator, uriNamingStrategy: RouteBuilder.UriNamingStrategy) :
        DefaultRouteBuilder(executionHandleLocator, uriNamingStrategy) { <b class="conum">(1)</b>

    @Inject
    fun issuesRoutes(issuesController: IssuesController) { <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController, "issue", Int::class.java) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Route definitions should subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to inject a method with the controller you want to route to</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use methods such as <a href="../api/io/micronaut/web/router/RouteBuilder.html#GET-java.lang.String-java.lang.Class-java.lang.String-java.lang.Class&#8230;&#8203;-">GET</a> to route to controller methods. Note that even though the issues controller is being used, the route has no knowledge of its <code>@Controller</code> annotation and thus the full path must be specified.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Unfortunately due to type erasure a Java method lambda reference cannot be used with the API. For Groovy there is a <code>GroovyRouteBuilder</code> class which can be subclassed that allows passing Groovy method references.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_route_compile_time_validation">Route Compile Time Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut supports validating route arguments at compile time with the validation library. To get started simply add the <code>validation</code> dependency to your build:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">annotationProcessor "io.micronaut:micronaut-validation" // Java only
kapt "io.micronaut:micronaut-validation" // Kotlin only
compile "io.micronaut:micronaut-validation"</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the correct dependency on your classpath, route arguments will automatically be checked at compile time. The compilation will fail if any of the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>
The URI template contains a variable that is optional, but the method parameter is not annotated with <code>@Nullable</code> or is an <code>java.util.Optional</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An optional variable is one that will allow the route to match a URI even if the value is not present. For example <code>/foo{/bar}</code> will match requests to <code>/foo</code> and <code>/foo/abc</code>. The non optional variant would be <code>/foo/{bar}</code>. See the <a href="#_uri_path_variables">URI Path Variables</a> section for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>
The URI template contains a variable that is missing from the method arguments.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To disable route compile time validation, set the system property <code>-Dmicronaut.route.validation=false</code>. For Java and Kotlin users using Gradle, the same effect can be achieved by removing the <code>validation</code> dependency from the <code>annotationProcessor</code>/<code>kapt</code> scope.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_non_standard_http_methods">Routing non-standard HTTP methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It may be necessary to support a non-standard HTTP method for a client or server. Specifications like <a href="https://tools.ietf.org/html/rfc4918">RFC-4918 Webdav</a> require additional methods like REPORT or LOCK for example. To support that use case the @CustomHttpMethod annotation can be used.</p>
</div>
<div class="listingblock">
<div class="title">RoutingExample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CustomHttpMethod(method = "LOCK", value = "/{name}")
String lock(String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation can be used anywhere any of the standard method annotations can be used, including controllers and declarative http clients.</p>
</div>
</div>
</div>

<h2 id="binding"><a class="anchor" href="#binding"></a>6.4 Simple Request Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/binding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The examples in the previous section demonstrates how Micronaut allows you to bind method parameters from URI path variables. This section will discuss how to bind arguments from other parts of the request.</p>
</div>
<div class="sect1">
<h2 id="_binding_annotations">Binding Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All of the binding annotations support customization of the name of the variable being bound from with their <code>name</code> member.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the annotations, their purpose and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from a cookie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from an HTTP header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String contentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from a request query parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryValue String myParam</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Part.html">@Part</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from a part of a multipart request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Part CompletedFileUpload file</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@RequestAttribute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from an attribute of the request. Attributes are typically created in filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestAttribute String myAttribute</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/PathVariable.html">@PathVariable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from the path of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathVariable String id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestBean.html">@RequestBean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds any Bindable value to single Bean object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestBean MyBean bean</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a value is not specified to any binding annotation then the parameter name is used. In other words the following two methods are equivalent and both bind from a cookie called <code>myCookie</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/cookieName")
    public String cookieName(@CookieValue("myCookie") String myCookie) {
        // ...
    }

    @Get("/cookieInferred")
    public String cookieInferred(@CookieValue String myCookie) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/cookieName")
    String cookieName(@CookieValue("myCookie") String myCookie) {
        // ...
    }

    @Get("/cookieInferred")
    String cookieInferred(@CookieValue String myCookie) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/cookieName")
    fun cookieName(@CookieValue("myCookie") myCookie: String): String {
        // ...
    }

    @Get("/cookieInferred")
    fun cookieInferred(@CookieValue myCookie: String): String {
        // ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because hyphens are not allowed in variable names it may be necessary to set the name in the annotation. The following two definitions are equivalent:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/headerName")
    public String headerName(@Header("Content-Type") String contentType) {
        // ...
    }

    @Get("/headerInferred")
    public String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/headerName")
    String headerName(@Header("Content-Type") String contentType) {
        // ...
    }

    @Get("/headerInferred")
    String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/headerName")
    fun headerName(@Header("Content-Type") contentType: String): String {
        // ...
    }

    @Get("/headerInferred")
    fun headerInferred(@Header contentType: String): String {
        // ...
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_from_multiple_query_values">Binding from Multiple Query values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of binding from a single section of the request, it may be desirable to bind all query values for example to a POJO. This can be achieved by using the exploded operator (<code>?pojo*</code>) in the URI template. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpStatus;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

import edu.umd.cs.findbugs.annotations.Nullable;
import javax.validation.Valid;

@Controller("/api")
public class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    public HttpStatus list(@Valid @Nullable PaginationCommand paginationCommand) {
        return HttpStatus.OK;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpStatus
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

import javax.annotation.Nullable
import javax.validation.Valid

@Controller("/api")
class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    HttpStatus list(@Valid @Nullable PaginationCommand paginationCommand) {
        HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpStatus
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.validation.Validated
import javax.validation.Valid

@Controller("/api")
open class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    open fun list(@Valid paginationCommand: PaginationCommand): HttpStatus {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_from_multiple_bindable_values">Binding from Multiple Bindable values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of binding just Query values, it is also possible to bind any Bindable value to POJO  (e.g. when you want to bind <code>HttpRequest</code>, <code>@PathVariable</code>, <code>@QueryValue</code> and <code>@Header</code> to single POJO).
This can be achieved with <code>@RequestBean</code> annotation and custom Bean class that has fields with Bindable annotations or fields that can be bound by type (e.g. HttpRequest, BasicAuth, Authentication etc.).
For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Bindable values to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/api")
public class MovieTicketController {

    // You can also omit query parameters like:
    // @Get("/movie/ticket/{movieId}
    @Get("/movie/ticket/{movieId}{?minPrice,maxPrice}")
    public HttpStatus list(@Valid @RequestBean MovieTicketBean bean) {
        return HttpStatus.OK;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Bindable values to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/api")
class MovieTicketController {

    // You can also omit query parameters like:
    // @Get("/movie/ticket/{movieId}
    @Get("/movie/ticket/{movieId}{?minPrice,maxPrice}")
    HttpStatus list(@Valid @RequestBean MovieTicketBean bean) {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Bindable values to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/api")
open class MovieTicketController {

    // You can also omit query parameters like:
    // @Get("/movie/ticket/{movieId}
    @Get("/movie/ticket/{movieId}{?minPrice,maxPrice}")
    open fun list(@Valid @RequestBean bean: MovieTicketBean): HttpStatus {
        return HttpStatus.OK
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Bean definition</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Introspected
public class MovieTicketBean {

    private HttpRequest&lt;?&gt; httpRequest;

    @PathVariable
    private String movieId;

    @Nullable
    @QueryValue
    @PositiveOrZero
    private Double minPrice;

    @Nullable
    @QueryValue
    @PositiveOrZero
    private Double maxPrice;

    public MovieTicketBean(HttpRequest&lt;?&gt; httpRequest, String movieId, Double minPrice, Double maxPrice) {
        this.httpRequest = httpRequest;
        this.movieId = movieId;
        this.minPrice = minPrice;
        this.maxPrice = maxPrice;
    }

    public HttpRequest&lt;?&gt; getHttpRequest() {
        return httpRequest;
    }

    public String getMovieId() {
        return movieId;
    }

    @Nullable
    public Double getMaxPrice() {
        return maxPrice;
    }

    @Nullable
    public Double getMinPrice() {
        return minPrice;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Bean definition</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Introspected
class MovieTicketBean {

    private HttpRequest&lt;?&gt; httpRequest

    @PathVariable
    String movieId

    @Nullable
    @QueryValue
    @PositiveOrZero
    Double minPrice

    @Nullable
    @QueryValue
    @PositiveOrZero
    Double maxPrice
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Bean definition</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Introspected
data class MovieTicketBean(val httpRequest: HttpRequest&lt;Any&gt;,
                           @field:PathVariable val movieId: String,
                           @field:QueryValue @field:PositiveOrZero @field:Nullable val minPrice: Double,
                           @field:QueryValue @field:PositiveOrZero @field:Nullable val maxPrice: Double)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bean class has to be introspected with <code>@Introspected</code>. It can be one of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mutable Bean class with setters and getters</p>
</li>
<li>
<p>Immutable Bean class with getters and all argument constructor (or <code>@Creator</code> annotation on a constructor or static method).
Arguments of constructor have to match field names so object can be constructed without reflection.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Since Java does not retain argument names in the byte code, you have to compile code with <code>-parameters</code> in case you want to use Immutable Bean class from another Jar.
Another option is to extend Bean class in your source.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bindable_types">Bindable Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generally any type that can be converted from a String representation to a Java type via the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> API can be bound to.</p>
</div>
<div class="paragraph">
<p>This includes most common Java types, however additional <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> instances can be registered simply be creating <code>@Singleton</code> beans of type <code>TypeConverter</code>.</p>
</div>
<div class="paragraph">
<p>The handling of nullability deserves special mention. Consider for example the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/headerInferred")
    public String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/headerInferred")
    String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/headerInferred")
    fun headerInferred(@Header contentType: String): String {
        // ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case if the HTTP header <code>Content-Type</code> is not present in the request the route is considered invalid, since it cannot be satisfied and a HTTP 400 <code>BAD REQUEST</code> is returned.</p>
</div>
<div class="paragraph">
<p>If you wish for the <code>Content-Type</code> header to be optional, you can instead write:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/headerNullable")
    public String headerNullable(@Nullable @Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/headerNullable")
    String headerNullable(@Nullable @Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/headerNullable")
    fun headerNullable(@Header contentType: String?): String? {
        // ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>An null string will be passed if the header is absent from the request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>java.util.Optional</code> can also be used, however that is discouraged for method parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, any <code>DateTime</code> that conforms to <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#RFC_1123_DATE_TIME">RFC-1123</a> can be bound to a parameter, alternatively the format can be customized with the <a href="../api/io/micronaut/core/convert/format/Format.html">Format</a> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/date")
    public String date(@Header ZonedDateTime date) {
        // ...
    }

    @Get("/dateFormat")
    public String dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header ZonedDateTime date) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/date")
    String date(@Header ZonedDateTime date) {
        // ...
    }

    @Get("/dateFormat")
    String dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header ZonedDateTime date) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/date")
    fun date(@Header date: ZonedDateTime): String {
        // ...
    }

    @Get("/dateFormat")
    fun dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header date: ZonedDateTime): String {
        // ...
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_type_based_binding_parameters">Type Based Binding Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some parameters are recognized by their type instead of their annotation. The following table summarizes the parameter types, their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/BasicAuth.html">BasicAuth</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows binding of basic authorization credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuth basicAuth</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_variables_resolution">Variables resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut will try to populate method arguments in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>URI variables like <code>/{id}</code>.</p>
</li>
<li>
<p>If the request is a <code>GET</code> request from query parameters (ie. <code>?foo=bar</code>).</p>
</li>
<li>
<p>If there is a <code>@Body</code> and request allows the body, bind the body to it.</p>
</li>
<li>
<p>if the request can have a body and no <code>@Body</code> is defined then try parse the body (either JSON or form data) and
bind the method arguments from the body.</p>
</li>
<li>
<p>Finally, if the method arguments cannot be populated return <code>400 BAD REQUEST</code>.</p>
</li>
</ol>
</div>
</div>
</div>

<h2 id="hostResolution"><a class="anchor" href="#hostResolution"></a>6.5 Host Resolution</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/hostResolution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may need to resolve the host name of the current server. Micronaut ships with an implementation of the <a href="../api/io/micronaut/http/server/util/HttpHostResolver.html">HttpHostResolver</a> interface.</p>
</div>
<div class="paragraph">
<p>The default implementation will look for host information in the following places in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The supplied configuration</p>
</li>
<li>
<p>The <code>Forwarded</code> header</p>
</li>
<li>
<p>The <code>X-Forwarded-</code> headers</p>
</li>
<li>
<p>The <code>Host</code> header</p>
</li>
<li>
<p>The properties on the request URI</p>
</li>
<li>
<p>The properties on the embedded server URI</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The behavior of which headers to pull the relevant data can be changed with the following configuration:</p>
</div>
<a id="io.micronaut.http.server.HttpServerConfiguration$HostResolutionConfiguration" href="#io.micronaut.http.server.HttpServerConfiguration$HostResolutionConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/HttpServerConfiguration.HostResolutionConfiguration.html">HttpServerConfiguration$HostResolutionConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.host-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.protocol-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.port-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.port-in-host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True if the host header supports a port</p></td>
</tr>
</tbody>
</table>

<h2 id="clientIpAddress"><a class="anchor" href="#clientIpAddress"></a>6.6 Client IP Address</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/clientIpAddress.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may need to resolve the originating IP address of an HTTP Request. Micronaut ships with an implementation of <a href="../api/io/micronaut/http/server/util/HttpClientAddressResolver.html">HttpClientAddressResolver</a>.</p>
</div>
<div class="paragraph">
<p>The default implementation will resolve the client address in the following places in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The configured header</p>
</li>
<li>
<p>The <code>Forwarded</code> header</p>
</li>
<li>
<p>The <code>X-Forwarded-For</code> header</p>
</li>
<li>
<p>The remote address on the request</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first priority header name can be configured with <code>micronaut.server.client-address-header</code>.</p>
</div>

<h2 id="requestResponse"><a class="anchor" href="#requestResponse"></a>6.7 The HttpRequest and HttpResponse</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/requestResponse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you need more control over request processing then you can instead write a method that receives the complete <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a>.</p>
</div>
<div class="paragraph">
<p>In fact, there are several higher level interfaces that can be bound to method parameters of controllers. These include:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Bindable Micronaut Interfaces</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full <code>HttpRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpRequest request)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpHeaders.html">HttpHeaders</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP headers present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpHeaders headers)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpParameters.html">HttpParameters</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP parameters (either from URI variables or request parameters) present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpParameters params)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/Cookies.html">Cookies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the Cookies present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(Cookies cookies)</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> should be declared parametrized with a concrete generic type if the request body is needed, e.g. <code>HttpRequest&lt;MyClass&gt; request</code>. The body may not be available from the request otherwise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, for full control over the emitted HTTP response you can use the static factory methods of the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> class which return a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a>.</p>
</div>
<div class="paragraph">
<p>The following example implements the previous <code>MessageController</code> example using the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> objects:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/request")
public class MessageController {

    @Get("/hello") <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; hello(HttpRequest&lt;?&gt; request) {
        String name = request.getParameters()
                             .getFirst("name")
                             .orElse("Nobody"); <b class="conum">(2)</b>

        return HttpResponse.ok("Hello " + name + "!!")
                 .header("X-My-Header", "Foo"); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/request")
class MessageController {

    @Get("/hello") <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; hello(HttpRequest&lt;?&gt; request) {
        String name = request.getParameters()
                             .getFirst("name")
                             .orElse("Nobody") <b class="conum">(2)</b>

        HttpResponse.ok("Hello " + name + "!!")
                 .header("X-My-Header", "Foo") <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/request")
class MessageController {

    @Get("/hello") <b class="conum">(1)</b>
    fun hello(request: HttpRequest&lt;*&gt;): HttpResponse&lt;String&gt; {
        val name = request.parameters
                .getFirst("name")
                .orElse("Nobody") <b class="conum">(2)</b>

        return HttpResponse.ok("Hello $name!!")
                .header("X-My-Header", "Foo") <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is mapped to the URI <code>/hello</code> and accepts a <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> is used to obtain the value of a query parameter called <code>name</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/HttpResponse.html#ok-T-">HttpResponse.ok(T)</a> method is used to return a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> with a text body. A header called <code>X-My-Header</code> is also added to the response object.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> is also available from static context via <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Generally <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a> is available within reactive flow, but the recommended approach is to propagate the necessary state through lambdas.
</td>
</tr>
</table>
</div>

<h2 id="statusAnnotation"><a class="anchor" href="#statusAnnotation"></a>6.8 Response Status</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/statusAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action responds with a 200 HTTP status code by default.</p>
</div>
<div class="paragraph">
<p>If the controller&#8217;s action returns a <code>HttpResponse</code> object, you can configure the status code for the response object with the <code>status</code> method.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get(value = "/http-response", produces = MediaType.TEXT_PLAIN)
    public HttpResponse httpResponse() {
        return HttpResponse.status(HttpStatus.CREATED).body("success");
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get(value = "/http-response", produces = MediaType.TEXT_PLAIN)
    HttpResponse httpResponse() {
        HttpResponse.status(HttpStatus.CREATED).body("success")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get(value = "/http-response", produces = [MediaType.TEXT_PLAIN])
    fun httpResponse(): HttpResponse&lt;String&gt; {
        return HttpResponse.status&lt;String&gt;(HttpStatus.CREATED).body("success")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>@Status</code> annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Status(HttpStatus.CREATED)
    @Get(produces = MediaType.TEXT_PLAIN)
    public String index() {
        return "success";
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Status(HttpStatus.CREATED)
    @Get(produces = MediaType.TEXT_PLAIN)
    String index() {
        return "success"
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Status(HttpStatus.CREATED)
    @Get(produces = [MediaType.TEXT_PLAIN])
    fun index(): String {
        return "success"
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or even respond with an <code>HttpStatus</code></p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/http-status")
    public HttpStatus httpStatus() {
        return HttpStatus.CREATED;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/http-status")
    HttpStatus httpStatus() {
        HttpStatus.CREATED
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/http-status")
    fun httpStatus(): HttpStatus {
        return HttpStatus.CREATED
    }</code></pre>
</div>
</div>

<h2 id="producesAnnotation"><a class="anchor" href="#producesAnnotation"></a>6.9 Response Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/producesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action produces <code>application/json</code> by default.
Nonetheless you can change the <code>Content-Type</code> of the response with the <code>@Produces</code> annotation or the <code>produces</code> member of the HTTP method annotations.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Produces;

@Controller("/produces")
public class ProducesController {

    @Get <b class="conum">(1)</b>
    public HttpResponse index() {
        return HttpResponse.ok().body("{\"msg\":\"This is JSON\"}");
    }

    @Produces(MediaType.TEXT_HTML)
    @Get("/html") <b class="conum">(2)</b>
    public String html() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;";
    }

    @Get(value = "/xml", produces = MediaType.TEXT_XML) <b class="conum">(3)</b>
    public String xml() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces

@Controller("/produces")
class ProducesController {

    @Get <b class="conum">(1)</b>
    HttpResponse index() {
        HttpResponse.ok().body("{\"msg\":\"This is JSON\"}")
    }

    @Produces(MediaType.TEXT_HTML) <b class="conum">(2)</b>
    @Get("/html")
    String html() {
        "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }

    @Get(value = "/xml", produces = MediaType.TEXT_XML) <b class="conum">(3)</b>
    String xml() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces

@Controller("/produces")
class ProducesController {

    @Get <b class="conum">(1)</b>
    fun index(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;().body("{\"msg\":\"This is JSON\"}")
    }

    @Produces(MediaType.TEXT_HTML)
    @Get("/html") <b class="conum">(2)</b>
    fun html(): String {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }

    @Get(value = "/xml", produces = [MediaType.TEXT_XML]) <b class="conum">(3)</b>
    fun xml(): String {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default content type is JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate a controller&#8217;s action with <code>@Produces</code> to change the response content type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Setting the <code>produces</code> member of the method annotation also changes the content type.</td>
</tr>
</table>
</div>

<h2 id="consumesAnnotation"><a class="anchor" href="#consumesAnnotation"></a>6.10 Accepted Request Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/consumesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action consumes <code>application/json</code> by default. Consuming other content types is supported with the <code>@Consumes</code> annotation, or the <code>consumes</code> member of any HTTP method annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Consumes;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;

@Controller("/consumes")
public class ConsumesController {

    @Post <b class="conum">(1)</b>
    public HttpResponse index() {
        return HttpResponse.ok();
    }

    @Consumes({MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON}) <b class="conum">(2)</b>
    @Post("/multiple")
    public HttpResponse multipleConsumes() {
        return HttpResponse.ok();
    }

    @Post(value = "/member", consumes = MediaType.TEXT_PLAIN) <b class="conum">(3)</b>
    public HttpResponse consumesMember() {
        return HttpResponse.ok();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Consumes
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

@Controller("/consumes")
class ConsumesController {

    @Post <b class="conum">(1)</b>
    HttpResponse index() {
        HttpResponse.ok()
    }

    @Consumes([MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON]) <b class="conum">(2)</b>
    @Post("/multiple")
    HttpResponse multipleConsumes() {
        HttpResponse.ok()
    }

    @Post(value = "/member", consumes = MediaType.TEXT_PLAIN) <b class="conum">(3)</b>
    HttpResponse consumesMember() {
        HttpResponse.ok()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Consumes
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

@Controller("/consumes")
class ConsumesController {

    @Post <b class="conum">(1)</b>
    fun index(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }

    @Consumes(MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON) <b class="conum">(2)</b>
    @Post("/multiple")
    fun multipleConsumes(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }

    @Post(value = "/member", consumes = [MediaType.TEXT_PLAIN]) <b class="conum">(3)</b>
    fun consumesMember(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default, a controller&#8217;s action consumes request with <code>Content-Type</code> of type <code>application/json</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@Consumes</code> annotation takes a <code>String[]</code> of supported media types for an incoming request.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The consumes can also be specified with the <code>consumes</code> member of the method annotation.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customizing_processed_content_types">Customizing Processed Content Types</h3>
<div class="paragraph">
<p>Normally the JSON parsing only happens if the content type is <code>application/json</code>. The other <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> classes behave in a similar manner that they have pre-defined content types they can process. To extend the list of media types that a given codec should process, you can provide configuration that will be stored in <a href="../api/io/micronaut/http/codec/CodecConfiguration.html">CodecConfiguration</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    codec:
        json:
            additionalTypes:
              - text/javascript
              - ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently supported configuration prefixes are <code>json</code>, <code>json-stream</code>, <code>text</code>, and <code>text-stream</code>.</p>
</div>
</div>

<h2 id="reactiveServer"><a class="anchor" href="#reactiveServer"></a>6.11 Reactive HTTP Request Processing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/reactiveServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Micronaut is built on Netty which is designed around an Event loop model and non-blocking I/O. Micronaut will execute code defined in <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> beans in the same thread as the request thread (an Event Loop thread).</p>
</div>
<div class="paragraph">
<p>This makes it critical that if you do any blocking I/O operations (for example interactions with Hibernate/JPA or JDBC) that you offload those tasks to a separate thread pool that does not block the Event loop.</p>
</div>
<div class="paragraph">
<p>For example the following configuration will configure the I/O thread pool as a fixed thread pool with 75 threads (similar to what a traditional blocking server such as Tomcat uses in the thread per request model):</p>
</div>
<div class="listingblock">
<div class="title">Configuring the IO thread pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    executors:
        io:
            type: fixed
            nThreads: 75</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use this thread pool in a <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> bean you have a number of options. The simplest option is to use the <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation which can be declared at the type or method level to indicate which configured thread pool you wish to run the method or methods of the controller on:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.*;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;

@Controller("/executeOn/people")
public class PersonController {

    private final PersonService personService;

    PersonController(
            PersonService personService) {
        this.personService = personService;
    }

    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) <b class="conum">(1)</b>
    Person byName(String name) {
        return personService.findByName(name);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.*
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn

@Controller("/executeOn/people")
class PersonController {

    private final PersonService personService

    PersonController(
            PersonService personService) {
        this.personService = personService
    }

    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) <b class="conum">(1)</b>
    Person byName(String name) {
        return personService.findByName(name)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.*
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn

@Controller("/executeOn/people")
class PersonController (private val personService: PersonService) {
    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) <b class="conum">(1)</b>
    fun byName(name: String): Person {
        return personService.findByName(name)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation is used to execute the operation on the I/O thread pool</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value of the <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation can be any named executor defined under <code>micronaut.executors</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Generally speaking for database operations you will want a thread pool configured that matches maximum number of connections you have specified in the database connection pool.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative to the <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation is to use the facility provided by the reactive library you have chosen. RxJava for example features a <code>subscribeOn</code> method which allows you to alter which thread executes user code. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">RxJava subscribeOn Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.*;
import io.micronaut.scheduling.TaskExecutors;
import io.reactivex.*;
import io.reactivex.schedulers.Schedulers;
import javax.inject.Named;
import java.util.concurrent.ExecutorService;

@Controller("/subscribeOn/people")
public class PersonController {

    private final Scheduler scheduler;
    private final PersonService personService;

    PersonController(
            @Named(TaskExecutors.IO) ExecutorService executorService, <b class="conum">(1)</b>
            PersonService personService) {
        this.scheduler = Schedulers.from(executorService);
        this.personService = personService;
    }

    @Get("/{name}")
    Single&lt;Person&gt; byName(String name) {
        return Single.fromCallable(() -&gt;
                personService.findByName(name) <b class="conum">(2)</b>
        ).subscribeOn(scheduler); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">RxJava subscribeOn Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.*
import io.micronaut.scheduling.TaskExecutors
import io.reactivex.*
import io.reactivex.schedulers.Schedulers
import javax.inject.Named
import java.util.concurrent.ExecutorService

@Controller("/subscribeOn/people")
class PersonController {

    private final Scheduler scheduler
    private final PersonService personService

    PersonController(
            @Named(TaskExecutors.IO) ExecutorService executorService, <b class="conum">(1)</b>
            PersonService personService) {
        this.scheduler = Schedulers.from(executorService)
        this.personService = personService
    }

    @Get("/{name}")
    Single&lt;Person&gt; byName(String name) {
        return Single.fromCallable({ -&gt; <b class="conum">(2)</b>
            personService.findByName(name)
        }).subscribeOn(scheduler) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">RxJava subscribeOn Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.*
import io.micronaut.scheduling.TaskExecutors
import io.reactivex.*
import io.reactivex.schedulers.Schedulers
import java.util.concurrent.ExecutorService
import javax.inject.Named

@Controller("/subscribeOn/people")
class PersonController internal constructor(
        @Named(TaskExecutors.IO) executorService: ExecutorService, <b class="conum">(1)</b>
        val personService: PersonService) {
    private val scheduler: Scheduler

    init {
        scheduler = Schedulers.from(executorService)
    }

    @Get("/{name}")
    fun byName(name: String): Single&lt;Person&gt; {
        return Single.fromCallable { personService.findByName(name) } <b class="conum">(2)</b>
                .subscribeOn(scheduler) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The configured I/O executor service is injected</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>RxJava&#8217;s <code>fromCallable</code> method is used to wrap the blocking operation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>RxJava&#8217;s <code>subscribeOn</code> method is used to schedule the operation on the I/O thread pool</td>
</tr>
</table>
</div>

<h2 id="bodyAnnotation"><a class="anchor" href="#bodyAnnotation"></a>6.11.1 Using the @Body Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/reactiveServer/bodyAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To parse the request body, you first need to indicate to Micronaut the parameter which will receive the data. This is done with the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following example implements a simple echo server that echos the body sent in the request:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.MutableHttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.reactivex.Flowable;
import io.reactivex.Single;

import javax.validation.constraints.Size;

    @Post(value = "/echo", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    String echo(@Size(max = 1024) @Body String text) { <b class="conum">(2)</b>
        return text; <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.reactivex.Flowable
import io.reactivex.Single

import javax.validation.constraints.Size

    @Post(value = "/echo", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    String echo(@Size(max = 1024) @Body String text) { <b class="conum">(2)</b>
        text <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.reactivex.Flowable
import io.reactivex.Single

import javax.validation.constraints.Size


@Controller("/receive")
open class MessageController {

    @Post(value = "/echo", consumes = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    open fun echo(@Size(max = 1024) @Body text: String): String { <b class="conum">(2)</b>
        return text <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Post.html">Post</a> annotation is used with a <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> of <code>text/plain</code> (the default is <code>application/json</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation is used with a <code>javax.validation.constraints.Size</code> that limits the size of the body to at most 1MB. This constraint does <strong>not</strong> limit the amount of data read/buffered by the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The body is returned as the result of the method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that reading the request body is done in a non-blocking manner in that the request contents are read as the data becomes available and accumulated into the String passed to the method.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>micronaut.server.maxRequestSize</code> setting in <code>application.yml</code> will limit the size of the data (the default maximum request size is 10MB) read/buffered by the server. <code>@Size</code> is <strong>not</strong> a replacement for this setting.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regardless of the limit, for a large amount of data accumulating the data into a String in-memory may lead to memory strain on the server. A better approach is to include a Reactive library in your project (such as <code>RxJava 2.x</code>, <code>Reactor</code> or <code>Akka</code>) that supports the Reactive streams implementation and stream the data it becomes available:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the request body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Post(value = "/echo-flow", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    Single&lt;MutableHttpResponse&lt;String&gt;&gt; echoFlow(@Body Flowable&lt;String&gt; text) { <b class="conum">(2)</b>
        return text.collect(StringBuffer::new, StringBuffer::append) <b class="conum">(3)</b>
                   .map(buffer -&gt;
                        HttpResponse.ok(buffer.toString())
                   );
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the request body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Post(value = "/echo-flow", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    Single&lt;MutableHttpResponse&lt;String&gt;&gt; echoFlow(@Body Flowable&lt;String&gt; text) { <b class="conum">(2)</b>
        return text.collect({ x -&gt; new StringBuffer()}, { StringBuffer sb, String s -&gt; sb.append(s)}) <b class="conum">(3)</b>
                   .map({ buffer -&gt;
                       HttpResponse.ok(buffer.toString())
                   });
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the request body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Post(value = "/echo-flow", consumes = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    open fun echoFlow(@Body text: Flowable&lt;String&gt;): Single&lt;MutableHttpResponse&lt;String&gt;&gt; { <b class="conum">(2)</b>
        return text.collect({ StringBuffer() }, { obj, str -&gt; obj.append(str) }) <b class="conum">(3)</b>
                .map { buffer -&gt; HttpResponse.ok(buffer.toString()) }
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case the method is altered to receive and return an RxJava 2.x <code>Flowable</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> is returned so that Micronaut will only emit the response once the operation completes without blocking.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>collect</code> method is used to accumulate the data in this simulated example, but it could for example write the data to logging service, database or whatever chunk by chunk</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Body arguments of types that do not require conversion will cause Micronaut to skip decoding of the request!
</td>
</tr>
</table>
</div>

<h2 id="reactiveResponses"><a class="anchor" href="#reactiveResponses"></a>6.11.2 Reactive Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/reactiveServer/reactiveResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous section introduced the notion of Reactive programming using RxJava 2.x and Micronaut.</p>
</div>
<div class="paragraph">
<p>Micronaut supports returning common reactive types such as <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> or <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html">Observable</a> (or the <code>Mono</code> type from Reactor 3.x), an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> from any controller method.</p>
</div>
<div class="paragraph">
<p>The argument that is designated the body of the request using the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation can also be a reactive type or a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a>.</p>
</div>
<div class="paragraph">
<p>When returning a reactive type Micronaut will subscribe to the returned reactive type on the same thread as the request (A Netty Event Loop thread). It is therefore important that if you perform any blocking operations you offload those operations to an appropriately configured thread pool for example, using RxJava&#8217;s <code>subscribeOn(..)</code> facility or <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the section on <a href="#threadPools">Configuring Thread Pools</a> for information on the thread pools that Micronaut sets up and how to configure them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To summarize, the following table illustrates some common response types and their handling:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpResponse&lt;Flowable&lt;String&gt;&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any implementation of <code>CharSequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When returning a Reactive type, the type of reactive type has an impact on the response returned. For example, when returning a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>, Micronaut can not know the size of the response, so <code>Transfer-Encoding</code> type of <code>Chunked</code> is used. Whilst for types that emit a single result such as <code><a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a></code> the <code>Content-Length</code> header will be populated.
</td>
</tr>
</table>
</div>

<h2 id="jsonBinding"><a class="anchor" href="#jsonBinding"></a>6.12 JSON Binding with Jackson</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/jsonBinding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The most common data interchange format nowadays is JSON.</p>
</div>
<div class="paragraph">
<p>In fact, the defaults in the <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> annotation specify that the controllers in Micronaut consume and produce JSON by default.</p>
</div>
<div class="paragraph">
<p>In order to do so in a non-blocking manner Micronaut builds on the <a href="https://github.com/FasterXML/jackson">Jackson</a> Asynchronous JSON parsing API and Netty such that the reading of incoming JSON is done in a non-blocking manner.</p>
</div>
<div class="sect1">
<h2 id="_binding_using_reactive_frameworks">Binding using Reactive Frameworks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From a developer perspective however, you can generally just work with Plain Old Java Objects (POJOs) and can optionally use a Reactive framework such as RxJava or Reactor. The following is an example of a controller that reads and saves an incoming POJO in a non-blocking way from JSON:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post("/saveReactive")
    public Single&lt;HttpResponse&lt;Person&gt;&gt; save(@Body Single&lt;Person&gt; person) { <b class="conum">(1)</b>
        return person.map(p -&gt; {
                    inMemoryDatastore.put(p.getFirstName(), p); <b class="conum">(2)</b>
                    return HttpResponse.created(p); <b class="conum">(3)</b>
                }
        );
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post("/saveReactive")
    Single&lt;HttpResponse&lt;Person&gt;&gt; save(@Body Single&lt;Person&gt; person) { <b class="conum">(1)</b>
        person.map({ p -&gt;
            inMemoryDatastore.put(p.getFirstName(), p) <b class="conum">(2)</b>
            HttpResponse.created(p) <b class="conum">(3)</b>
        })
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post("/saveReactive")
    fun save(@Body person: Single&lt;Person&gt;): Single&lt;HttpResponse&lt;Person&gt;&gt; { <b class="conum">(1)</b>
        return person.map { p -&gt;
            inMemoryDatastore[p.firstName] = p <b class="conum">(2)</b>
            HttpResponse.created(p) <b class="conum">(3)</b>
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method receives a RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> which emits the POJO once the JSON has been read</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>map</code> method is used to store the instance in <code>Map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using CURL from the command line you can POST JSON to the <code>/people</code> URI for the server to receive it:</p>
</div>
<div class="listingblock">
<div class="title">Using CURL to Post JSON</div>
<div class="content">
<pre>$ curl -X POST localhost:8080/people -d '{"firstName":"Fred","lastName":"Flintstone","age":45}'</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_completablefuture">Binding Using CompletableFuture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The same method as the previous example can also be written with the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> API instead:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post("/saveFuture")
    public CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; save(@Body CompletableFuture&lt;Person&gt; person) {
        return person.thenApply(p -&gt; {
                    inMemoryDatastore.put(p.getFirstName(), p);
                    return HttpResponse.created(p);
                }
        );
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post("/saveFuture")
    CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; save(@Body CompletableFuture&lt;Person&gt; person) {
        person.thenApply({ p -&gt;
            inMemoryDatastore.put(p.getFirstName(), p)
            HttpResponse.created(p)
        })
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post("/saveFuture")
    fun save(@Body person: CompletableFuture&lt;Person&gt;): CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; {
        return person.thenApply { p -&gt;
            inMemoryDatastore[p.firstName] = p
            HttpResponse.created(p)
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example uses the <code>thenApply</code> method to achieve the same as the previous example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_pojos">Binding using POJOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note however you can just as easily write:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post
    public HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person);
        return HttpResponse.created(person);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post
    HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person)
        HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post
    fun save(@Body person: Person): HttpResponse&lt;Person&gt; {
        inMemoryDatastore[person.firstName] = person
        return HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will only execute your method once the data has been read in a non-blocking manner.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The output produced by Jackson can be customized in a variety of manners, from defining Jackson modules to using <a href="https://github.com/FasterXML/jackson-annotations/wiki/Jackson-Annotations">Jackson&#8217;s annotations</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jackson_configuration">Jackson Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Jackson ObjectMapper can be configured through normal configuration with the <a href="../api/io/micronaut/jackson/JacksonConfiguration.html">JacksonConfiguration</a> class.</p>
</div>
<div class="paragraph">
<p>All jackson configuration keys start with <code>jackson</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#forLanguageTag-java.lang.String-">Locale.forLanguageTag</a>. Example: <code>en-US</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeZone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <a href="https://docs.oracle.com/javase/8/docs/api/java/util/TimeZone.html#getTimeZone-java.lang.String-">TimeZone.getTimeZone</a>. Example: <code>PST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializationInclusion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <a href="http://fasterxml.github.io/jackson-annotations/javadoc/2.9/com/fasterxml/jackson/annotation/JsonInclude.Include.html">JsonInclude.Include</a>. Example: <code>ALWAYS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">propertyNamingStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of an instance of <a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/PropertyNamingStrategy.html">PropertyNamingStrategy</a>. Example: <code>SNAKE_CASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultTyping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The global defaultTyping for polymorphic type handling from enum <a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/ObjectMapper.DefaultTyping.html">ObjectMapper.DefaultTyping</a>. Example: <code>NON_FINAL</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
    serializationInclusion: ALWAYS</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_features">Features</h3>
<div class="paragraph">
<p>All features can be configured with their name as the key and a boolean to indicate enabled or disabled.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/SerializationFeature.html">SerializationFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deserialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/DeserializationFeature.html">DeserializationFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/MapperFeature.html">MapperFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-core/javadoc/2.9/com/fasterxml/jackson/core/JsonParser.Feature.html">JsonParser.Feature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-core/javadoc/2.9/com/fasterxml/jackson/core/JsonGenerator.Feature.html">JsonGenerator.Feature</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
    serialization:
        indentOutput: true
        writeDatesAsTimestamps: false
    deserialization:
        useBigIntegerForInts: true
        failOnUnknownProperties: false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_code_jsonview_code">Support for <code>@JsonView</code></h3>
<div class="paragraph">
<p>You can use the <code>@JsonView</code> annotation to controller methods if you set <code>jackson.json-view.enabled</code> to <code>true</code> in <code>application.yml</code>.</p>
</div>
<div class="paragraph">
<p>Jackson&#8217;s <code>@JsonView</code> annotation allows you to control which properties are exposes on a per response basis. See <a href="https://www.baeldung.com/jackson-json-view-annotation">Jackson JSON Views</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_beans">Beans</h3>
<div class="paragraph">
<p>In addition to configuration, beans can be registered to customize Jackson. All beans that extend any of the following classes will be registered with the object mapper.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/Module.html">Module</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/JsonDeserializer.html">JsonDeserializer</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/JsonSerializer.html">JsonSerializer</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/KeyDeserializer.html">KeyDeserializer</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/deser/BeanDeserializerModifier.html">BeanDeserializerModifier</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/ser/BeanSerializerModifier.html">BeanSerializerModifier</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_service_loader">Service Loader</h3>
<div class="paragraph">
<p>Any modules registered via the service loader will also be added to the default object mapper.</p>
</div>
</div>
</div>
</div>

<h2 id="datavalidation"><a class="anchor" href="#datavalidation"></a>6.13 Data Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/datavalidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is easy to validate incoming data with Micronaut&#8217;s controllers with the
<a href="#validation">Validation Advice</a>.</p>
</div>
<div class="paragraph">
<p>First, add the Hibernate Validator configuration to your application:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.beanvalidation:micronaut-hibernate-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.beanvalidation&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>We can validate parameters using <code>javax.validation</code> annotations and the <a href="../api/io/micronaut/validation/Validated.html">Validated</a> annotation at the class level.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.validation.Validated;

import javax.validation.constraints.NotBlank;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
public class EmailController {

    @Get("/send")
    public HttpResponse send(@NotBlank String recipient, <b class="conum">(2)</b>
                             @NotBlank String subject) { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.validation.Validated;

import javax.validation.constraints.NotBlank;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
class EmailController {

    @Get("/send")
    HttpResponse send(@NotBlank String recipient, <b class="conum">(2)</b>
                             @NotBlank String subject) { <b class="conum">(2)</b>
        HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.validation.Validated

import javax.validation.constraints.NotBlank
import java.util.Collections


@Validated <b class="conum">(1)</b>
@Controller("/email")
open class EmailController {

    @Get("/send")
    open fun send(@NotBlank recipient: String, <b class="conum">(2)</b>
             @NotBlank subject: String): HttpResponse&lt;*&gt; { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>subject</code> and <code>recipient</code> cannot be blank.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a validation error occurs a <code>javax.validation.ConstraintViolationException</code> will be thrown. By default, the integrated <code>io.micronaut.validation.exception.ConstraintExceptionHandler</code> is used to handle the exception leading to a behaviour as shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void testParametersAreValidated() {
        HttpClientResponseException e = Assertions.assertThrows(HttpClientResponseException.class, () -&gt;
            client.toBlocking().exchange("/email/send?subject=Hi&amp;recipient="));
        HttpResponse response = e.getResponse();

        assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

        response = client.toBlocking().exchange("/email/send?subject=Hi&amp;recipient=me@micronaut.example");

        assertEquals(HttpStatus.OK, response.getStatus());
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    def "test parameter validation"() {
        when:
        client.toBlocking().exchange('/email/send?subject=Hi&amp;recipient=')

        then:
        def e = thrown(HttpClientResponseException)
        def response = e.response
        response.status == HttpStatus.BAD_REQUEST

        when:
        response = client.toBlocking().exchange('/email/send?subject=Hi&amp;recipient=me@micronaut.example')

        then:
        response.status == HttpStatus.OK
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "test params are validated"() {
            val e = shouldThrow&lt;HttpClientResponseException&gt; {
                client.toBlocking().exchange&lt;Any&gt;("/email/send?subject=Hi&amp;recipient=")
            }
            var response = e.response

            response.status shouldBe HttpStatus.BAD_REQUEST

            response = client.toBlocking().exchange&lt;Any&gt;("/email/send?subject=Hi&amp;recipient=me@micronaut.example")

            response.status shouldBe HttpStatus.OK
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want your own <code>ExceptionHandler</code> to handle the constraint exceptions, you need to annotate it with <code>@Replaces(ConstraintExceptionHandler.class)</code></p>
</div>
<div class="paragraph">
<p>Often, you may want to use POJOs as controller method parameters.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.docs.datavalidation.pogo;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;

@Introspected
public class Email {

    @NotBlank <b class="conum">(1)</b>
    String subject;

    @NotBlank <b class="conum">(1)</b>
    String recipient;

    public String getSubject() {
        return subject;
    }

    public void setSubject(String subject) {
        this.subject = subject;
    }

    public String getRecipient() {
        return recipient;
    }

    public void setRecipient(String recipient) {
        this.recipient = recipient;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.docs.datavalidation.pogo;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;

@Introspected
class Email {

    @NotBlank <b class="conum">(1)</b>
    String subject;

    @NotBlank <b class="conum">(1)</b>
    String recipient;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.docs.datavalidation.pogo

import io.micronaut.core.annotation.Introspected

import javax.validation.constraints.NotBlank

@Introspected
open class Email {

    @NotBlank <b class="conum">(1)</b>
    var subject: String? = null

    @NotBlank <b class="conum">(1)</b>
    var recipient: String? = null
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can use <code>javax.validation</code> annotations in your POJOs.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You need to annotate your controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a>. Also, you need to annotate the binding POJO with <code>@Valid</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;

import javax.validation.Valid;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
public class EmailController {

    @Post("/send")
    public HttpResponse send(@Body @Valid Email email) { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;

import javax.validation.Valid;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
class EmailController {

    @Post("/send")
    HttpResponse send(@Body @Valid Email email) { <b class="conum">(2)</b>
        HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated

import javax.validation.Valid
import java.util.Collections


@Validated <b class="conum">(1)</b>
@Controller("/email")
open class EmailController {

    @Post("/send")
    open fun send(@Body @Valid email: Email): HttpResponse&lt;*&gt; { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the POJO which you wish to validate with <code>@Valid</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The validation of POJOs is shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    public void testPoJoValidation() {
        HttpClientResponseException e = Assertions.assertThrows(HttpClientResponseException.class, () -&gt; {
            Email email = new Email();
            email.subject = "Hi";
            email.recipient = "";
            client.toBlocking().exchange(HttpRequest.POST("/email/send", email));
        });
        HttpResponse response = e.getResponse();

        assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

        Email email = new Email();
        email.subject = "Hi";
        email.recipient = "me@micronaut.example";
        response = client.toBlocking().exchange(HttpRequest.POST("/email/send", email));

        assertEquals(HttpStatus.OK, response.getStatus());
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    def "invoking /email/send parse parameters in a POJO and validates"() {
        when:
        Email email = new Email()
        email.subject = 'Hi'
        email.recipient = ''
        client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

        then:
        def e = thrown(HttpClientResponseException)
        def response = e.response
        response.status == HttpStatus.BAD_REQUEST

        when:
        email = new Email()
        email.subject = 'Hi'
        email.recipient = 'me@micronaut.example'
        response = client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

        then:
        response.status == HttpStatus.OK
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "test poko validation"() {
            val e = shouldThrow&lt;HttpClientResponseException&gt; {
                val email = Email()
                email.subject = "Hi"
                email.recipient = ""
                client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))
            }
            var response = e.response

            response.status shouldBe HttpStatus.BAD_REQUEST

            val email = Email()
            email.subject = "Hi"
            email.recipient = "me@micronaut.example"
            response = client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))

            response.status shouldBe HttpStatus.OK
        }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bean injection is supported in custom constraints with the hibernate validator configuration.
</td>
</tr>
</table>
</div>

<h2 id="staticResources"><a class="anchor" href="#staticResources"></a>6.14 Serving Static Resources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/staticResources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Static resource resolution is disabled by default. Micronaut supports resolving resources from the classpath or the file system.</p>
</div>
<div class="paragraph">
<p>See the information below for available configuration options:</p>
</div>
<a id="io.micronaut.web.router.resource.StaticResourceConfiguration" href="#io.micronaut.web.router.resource.StaticResourceConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/web/router/resource/StaticResourceConfiguration.html">StaticResourceConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether this specific mapping is enabled. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.paths</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of paths either starting with <code>classpath:</code> or <code>file:</code>. You can serve files from anywhere on disk or the classpath. For example to serve static resources from <code>src/main/resources/public</code>, you would use <code>classpath:public</code> as the path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.mapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path resources should be served from. Uses ant path matching. Default value ("/**").</p></td>
</tr>
</tbody>
</table>

<h2 id="errorHandling"><a class="anchor" href="#errorHandling"></a>6.15 Error Handling</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/errorHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Sometimes with distributed applications, bad things happen. Having a good way to handle errors is important.</p>
</div>
<div class="sect1">
<h2 id="_status_handlers">Status Handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> annotation supports defining either an exception class or an HTTP status. Methods decorated with the annotation will be invoked as the result of other controller methods. The annotation also supports the notion of global and local, local being the default.</p>
</div>
<div class="paragraph">
<p>Local error handlers will only respond to methods defined in the same controller. Global error handlers can respond to any method in any controller. A local error handler is always searched for first when resolving which handler to execute.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When defining an error handler for an exception, you can specify the exception instance as an argument to the method and omit the exception property of the annotation.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_error_handling">Local Error Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For example the following method will handling JSON parse exceptions from Jackson for the scope of the declaring controller:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error
    public HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException jsonParseException) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Invalid JSON: " + jsonParseException.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, "Fix Your JSON")
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error
    HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException jsonParseException) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Invalid JSON: " + jsonParseException.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, "Fix Your JSON")
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error
    fun jsonError(request: HttpRequest&lt;*&gt;, jsonParseException: JsonParseException): HttpResponse&lt;JsonError&gt; { <b class="conum">(1)</b>
        val error = JsonError("Invalid JSON: " + jsonParseException.message) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.status&lt;JsonError&gt;(HttpStatus.BAD_REQUEST, "Fix Your JSON")
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method that explicitly handles <code>JsonParseException</code> is declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An instance of <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A custom response is returned to handle the error</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error(status = HttpStatus.NOT_FOUND)
    public HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;notFound()
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error(status = HttpStatus.NOT_FOUND)
    HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;notFound()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error(status = HttpStatus.NOT_FOUND)
    fun notFound(request: HttpRequest&lt;*&gt;): HttpResponse&lt;JsonError&gt; { <b class="conum">(1)</b>
        val error = JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.notFound&lt;JsonError&gt;()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> declares which <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> error code to handle (in this case 404)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all 404 responses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#NOT_FOUND">NOT_FOUND</a> response is returned</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_global_error_handling">Global Error Handling</h2>
<div class="sectionbody">
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error(global = true) <b class="conum">(1)</b>
    public HttpResponse&lt;JsonError&gt; error(HttpRequest request, Throwable e) {
        JsonError error = new JsonError("Bad Things Happened: " + e.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;serverError()
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error(global = true) <b class="conum">(1)</b>
    HttpResponse&lt;JsonError&gt; error(HttpRequest request, Throwable e) {
        JsonError error = new JsonError("Bad Things Happened: " + e.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;serverError()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error(global = true) <b class="conum">(1)</b>
    fun error(request: HttpRequest&lt;*&gt;, e: Throwable): HttpResponse&lt;JsonError&gt; {
        val error = JsonError("Bad Things Happened: " + e.message) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.serverError&lt;JsonError&gt;()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> is used to declare the method a global error handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all errors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#INTERNAL_SERVER_ERROR">INTERNAL_SERVER_ERROR</a> response is returned</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error(status = HttpStatus.NOT_FOUND)
    public HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;notFound()
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error(status = HttpStatus.NOT_FOUND)
    HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;notFound()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error(status = HttpStatus.NOT_FOUND)
    fun notFound(request: HttpRequest&lt;*&gt;): HttpResponse&lt;JsonError&gt; { <b class="conum">(1)</b>
        val error = JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.notFound&lt;JsonError&gt;()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> declares which <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> error code to handle (in this case 404)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all 404 responses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#NOT_FOUND">NOT_FOUND</a> response is returned</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A few things to note about the <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> annotation. Two identical <code>@Error</code> annotations that are
global cannot be declared. Two identical <code>@Error</code> annotations that are non-global cannot be declared in the same controller.
If an <code>@Error</code> annotation with the same parameter exists as global and another as a local, the local one will take precedence.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptionhandler">ExceptionHandler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additionally you can implement a <a href="../api/io/micronaut/http/server/exceptions/ExceptionHandler.html">ExceptionHandler</a>; a generic hook for handling exceptions that occurs during the execution of an HTTP request.</p>
</div>
<div class="paragraph">
<p>Imagine your e-commerce app throws an <code>OutOfStockException</code> when a book is out of stock:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class OutOfStockException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class OutOfStockException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class OutOfStockException : RuntimeException()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with <code>BookController</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/books")
public class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    Integer stock(String isbn) {
        throw new OutOfStockException();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/books")
class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    Integer stock(String isbn) {
        throw new OutOfStockException()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/books")
class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    internal fun stock(isbn: String): Int? {
        throw OutOfStockException()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t handle the exception the server returns a 500 (Internal Server Error) status code.</p>
</div>
<div class="paragraph">
<p>If you want to respond 200 OK with 0 (stock level) as the response body when the <code>OutOfStockException</code> is thrown, you could register a <code>ExceptionHandler</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Produces
@Singleton
@Requires(classes = {OutOfStockException.class, ExceptionHandler.class})
public class OutOfStockExceptionHandler implements ExceptionHandler&lt;OutOfStockException, HttpResponse&gt; {

    @Override
    public HttpResponse handle(HttpRequest request, OutOfStockException exception) {
        return HttpResponse.ok(0);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Produces
@Singleton
@Requires(classes = [OutOfStockException.class, ExceptionHandler.class])
class OutOfStockExceptionHandler implements ExceptionHandler&lt;OutOfStockException, HttpResponse&gt; {

    @Override
    HttpResponse handle(HttpRequest request, OutOfStockException exception) {
        HttpResponse.ok(0)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Produces
@Singleton
@Requirements(
        Requires(classes = [OutOfStockException::class, ExceptionHandler::class])
)
class OutOfStockExceptionHandler : ExceptionHandler&lt;OutOfStockException, HttpResponse&lt;*&gt;&gt; {

    override fun handle(request: HttpRequest&lt;*&gt;, exception: OutOfStockException): HttpResponse&lt;*&gt; {
        return HttpResponse.ok(0)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
An <code>@Error</code> annotation capturing an exception has precedence over an implementation of <code>ExceptionHandler</code> capturing the same exception.
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="apiVersioning"><a class="anchor" href="#apiVersioning"></a>6.16 API Versioning</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/apiVersioning.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.1.x, Micronaut supports API versioning via a dedicated <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to version an API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.version.annotation.Version;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/versioned")
class VersionedController {

    @Version("1") <b class="conum">(1)</b>
    @Get("/hello")
    String helloV1() {
        return "helloV1";
    }

    @Version("2") <b class="conum">(2)</b>
    @Get("/hello")
    String helloV2() {
        return "helloV2";
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/versioned")
class VersionedController {

    @Version("1") <b class="conum">(1)</b>
    @Get("/hello")
    String helloV1() {
        "helloV1"
    }

    @Version("2") <b class="conum">(2)</b>
    @Get("/hello")
    String helloV2() {
        "helloV2"
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get


@Controller("/versioned")
internal class VersionedController {

    @Version("1") <b class="conum">(1)</b>
    @Get("/hello")
    fun helloV1(): String {
        return "helloV1"
    }

    @Version("2") <b class="conum">(2)</b>
    @Get("/hello")
    fun helloV2(): String {
        return "helloV2"
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>helloV1</code> method is declared as version <code>1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>helloV2</code> method is declared as version <code>2</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should then enabling versioning by setting <code>micronaut.router.versioning.enabled</code> to <code>true</code> in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    router:
        versioning:
            enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut has 2 out-of-the-box strategies for resolving the version that are based on an HTTP header named <code>X-API-VERSION</code> or a request parameter named <code>api-version</code>, however this is configurable. A full configuration example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    router:
        versioning:
            enabled: true <i class="conum" data-value="1"></i><b>(1)</b>
            parameter:
                enabled: false <i class="conum" data-value="2"></i><b>(2)</b>
                names: 'v,api-version' <i class="conum" data-value="3"></i><b>(3)</b>
            header:
                enabled: true <i class="conum" data-value="4"></i><b>(4)</b>
                names: <i class="conum" data-value="5"></i><b>(5)</b>
                    - 'X-API-VERSION'
                    - 'Accept-Version'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables versioning</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enables or disables parameter based versioning</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the parameter names as a comma separated list</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enables or disables header based versioning</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify the header names as a YAML list</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If this is not enough you can also implement the <a href="../api/io/micronaut/web/router/version/resolution/RequestVersionResolver.html">RequestVersionResolver</a> interface which receives the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and can implement any strategy you choose.</p>
</div>
<div class="sect2">
<h3 id="_default_version">Default Version</h3>
<div class="paragraph">
<p>It is possible to supply a default version through configuration.</p>
</div>
<div class="listingblock">
<div class="title">Configuring Default Version</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    router:
        versioning:
            enabled: true
            default-version: 3 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the default version</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A route will <strong>not</strong> be matched if the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default version is configured</p>
</li>
<li>
<p>No version is found in the request</p>
</li>
<li>
<p>The route defines a version</p>
</li>
<li>
<p>The route version does not match the default version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the incoming request specifies a version then the default version has no effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="_versioning_client_requests">Versioning Client Requests</h3>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="#clientAnnotation">Declarative HTTP client</a> also supports automatic versioning of outgoing requests via the <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> annotation.</p>
</div>
<div class="paragraph">
<p>By default if you annotate a client interface with <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> the value supplied to the annotation will be included using the <code>X-API-VERSION</code> header.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.version.annotation.Version;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Single;

@Client("/hello")
@Version("1") <b class="conum">(1)</b>
public interface HelloClient {

    @Get("/greeting/{name}")
    String sayHello(String name);

    @Version("2")
    @Get("/greeting/{name}")
    Single&lt;String&gt; sayHelloTwo(String name); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Single


@Client("/hello")
@Version("1") <b class="conum">(1)</b>
interface HelloClient {

    @Get("/greeting/{name}")
    String sayHello(String name)

    @Version("2")
    @Get("/greeting/{name}")
    Single&lt;String&gt; sayHelloTwo(String name) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Single

@Client("/hello")
@Version("1") <b class="conum">(1)</b>
interface HelloClient {

    @Get("/greeting/{name}")
    fun sayHello(name : String) : String

    @Version("2")
    @Get("/greeting/{name}")
    fun sayHelloTwo(name : String) : Single&lt;String&gt;  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> can be used as the type level to specify the version to use for all methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When defined at the method level it is used only for that method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default behaviour for how the version is sent for each call can be configured with <a href="../api/io/micronaut/http/client/interceptor/configuration/DefaultClientVersioningConfiguration.html">DefaultClientVersioningConfiguration</a>:</p>
</div>
<a id="io.micronaut.http.client.interceptor.configuration.DefaultClientVersioningConfiguration" href="#io.micronaut.http.client.interceptor.configuration.DefaultClientVersioningConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/client/interceptor/configuration/DefaultClientVersioningConfiguration.html">DefaultClientVersioningConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.http.client.versioning.default.headers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of request header names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.http.client.versioning.default.parameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of request query parameter names.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example to use <code>Accept-Version</code> as the header name:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Client Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            versioning:
                default:
                    headers:
                        - 'Accept-Version'
                        - 'X-API-VERSION'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>default</code> key is used to refer to the default configuration. You can specify client specific configuration by using the value passed to <code>@Client</code> (typically the service ID). For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            versioning:
                greeting-service:
                    headers:
                        - 'Accept-Version'
                        - 'X-API-VERSION'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above uses a key called <code>greeting-service</code> which can be used to configure a client annotated with <code>@Client('greeting-service')</code>.</p>
</div>
</div>

<h2 id="formData"><a class="anchor" href="#formData"></a>6.17 Handling Form Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/formData.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In order to make data binding model customizations consistent between form data and JSON, Micronaut uses Jackson to implement binding data from form submissions.</p>
</div>
<div class="paragraph">
<p>The advantage of this approach is that the same Jackson annotations used for customizing JSON binding can be used for form submissions too.</p>
</div>
<div class="paragraph">
<p>What this means in practise is that in order to bind regular form data the only change required to the previous JSON binding code is updating the <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> consumed:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post
    public HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person);
        return HttpResponse.created(person);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post
    HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person)
        HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post
    fun save(@Body person: Person): HttpResponse&lt;Person&gt; {
        inMemoryDatastore[person.firstName] = person
        return HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To avoid denial of service attacks, collection types and arrays created during binding are limited by the setting <code>jackson.arraySizeThreshold</code> in <code>application.yml</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, instead of using a POJO you can bind form data directly to method parameters (which works with JSON too!):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post("/saveWithArgs")
    public HttpResponse&lt;Person&gt; save(String firstName, String lastName, Optional&lt;Integer&gt; age) {
        Person p = new Person(firstName, lastName);
        age.ifPresent(p::setAge);
        inMemoryDatastore.put(p.getFirstName(), p);
        return HttpResponse.created(p);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post("/saveWithArgs")
    HttpResponse&lt;Person&gt; save(String firstName, String lastName, Optional&lt;Integer&gt; age) {
        Person p = new Person(firstName, lastName)
        age.ifPresent({ a -&gt; p.setAge(a)})
        inMemoryDatastore.put(p.getFirstName(), p)
        HttpResponse.created(p)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post("/saveWithArgs")
    fun save(firstName: String, lastName: String, age: Optional&lt;Int&gt;): HttpResponse&lt;Person&gt; {
        val p = Person(firstName, lastName)
        age.ifPresent { p.age = it }
        inMemoryDatastore[p.firstName] = p
        return HttpResponse.created(p)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example above, this approach allows you to use features such as support for <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a> types and restrict the parameters to be bound (When using POJOs you must be careful to use Jackson annotations to exclude properties that should not be bound).</p>
</div>

<h2 id="serverIO"><a class="anchor" href="#serverIO"></a>6.18 Writing Response Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverIO.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_reactively_writing_response_data">Reactively Writing Response Data</h3>
<div class="paragraph">
<p>Micronaut&#8217;s HTTP server supports writing chunks of response data by returning a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> the emits objects that can be encoded to the HTTP response.</p>
</div>
<div class="paragraph">
<p>The following table summarizes example return type signatures and the behaviour the server exhibits to handle each of them:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;byte[]&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> that emits each chunk of content as a <code>byte[]</code> without blocking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;ByteBuf&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Reactor <code>Flux</code> that emits each chunk as a Netty <code>ByteBuf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Publisher&lt;String&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits each chunk of content as a String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When emitting a POJO each emitted object is encoded as JSON by default without blocking</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When returning reactive type the server will use a <code>Transfer-Encoding</code> of <code>chunked</code> and keep writing data until the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>'s <code>onComplete</code> method is called.</p>
</div>
<div class="paragraph">
<p>The server will request a single item from the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>, write the item and then request the next item, controlling back pressure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is up to the implementation of the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> to schedule any blocking I/O work that may be done as a result of subscribing to the publisher.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_performing_blocking_i_o">Performing Blocking I/O</h3>
<div class="paragraph">
<p>In some cases you may wish to integrate with a library that does not support non-blocking I/O.</p>
</div>
<div class="paragraph">
<p>In this case you can return a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> object from any controller method. The <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> has various signatures that allowing writing to traditional blocking streams like <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Writer.html">Writer</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html">OutputStream</a>.</p>
</div>
<div class="paragraph">
<p>When returning a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> object the blocking I/O operation will be shifted to the I/O thread pool so that the Netty event loop is not blocked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the section on configuring <a href="#threadPools">Server Thread Pools</a> for details on how to configure the I/O thread pool to meet the requirements of your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example demonstrates how to use this API with Groovy&#8217;s <code>SimpleTemplateEngine</code> to write a server side template:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import groovy.text.SimpleTemplateEngine;
import groovy.text.Template;
import io.micronaut.core.io.Writable;
import io.micronaut.core.util.CollectionUtils;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.server.exceptions.HttpServerException;

@Controller("/template")
public class TemplateController {

    private final SimpleTemplateEngine templateEngine = new SimpleTemplateEngine();
    private final Template template;

    public TemplateController() {
        template = initTemplate(); <b class="conum">(1)</b>
    }

    @Get(value = "/welcome", produces = MediaType.TEXT_PLAIN)
    Writable render() { <b class="conum">(2)</b>
        return writer -&gt; template.make( <b class="conum">(3)</b>
            CollectionUtils.mapOf(
                    "firstName", "Fred",
                    "lastName", "Flintstone"
            )
        ).writeTo(writer);
    }

    private Template initTemplate() {
        Template template;
        try {
            template = templateEngine.createTemplate(
                    "Dear $firstName $lastName. Nice to meet you."
            );
        } catch (Exception e) {
            throw new HttpServerException("Cannot create template");
        }
        return template;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import groovy.text.SimpleTemplateEngine;
import groovy.text.Template;
import io.micronaut.core.io.Writable;
import io.micronaut.core.util.CollectionUtils;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.server.exceptions.HttpServerException;

@Controller("/template")
class TemplateController {

    private final SimpleTemplateEngine templateEngine = new SimpleTemplateEngine()
    private final Template template

    TemplateController() {
        template = initTemplate() <b class="conum">(1)</b>
    }

    @Get(value = "/welcome", produces = MediaType.TEXT_PLAIN)
    Writable render() { <b class="conum">(2)</b>
        { writer -&gt;
            template.make( <b class="conum">(3)</b>
                    CollectionUtils.mapOf(
                            "firstName", "Fred",
                            "lastName", "Flintstone"
                    )
            ).writeTo(writer)
        }
    }

    private Template initTemplate() {
        Template template
        try {
            template = templateEngine.createTemplate(
                    'Dear $firstName $lastName. Nice to meet you.'
            )
        } catch (Exception e) {
            throw new HttpServerException("Cannot create template")
        }
        template
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import groovy.text.SimpleTemplateEngine
import groovy.text.Template
import io.micronaut.core.io.Writable
import io.micronaut.core.util.CollectionUtils
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.server.exceptions.HttpServerException
import java.io.Writer


@Controller("/template")
class TemplateController {

    private val templateEngine = SimpleTemplateEngine()
    private val template: Template

    init {
        template = initTemplate() <b class="conum">(1)</b>
    }

    @Get(value = "/welcome", produces = [MediaType.TEXT_PLAIN])
    internal fun render(): Writable { <b class="conum">(2)</b>
        return { writer: Writer -&gt;
            val writable = template.make( <b class="conum">(3)</b>
                    CollectionUtils.mapOf(
                            "firstName", "Fred",
                            "lastName", "Flintstone"
                    )
            )
            writable.writeTo(writer)
        } as Writable
    }

    private fun initTemplate(): Template {
        val template: Template
        try {
            template = templateEngine.createTemplate(
                    "Dear \$firstName \$lastName. Nice to meet you."
            )
        } catch (e: Exception) {
            throw HttpServerException("Cannot create template")
        }

        return template
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller creates a simple template</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The controller method returns a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The returned function receives a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Writer.html">Writer</a> and calls <code>writeTo</code> on the template.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_404_responses">404 Responses</h3>
<div class="paragraph">
<p>Often, you want to respond 404 (Not Found) when you don&#8217;t find an item in your persistence layer or in similar scenarios.</p>
</div>
<div class="paragraph">
<p>See the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/books")
public class BooksController {

    @Get("/stock/{isbn}")
    public Map stock(String isbn) {
        return null; <b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    public Maybe&lt;Map&gt; maybestock(String isbn) {
        return Maybe.empty(); <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/books")
class BooksController {

    @Get("/stock/{isbn}")
    Map stock(String isbn) {
        null <b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    Maybe&lt;Map&gt; maybestock(String isbn) {
        Maybe.empty() <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/books")
class BooksController {

    @Get("/stock/{isbn}")
    fun stock(isbn: String): Map&lt;*, *&gt;? {
        return null <b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    fun maybestock(isbn: String): Maybe&lt;Map&lt;*, *&gt;&gt; {
        return Maybe.empty() <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Returning <code>null</code> triggers a 404 (Not Found) response.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returning an empty <code>Maybe</code> triggers a 404 (Not Found) response.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Responding with an empty <code>Publisher</code> or <code>Flowable</code> will result in an empty array being returned if the content type is JSON.
</td>
</tr>
</table>
</div>
</div>

<h2 id="uploads"><a class="anchor" href="#uploads"></a>6.19 File Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/uploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Handling of file uploads has special treatment in Micronaut. Support is provided for streaming of uploads in a non-blocking manner through streaming uploads or completed uploads.</p>
</div>
<div class="paragraph">
<p>To receive data from a multipart request, set the <code>consumes</code> argument of the method annotation to <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post(consumes = MediaType.MULTIPART_FORM_DATA)
HttpResponse upload( ... )</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_route_arguments">Route Arguments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How the files are received by your method is determined by the type of the arguments. Data can be received a chunk at a time or when an upload is completed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the route argument name can&#8217;t or shouldn&#8217;t match the name of the part in the request, simply add the <a href="../api/io/micronaut/http/annotation/Part.html">@Part</a> annotation to the argument and specify the name that is expected to be in the request.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_chunk_data_types">Chunk Data Types</h3>
<div class="paragraph">
<p><a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> is the data type used to represent a chunk of data received in a multipart request. There are methods on the <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> interface to convert the data to a <code>byte[]</code>, <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html">InputStream</a>, or a <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html">ByteBuffer</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Data can only be retrieved from a <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> once. The underlying buffer will be released which causes further attempts to fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Route arguments of type <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher&lt;PartData&gt;</a> will be treated as only intended to receive a single file and each chunk of the received file will be sent downstream. If the generic type is something other than <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a>, conversion will be attempted using Micronaut&#8217;s conversion service. Conversions to <code>String</code> and <code>byte[]</code> are supported by default.</p>
</div>
<div class="paragraph">
<p>If requirements dictate you must have knowledge about the metadata of the file being received, a special class called <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a> has been created that is a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher&lt;PartData&gt;</a>, but also has file information like the content type and file name.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.HttpStatus;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.StreamingFileUpload;
import io.reactivex.Single;
import java.io.File;
import org.reactivestreams.Publisher;
import java.io.IOException;

@Controller("/upload")
public class UploadController {

    @Post(value = "/", consumes = MediaType.MULTIPART_FORM_DATA, produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    public Single&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { <b class="conum">(2)</b>
        File tempFile;
        try {
            tempFile = File.createTempFile(file.getFilename(), "temp");
        } catch (IOException e) {
            return Single.error(e);
        }
        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile); <b class="conum">(3)</b>
        return Single.fromPublisher(uploadPublisher)  <b class="conum">(4)</b>
            .map(success -&gt; {
                if (success) {
                    return HttpResponse.ok("Uploaded");
                } else {
                    return HttpResponse.&lt;String&gt;status(HttpStatus.CONFLICT)
                                       .body("Upload Failed");
                }
            });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import io.reactivex.Single
import org.reactivestreams.Publisher

@Controller("/upload")
class UploadController {

    @Post(value = "/", consumes = MediaType.MULTIPART_FORM_DATA, produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    Single&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { <b class="conum">(2)</b>
        File tempFile = File.createTempFile(file.filename, "temp")
        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile) <b class="conum">(3)</b>
        Single.fromPublisher(uploadPublisher)  <b class="conum">(4)</b>
            .map({ success -&gt;
                if (success) {
                    HttpResponse.ok("Uploaded")
                } else {
                    HttpResponse.&lt;String&gt;status(HttpStatus.CONFLICT)
                            .body("Upload Failed")
                }
            })
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import io.reactivex.Single
import java.io.File

@Controller("/upload")
class UploadController {

    @Post(value = "/", consumes = [MediaType.MULTIPART_FORM_DATA], produces = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    fun upload(file: StreamingFileUpload): Single&lt;HttpResponse&lt;String&gt;&gt; { <b class="conum">(2)</b>
        val tempFile = File.createTempFile(file.filename, "temp")
        val uploadPublisher = file.transferTo(tempFile) <b class="conum">(3)</b>
        return Single.fromPublisher(uploadPublisher)  <b class="conum">(4)</b>
                .map { success -&gt;
                    if (success) {
                        HttpResponse.ok("Uploaded")
                    } else {
                        HttpResponse.status&lt;String&gt;(HttpStatus.CONFLICT)
                                .body("Upload Failed")
                    }
                }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is set to consume <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html#transferTo-java.lang.String-">StreamingFileUpload.transferTo(java.lang.String)</a> method is used to transfer the file to the server. The method returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The returned <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> subscribes to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and outputs a response once the upload is complete, without blocking.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_whole_data_types">Whole Data Types</h3>
<div class="paragraph">
<p>Route arguments that are not publishers will cause the route execution to be delayed until the upload has finished. The received data will attempt to be converted to the requested type. Conversions to a <code>String</code> or <code>byte[]</code> are supported by default. In addition, the file can be converted to a POJO if a media type codec has been registered that supports the media type of the file. A media type codec is included by default that allows conversion of JSON files to POJOs.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

@Controller("/upload")
public class BytesUploadController {

    @Post(value = "/bytes",
            consumes = MediaType.MULTIPART_FORM_DATA,
            produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; uploadBytes(byte[] file, String fileName) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(fileName, "temp");
            Path path = Paths.get(tempFile.getAbsolutePath());
            Files.write(path, file); <b class="conum">(3)</b>
            return HttpResponse.ok("Uploaded");
        } catch (IOException exception) {
            return HttpResponse.badRequest("Upload Failed");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class BytesUploadController {

    @Post(value = "/bytes",
            consumes = MediaType.MULTIPART_FORM_DATA,
            produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; uploadBytes(byte[] file, String fileName) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(fileName, "temp")
            Path path = Paths.get(tempFile.absolutePath)
            Files.write(path, file) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (IOException exception) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

import java.io.File
import java.io.IOException
import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class BytesUploadController {

    @Post(value = "/bytes",
            consumes = [MediaType.MULTIPART_FORM_DATA],
            produces = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    fun uploadBytes(file: ByteArray, fileName: String): HttpResponse&lt;String&gt; { <b class="conum">(2)</b>
        return try {
            val tempFile = File.createTempFile(fileName, "temp")
            val path = Paths.get(tempFile.absolutePath)
            Files.write(path, file) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (exception: IOException) {
            HttpResponse.badRequest("Upload Failed")
        }

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If requirements dictate you must have knowledge about the metadata of the file being received, a special class called <a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a> has been created that has methods to retrieve the data of the file, but also has file information like the content type and file name.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.CompletedFileUpload;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

@Controller("/upload")
public class CompletedUploadController {

    @Post(value = "/completed",
            consumes = MediaType.MULTIPART_FORM_DATA,
            produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; uploadCompleted(CompletedFileUpload file) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(file.getFilename(), "temp"); <b class="conum">(3)</b>
            Path path = Paths.get(tempFile.getAbsolutePath());
            Files.write(path, file.getBytes()); <b class="conum">(3)</b>
            return HttpResponse.ok("Uploaded");
        } catch (IOException exception) {
            return HttpResponse.badRequest("Upload Failed");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload

import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class CompletedUploadController {

    @Post(value = "/completed",
            consumes = MediaType.MULTIPART_FORM_DATA,
            produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; uploadCompleted(CompletedFileUpload file) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(file.filename, "temp") <b class="conum">(3)</b>
            Path path = Paths.get(tempFile.absolutePath)
            Files.write(path, file.bytes) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (IOException exception) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload

import java.io.File
import java.io.IOException
import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class CompletedUploadController {

    @Post(value = "/completed",
            consumes = [MediaType.MULTIPART_FORM_DATA],
            produces = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    fun uploadCompleted(file: CompletedFileUpload): HttpResponse&lt;String&gt; { <b class="conum">(2)</b>
        return try {
            val tempFile = File.createTempFile(file.filename, "temp") <b class="conum">(3)</b>
            val path = Paths.get(tempFile.absolutePath)
            Files.write(path, file.bytes) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (exception: IOException) {
            HttpResponse.badRequest("Upload Failed")
        }

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is set to consume <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>CompletedFileUpload</code> instance gives access to metadata about the upload as well as access to the file&#8217;s contents.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_uploads">Multiple Uploads</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_different_names">Different Names</h3>
<div class="paragraph">
<p>If a multipart request supplies multiple uploads that each have a different part name, simply create an argument to your route that receives each part. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpResponse upload(String title, String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A route method signature like the above will expect 2 different parts with the names "title" and "name".</p>
</div>
</div>
<div class="sect2">
<h3 id="_same_name">Same Name</h3>
<div class="paragraph">
<p>To handle receiving multiple parts with the same part name, the argument must be a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>. When used in one of the following ways, the publisher will emit one item per file found with the specified name. The publisher must accept one of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a></p>
</li>
<li>
<p>Any POJO assuming a media codec is found that supports the content type</p>
</li>
<li>
<p>Another <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that accepts one of the chunked data types described above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpResponse upload(Publisher&lt;StreamingFileUpload&gt; files)
HttpResponse upload(Publisher&lt;CompletedFileUpload&gt; files)
HttpResponse upload(Publisher&lt;MyObject&gt; files)
HttpResponse upload(Publisher&lt;Publisher&lt;PartData&gt;&gt; files)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whole_body_binding">Whole Body Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the cases where the names of the parts of the request cannot be known ahead of time, or the entire body should be read, a special type can be used to indicate the entire body is desired.</p>
</div>
<div class="paragraph">
<p>If a route has an argument of type <a href="../api/io/micronaut/http/server/multipart/MultipartBody.html">MultipartBody</a> (not to be confused with the class for the client) annotated with <a href="../api/io/micronaut/http/annotation/Body.html">@Body</a>, then each part of the request will be emitted through the argument. A <a href="../api/io/micronaut/http/server/multipart/MultipartBody.html">MultipartBody</a> is a publisher of <a href="../api/io/micronaut/http/multipart/CompletedPart.html">CompletedPart</a> instances.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.CompletedFileUpload;
import io.micronaut.http.multipart.CompletedPart;
import io.micronaut.http.server.multipart.MultipartBody;
import io.reactivex.Single;
import org.reactivestreams.Subscriber;
import org.reactivestreams.Subscription;

@Controller("/upload")
public class WholeBodyUploadController {

    @Post(value = "/whole-body",
            consumes = MediaType.MULTIPART_FORM_DATA,
            produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    public Single&lt;String&gt; uploadBytes(@Body MultipartBody body) { <b class="conum">(2)</b>
        return Single.create(emitter -&gt; {
            body.subscribe(new Subscriber&lt;CompletedPart&gt;() {
                private Subscription s;

                @Override
                public void onSubscribe(Subscription s) {
                    this.s = s;
                    s.request(1);
                }

                @Override
                public void onNext(CompletedPart completedPart) {
                    String partName = completedPart.getName();
                    if (completedPart instanceof CompletedFileUpload) {
                        String originalFileName = ((CompletedFileUpload) completedPart).getFilename();
                    }
                }

                @Override
                public void onError(Throwable t) {
                    emitter.onError(t);
                }

                @Override
                public void onComplete() {
                    emitter.onSuccess("Uploaded");
                }
            });
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.CompletedPart
import io.micronaut.http.server.multipart.MultipartBody
import io.reactivex.Single
import org.reactivestreams.Subscriber
import org.reactivestreams.Subscription

@Controller("/upload")
class WholeBodyUploadController {

    @Post(value = "/whole-body",
            consumes = MediaType.MULTIPART_FORM_DATA,
            produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    Single&lt;String&gt; uploadBytes(@Body MultipartBody body) { <b class="conum">(2)</b>
        Single.&lt;String&gt;create({ emitter -&gt;
            body.subscribe(new Subscriber&lt;CompletedPart&gt;() {
                private Subscription s

                @Override
                void onSubscribe(Subscription s) {
                    this.s = s
                    s.request(1)
                }

                @Override
                void onNext(CompletedPart completedPart) {
                    String partName = completedPart.name
                    if (completedPart instanceof CompletedFileUpload) {
                        String originalFileName = ((CompletedFileUpload) completedPart).filename
                    }
                }

                @Override
                void onError(Throwable t) {
                    emitter.onError(t)
                }

                @Override
                void onComplete() {
                    emitter.onSuccess("Uploaded")
                }
            })
        })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.CompletedPart
import io.micronaut.http.server.multipart.MultipartBody
import io.reactivex.Single
import org.reactivestreams.Subscriber
import org.reactivestreams.Subscription

@Controller("/upload")
class WholeBodyUploadController {

    @Post(value = "/whole-body",
            consumes = [MediaType.MULTIPART_FORM_DATA],
            produces = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    fun uploadBytes(@Body body: MultipartBody): Single&lt;String&gt; { <b class="conum">(2)</b>
        return Single.create { emitter -&gt;
            body.subscribe(object : Subscriber&lt;CompletedPart&gt; {
                private var s: Subscription? = null

                override fun onSubscribe(s: Subscription) {
                    this.s = s
                    s.request(1)
                }

                override fun onNext(completedPart: CompletedPart) {
                    val partName = completedPart.name
                    if (completedPart is CompletedFileUpload) {
                        val originalFileName = completedPart.filename
                    }
                }

                override fun onError(t: Throwable) {
                    emitter.onError(t)
                }

                override fun onComplete() {
                    emitter.onSuccess("Uploaded")
                }
            })
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="transfers"><a class="anchor" href="#transfers"></a>6.20 File Transfers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/transfers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports the sending of files to the client in a couple of easy ways.</p>
</div>
<div class="sect1">
<h2 id="_sending_file_objects">Sending File Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to simply return a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a> object from your controller method and the data will be returned to the client. The <code>Content-Type</code> header of file responses will be calculated based on the name of the file.</p>
</div>
<div class="paragraph">
<p>To control either the media type of the file being sent, or to set the file to be downloaded (i.e. using the <code>Content-Disposition</code> header) you should instead construct an <a href="../api/io/micronaut/http/server/types/files/SystemFile.html">SystemFile</a> with the file object you would like to be used. For example:</p>
</div>
<div class="listingblock">
<div class="title">Sending a SystemFile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get
public SystemFile download() {
    File file = ...
    return new SystemFile(file).attach("myfile.txt");
    // or new SystemFile(file, MediaType.TEXT_HTML_TYPE)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_an_inputstream">Sending an InputStream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For cases where a reference to a <code>File</code> object is not possible (for example resources contained within JAR files), Micronaut supports transferring of input streams. To return a stream of data from the controller method, construct a <a href="../api/io/micronaut/http/server/types/files/StreamedFile.html">StreamedFile</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The constructor for <code>StreamedFile</code> also accepts a <code>java.net.URL</code> for your convenience.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Sending a StreamedFile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get
public StreamedFile download() {
    InputStream inputStream = ...
    return new StreamedFile(inputStream, MediaType.TEXT_PLAIN_TYPE)
    // An attach(String filename) method is also available to set the Content-Disposition
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server supports returning <code>304</code> (Not Modified) responses if the files being transferred have not changed and the request contains the appropriate header. In addition, if the client accepts encoded responses, Micronaut will encode the file if it is deemed appropriate. Encoding will happen if the file is text based and greater than 1KB by default. The threshold at which data will be encoded is configurable. See the server configuration reference for details.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To use a custom data source to send data through an input stream, construct a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/PipedInputStream.html">PipedInputStream</a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/io/PipedOutputStream.html">PipedOutputStream</a> to allow writing data from the output stream to the input. Make sure to do the work on a separate thread so the file can be returned immediately.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cache_configuration">Cache Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default file responses will include caching headers. The following options determine how the <code>Cache-Control</code> header is built.</p>
</div>
<a id="io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration" href="#io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/types/files/FileTypeHandlerConfiguration.html">FileTypeHandlerConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netty.responses.file.cache-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache Seconds. Default value (60).</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration$CacheControlConfiguration" href="#io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration$CacheControlConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/types/files/FileTypeHandlerConfiguration.CacheControlConfiguration.html">FileTypeHandlerConfiguration$CacheControlConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netty.responses.file.cache-control.public</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the cache control is public. Default value (false)</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<h2 id="filters"><a class="anchor" href="#filters"></a>6.21 HTTP Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/filters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports the ability to apply filters to request/response processing in a similar, but reactive, way to Servlet filters in traditional Java applications.</p>
</div>
<div class="paragraph">
<p>Filters provide the ability to support the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decoration of the incoming <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p>
</li>
<li>
<p>Modification of the outgoing <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p>
</li>
<li>
<p>Implementation of cross cutting concerns such as security, tracing etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a server application, the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface&#8217;s <code>doFilter</code> method can be implemented.</p>
</div>
<div class="paragraph">
<p>The <code>doFilter</code> method accepts the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and an instance of <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a>.</p>
</div>
<div class="paragraph">
<p>The <code>ServerFilterChain</code> interface contains a resolved chain of filters with the final entry in the chain being the matched route. The <a href="../api/io/micronaut/http/filter/ServerFilterChain.html#proceed-io.micronaut.http.HttpRequest-">ServerFilterChain.proceed(io.micronaut.http.HttpRequest)</a> method can be used to resume processing of the request.</p>
</div>
<div class="paragraph">
<p>The <code>proceed(..)</code> method returns a Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits the response that will be returned to the client. Implementors of filters can subscribe to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and mutate the emitted <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> object to modify the response prior to returning the response to the client.</p>
</div>
<div class="paragraph">
<p>To put these concepts into practise lets look at an example.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Filters execute in the event loop therefore blocking operations must be offloaded to another thread pool.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_writing_a_filter">Writing a Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider a hypothetical use case whereby you wish to trace each request to the Micronaut "Hello World" example using some external system. The external system could be a database, a distributed tracing service and may require I/O operations.</p>
</div>
<div class="paragraph">
<p>What you don&#8217;t want to do is block the underlying Netty event loop within your filter, instead you want the filter to proceed with execution once any I/O is complete.</p>
</div>
<div class="paragraph">
<p>As an example, consider the following example <code>TraceService</code> that uses RxJava to compose an I/O operation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using RxJava</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpRequest;
import io.reactivex.Flowable;
import io.reactivex.schedulers.Schedulers;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.inject.Singleton;

@Singleton
public class TraceService {

    private static final Logger LOG = LoggerFactory.getLogger(TraceService.class);

    Flowable&lt;Boolean&gt; trace(HttpRequest&lt;?&gt; request) {
        return Flowable.fromCallable(() -&gt; { <b class="conum">(1)</b>
            if (LOG.isDebugEnabled()) {
                LOG.debug("Tracing request: " + request.getUri());
            }
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            return true;
        }).subscribeOn(Schedulers.io()); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using RxJava</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.reactivex.Flowable
import io.reactivex.schedulers.Schedulers
import org.slf4j.Logger
import org.slf4j.LoggerFactory

import javax.inject.Singleton

@Singleton
class TraceService {

    private static final Logger LOG = LoggerFactory.getLogger(TraceService.class)

    Flowable&lt;Boolean&gt; trace(HttpRequest&lt;?&gt; request) {
        Flowable.fromCallable({ -&gt;  <b class="conum">(1)</b>
            if (LOG.isDebugEnabled()) {
                LOG.debug("Tracing request: " + request.getUri())
            }
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            return true
        }).subscribeOn(Schedulers.io()) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using RxJava</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.reactivex.Flowable
import io.reactivex.schedulers.Schedulers
import org.slf4j.LoggerFactory

import javax.inject.Singleton


@Singleton
class TraceService {

    private val LOG = LoggerFactory.getLogger(TraceService::class.java)

    internal fun trace(request: HttpRequest&lt;*&gt;): Flowable&lt;Boolean&gt; {
        return Flowable.fromCallable {
            <b class="conum">(1)</b>
            if (LOG.isDebugEnabled) {
                LOG.debug("Tracing request: " + request.uri)
            }
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            true
        }.subscribeOn(Schedulers.io()) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> type is used to create logic that executes potentially blocking operations to write the trace data from the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since this is just an example the logic does nothing and a place holder comment is used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The RxJava I/O scheduler is used to execute the logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then inject this implementation into your filter definition:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.*;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.filter.*;
import org.reactivestreams.Publisher;

@Filter("/hello/**") <b class="conum">(1)</b>
public class TraceFilter implements HttpServerFilter { <b class="conum">(2)</b>
    private final TraceService traceService;

    public TraceFilter(TraceService traceService) { <b class="conum">(3)</b>
        this.traceService = traceService;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher

@Filter("/hello/**") <b class="conum">(1)</b>
class TraceFilter implements HttpServerFilter { <b class="conum">(2)</b>
    private final TraceService traceService

    TraceFilter(TraceService traceService) { <b class="conum">(3)</b>
        this.traceService = traceService
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher


@Filter("/hello/**") <b class="conum">(1)</b>
class TraceFilter(<b class="conum">(2)</b>
        private val traceService: TraceService)<b class="conum">(3)</b>
    : HttpServerFilter {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Filter.html">Filter</a> annotation is used to define the URI patterns the filter matches</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class implements the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The previously defined <code>TraceService</code> is injected via a constructor argument</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The final step is write the <code>doFilter</code> implementation of the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Override
    public Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        return traceService.trace(request) <b class="conum">(1)</b>
                           .switchMap(aBoolean -&gt; chain.proceed(request)) <b class="conum">(2)</b>
                           .doOnNext(res -&gt; <b class="conum">(3)</b>
                                res.getHeaders().add("X-Trace-Enabled", "true")
                           );
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Override
    Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        traceService.trace(request) <b class="conum">(1)</b>
                           .switchMap({ aBoolean -&gt; chain.proceed(request) }) <b class="conum">(2)</b>
                           .doOnNext({ res -&gt; <b class="conum">(3)</b>
                               res.getHeaders().add("X-Trace-Enabled", "true")
                           })
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    override fun doFilter(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
        return traceService.trace(request) <b class="conum">(1)</b>
                .switchMap { aBoolean -&gt; chain.proceed(request) } <b class="conum">(2)</b>
                .doOnNext { res -&gt;
                    <b class="conum">(3)</b>
                    res.headers.add("X-Trace-Enabled", "true")
                }
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The previously defined <code>TraceService</code> is called to trace the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the trace call succeeds then the filter switches back to resuming the request processing using RxJava&#8217;s <code>switchMap</code> method, which invokes the <code>proceed</code> method of the <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finally, RxJava&#8217;s <code>doOnNext</code> method is used to add a header called <code>X-Trace-Enabled</code> to the response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous example demonstrates some key concepts such as executing logic in a non-blocking matter before proceeding with the request and modifying the outgoing response.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The examples use RxJava, however you can use any reactive framework that supports the Reactive streams specifications
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="sessions"><a class="anchor" href="#sessions"></a>6.22 HTTP Sessions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/sessions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default Micronaut is a stateless HTTP server, however depending on your application requirements you may need the notion of HTTP sessions.</p>
</div>
<div class="paragraph">
<p>Micronaut comes with a <code>session</code> module inspired by <a href="https://projects.spring.io/spring-session/">Spring Session</a> that enables this that currently features two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In-Memory sessions - which you should combine with an a sticky sessions proxy if you plan to run multiple instances.</p>
</li>
<li>
<p>Redis sessions - In this case <a href="https://redis.io">Redis</a> is used to store sessions and non-blocking I/O is used to read/write sessions to Redis.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_enabling_sessions">Enabling Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable support for in-memory sessions you just need the <code>session</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-session")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-session&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="sect2">
<h3 id="_redis_sessions">Redis Sessions</h3>
<div class="paragraph">
<p>If you wish to store <a href="../api/io/micronaut/session/Session.html">Session</a> instances in Redis you can do so with the <a href="https://micronaut-projects.github.io/micronaut-redis/latest/guide/#sessions">Micronaut Redis</a> module which includes detailed instructions.</p>
</div>
<div class="paragraph">
<p>To quickly get up and running with Redis sessions you must also have the <code>redis-lettuce</code> configuration on your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut:micronaut-session"
compile "io.micronaut.redis:micronaut-redis-lettuce"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And enable Redis sessions via configuration in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Redis Sessions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">redis:
    uri: redis://localhost:6379
micronaut:
    session:
        http:
            redis:
                enabled: true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_session_resolution">Configuring Session Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How the <a href="../api/io/micronaut/session/Session.html">Session</a> is resolved can be configured with <a href="../api/io/micronaut/session/http/HttpSessionConfiguration.html">HttpSessionConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>By default sessions are resolved using an <a href="../api/io/micronaut/session/http/HttpSessionFilter.html">HttpSessionFilter</a> that looks up session identifiers via either an HTTP header (using the <code>Authorization-Info</code> or <code>X-Auth-Token</code> header values) or via a Cookie called <code>SESSION</code>.</p>
</div>
<div class="paragraph">
<p>If you wish to disable either header resolution or cookie resolution you can via configuration in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Disabling Cookie Resolution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    session:
        http:
            cookie: false
            header: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration enables header resolution, but disables cookie resolution. You can also configure the header or cookie names as necessary.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_sessions">Working with Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="../api/io/micronaut/session/Session.html">Session</a> object can be retrieved simply by declaring the <a href="../api/io/micronaut/session/Session.html">Session</a> in a controller method signature. For example consider the following controller:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.session.Session;
import io.micronaut.session.annotation.SessionValue;

import edu.umd.cs.findbugs.annotations.Nullable;
import javax.validation.constraints.NotBlank;

@Controller("/shopping")
public class ShoppingController {
    private static final String ATTR_CART = "cart"; <b class="conum">(1)</b>

    @Post("/cart/{name}")
    Cart addItem(Session session, @NotBlank String name) { <b class="conum">(2)</b>
        Cart cart = session.get(ATTR_CART, Cart.class).orElseGet(() -&gt; { <b class="conum">(3)</b>
            Cart newCart = new Cart();
            session.put(ATTR_CART, newCart); <b class="conum">(4)</b>
            return newCart;
        });
        cart.getItems().add(name);
        return cart;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.session.Session
import io.micronaut.session.annotation.SessionValue

import javax.annotation.Nullable
import javax.validation.constraints.NotBlank

@Controller("/shopping")
class ShoppingController {
    static final String ATTR_CART = "cart" <b class="conum">(1)</b>

    @Post("/cart/{name}")
    Cart addItem(Session session, @NotBlank String name) { <b class="conum">(2)</b>
        Cart cart = session.get(ATTR_CART, Cart.class).orElseGet({ -&gt;  <b class="conum">(3)</b>
            Cart newCart = new Cart()
            session.put(ATTR_CART, newCart) <b class="conum">(4)</b>
            newCart
        })
        cart.getItems().add(name)
        cart
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.session.Session
import io.micronaut.session.annotation.SessionValue


@Controller("/shopping")
class ShoppingController {

    @Post("/cart/{name}")
    internal fun addItem(session: Session, name: String): Cart { <b class="conum">(2)</b>
        require(name.isNotBlank()) { "Name cannot be blank" }
        val cart = session.get(ATTR_CART, Cart::class.java).orElseGet({
            <b class="conum">(3)</b>
            val newCart = Cart()
            session.put(ATTR_CART, newCart) <b class="conum">(4)</b>
            newCart
        })
        cart.items.add(name)
        return cart
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ShoppingController</code> declares a <a href="../api/io/micronaut/session/Session.html">Session</a> attribute called <code>cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a parameter to the method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>cart</code> attribute is retrieved</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise a new <code>Cart</code> instance is created and stored in the session</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that because the <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a required parameter to the execute the controller action, the <a href="../api/io/micronaut/session/Session.html">Session</a> will be created and saved to the <a href="../api/io/micronaut/session/SessionStore.html">SessionStore</a>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to create unnecessary sessions then you can declare the <a href="../api/io/micronaut/session/Session.html">Session</a> as <code>@Nullable</code> in which case a session will not be created and saved unnecessarily. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Post("/cart/clear")
    void clearCart(@Nullable Session session) {
        if (session != null) {
            session.remove(ATTR_CART);
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Post("/cart/clear")
    void clearCart(@Nullable Session session) {
        if (session != null) {
            session.remove(ATTR_CART)
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Post("/cart/clear")
    internal fun clearCart(session: Session?) {
        session?.remove(ATTR_CART)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method will only create and inject a new <a href="../api/io/micronaut/session/Session.html">Session</a> if one already exists.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_clients">Session Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the client is a web browser then sessions should just work if you have cookies is enabled. However for programmatic HTTP clients you need to make sure you propagate the session id between HTTP calls.</p>
</div>
<div class="paragraph">
<p>For example, when invoking the <code>viewCart</code> method of the <code>StoreController</code> in the previous example the HTTP client will receive by default a <code>AUTHORIZATION_INFO</code> header. The following example, using a Spock test, demonstrates this:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        HttpResponse&lt;Cart&gt; response = client.exchange(HttpRequest.GET("/shopping/cart"), Cart.class) <b class="conum">(1)</b>
                                                .blockingFirst();
        Cart cart = response.body();

        assertNotNull(response.header(HttpHeaders.AUTHORIZATION_INFO)); <b class="conum">(2)</b>
        assertNotNull(cart);
        assertTrue(cart.getItems().isEmpty());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when: "The shopping cart is retrieved"
        HttpResponse&lt;Cart&gt; response = httpClient.exchange(HttpRequest.GET('/shopping/cart'), Cart) <b class="conum">(1)</b>
                                                .blockingFirst()
        Cart cart = response.body()

        then: "The shopping cart is present as well as a session id header"
        response.header(HttpHeaders.AUTHORIZATION_INFO) != null <b class="conum">(2)</b>
        cart != null
        cart.items.isEmpty()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            var response = client.exchange(HttpRequest.GET&lt;Cart&gt;("/shopping/cart"), Cart::class.java) <b class="conum">(1)</b>
                    .blockingFirst()
            var cart = response.body()

            assertNotNull(response.header(HttpHeaders.AUTHORIZATION_INFO)) <b class="conum">(2)</b>
            assertNotNull(cart)
            cart.items.isEmpty()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A request is made to <code>/shopping/cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>AUTHORIZATION_INFO</code> header is present in the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then pass this <code>AUTHORIZATION_INFO</code> in subsequent requests to re-use the existing <a href="../api/io/micronaut/session/Session.html">Session</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        String sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO); <b class="conum">(1)</b>

        response = client.exchange(
                HttpRequest.POST("/shopping/cart/Apple", "")
                        .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart.class) <b class="conum">(2)</b>
                .blockingFirst();
        cart = response.body();</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        String sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO) <b class="conum">(1)</b>

        response = httpClient.exchange(
                HttpRequest.POST('/shopping/cart/Apple', "")
                        .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart) <b class="conum">(2)</b>
                .blockingFirst()
        cart = response.body()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO) <b class="conum">(1)</b>

            response = client.exchange(
                    HttpRequest.POST("/shopping/cart/Apple", "")
                            .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart::class.java) <b class="conum">(2)</b>
                    .blockingFirst()
            cart = response.body()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>AUTHORIZATION_INFO</code> is retrieved from the response</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And then sent as a header in the subsequent request</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_sessionvalue">Using @SessionValue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rather than explicitly injecting the <a href="../api/io/micronaut/session/Session.html">Session</a> into a controller method you can instead use <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/cart")
    @SessionValue(ATTR_CART) <b class="conum">(1)</b>
    Cart viewCart(@SessionValue @Nullable Cart cart) { <b class="conum">(2)</b>
        if (cart == null) {
            cart = new Cart();
        }
        return cart;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/cart")
    @SessionValue("cart") <b class="conum">(1)</b>
    Cart viewCart(@SessionValue @Nullable Cart cart) { <b class="conum">(2)</b>
        if (cart == null) {
            cart = new Cart()
        }
        cart
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/cart")
    @SessionValue(ATTR_CART) <b class="conum">(1)</b>
    internal fun viewCart(@SessionValue cart: Cart?): Cart { <b class="conum">(2)</b>
        var cart = cart
        if (cart == null) {
            cart = Cart()
        }
        return cart
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is declared on the method resulting in the return value being stored in the <a href="../api/io/micronaut/session/Session.html">Session</a>. Note that you must specify the attribute name when used on a return value</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is used on a <code>@Nullable</code> parameter which results in looking up the value from the <a href="../api/io/micronaut/session/Session.html">Session</a> in a non-blocking way and supplying it if present. In the case a value is not specified to <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> resulting in the parameter name being used to lookup the attribute.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_events">Session Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> beans to listen for <a href="../api/io/micronaut/session/Session.html">Session</a> related events located in the <a href="../api/io/micronaut/session/event/package-summary.html">io.micronaut.session.event</a> package.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the events:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Session Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionCreatedEvent.html">SessionCreatedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDeletedEvent.html">SessionDeletedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionExpiredEvent.html">SessionExpiredEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> expires</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDestroyedEvent.html">SessionDestroyedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parent of both <code>SessionDeletedEvent</code> and <code>SessionExpiredEvent</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>

<h2 id="sse"><a class="anchor" href="#sse"></a>6.23 Server Sent Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/sse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports emitting <a href="https://en.wikipedia.org/wiki/Server-sent_events">Server Sent Events (SSE)</a> using the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> API.</p>
</div>
<div class="paragraph">
<p>To emit events from the server you simply return a Reactive Streams <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> that emits objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> itself could publish events from a background task, via an event system or whatever.</p>
</div>
<div class="paragraph">
<p>Imagine for an example a event stream of news headlines, you may define a data class as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Headline {
    private String title;
    private String description;

    public Headline() { }

    public Headline(String title, String description) {
        this.title = title;
        this.description = description;
    }

    public String getTitle() {
        return title;
    }

    public String getDescription() {
        return description;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public void setDescription(String description) {
        this.description = description;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class Headline {
    String title;
    String description;

    Headline() {}

    Headline(String title, String description) {
        this.title = title;
        this.description = description;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class Headline {
    var title: String? = null
    var description: String? = null

    constructor() {}

    constructor(title: String, description: String) {
        this.title = title
        this.description = description
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To emit news headline events you can write a controller that returns a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a> instances using which ever Reactive library you prefer. The example below uses RxJava 2&#8217;s <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> via the <code>generate</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.*;
import io.micronaut.http.sse.Event;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;
import io.reactivex.Flowable;
import org.reactivestreams.Publisher;

@Controller("/headlines")
public class HeadlineController {

    @ExecuteOn(TaskExecutors.IO)
    @Get(produces = MediaType.TEXT_EVENT_STREAM)
    public Publisher&lt;Event&lt;Headline&gt;&gt; index() { <b class="conum">(1)</b>
        String[] versions = new String[]{"1.0", "2.0"}; <b class="conum">(2)</b>

        return Flowable.generate(() -&gt; 0, (i, emitter) -&gt; { <b class="conum">(3)</b>
            if (i &lt; versions.length) {
                emitter.onNext( <b class="conum">(4)</b>
                    Event.of(new Headline("Micronaut " + versions[i] + " Released", "Come and get it"))
                );
            } else {
                emitter.onComplete(); <b class="conum">(5)</b>
            }
            return ++i;
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.sse.Event
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn
import io.reactivex.Emitter
import io.reactivex.Flowable
import io.reactivex.functions.BiFunction
import org.reactivestreams.Publisher


@Controller("/headlines")
class HeadlineController {

    @ExecuteOn(TaskExecutors.IO)
    @Get(produces = MediaType.TEXT_EVENT_STREAM)
    Publisher&lt;Event&lt;Headline&gt;&gt; index() { <b class="conum">(1)</b>
        String[] versions = ["1.0", "2.0"] <b class="conum">(2)</b>

        def initialState = { -&gt; 0 }
        def emitterFunction = { Integer i, Emitter emitter -&gt;  <b class="conum">(3)</b>
            if (i &lt; versions.length) {
                emitter.onNext( <b class="conum">(4)</b>
                        Event.of(new Headline("Micronaut " + versions[i] + " Released", "Come and get it"))
                )
            } else {
                emitter.onComplete() <b class="conum">(5)</b>
            }
            return ++i
        }

        return Flowable.generate(initialState, emitterFunction as BiFunction&lt;Integer,Emitter&lt;Event&lt;Headline&gt;&gt;,Integer&gt;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.sse.Event
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn
import io.reactivex.Emitter
import io.reactivex.Flowable
import io.reactivex.functions.BiFunction
import org.reactivestreams.Publisher
import java.util.concurrent.Callable


@Controller("/headlines")
class HeadlineController {

    @ExecuteOn(TaskExecutors.IO)
    @Get(produces = [MediaType.TEXT_EVENT_STREAM])
    fun index(): Publisher&lt;Event&lt;Headline&gt;&gt; { <b class="conum">(1)</b>
        val versions = arrayOf("1.0", "2.0") <b class="conum">(2)</b>

        return Flowable.generate&lt;Event&lt;Headline&gt;, Int&gt;(Callable&lt;Int&gt;{ 0 }, BiFunction { <b class="conum">(3)</b>
            i: Int, emitter: Emitter&lt;Event&lt;Headline&gt;&gt; -&gt;
            var nextInt: Int = i
            if (i &lt; versions.size) {
                emitter.onNext( <b class="conum">(4)</b>
                        Event.of&lt;Headline&gt;(Headline("Micronaut " + versions[i] + " Released", "Come and get it"))
                )
            } else {
                emitter.onComplete() <b class="conum">(5)</b>
            }
            ++nextInt
        })
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller method returns a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>For each version of Micronaut a headline is emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> type&#8217;s <code>generate</code> method is used to generate a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a>. The <code>generate</code> method accepts an initial value and a lambda that accepts the value and a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a>.  Note that this example executes on the same thread as the controller action, but you could use <code>subscribeOn</code> or map and existing "hot" <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface&#8217;s <code>onNext</code> method is used to emit objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>. The <a href="../api/io/micronaut/http/sse/Event.html#of-ET-">Event.of(ET)</a> factory method is used to construct the event.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface&#8217;s <code>onComplete</code> method is used to indicate when to finish sending server sent events.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You typically want to schedule SSE event streams on a separate executor. The previous example uses <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> to execute the stream on the I/O executor.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example will send back a response of type <code>text/event-stream</code> and for each  <a href="../api/io/micronaut/http/sse/Event.html">Event</a> emitted the <code>Headline</code> type previously will be converted to JSON resulting in responses such as:</p>
</div>
<div class="listingblock">
<div class="title">Server Sent Event Response Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> data: {"title":"Micronaut 1.0 Released","description":"Come and get it"}
 data: {"title":"Micronaut 2.0 Released","description":"Come and get it"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the methods of the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> interface to customize the Server Sent Event data sent back including associating event ids, comments, retry timeouts etc.</p>
</div>

<h2 id="websocket"><a class="anchor" href="#websocket"></a>6.24 WebSocket Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/websocket.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features dedicated support for creating WebSocket clients and servers. The <a href="../api/io/micronaut/websocket/annotation/package-summary.html">io.micronaut.websocket.annotation</a> package includes a set of annotations for defining both clients and servers.</p>
</div>

<h2 id="websocketServer"><a class="anchor" href="#websocketServer"></a>6.24.1 Using @ServerWebSocket</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/websocket/websocketServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">@ServerWebSocket</a> annotation can be applied to any class that should map to a WebSocket URI. The following example is a simple chat WebSocket implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.websocket.WebSocketBroadcaster;
import io.micronaut.websocket.WebSocketSession;
import io.micronaut.websocket.annotation.OnClose;
import io.micronaut.websocket.annotation.OnMessage;
import io.micronaut.websocket.annotation.OnOpen;
import io.micronaut.websocket.annotation.ServerWebSocket;

import java.util.function.Predicate;

@ServerWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
public class ChatServerWebSocket {
    private WebSocketBroadcaster broadcaster;

    public ChatServerWebSocket(WebSocketBroadcaster broadcaster) {
        this.broadcaster = broadcaster;
    }

    @OnOpen <b class="conum">(2)</b>
    public void onOpen(String topic, String username, WebSocketSession session) {
        String msg = "[" + username + "] Joined!";
        broadcaster.broadcastSync(msg, isValid(topic, session));
    }

    @OnMessage <b class="conum">(3)</b>
    public void onMessage(
            String topic,
            String username,
            String message,
            WebSocketSession session) {
        String msg = "[" + username + "] " + message;
        broadcaster.broadcastSync(msg, isValid(topic, session)); <b class="conum">(4)</b>
    }

    @OnClose <b class="conum">(5)</b>
    public void onClose(
            String topic,
            String username,
            WebSocketSession session) {
        String msg = "[" + username + "] Disconnected!";
        broadcaster.broadcastSync(msg, isValid(topic, session));
    }

    private Predicate&lt;WebSocketSession&gt; isValid(String topic, WebSocketSession session) {
        return s -&gt; s != session &amp;&amp; topic.equalsIgnoreCase(s.getUriVariables().get("topic", String.class, null));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.websocket.WebSocketBroadcaster
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.OnClose
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.micronaut.websocket.annotation.ServerWebSocket

import java.util.function.Predicate

@ServerWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
class ChatServerWebSocket {
    private WebSocketBroadcaster broadcaster

    ChatServerWebSocket(WebSocketBroadcaster broadcaster) {
        this.broadcaster = broadcaster
    }

    @OnOpen <b class="conum">(2)</b>
    void onOpen(String topic, String username, WebSocketSession session) {
        String msg = "[" + username + "] Joined!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    @OnMessage <b class="conum">(3)</b>
     void onMessage(
            String topic,
            String username,
            String message,
            WebSocketSession session) {
        String msg = "[" + username + "] " + message
        broadcaster.broadcastSync(msg, isValid(topic, session)) <b class="conum">(4)</b>
    }

    @OnClose <b class="conum">(5)</b>
     void onClose(
            String topic,
            String username,
            WebSocketSession session) {
        String msg = "[" + username + "] Disconnected!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    private Predicate&lt;WebSocketSession&gt; isValid(String topic, WebSocketSession session) {
        return { s -&gt; s != session &amp;&amp; topic.equalsIgnoreCase(s.getUriVariables().get("topic", String.class, null)) }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.websocket.WebSocketBroadcaster
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.OnClose
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.micronaut.websocket.annotation.ServerWebSocket

import java.util.function.Predicate

@ServerWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
class ChatServerWebSocket(private val broadcaster: WebSocketBroadcaster) {

    @OnOpen <b class="conum">(2)</b>
    fun onOpen(topic: String, username: String, session: WebSocketSession) {
        val msg = "[$username] Joined!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    @OnMessage <b class="conum">(3)</b>
    fun onMessage(
            topic: String,
            username: String,
            message: String,
            session: WebSocketSession) {
        val msg = "[$username] $message"
        broadcaster.broadcastSync(msg, isValid(topic, session)) <b class="conum">(4)</b>
    }

    @OnClose <b class="conum">(5)</b>
    fun onClose(
            topic: String,
            username: String,
            session: WebSocketSession) {
        val msg = "[$username] Disconnected!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    private fun isValid(topic: String, session: WebSocketSession): Predicate&lt;WebSocketSession&gt; {
        return Predicate&lt;WebSocketSession&gt;{ s -&gt; (s !== session &amp;&amp; topic.equals(s.getUriVariables().get("topic", String::class.java, null), ignoreCase = true)) }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">@ServerWebSocket</a> annotation is used to define the path the WebSocket is mapped under. The URI can be a URI template.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnOpen.html">@OnOpen</a> annotation is used to declare a method that is invoked when the WebSocket is opened.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a> annotation is used to declare a method that is invoked when a message is received.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can use a <a href="../api/io/micronaut/websocket/WebSocketBroadcaster.html">WebSocketBroadcaster</a> to broadcast messages to every WebSocket session. You can filter which sessions to communicate with a <code>Predicate</code>. Also, you could use the passed <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> instance to send a message to it with <code>WebSocketSession::send</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnClose.html">@OnClose</a> annotation is used to declare a method that is invoked when the WebSocket is closed.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A working example of WebSockets in action can be found in the <a href="https://github.com/micronaut-projects/micronaut-examples/tree/master/websocket-chat">Micronaut Examples</a> GitHub repository.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In terms of binding the method arguments to each WebSocket method can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A variable from the URI template (in the above example <code>topic</code> and <code>username</code> are variables in the URI template)</p>
</li>
<li>
<p>An instance of <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_onclose_method">The @OnClose Method</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/OnClose.html">@OnClose</a> method can also optionally receive a <a href="../api/io/micronaut/websocket/CloseReason.html">CloseReason</a>. The <code>@OnClose</code> method is invoked prior to the session closing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_onmessage_method">The @OnMessage Method</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a> method can define a parameter that is the message body. The parameter can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Netty <code>WebSocketFrame</code></p>
</li>
<li>
<p>Any Java primitive or simple type (such as <code>String</code>). In fact any type that can be converted from <code>ByteBuf</code> (you can register additional <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> beans if you wish to support a custom type).</p>
</li>
<li>
<p>A <code>byte[]</code>, a <code>ByteBuf</code> or a Java NIO <code>ByteBuffer</code>.</p>
</li>
<li>
<p>A Plain Old Java Object (POJO). In the case of a POJO the POJO will be decoded by default  as JSON using <a href="../api/io/micronaut/jackson/codec/JsonMediaTypeCodec.html">JsonMediaTypeCodec</a>. You can register a custom codec if necessary and define the content type of the handler using the <a href="../api/io/micronaut/http/annotation/Consumes.html">@Consumes</a> annotation.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_onerror_method">The @OnError Method</h3>
<div class="paragraph">
<p>A method annotated with <a href="../api/io/micronaut/websocket/annotation/OnError.html">@OnError</a> can be added to implement custom error handling. The <code>@OnError</code> method can optionally define a parameter that receives the exception type that is to be handled. If no <code>@OnError</code> handling is present and a unrecoverable exception occurs the WebSocket is automatically closed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_blocking_message_handling">Non-Blocking Message Handling</h3>
<div class="paragraph">
<p>The previous example uses the <code>broadcastSync</code> method of the <a href="../api/io/micronaut/websocket/WebSocketBroadcaster.html">WebSocketBroadcaster</a> interface which blocks until the broadcast is complete. A similar <code>sendSync</code> method exists in <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> to send a message to a single receiver in a blocking manner. You can however implement non-blocking WebSocket servers by instead returning a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> or a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html">Future</a> from each WebSocket handler method. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @OnMessage
    public Publisher&lt;Message&gt; onMessage(
            String topic,
            String username,
            Message message,
            WebSocketSession session) {

        String text = "[" + username + "] " + message.getText();
        Message newMessage = new Message(text);
        return broadcaster.broadcast(newMessage, isValid(topic, session));
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @OnMessage
     Publisher&lt;Message&gt; onMessage(
            String topic,
            String username,
            Message message,
            WebSocketSession session) {

        String text = "[" + username + "] " + message.getText()
        Message newMessage = new Message(text)
        broadcaster.broadcast(newMessage, isValid(topic, session))
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @OnMessage
    fun onMessage(
            topic: String,
            username: String,
            message: Message,
            session: WebSocketSession): Publisher&lt;Message&gt; {

        val text = "[" + username + "] " + message.text
        val newMessage = Message(text)
        return broadcaster.broadcast(newMessage, isValid(topic, session))
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above uses <code>broadcast</code>, which creates an instance of <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> and returns the value to Micronaut.
Micronaut will then take care of sending the message asynchronously based on the Publisher interface.
The similar <code>send</code> method can be used to send a single message asynchronously via Micronaut return value.</p>
</div>
<div class="paragraph">
<p>For sending messages asynchronously outside Micronaut annotated handler methods, you can use <code>broadcastAsync</code> and <code>sendAsync</code> methods in their respective <a href="../api/io/micronaut/websocket/WebSocketBroadcaster.html">WebSocketBroadcaster</a> and <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> interfaces.
For blocking sends, the <code>broadcastSync</code> and <code>sendSync</code> methods can be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serverwebsocket_and_scopes">@ServerWebSocket and Scopes</h3>
<div class="paragraph">
<p>By default a unique <code>@ServerWebSocket</code> instance is created for each WebSocket connection. This allows you to retrieve the <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> from the <code>@OnOpen</code> handler and assign it to a field of the  <code>@ServerWebSocket</code> instance.</p>
</div>
<div class="paragraph">
<p>If you define the <code>@ServerWebSocket</code> as <code>@Singleton</code> it should be noted that extra care will need to be taken to synchronize local state to avoid thread safety issues.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sharing_sessions_with_the_http_session">Sharing Sessions with the HTTP Session</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> is by default backed by an in-memory map. If you add the the <code>session</code> module you can however share <a href="#sessions">sessions</a> between the HTTP server and the WebSocket server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When sessions are backed by a persistent store such as Redis then after each message is processed the session is updated to the backing store.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you have created your project using the Micronaut CLI and the default (<code>service</code>) profile, you can use the <code>create-websocket-server</code> command to create a class with <a href="../api/io/micronaut/websocket/WebSocketServer.html">WebSocketServer</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-websocket-server MyChat
| Rendered template WebsocketServer.java to destination src/main/java/example/MyChatServer.java</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_connection_timeouts">Connection Timeouts</h3>
<div class="paragraph">
<p>By default Micronaut will timeout idle connections that have no activity after 5 minutes. Normally this is not a problem as browsers will automatically reconnect WebSocket sessions, however you can control this behaviour by setting the <code>micronaut.server.idle-timeout</code> setting (a negative value will result no timeout):</p>
</div>
<div class="listingblock">
<div class="title">Setting the Connection Timeout for the Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        idle-timeout: 30m # 30 minutes</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Micronaut&#8217;s WebSocket client then you may also wish to set the timeout on the client:</p>
</div>
<div class="listingblock">
<div class="title">Setting the Connection Timeout for the Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-idle-timeout: 30m # 30 minutes</code></pre>
</div>
</div>
</div>

<h2 id="websocketClient"><a class="anchor" href="#websocketClient"></a>6.24.2 Using @ClientWebSocket</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/websocket/websocketClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a> annotation can be used in combination with the <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> interface to define WebSocket clients.</p>
</div>
<div class="paragraph">
<p>You can inject a reference to the a <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> instance using the <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Client("http://localhost:8080")
RxWebSocketClient webSocketClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to use the same service discovery and load balancing features for WebSocket clients.</p>
</div>
<div class="paragraph">
<p>Once you have a reference to the <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> interface you can use the <code>connect</code> method to obtain a connected instance of a bean annotated with <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a>.</p>
</div>
<div class="paragraph">
<p>For example consider the following implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.websocket.WebSocketSession;
import io.micronaut.websocket.annotation.ClientWebSocket;
import io.micronaut.websocket.annotation.OnMessage;
import io.micronaut.websocket.annotation.OnOpen;
import io.reactivex.Single;

import java.util.Collection;
import java.util.concurrent.ConcurrentLinkedQueue;
import java.util.concurrent.Future;


@ClientWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
public abstract class ChatClientWebSocket implements AutoCloseable { <b class="conum">(2)</b>

    private WebSocketSession session;
    private HttpRequest request;
    private String topic;
    private String username;
    private Collection&lt;String&gt; replies = new ConcurrentLinkedQueue&lt;&gt;();

    @OnOpen
    public void onOpen(String topic, String username, WebSocketSession session, HttpRequest request) { <b class="conum">(3)</b>
        this.topic = topic;
        this.username = username;
        this.session = session;
        this.request = request;
    }

    public String getTopic() {
        return topic;
    }

    public String getUsername() {
        return username;
    }

    public Collection&lt;String&gt; getReplies() {
        return replies;
    }

    public WebSocketSession getSession() {
        return session;
    }

    public HttpRequest getRequest() {
        return request;
    }

    @OnMessage
    public void onMessage(
            String message) {
        replies.add(message); <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.ClientWebSocket
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.reactivex.Single

import java.util.concurrent.ConcurrentLinkedQueue
import java.util.concurrent.Future


@ClientWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
abstract class ChatClientWebSocket implements AutoCloseable { <b class="conum">(2)</b>

    private WebSocketSession session
    private HttpRequest request
    private String topic
    private String username
    private Collection&lt;String&gt; replies = new ConcurrentLinkedQueue&lt;&gt;()

    @OnOpen
    void onOpen(String topic, String username, WebSocketSession session, HttpRequest request) { <b class="conum">(3)</b>
        this.topic = topic
        this.username = username
        this.session = session
        this.request = request
    }

    String getTopic() {
        topic
    }

    String getUsername() {
        username
    }

    Collection&lt;String&gt; getReplies() {
        replies
    }

    WebSocketSession getSession() {
        session
    }

    HttpRequest getRequest() {
        request
    }

    @OnMessage
    void onMessage(
            String message) {
        replies.add(message) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.ClientWebSocket
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.reactivex.Single
import java.util.concurrent.ConcurrentLinkedQueue
import java.util.concurrent.Future


@ClientWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
abstract class ChatClientWebSocket : AutoCloseable { <b class="conum">(2)</b>

    var session: WebSocketSession? = null
        private set
    var request: HttpRequest&lt;*&gt;? = null
        private set
    var topic: String? = null
        private set
    var username: String? = null
        private set
    private val replies = ConcurrentLinkedQueue&lt;String&gt;()

    @OnOpen
    fun onOpen(topic: String, username: String, session: WebSocketSession, request: HttpRequest&lt;*&gt;) { <b class="conum">(3)</b>
        this.topic = topic
        this.username = username
        this.session = session
        this.request = request
    }

    fun getReplies(): Collection&lt;String&gt; {
        return replies
    }

    @OnMessage
    fun onMessage(
            message: String) {
        replies.add(message) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is abstract (more on that later) and is annotated with <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The client must implement <code>AutoCloseable</code> and you should ensure that the connection is closed at some point.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use the same annotations as on the server, in this case <code>@OnOpen</code> to obtain a reference to the underlying session.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@OnMessage</code> annotation can be used to define the method that receives responses from the server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also define abstract methods that start with either <code>send</code> or <code>broadcast</code> and these methods will be implemented for you at compile time. For example:</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract void send(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note by returning <code>void</code> this tells Micronaut that the method is a blocking send. You can instead define methods that return either futures or a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a>:</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract io.reactivex.Single&lt;String&gt; send(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a send method that returns an <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a>.</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract java.util.concurrent.Future&lt;String&gt; sendAsync(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a send method that executes asynchronously and returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html">Future</a> to access the results.</p>
</div>
<div class="paragraph">
<p>Once you have defined a client class you can connect to the client socket and start sending messages:</p>
</div>
<div class="listingblock">
<div class="title">Connecting a Client WebSocket</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ChatClientWebSocket chatClient = webSocketClient.connect(ChatClientWebSocket.class, "/chat/football/fred").blockingFirst();
chatClient.send("Hello World!");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For illustration purposes we use <code>blockingFirst()</code> to obtain the client, it is however possible to combine <code>connect</code> (which returns an <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>) to perform non-blocking interaction via WebSocket.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you have created your project using the Micronaut CLI and the default (<code>service</code>) profile, you can use the <code>create-websocket-client</code> command to create an abstract class with <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-websocket-client MyChat
| Rendered template WebsocketClient.java to destination src/main/java/example/MyChatClient.java</pre>
</div>
</div>
</td>
</tr>
</table>
</div>

<h2 id="http2Server"><a class="anchor" href="#http2Server"></a>6.25 HTTP/2 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/http2Server.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 2.x, Micronaut&#8217;s Netty-based HTTP server can be configured to support HTTP/2.</p>
</div>
<div class="sect3">
<h4 id="_configuring_the_server_for_http_2">Configuring the Server for HTTP/2</h4>
<div class="paragraph">
<p>The first step to doing so is setting the supported HTTP version is the server configuration:</p>
</div>
<div class="listingblock">
<div class="title">Enabling HTTP/2 Support</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
      http-version: 2.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration in place Micronaut will enable support for the <code>h2c</code> protocol (see <a href="https://http2.github.io/http2-spec/#discover-http">HTTP/2 over cleartext</a>) which is fine for development.</p>
</div>
<div class="paragraph">
<p>Since browsers don&#8217;t support <code>h2c</code> and in general <a href="https://http2.github.io/http2-spec/#discover-https">HTTP/2 over TLS</a> (the <code>h2</code> protocol) is recommended for production you should enable <a href="#https">HTTPS support</a> support. For development this can be done with:</p>
</div>
<div class="listingblock">
<div class="title">Enabling <code>h2</code> Protocol Support</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  ssl:
      enabled: true
      buildSelfSigned: true
  server:
      http-version: 2.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>For production, see the <a href="#https">configuring HTTPS</a> section of the documentation.</p>
</div>
<div class="paragraph">
<p>Note that if you deployment environment is JDK 8 or if you wish for improved support for OpenSSL you will need to define the following dependencies on Netty Tomcat Native:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-tcnative:2.0.29.Final")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-tcnative&lt;/artifactId&gt;
    &lt;version&gt;2.0.29.Final&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-tcnative-boringssl-static:2.0.29.Final")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-tcnative-boringssl-static&lt;/artifactId&gt;
    &lt;version&gt;2.0.29.Final&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>In addition to a dependency on the appropriate native library for your architecture. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Tomcat Native</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">runtimeOnly "io.netty:netty-tcnative-boringssl-static:2.0.29.Final:${Os.isFamily(Os.FAMILY_MAC) ? 'osx-x86_64' : 'linux-x86_64'}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the documentation on <a href="https://netty.io/wiki/forked-tomcat-native.html">Tomcat Native</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_http_2_clients">HTTP/2 Clients</h4>
<div class="paragraph">
<p>By default Micronaut&#8217;s HTTP client is configured to support HTTP 1.1. To enable support for HTTP/2 you can do so globally by setting the supported HTTP version if configuration:</p>
</div>
<div class="listingblock">
<div class="title">Enabling HTTP/2 in Clients</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            http-version: 2.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or by specifying the HTTP version to use when injecting the client:</p>
</div>
<div class="listingblock">
<div class="title">Injecting a HTTP/2 Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Client(httpVersion=HttpVersion.HTTP_2_0)
RxHttpClient client;</code></pre>
</div>
</div>
</div>

<h2 id="serverEvents"><a class="anchor" href="#serverEvents"></a>6.26 Server Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server will emit a number of <a href="#events">Bean Events</a>, defined in the <a href="../api/io/micronaut/runtime/server/event/package-summary.html">io.micronaut.runtime.server.event</a> package, that you can write listeners for. The following table summarizes those events:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Server Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server completes startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server shuts down</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> listeners have been executed and exposes the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceStoppedEvent.html">ServiceStoppedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a> listeners have been executed and exposes the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you do significant work within a listener for a <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> this will slow down you startup time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example defines a <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> that listens for <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a>:</p>
</div>
<div class="listingblock">
<div class="title">Listening for Server Startup Events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.event.ApplicationEventListener;
...
@Singleton
public class StartupListener implements ApplicationEventListener&lt;ServerStartupEvent&gt; {
    @Override
    public void onApplicationEvent(ServerStartupEvent event) {
        // logic here
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can also use the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation on a method of any existing bean that accepts <code>ServerStartupEvent</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@EventListener</code> with <code>ServerStartupEvent</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.server.event.*;
import io.micronaut.runtime.event.annotation.*;
...
@Singleton
public class MyBean {

    @EventListener
    public void onStartup(ServerStartupEvent event) {
        // logic here
        ...
    }
}</code></pre>
</div>
</div>

<h2 id="serverConfiguration"><a class="anchor" href="#serverConfiguration"></a>6.27 Configuring the HTTP Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server features a number of configuration options you may wish to tweak. They are defined in the <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a> configuration class, which extends <a href="../api/io/micronaut/http/server/HttpServerConfiguration.html">HttpServerConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to tweak configuration options for the server via <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring HTTP server settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        maxRequestSize: 1MB
        host: localhost <i class="conum" data-value="1"></i><b>(1)</b>
        netty:
           maxHeaderSize: 500KB <i class="conum" data-value="2"></i><b>(2)</b>
           worker:
              threads: 8 <i class="conum" data-value="3"></i><b>(3)</b>
           childOptions:
              autoRead: true <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default Micronaut will bind to all the network interfaces. Use <code>localhost</code> to bind only to loopback network interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Maximum size for headers</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Number of netty worker threads</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Auto read request body</td>
</tr>
</table>
</div>
<a id="io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration" href="#io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.child-options</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Netty child worker options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.options</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the channel options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-initial-line-length</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum initial line length for the HTTP request. Default value (4096).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-header-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size of any one header. Default value (8192).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-chunk-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size of any single request chunk. Default value (8192).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.chunked-supported</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether chunked transfer encoding is supported. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.validate-headers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to validate incoming headers. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.initial-buffer-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the initial buffer size. Default value (128).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.log-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.netty.handler.logging.LogLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Netty log level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.compression-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the minimum size of a request body must be in order to be compressed. Default value (1024).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.compression-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the compression level (0-9). Default value (6).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.use-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to use netty&#8217;s native transport (epoll or kqueue) if available . Default value (false).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.fallback-protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the fallback protocol to use when negotiating via ALPN.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_using_native_transports">Using Native Transports</h3>
<div class="paragraph">
<p>The native Netty transports add features specific to a particular platform, generate less garbage, and generally improve performance when compared to the NIO based transport.</p>
</div>
<div class="paragraph">
<p>To enable native transports first add a necessarily dependency:</p>
</div>
<div class="paragraph">
<p>For macOS:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.netty:netty-transport-native-kqueue:osx-x86_64")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-kqueue&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;osx-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For Linux:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.netty:netty-transport-native-epoll:linux-x86_64")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-epoll&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;linux-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Then configure the default event loop group to prefer native transports:</p>
</div>
<div class="listingblock">
<div class="title">Configuring The Default Event Loop to Prefer Native Transports</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    netty:
        event-loops:
            default:
                prefer-native-transport: true</code></pre>
</div>
</div>
</div>

<h2 id="threadPools"><a class="anchor" href="#threadPools"></a>6.27.1 Configuring Server Thread Pools</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverConfiguration/threadPools.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server is built on <a href="http://netty.io">Netty</a> which is designed as a non-blocking I/O toolkit in an event loop model.</p>
</div>
<div class="paragraph">
<p>The Netty worker event loop uses the "default" named event loop group. That event loop can be configured through <code>micronaut.server.netty.worker</code>, or <code>micronaut.netty.event-loops.default</code>, with the latter having precedence.</p>
</div>
<a id="io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration$Worker" href="#io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration$Worker">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.Worker.html">NettyHttpServerConfiguration$Worker</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.event-loop-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of threads for the event loop group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.io-ratio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the I/O ratio.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.executor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the executor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.prefer-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set whether to prefer the native transport if available</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The parent event loop can be configured with <code>micronaut.server.netty.parent</code> with the same configuration options.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The server can also be configured to use a different named worker event loop:</p>
</div>
<div class="listingblock">
<div class="title">Using a different event loop for the server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        netty:
            worker:
                event-loop-group: other
    netty:
        event-loops:
            other:
                num-threads: 10</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value for the number of threads is the value of the system property <code>io.netty.eventLoopThreads</code>, or if not specified, the available processors x 2.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the following table for configuring event loops:</p>
</div>
<a id="io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration" href="#io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/http/netty/channel/DefaultEventLoopGroupConfiguration.html">DefaultEventLoopGroupConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.num-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.io-ratio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.prefer-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.executor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_blocking_operations">Blocking Operations</h4>
<div class="paragraph">
<p>When dealing with blocking operations, Micronaut will shift the blocking operations to an unbound, caching I/O thread pool by default. You can configure the I/O thread pool using the <a href="../api/io/micronaut/scheduling/executor/ExecutorConfiguration.html">ExecutorConfiguration</a> named <code>io</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Server I/O Thread Pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    executors:
        io:
           type: fixed
           nThreads: 75</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will create a fixed thread pool with 75 threads.</p>
</div>
</div>

<h2 id="nettyPipeline"><a class="anchor" href="#nettyPipeline"></a>6.27.2 Configuring the Netty Pipeline</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverConfiguration/nettyPipeline.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can customize the Netty pipeline by writing an <a href="#events">Bean Event Listener</a> that listens for the creation of <a href="../api/io/micronaut/http/netty/channel/ChannelPipelineCustomizer.html">ChannelPipelineCustomizer</a>.</p>
</div>
<div class="paragraph">
<p>Both the Netty HTTP server and client implement this interface and it allows you to customize the Netty <code>ChannelPipeline</code> and add additional handlers.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/netty/channel/ChannelPipelineCustomizer.html">ChannelPipelineCustomizer</a> interface defines constants for the names of the various handlers Micronaut registers.</p>
</div>
<div class="paragraph">
<p>As an example the following demonstrates registing the <a href="https://github.com/zalando/logbook">Logbook</a> library which includes additional Netty handlers to perform request and response logging:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty pipeline for Logbook</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.context.event.*;
import io.micronaut.http.netty.channel.ChannelPipelineCustomizer;
import org.zalando.logbook.Logbook;
import org.zalando.logbook.netty.*;
import javax.inject.Singleton;

@Requires(beans = Logbook.class)
@Singleton
public class LogbookPipelineCustomizer implements BeanCreatedEventListener&lt;ChannelPipelineCustomizer&gt; { <b class="conum">(1)</b>
    private final Logbook logbook;

    public LogbookPipelineCustomizer(Logbook logbook) {
        this.logbook = logbook;
    }

    @Override
    public ChannelPipelineCustomizer onCreated(BeanCreatedEvent&lt;ChannelPipelineCustomizer&gt; event) {
        ChannelPipelineCustomizer customizer = event.getBean();

        if (customizer.isServerChannel()) { <b class="conum">(2)</b>
            customizer.doOnConnect(pipeline -&gt; {
                pipeline.addAfter(
                    ChannelPipelineCustomizer.HANDLER_HTTP_SERVER_CODEC,
                    "logbook",
                    new LogbookServerHandler(logbook)
                );
                return pipeline;
            });
        } else { <b class="conum">(3)</b>
            customizer.doOnConnect(pipeline -&gt; {
                pipeline.addAfter(
                        ChannelPipelineCustomizer.HANDLER_HTTP_CLIENT_CODEC,
                        "logbook",
                        new LogbookClientHandler(logbook)
                );
                return pipeline;
            });
        }
        return customizer;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty pipeline for Logbook</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.context.event.*
import io.micronaut.http.netty.channel.ChannelPipelineCustomizer
import io.netty.channel.ChannelPipeline
import org.zalando.logbook.Logbook
import org.zalando.logbook.netty.*
import javax.inject.Singleton

@Requires(beans = Logbook.class)
@Singleton
class LogbookPipelineCustomizer implements BeanCreatedEventListener&lt;ChannelPipelineCustomizer&gt; { <b class="conum">(1)</b>
    private final Logbook logbook

    LogbookPipelineCustomizer(Logbook logbook) {
        this.logbook = logbook
    }

    @Override
    ChannelPipelineCustomizer onCreated(BeanCreatedEvent&lt;ChannelPipelineCustomizer&gt; event) {
        ChannelPipelineCustomizer customizer = event.getBean()

        if (customizer.isServerChannel()) { <b class="conum">(2)</b>
            customizer.doOnConnect( { ChannelPipeline pipeline -&gt;
                pipeline.addAfter(
                        ChannelPipelineCustomizer.HANDLER_HTTP_SERVER_CODEC,
                        "logbook",
                        new LogbookServerHandler(logbook)
                )
                return pipeline
            })
        } else { <b class="conum">(3)</b>
            customizer.doOnConnect({ ChannelPipeline pipeline -&gt;
                pipeline.addAfter(
                        ChannelPipelineCustomizer.HANDLER_HTTP_CLIENT_CODEC,
                        "logbook",
                        new LogbookClientHandler(logbook)
                )
                return pipeline
            })
        }
        return customizer
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty pipeline for Logbook</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.context.event.*
import io.micronaut.http.netty.channel.ChannelPipelineCustomizer
import io.netty.channel.ChannelPipeline
import org.zalando.logbook.Logbook
import org.zalando.logbook.netty.*
import javax.inject.Singleton

@Requires(beans = [Logbook::class])
@Singleton
class LogbookPipelineCustomizer(private val logbook: Logbook) : BeanCreatedEventListener&lt;ChannelPipelineCustomizer&gt; { <b class="conum">(1)</b>

    override fun onCreated(event: BeanCreatedEvent&lt;ChannelPipelineCustomizer&gt;): ChannelPipelineCustomizer {
        val customizer = event.bean
        if (customizer.isServerChannel) { <b class="conum">(2)</b>
            customizer.doOnConnect { pipeline: ChannelPipeline -&gt;
                pipeline.addAfter(
                        ChannelPipelineCustomizer.HANDLER_HTTP_SERVER_CODEC,
                        "logbook",
                        LogbookServerHandler(logbook)
                )
                pipeline
            }
        } else { <b class="conum">(3)</b>
            customizer.doOnConnect { pipeline: ChannelPipeline -&gt;
                pipeline.addAfter(
                        ChannelPipelineCustomizer.HANDLER_HTTP_CLIENT_CODEC,
                        "logbook",
                        LogbookClientHandler(logbook)
                )
                pipeline
            }
        }
        return customizer
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A bean is created that implements <a href="../api/io/micronaut/http/netty/ChannelPipelineCustomizer.html">ChannelPipelineCustomizer</a> and requires the definition of a <code>Logbook</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the bean being created is the server then the server handler is registered</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>if the bean being created is the client then the client handler is registered</td>
</tr>
</table>
</div>

<h2 id="cors"><a class="anchor" href="#cors"></a>6.27.3 Configuring CORS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverConfiguration/cors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports CORS (<a href="https://www.w3.org/TR/cors/">Cross Origin Resource Sharing</a>) out of the box. By default, CORS requests will be rejected. To enable processing of CORS requests, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">CORS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By only enabling CORS processing, a "wide open" strategy will be adopted that will allow requests from any origin.</p>
</div>
<div class="paragraph">
<p>To change the settings for all origins or a specific origin, change the configuration to provide a set of "configurations". By providing any configuration, the default "wide open" configuration is not configured.</p>
</div>
<div class="listingblock">
<div class="title">CORS Configurations (&#8230;&#8203; is a placeholder)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                all:
                    ...
                web:
                    ...
                mobile:
                    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, three configurations are being provided. Their names (<code>all</code>, <code>web</code>, <code>mobile</code>) are not important and have no significance inside Micronaut. They are there purely to be able to easily recognize the intended user of the configuration.</p>
</div>
<div class="paragraph">
<p>The same configuration properties can be applied to each configuration. See <a href="../api/io/micronaut/http/server/cors/CorsOriginConfiguration.html">CorsOriginConfiguration</a> for the reference of properties that can be defined. Each configuration supplied will have its values default to the default values of the corresponding fields.</p>
</div>
<div class="paragraph">
<p>When a CORS request is made, configurations are searched for allowed origins that are an exact match or match the request origin through a regular expression.</p>
</div>
<div class="sect1">
<h2 id="_allowed_origins">Allowed Origins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any origin for a given configuration, simply don&#8217;t include the <code>allowedOrigins</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of valid origins, set the <code>allowedOrigins</code> key of the configuration to a list of strings. Each value can either be a static value (<code><a href="http://www.foo.com" class="bare">http://www.foo.com</a></code>) or a regular expression (<code>^http(|s)://www\.google\.com$</code>).</p>
</div>
<div class="paragraph">
<p>Any regular expressions are passed to <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#compile-java.lang.String-">Pattern#compile</a> and compared to the request origin with <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#matches--">Matcher#matches</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowedOrigins:
                        - http://foo.com
                        - ^http(|s):\/\/www\.google\.com$</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allowed_methods">Allowed Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any request method for a given configuration, simply don&#8217;t include the <code>allowedMethods</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of allowed methods, set the <code>allowedMethods</code> key of the configuration to a list of strings.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowedMethods:
                        - POST
                        - PUT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allowed_headers">Allowed Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any request header for a given configuration, simply don&#8217;t include the <code>allowedHeaders</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of allowed headers, set the <code>allowedHeaders</code> key of the configuration to a list of strings.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowedHeaders:
                        - Content-Type
                        - Authorization</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exposed_headers">Exposed Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the list of headers that are sent in the response to a CORS request through the <code>Access-Control-Expose-Headers</code> header, include a list of strings for the <code>exposedHeaders</code> key in your configuration. By default no headers are exposed.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    exposedHeaders:
                        - Content-Type
                        - Authorization</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allow_credentials">Allow Credentials</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Credentials are allowed by default for CORS requests. To disallow credentials, simply set the <code>allowCredentials</code> option to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowCredentials: false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_max_age">Max Age</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default maximum age that preflight requests can be cached is 30 minutes. To change that behavior, specify a value in seconds.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    maxAge: 3600 # 1 hour</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_header_values">Multiple Header Values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default when a header has multiple values, multiple headers will be sent each with a single value. It is possible to change the behavior to send a single header with the list of values comma separated by setting a configuration option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            single-header: true</code></pre>
</div>
</div>
</div>
</div>

<h2 id="https"><a class="anchor" href="#https"></a>6.27.4 Securing the Server with HTTPS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverConfiguration/https.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports HTTPS out of the box. By default HTTPS is disabled and all requests are served using HTTP. To enable
HTTPS support, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        buildSelfSigned: true <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Micronaut will create a self-signed certificate.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default Micronaut with HTTPS support starts on port <code>8443</code> but you can change the port the property
 <code>micronaut.ssl.port</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Keep in mind that this configuration will generate a warning on the browser.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/https-warning.jpg" alt="https warning">
</div>
</div>
<div class="sect1">
<h2 id="_using_a_valid_x509_certificate">Using a valid x509 certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to configure Micronaut to use an existing valid x509 certificate, for example one created with
<a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a>. You will need the <code>server.crt</code> and <code>server.key</code> files and convert them to a
 PKCS #12 file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ openssl pkcs12 -export \
                 -in server.crt \ <i class="conum" data-value="1"></i><b>(1)</b>
                 -inkey server.key \ <i class="conum" data-value="2"></i><b>(2)</b>
                 -out server.p12 \ <i class="conum" data-value="3"></i><b>(3)</b>
                 -name someAlias \ <i class="conum" data-value="4"></i><b>(4)</b>
                 -chain -CAfile ca.crt -caname root</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The original <code>server.crt</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The original <code>server.key</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>server.p12</code> file that will be created</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias for the certificate</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During the creation of the <code>server.p12</code> file it is necessary to define a password that will be required later when using
the certificate in Micronaut.</p>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        keyStore:
            path: classpath:server.p12 <i class="conum" data-value="1"></i><b>(1)</b>
            password: mypassword <i class="conum" data-value="2"></i><b>(2)</b>
            type: PKCS12</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>p12</code> file created. It can also be referenced as <code>file:/path/to/the/file</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The password defined during the export</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this configuration if we start Micronaut and connect to <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> we still see the warning on the
browser but if we inspect the certificate we can check that it&#8217;s the one generated by Let&#8217;s Encrypt.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/https-certificate.jpg" alt="https certificate">
</div>
</div>
<div class="paragraph">
<p>Finally we can test that the certificate is valid for the browser just by adding an alias to the domain in <code>/etc/hosts</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cat /etc/hosts
...
127.0.0.1   my-domain.org
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can connect to <code><a href="https://my-domain.org:8443" class="bare">https://my-domain.org:8443</a></code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/https-valid-certificate.jpg" alt="https valid certificate">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_java_keystore_jks">Using Java Keystore (JKS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is not recommended using this type of certificate because it is a proprietary format and it&#8217;s better to use a PKCS12
format. In any case Micronaut also supports it.</p>
</div>
<div class="paragraph">
<p>Convert the <code>p12</code> certificate to a JKS one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ keytool -importkeystore \
          -deststorepass newPassword -destkeypass newPassword \ <i class="conum" data-value="1"></i><b>(1)</b>
          -destkeystore server.keystore \ <i class="conum" data-value="2"></i><b>(2)</b>
          -srckeystore server.p12 -srcstoretype PKCS12 -srcstorepass mypassword \ <i class="conum" data-value="3"></i><b>(3)</b>
          -alias someAlias <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is necessary to define a the password for the keystore</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The file that will be created</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The PKCS12 file created before and the password defined during the creation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias used before</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If either <code>srcstorepass</code> or <code>alias</code> are not the same as defined in the <code>p12</code> file, the conversion will fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        keyStore:
            path: classpath:server.keystore
            password: newPassword
            type: JKS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start Micronaut and the application is running on <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> using the certificate in the keystore.</p>
</div>
</div>
</div>

<h2 id="dualProtocol"><a class="anchor" href="#dualProtocol"></a>6.27.5 Enabling HTTP and HTTPS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverConfiguration/dualProtocol.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports binding both HTTP and HTTPS out of the box. To enable
dual protocol support, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Dual Protocol Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        buildSelfSigned: true <i class="conum" data-value="1"></i><b>(1)</b>
    server:
        dualProtocol : true <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You will need to configure ssl for https to work. In this example we are just using self signed but see <a href="#https">Securing the Server with HTTPS</a> for other configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>To enable http &amp; https is an opt-in feature, setting the dualProtocol flag enables that, by default Micronaut will only enable one or the other</td>
</tr>
</table>
</div>

<h2 id="accessLogger"><a class="anchor" href="#accessLogger"></a>6.27.6 Enabling Access Logger</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/serverConfiguration/accessLogger.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In the spirit of <a href="http://httpd.apache.org/docs/current/mod/mod_log_config.html">apache mod_log_config</a> and  <a href="https://tomcat.apache.org/tomcat-10.0-doc/config/valve.html#Access_Logging">Tomcat Access Log Valve</a>, it is possible to enabled an access logger for
 the http server (it works for both http/1 and http/2.)</p>
</div>
<div class="paragraph">
<p>To enable and configure the access logger, in <code>application.yml</code> set:</p>
</div>
<div class="listingblock">
<div class="title">Enabling the access logger</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        netty:
           access-logger:
              enabled: true # Enables the access logger
              logger-name: my-access-logger # A logger name, optional, default is `HTTP_ACCESS_LOGGER`
              log-format: common # A log format, optional, default is Common Log Format</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_logback_configuration">Logback Configuration</h4>
<div class="paragraph">
<p>In addition to enabling the access logger, you have to add a logger for the specified or default logger name.
For instance using the default logger name for logback:</p>
</div>
<div class="listingblock">
<div class="title">Logback configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;appender
    name="httpAccessLogAppender"
    class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
    &lt;append&gt;true&lt;/append&gt;
    &lt;file&gt;log/http-access.log&lt;/file&gt;
    &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
        &lt;!-- daily rollover --&gt;
        &lt;fileNamePattern&gt;log/http-access-%d{yyyy-MM-dd}.log
        &lt;/fileNamePattern&gt;
        &lt;maxHistory&gt;7&lt;/maxHistory&gt;
    &lt;/rollingPolicy&gt;
    &lt;encoder&gt;
        &lt;charset&gt;UTF-8&lt;/charset&gt;
        &lt;pattern&gt;%msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
        &lt;immediateFlush&gt;true&lt;/immediateFlush&gt;
&lt;/appender&gt;

&lt;logger name="HTTP_ACCESS_LOGGER" additivity="false" level="info"&gt;
    &lt;appender-ref ref="httpAccessLogAppender" /&gt;
&lt;/logger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pattern should only have the message marker as other elements will be processed by the access logger.</p>
</div>
</div>
<div class="sect3">
<h4 id="_log_format">Log Format</h4>
<div class="paragraph">
<p>The syntax is based on <a href="http://httpd.apache.org/docs/current/mod/mod_log_config.html">Apache httpd log format</a>.</p>
</div>
<div class="paragraph">
<p>Here are the supported markers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>%a</strong> - Remote IP address</p>
</li>
<li>
<p><strong>%A</strong> - Local IP address</p>
</li>
<li>
<p><strong>%b</strong> - Bytes sent, excluding HTTP headers, or '-' if no bytes were sent</p>
</li>
<li>
<p><strong>%B</strong> - Bytes sent, excluding HTTP headers</p>
</li>
<li>
<p><strong>%h</strong> - Remote host name</p>
</li>
<li>
<p><strong>%H</strong> - Request protocol</p>
</li>
<li>
<p><strong>%{&lt;header&gt;}i</strong> - Request header. If the argument is omitted (<strong>%i</strong>) all headers will be printed</p>
</li>
<li>
<p><strong>%{&lt;header&gt;}o</strong> - Response header. If the argument is omitted (<strong>%o</strong>) all headers will be printed</p>
</li>
<li>
<p><strong>%{&lt;cookie&gt;}C</strong> - Request cookie (COOKIE). If the argument is omitted (<strong>%C</strong>) all cookies will be printed</p>
</li>
<li>
<p><strong>%{&lt;cookie&gt;}c</strong> - Response cookie (SET_COOKIE). If the argument is omitted (<strong>%c</strong>) all cookies will be printed</p>
</li>
<li>
<p><strong>%l</strong> - Remote logical username from identd (always returns '-')</p>
</li>
<li>
<p><strong>%m</strong> - Request method</p>
</li>
<li>
<p><strong>%p</strong> - Local port</p>
</li>
<li>
<p><strong>%q</strong> - Query string (excluding the '?' character)</p>
</li>
<li>
<p><strong>%r</strong> - First line of the request</p>
</li>
<li>
<p><strong>%s</strong> - HTTP status code of the response</p>
</li>
<li>
<p><strong>%{&lt;format&gt;}t</strong> - Date and time. If the argument is ommitted the Common Log Format format is used ("'['dd/MMM/yyyy:HH:mm:ss Z']'").</p>
<div class="ulist">
<ul>
<li>
<p>If the format starts with begin: (default) the time is taken at the beginning of the request processing. If it starts with end: it is the time when the log entry gets written, close to the end of the request processing.</p>
</li>
<li>
<p>The format should follow the DateTimeFormatter syntax.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>%{property}u</strong> - Remote user that was authenticated. When <strong>micronaut-session</strong> is on the classpath, returns the session id if the argument is omitted or the specified property otherwise prints '-'</p>
</li>
<li>
<p><strong>%U</strong> - Requested URI</p>
</li>
<li>
<p><strong>%v</strong> - Local server name</p>
</li>
<li>
<p><strong>%D</strong> - Time taken to process the request, in millis</p>
</li>
<li>
<p><strong>%T</strong> - Time taken to process the request, in seconds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, you can use the following aliases for commonly utilized patterns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>common</strong> - <code>%h %l %u %t "%r" %s %b</code> for <a href="https://httpd.apache.org/docs/1.3/logs.html#common">Common Log Format</a> (CLF)</p>
</li>
<li>
<p><strong>combined</strong> - <code>%h %l %u %t "%r" %s %b "%{Referer}i" "%{User-Agent}i"</code> for <a href="https://httpd.apache.org/docs/1.3/logs.html#combined">Combined Log Format</a></p>
</li>
</ul>
</div>
</div>

<h2 id="views"><a class="anchor" href="#views"></a>6.28 Server Side View Rendering</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/views.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports Server Side View Rendering.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-views/latest/guide">Micronaut Views</a> for more information.</p>
</div>

<h2 id="openapi"><a class="anchor" href="#openapi"></a>6.29 OpenAPI / Swagger Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/openapi.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure Micronaut integration with <a href="https://swagger.io/docs/specification/about/">OpenAPI/Swagger</a>, please follow
<a href="https://micronaut-projects.github.io/micronaut-openapi/latest/guide/index.html">these instructions</a></p>
</div>

<h2 id="graphql"><a class="anchor" href="#graphql"></a>6.30 GraphQL Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpServer/graphql.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://graphql.org/">GraphQL</a> is a query language for building APIs that provides an intuitive and flexible syntax and a system for describing data requirements and interactions.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-graphql/latest/guide">Micronaut GraphQL</a> for more information on how to build GraphQL applications with Micronaut.</p>
</div>

<h1 id="httpClient"><a class="anchor" href="#httpClient"></a>7 The HTTP Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, the <code>http-client</code> dependency is included by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A critical component of any Microservice architecture is the client communication between Microservices. With that in mind Micronaut features a built in HTTP client that has both a low-level API and a higher level AOP-driven API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Regardless whether you choose to use Micronaut&#8217;s HTTP server, you may wish to use the Micronaut HTTP client in your application since it is a feature-rich client implementation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the HTTP client you must have the <code>http-client</code> dependency on your classpath.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Since the higher level API is built on the low-level HTTP client, we will first introduce the low-level client.</p>
</div>

<h2 id="lowLevelHttpClient"><a class="anchor" href="#lowLevelHttpClient"></a>7.1 Using the Low-Level HTTP Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface forms the basis for the low-level API. This interfaces declares methods to help ease executing HTTP requests and receive responses.</p>
</div>
<div class="paragraph">
<p>The majority of the methods in the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface returns Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances, which is not always the most useful interface to work against, hence a sub-interface called <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> is included that provides a variation of the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface that returns RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> types.</p>
</div>

<h2 id="clientBasics"><a class="anchor" href="#clientBasics"></a>7.1.1 Sending your first HTTP request</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientBasics.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_obtaining_a_httpclient">Obtaining a HttpClient</h4>
<div class="paragraph">
<p>There are a few ways by which you can obtain a reference to a <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>. The most common way is using the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("https://api.twitter.com/1.1") @Inject RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will inject a client that targets the Twitter API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@field:Client("\${myapp.api.twitter.url}") @Inject lateinit var httpClient: RxHttpClient</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above Kotlin example will inject a client that targets the Twitter API using a configuration path. Note the required escaping (backslash) on <code>"\${path.to.config}"</code> which is required due to Kotlin string interpolation.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is also a custom scope that will manage the creation of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> instances and ensure they are shutdown when the application shuts down.</p>
</div>
<div class="paragraph">
<p>The value you pass to the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A absolute URI. Example <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the server targeted will be the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another way to create an <code>HttpClient</code> is with the <code>create</code> static method of the <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a>, however this approach is not recommended as you will have to ensure you manually shutdown the client and of course no dependency injection will occur for the created client.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performing_an_http_get">Performing an HTTP GET</h4>
<div class="paragraph">
<p>Generally there are two methods of interest when working with the <code>HttpClient</code>. The first method is called <code>retrieve</code>, which will execute an HTTP request and return the body in whichever type you request (by default a <code>String</code>) as an RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>.</p>
</div>
<div class="paragraph">
<p>The <code>retrieve</code> method accepts an <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> object or a <code>String</code> URI to the endpoint you wish to request.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>retrieve</code> to execute an HTTP <code>GET</code> and receive the response body as a <code>String</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        String uri = UriBuilder.of("/hello/{name}")
                               .expand(Collections.singletonMap("name", "John"))
                               .toString();
        assertEquals("/hello/John", uri);

        String result = client.toBlocking().retrieve(uri);

        assertEquals(
                "Hello John",
                result
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        String uri = UriBuilder.of("/hello/{name}")
                               .expand(Collections.singletonMap("name", "John"))
                               .toString()
        then:
        "/hello/John" == uri

        when:
        String result = client.toBlocking().retrieve(uri)

        then:
        "Hello John" == result</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val uri = UriBuilder.of("/hello/{name}")
                    .expand(Collections.singletonMap("name", "John"))
                    .toString()
            uri shouldBe "/hello/John"

            val result = client.toBlocking().retrieve(uri)

            result shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, for illustration purposes we are calling <code>toBlocking()</code> to return a blocking version of the client. However, in production code you should not do this and instead rely on the non-blocking nature of the Micronaut HTTP server.</p>
</div>
<div class="paragraph">
<p>For example the following <code>@Controller</code> method calls another endpoint in a non-blocking manner:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpStatus;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.*;
import io.micronaut.http.client.RxHttpClient;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Maybe;

import static io.micronaut.http.HttpRequest.GET;

    @Get("/hello/{name}")
    Maybe&lt;String&gt; hello(String name) { <b class="conum">(1)</b>
        return httpClient.retrieve( GET("/hello/" + name) )
                         .firstElement(); <b class="conum">(2)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.*
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.client.annotation.Client
import io.reactivex.Maybe

import static io.micronaut.http.HttpRequest.GET

    @Get("/hello/{name}")
    Maybe&lt;String&gt; hello(String name) { <b class="conum">(1)</b>
        return httpClient.retrieve( GET("/hello/" + name) )
                         .firstElement() <b class="conum">(2)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.*
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.client.annotation.Client
import io.reactivex.Maybe

import io.micronaut.http.HttpRequest.GET

    @Get("/hello/{name}")
    internal fun hello(name: String): Maybe&lt;String&gt; { <b class="conum">(1)</b>
        return httpClient.retrieve(GET&lt;Any&gt;("/hello/$name"))
                .firstElement() <b class="conum">(2)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method <code>hello</code> returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Maybe.html">Maybe</a> which may or may not emit an item. If an item is not emitted a 404 is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>retrieve</code> method is called which returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> which has a <code>firstElement</code> method that returns the first emitted item or nothing</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using RxJava (or Reactor if you prefer) you can easily and efficiently compose multiple HTTP client calls without blocking (which will limit the throughput and scalability of your application).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_tracing_the_http_client">Debugging / Tracing the HTTP Client</h4>
<div class="paragraph">
<p>To debug the requests being sent and received from the HTTP client you can enable tracing logging via your <code>logback.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="io.micronaut.http.client" level="TRACE"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client_specific_debugging_tracing">Client Specific Debugging / Tracing</h4>
<div class="paragraph">
<p>To enable client-specific logging you could configure the default logger for all HTTP clients. And, you could also configure different loggers for different clients using <a href="#_client_specific_configuration">Client Specific Configuration</a>. For example, in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">micronaut:
    http:
        client:
            logger-name: mylogger
        services:
            otherClient:
                logger-name: other.client</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, then enable logging in <code>logback.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="mylogger" level="DEBUG"/&gt;
&lt;logger name="other.client" level="TRACE"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_http_request">Customizing the HTTP Request</h4>
<div class="paragraph">
<p>The previous example demonstrated using the static methods of the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface to construct a <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> instance. Like the name suggests a <code>MutableHttpRequest</code> can be mutated including the ability to add headers, customize the request body and so on. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;String&gt; response = client.retrieve(
                GET("/hello/John")
                .header("X-My-Header", "SomeValue")
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;String&gt; response = client.retrieve(
                GET("/hello/John")
                .header("X-My-Header", "SomeValue")
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val response = client.retrieve(
                    GET&lt;Any&gt;("/hello/John")
                            .header("X-My-Header", "SomeValue")
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example adds an additional header called <code>X-My-Header</code> to the request before it is sent. The <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> interface has a bunch more convenience methods that make it easy to modify the request in common ways.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading_json_responses">Reading JSON Responses</h4>
<div class="paragraph">
<p>Typically with Microservices a message encoding format is used such as JSON. Micronaut&#8217;s HTTP client leverages Jackson for JSON parsing hence whatever type Jackson can decode can passed as a second argument to <code>retrieve</code>.</p>
</div>
<div class="paragraph">
<p>For example consider the following <code>@Controller</code> method that returns a JSON response:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/greet/{name}")
    Message greet(String name) {
        return new Message("Hello " + name);
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/greet/{name}")
    Message greet(String name) {
        return new Message("Hello " + name)
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/greet/{name}")
    internal fun greet(name: String): Message {
        return Message("Hello $name")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method above returns a POJO of type <code>Message</code> which looks like:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonProperty;

public class Message {
    private final String text;

    @JsonCreator
    public Message(@JsonProperty("text") String text) {
        this.text = text;
    }

    public String getText() {
        return text;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import com.fasterxml.jackson.annotation.JsonCreator
import com.fasterxml.jackson.annotation.JsonProperty

class Message {
    private final String text

    @JsonCreator
    Message(@JsonProperty("text") String text) {
        this.text = text
    }

    String getText() {
        return text
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import com.fasterxml.jackson.annotation.JsonCreator
import com.fasterxml.jackson.annotation.JsonProperty


class Message @JsonCreator
constructor(@param:JsonProperty("text") val text: String)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jackson annotations are used to map the constructor
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the client end you can call this endpoint and decode the JSON into a map using the <code>retrieve</code> method as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;Map&gt; response = client.retrieve(
                GET("/greet/John"), Map.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;Map&gt; response = client.retrieve(
                GET("/greet/John"), Map.class
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            var response: Flowable&lt;Map&lt;*, *&gt;&gt; = client.retrieve(
                    GET&lt;Any&gt;("/greet/John"), Map::class.java
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above examples decodes the response into a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html">Map</a>, representing the JSON. If you wish to customize the type of the key and string you can use the <code>Argument.of(..)</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        response = client.retrieve(
                GET("/greet/John"),
                Argument.of(Map.class, String.class, String.class) <b class="conum">(1)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        response = client.retrieve(
                GET("/greet/John"),
                Argument.of(Map.class, String.class, String.class) <b class="conum">(1)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            response = client.retrieve(
                    GET&lt;Any&gt;("/greet/John"),
                    Argument.of(Map::class.java, String::class.java, String::class.java) <b class="conum">(1)</b>
            )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Argument.of</code> method is used to return a <code>Map</code> whether the key and value are typed as <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whilst retrieving JSON as a map can be desirable, more often than not you will want to decode objects into Plain Old Java Objects (POJOs). To do that simply pass the type instead:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;Message&gt; response = client.retrieve(
                GET("/greet/John"), Message.class
        );

        assertEquals(
                "Hello John",
                response.blockingFirst().getText()
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Flowable&lt;Message&gt; response = client.retrieve(
                GET("/greet/John"), Message.class
        )

        then:
        "Hello John" == response.blockingFirst().getText()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val response = client.retrieve(
                    GET&lt;Any&gt;("/greet/John"), Message::class.java
            )

            response.blockingFirst().text shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how you can use the same Java type on both the client and the server. The implication of this is that typically you will want to define a common API project where you define the interfaces and types that define your API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_decoding_other_content_types">Decoding Other Content Types</h4>
<div class="paragraph">
<p>If the server you are communicating with uses a custom content type that is not JSON by default Micronaut&#8217;s HTTP client will not know how to decode this type.</p>
</div>
<div class="paragraph">
<p>To resolve this issue you can register <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> as a bean and it will be automatically picked up and used to decode (or encode) messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_receiving_the_full_http_response">Receiving the Full HTTP Response</h4>
<div class="paragraph">
<p>Sometimes, receiving just the object is not enough and you need information about the response. In this case, instead of <code>retrieve</code> you should use the <code>exchange</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Recieving the Full HTTP Response</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                GET("/greet/John"), Message.class <b class="conum">(1)</b>
        );

        HttpResponse&lt;Message&gt; response = call.blockingFirst();
        Optional&lt;Message&gt; message = response.getBody(Message.class); <b class="conum">(2)</b>
        // check the status
        assertEquals(
                HttpStatus.OK,
                response.getStatus() <b class="conum">(3)</b>
        );
        // check the body
        assertTrue(message.isPresent());
        assertEquals(
                "Hello John",
                message.get().getText()
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Recieving the Full HTTP Response</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                GET("/greet/John"), Message.class <b class="conum">(1)</b>
        )

        HttpResponse&lt;Message&gt; response = call.blockingFirst();
        Optional&lt;Message&gt; message = response.getBody(Message.class) <b class="conum">(2)</b>
        // check the status
        then:
        HttpStatus.OK == response.getStatus() <b class="conum">(3)</b>
        // check the body
        message.isPresent()
        "Hello John" == message.get().getText()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Recieving the Full HTTP Response</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    GET&lt;Any&gt;("/greet/John"), Message::class.java <b class="conum">(1)</b>
            )

            val response = call.blockingFirst()
            val message = response.getBody(Message::class.java) <b class="conum">(2)</b>
            // check the status
            response.status shouldBe HttpStatus.OK <b class="conum">(3)</b>
            // check the body
            message.isPresent shouldBe true
            message.get().text shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>exchange</code> method is used to receive the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The body can be retrieved using the <code>getBody(..)</code> method of the response</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Other aspects of the response, such as the <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> can be checked</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example receives the full <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> object from which you can obtain headers and other useful information.</p>
</div>
</div>

<h2 id="clientPostRequests"><a class="anchor" href="#clientPostRequests"></a>7.1.2 Posting a Request Body</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientPostRequests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>All the examples up until now have used the same HTTP method i.e <code>GET</code>. The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface has factory methods for all the different HTTP methods. The following table summarizes the available methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. HttpRequest Factory Methods</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Allows Body</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#GET-java.lang.String-">HttpRequest.GET(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>GET</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#OPTIONS-java.lang.String-">HttpRequest.OPTIONS(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>OPTIONS</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#HEAD-java.lang.String-">HttpRequest.HEAD(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>HEAD</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#POST-java.lang.String-T-">HttpRequest.POST(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>POST</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PUT-java.lang.String-T-">HttpRequest.PUT(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PUT</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PATCH-java.lang.String-T-">HttpRequest.PATCH(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PATCH</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#DELETE-java.lang.String-">HttpRequest.DELETE(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>DELETE</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <code>create</code> method also exists to construct a request for any <a href="../api/io/micronaut/http/HttpMethod.html">HttpMethod</a> type. Since the <code>POST</code>, <code>PUT</code> and <code>PATCH</code> methods require a body, a second argument which is the body object is required.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to send a simply <code>String</code> body:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;String&gt;&gt; call = client.exchange(
                POST("/hello", "Hello John") <b class="conum">(1)</b>
                    .contentType(MediaType.TEXT_PLAIN_TYPE)
                    .accept(MediaType.TEXT_PLAIN_TYPE), <b class="conum">(2)</b>
                String.class <b class="conum">(3)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;String&gt;&gt; call = client.exchange(
                POST("/hello", "Hello John") <b class="conum">(1)</b>
                    .contentType(MediaType.TEXT_PLAIN_TYPE)
                    .accept(MediaType.TEXT_PLAIN_TYPE), <b class="conum">(2)</b>
                String.class <b class="conum">(3)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/hello", "Hello John") <b class="conum">(1)</b>
                            .contentType(MediaType.TEXT_PLAIN_TYPE)
                            .accept(MediaType.TEXT_PLAIN_TYPE), String::class.java <b class="conum">(3)</b>
            )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>POST</code> method is used with the first argument being the URI and the second argument the body</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The content type and accepted type are set to <code>text/plain</code> (the default content type is <code>application/json</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The expected response type is a <code>String</code></td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_sending_json">Sending JSON</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example sends plain text, if you wish send JSON you can simply pass the object you wish to encode as JSON, whether that be a map or a POJO. As long as Jackson is able to encode it.</p>
</div>
<div class="paragraph">
<p>For example, the <code>Message</code> class from the previous section, you can create an instance and pass it to the <code>POST</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                POST("/greet", new Message("Hello John")), <b class="conum">(1)</b>
                Message.class <b class="conum">(2)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                POST("/greet", new Message("Hello John")), <b class="conum">(1)</b>
                Message.class <b class="conum">(2)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/greet", Message("Hello John")), Message::class.java <b class="conum">(2)</b>
            )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>And instance of <code>Message</code> is created and passed to the <code>POST</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The same class is used to decode the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the above example the following JSON will be sent as the body of the request:</p>
</div>
<div class="listingblock">
<div class="title">Resulting JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"text":"Hello John"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON itself can be customized however you want using <a href="https://github.com/FasterXML/jackson-annotations">Jackson Annotations</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_uri_template">Using a URI Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If some of the properties of the object need to be in the URI being posted to you can use a URI template.</p>
</div>
<div class="paragraph">
<p>For example imagine you have a class <code>Book</code> that has a property called <code>title</code>. You can represent the <code>title</code> property in the URI template and then populate it from an instance of <code>Book</code>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand")),
                Book.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand")),
                Book.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/amazon/book/{title}", Book("The Stand")),
                    Book::class.java
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case the <code>title</code> property of the passed object will be included in the URI being posted to.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_form_data">Sending Form Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also encode a POJO or a map as regular form data instead of JSON. Just set the content type to <code>application/x-www-form-urlencoded</code> on the post request:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand"))
                .contentType(MediaType.APPLICATION_FORM_URLENCODED),
                Book.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand"))
                .contentType(MediaType.APPLICATION_FORM_URLENCODED),
                Book.class
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/amazon/book/{title}", Book("The Stand"))
                            .contentType(MediaType.APPLICATION_FORM_URLENCODED),
                    Book::class.java
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Jackson is used to bind form data too, so to customize the binding process you can use <a href="https://github.com/FasterXML/jackson-annotations">Jackson annotations</a>.</p>
</div>
</div>
</div>

<h2 id="clientUploads"><a class="anchor" href="#clientUploads"></a>7.1.3 Multipart Client Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientUploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP Client supports the ability to create multipart requests. In order to build a multipart request you must set the content type to <code>multipart/form-data</code> and set the body to be an instance of <a href="../api/io/micronaut/http/client/multipart/MultipartBody.html">MultipartBody</a>:</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.client.multipart.MultipartBody;

            String toWrite = "test file";
            File file = File.createTempFile("data", ".txt");
            FileWriter writer = new FileWriter(file);
            writer.write(toWrite);
            writer.close();

            MultipartBody requestBody = MultipartBody.builder()     <b class="conum">(1)</b>
                    .addPart(                                       <b class="conum">(2)</b>
                        "data",
                        file.getName(),
                        MediaType.TEXT_PLAIN_TYPE,
                        file
                    ).build()   ;                                    <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.StreamingFileUpload
import io.micronaut.http.client.multipart.MultipartBody
import org.reactivestreams.Publisher

        File file = new File(uploadDir, "data.txt")
        file.text = "test file"
        file.createNewFile()


        MultipartBody requestBody = MultipartBody.builder()     <b class="conum">(1)</b>
                .addPart(                                       <b class="conum">(2)</b>
                    "data",
                    file.name,
                    MediaType.TEXT_PLAIN_TYPE,
                    file
                ).build()                                       <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.client.multipart.MultipartBody

            val toWrite = "test file"
            val file = File.createTempFile("data", ".txt")
            val writer = FileWriter(file)
            writer.write(toWrite)
            writer.close()

            val requestBody = MultipartBody.builder()     <b class="conum">(1)</b>
                    .addPart(                             <b class="conum">(2)</b>
                            "data",
                            file.name,
                            MediaType.TEXT_PLAIN_TYPE,
                            file
                    ).build()                             <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You need to create a MultipartBody builder for adding parts to the body.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method to add a part to the body, in this case a file. There are different variations of this method which you can see in <a href="../api/io/micronaut/http/client/multipart/MultipartBody.Builder.html" target="_blank" rel="noopener">MultipartBody.Builder</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call the build method to assemble all parts from the builder into a MultipartBody. At least one part is required.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">                    HttpRequest.POST("/multipart/upload", requestBody)       <b class="conum">(1)</b>
                            .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">                HttpRequest.POST("/multipart/upload", requestBody)       <b class="conum">(1)</b>
                        .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">                    HttpRequest.POST("/multipart/upload", requestBody)   <b class="conum">(1)</b>
                            .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The multipart request body with different sets of data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the content-type header of the request to <code>multipart/form-data</code>.</td>
</tr>
</table>
</div>

<h2 id="clientStreaming"><a class="anchor" href="#clientStreaming"></a>7.1.4 Streaming JSON over HTTP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientStreaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s HTTP client includes support for streaming data over HTTP via the <a href="../api/io/micronaut/http/client/RxStreamingHttpClient.html">RxStreamingHttpClient</a> interface which includes methods specific to HTTP streaming including:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. HTTP Streaming Methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a stream of data as a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exchangeStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> wrapping a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsonStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a non-blocking stream of JSON objects</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In order to do JSON streaming you should on the server side declare a controller method that returns a <code>application/x-json-stream</code> of JSON objects. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.reactivex.Flowable;

import java.time.ZonedDateTime;
import java.util.concurrent.TimeUnit;

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines() {
        return Flowable.fromCallable(() -&gt; {  <b class="conum">(2)</b>
            Headline headline = new Headline();
            headline.setText("Latest Headline at " + ZonedDateTime.now());
            return headline;
        }).repeat(100) <b class="conum">(3)</b>
          .delay(1, TimeUnit.SECONDS); <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.reactivex.Flowable

import java.time.ZonedDateTime
import java.util.concurrent.TimeUnit

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines() {
        Flowable.fromCallable({ <b class="conum">(2)</b>
            Headline headline = new Headline()
            headline.setText("Latest Headline at " + ZonedDateTime.now())
            return headline
        }).repeat(100) <b class="conum">(3)</b>
          .delay(1, TimeUnit.SECONDS) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.reactivex.Flowable

import java.time.ZonedDateTime
import java.util.concurrent.TimeUnit


    @Get(value = "/headlines", processes = [MediaType.APPLICATION_JSON_STREAM]) <b class="conum">(1)</b>
    internal fun streamHeadlines(): Flowable&lt;Headline&gt; {
        return Flowable.fromCallable {
            <b class="conum">(2)</b>
            val headline = Headline()
            headline.text = "Latest Headline at " + ZonedDateTime.now()
            headline
        }.repeat(100) <b class="conum">(3)</b>
                .delay(1, TimeUnit.SECONDS) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method <code>streamHeadlines</code> is defined that produces <code>application/x-json-stream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is created from a <code>Callable</code> function (note no blocking occurs within the function so this is ok, otherwise you would want to <code>subscribeOn</code> an I/O thread pool).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is set to repeat 100 times</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> will emit items with a delay of 1 second between each item</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The server does not have to be written in Micronaut, any server that supports JSON streaming will do.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then on the client simply subscribe to the stream using <code>jsonStream</code> and every time the server emits a JSON object the client will decode and consume it:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;Headline&gt; headlineStream = client.jsonStream(GET("/streaming/headlines"), Headline.class); <b class="conum">(1)</b>
        CompletableFuture&lt;Headline&gt; future = new CompletableFuture&lt;&gt;(); <b class="conum">(2)</b>
        headlineStream.subscribe(new Subscriber&lt;Headline&gt;() {
            @Override
            public void onSubscribe(Subscription s) {
                s.request(1); <b class="conum">(3)</b>
            }

            @Override
            public void onNext(Headline headline) {
                System.out.println("Received Headline = " + headline.getText());
                future.complete(headline); <b class="conum">(4)</b>
            }

            @Override
            public void onError(Throwable t) {
                future.completeExceptionally(t); <b class="conum">(5)</b>
            }

            @Override
            public void onComplete() {
                // no-op <b class="conum">(6)</b>
            }
        });</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;Headline&gt; headlineStream = client.jsonStream(GET("/streaming/headlines"), Headline.class) <b class="conum">(1)</b>
        CompletableFuture&lt;Headline&gt; future = new CompletableFuture&lt;&gt;() <b class="conum">(2)</b>
        headlineStream.subscribe(new Subscriber&lt;Headline&gt;() {
            @Override
            void onSubscribe(Subscription s) {
                s.request(1) <b class="conum">(3)</b>
            }

            @Override
            void onNext(Headline headline) {
                System.out.println("Received Headline = " + headline.getText())
                future.complete(headline) <b class="conum">(4)</b>
            }

            @Override
            void onError(Throwable t) {
                future.completeExceptionally(t) <b class="conum">(5)</b>
            }

            @Override
            void onComplete() {
                // no-op <b class="conum">(6)</b>
            }
        })</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val headlineStream = client.jsonStream(GET&lt;Any&gt;("/streaming/headlines"), Headline::class.java) <b class="conum">(1)</b>
            val future = CompletableFuture&lt;Headline&gt;() <b class="conum">(2)</b>
            headlineStream.subscribe(object : Subscriber&lt;Headline&gt; {
                override fun onSubscribe(s: Subscription) {
                    s.request(1) <b class="conum">(3)</b>
                }

                override fun onNext(headline: Headline) {
                    println("Received Headline = " + headline.text!!)
                    future.complete(headline) <b class="conum">(4)</b>
                }

                override fun onError(t: Throwable) {
                    future.completeExceptionally(t) <b class="conum">(5)</b>
                }

                override fun onComplete() {
                    // no-op <b class="conum">(6)</b>
                }
            })</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>jsonStream</code> method is used return a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>CompletableFuture</code> is used in the example to receive a value, but what you do with each emitted item is application specific</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Subscription.html">Subscription</a> is used to request a single item. You can use the <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Subscription.html">Subscription</a> to regulate back pressure and demand.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>onNext</code> method is called when an item is emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>onError</code> method is called when an error occurs</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>onComplete</code> method is called when all <code>Headline</code> instances have been emitted</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note neither the server or the client in the example above perform blocking I/O at any point.</p>
</div>

<h2 id="clientConfiguration"><a class="anchor" href="#clientConfiguration"></a>7.1.5 Configuring HTTP clients</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_global_configuration_for_all_clients">Global Configuration for All Clients</h3>
<div class="paragraph">
<p>The default HTTP client configuration is a <a href="#configurationProperties">Configuration Properties</a> called <a href="../api/io/micronaut/http/client/DefaultHttpClientConfiguration.html">DefaultHttpClientConfiguration</a> that allows configuring the default behaviour for all HTTP clients. For example, in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Altering default HTTP client configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-timeout: 5s</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example sets of <code>readTimeout</code> property of the <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_client_specific_configuration">Client Specific Configuration</h3>
<div class="paragraph">
<p>If you wish to have a separate configuration per client then there a couple of options. You can configure <a href="#serviceDiscoveryManual">Service Discovery</a> manually in <code>application.yml</code> and apply per-client configuration:</p>
</div>
<div class="listingblock">
<div class="title">Manually configuring HTTP services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        services:
            foo:
                urls:
                    - http://foo1
                    - http://foo2
                read-timeout: 5s <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The read timeout is applied to the <code>foo</code> client.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>WARN: This client configuration can be used in conjunction with the <code>@Client</code> annotation, either by injecting an <code>HttpClient</code> directly or use on a client interface. In any case, all other attributes on the annotation <strong>will be ignored</strong> other than the service id.</p>
</div>
<div class="paragraph">
<p>Then simply inject the named client configuration:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("foo") @Inject RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also simply define a bean that extends from <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> and ensuring that the <code>javax.inject.Named</code> annotation is used to name it appropriately:</p>
</div>
<div class="listingblock">
<div class="title">Defining an HTTP client configuration bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("twitter")
@Singleton
class TwitterHttpClientConfiguration extends HttpClientConfiguration {
   public TwitterHttpClientConfiguration(ApplicationConfiguration applicationConfiguration) {
        super(applicationConfiguration);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration will then be picked up if you inject a service called <code>twitter</code> using <code>@Client</code> using <a href="#serviceDiscovery">Service Discovery</a>:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("twitter") @Inject RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively if you are not using service discovery then you can use the <code>configuration</code> member of <code>@Client</code> to refer to a specific type:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(value="https://api.twitter.com/1.1",
        configuration=TwitterHttpClientConfiguration.class)
@Inject
RxHttpClient httpClient;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_http_client_connection_pooling">Using HTTP Client Connection Pooling</h3>
<div class="paragraph">
<p>If you have a client that needs to handle a significant number of requests then you can benefit from enabling HTTP client connection pooling. The following configuration will enable pooling for the <code>foo</code> client:</p>
</div>
<div class="listingblock">
<div class="title">Manually configuring HTTP services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        services:
            foo:
                urls:
                    - http://foo1
                    - http://foo2
                pool:
                    enabled: true <i class="conum" data-value="1"></i><b>(1)</b>
                    max-connections: 50 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables the pool</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the maximum number of connections in the pool</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the API for <a href="../api/io/micronaut/http/client/HttpClientConfiguration.ConnectionPoolConfiguration.html">ConnectionPoolConfiguration</a> for details on available options to configure the pool.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_event_loop_groups">Configuring Event Loop Groups</h3>
<div class="paragraph">
<p>By default Micronaut will share a common Netty <code>EventLoopGroup</code> for worker threads and all HTTP clients threads.</p>
</div>
<div class="paragraph">
<p>This common <code>EventLoopGroup</code> can be configured via the <code>micronaut.netty.event-loops.default</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Configuring The Default Event Loop</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    netty:
        event-loops:
            default:
                num-threads: 10
                prefer-native-transport: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>micronaut.netty.event-loops</code> setting to configure one or more additional event loops. The following table summarizes the properties:</p>
</div>
<a id="io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration" href="#io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/netty/channel/DefaultEventLoopGroupConfiguration.html">DefaultEventLoopGroupConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.num-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.io-ratio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.prefer-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.executor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, if your interactions with an HTTP client involve CPU intensive work it may be worthwhile configuring a separate <code>EventLoopGroup</code> for one or all clients.</p>
</div>
<div class="paragraph">
<p>The following example configures an additional event loop group called "other" that uses 10 threads:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Additional Event Loops</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    netty:
        event-loops:
            other:
                num-threads: 10
                prefer-native-transport: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once an additional event loop has been configured you can alter the HTTP client configuration to use the newly defined event loop group:</p>
</div>
<div class="listingblock">
<div class="title">Altering the Event Loop Group used by Clients</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            event-loop-group: other</code></pre>
</div>
</div>
</div>

<h2 id="lowLevelClientError"><a class="anchor" href="#lowLevelClientError"></a>7.1.6 Error Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient/lowLevelClientError.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If an HTTP response is returned with a code of 400 or above, an <a href="../api/io/micronaut/http/client/exceptions/HttpClientResponseException.html">HttpClientResponseException</a> is created. The exception contains the original response. How that exception gets thrown depends on the return type of the method.</p>
</div>
<div class="paragraph">
<p>For blocking clients, the exception is thrown and should be caught and handled by the caller. For reactive clients, the exception is passed through the publisher as an error.</p>
</div>

<h2 id="bindErrors"><a class="anchor" href="#bindErrors"></a>7.1.7 Bind Errors</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/lowLevelHttpClient/bindErrors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often you want to consume an endpoint and bind to a POJO if the request is successful or bind to a different POJO if an error occurs. The following example shows how to invoke <code>exchange</code> with a success and error type.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/books")
public class BooksController {

    @Get("/{isbn}")
    public HttpResponse find(String isbn) {
        if (isbn.equals("1680502395")) {
            Map&lt;String, Object&gt; m = new HashMap&lt;&gt;();
            m.put("status", 401);
            m.put("error", "Unauthorized");
            m.put("message", "No message available");
            m.put("path", "/books/"+isbn);
            return HttpResponse.status(HttpStatus.UNAUTHORIZED).body(m);

        }
        return HttpResponse.ok(new Book("1491950358", "Building Microservices"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/books")
class BooksController {

    @Get("/{isbn}")
    HttpResponse find(String isbn) {
        if (isbn == "1680502395") {
            Map&lt;String, Object&gt; m = new HashMap&lt;&gt;()
            m.put("status", 401)
            m.put("error", "Unauthorized")
            m.put("message", "No message available")
            m.put("path", "/books/"+isbn)
            return HttpResponse.status(HttpStatus.UNAUTHORIZED).body(m)

        }
        return HttpResponse.ok(new Book("1491950358", "Building Microservices"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/books")
class BooksController {

    @Get("/{isbn}")
    fun find(isbn: String): HttpResponse&lt;*&gt; {
        if (isbn == "1680502395") {
            val m = HashMap&lt;String, Any&gt;()
            m["status"] = 401
            m["error"] = "Unauthorized"
            m["message"] = "No message available"
            m["path"] = "/books/$isbn"
            return HttpResponse.status&lt;Any&gt;(HttpStatus.UNAUTHORIZED).body(m)

        }
        return HttpResponse.ok(Book("1491950358", "Building Microservices"))
    }
}</code></pre>
</div>
</div>
<hr>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void afterAnHttpClientExceptionTheResponseBodyCanBeBoundToAPOJO() {
        try {
            client.toBlocking().exchange(HttpRequest.GET("/books/1680502395"),
                    Argument.of(Book.class), <b class="conum">(1)</b>
                    Argument.of(CustomError.class)); <b class="conum">(2)</b>
        } catch (HttpClientResponseException e) {
            assertEquals(HttpStatus.UNAUTHORIZED, e.getResponse().getStatus());
            Optional&lt;CustomError&gt; jsonError = e.getResponse().getBody(CustomError.class);
            assertTrue(jsonError.isPresent());
            assertEquals(401, jsonError.get().status);
            assertEquals("Unauthorized", jsonError.get().error);
            assertEquals("No message available", jsonError.get().message);
            assertEquals("/books/1680502395", jsonError.get().path);
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    def "after an HttpClientException the response body can be bound to a POJO"() {
        when:
        client.toBlocking().exchange(HttpRequest.GET("/books/1680502395"),
                Argument.of(Book), <b class="conum">(1)</b>
                Argument.of(CustomError)) <b class="conum">(2)</b>

        then:
        def e = thrown(HttpClientResponseException)
        e.response.status == HttpStatus.UNAUTHORIZED

        when:
        Optional&lt;CustomError&gt; jsonError = e.response.getBody(CustomError)

        then:
        jsonError.isPresent()
        jsonError.get().status == 401
        jsonError.get().error == 'Unauthorized'
        jsonError.get().message == 'No message available'
        jsonError.get().path == '/books/1680502395'
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "after an httpclient exception the response body can be bound to a POJO" {
            try {
                client.toBlocking().exchange(HttpRequest.GET&lt;Any&gt;("/books/1680502395"),
                        Argument.of(Book::class.java), <b class="conum">(1)</b>
                        Argument.of(CustomError::class.java)) <b class="conum">(2)</b>
            } catch (e: HttpClientResponseException) {
                e.response.status shouldBe HttpStatus.UNAUTHORIZED
            }
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Success Type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Error Type</td>
</tr>
</table>
</div>

<h2 id="proxyClient"><a class="anchor" href="#proxyClient"></a>7.2 Proxying Requests with ProxyHttpClient</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/proxyClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A common requirement in Microservice environments is to proxy requests in a Gateway Microservice to other backend Microservices.</p>
</div>
<div class="paragraph">
<p>The regular <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> API is designed around simplifying exchange of messages and is not really designed for proxying requests. For this use case you should use the the <a href="../api/io/micronaut/http/client/ProxyHttpClient.html">ProxyHttpClient</a> which can be used from a <a href="#filters">HTTP Server Filter</a> to proxy requests to backend Microservices.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates rewriting requests under the URI <code>/proxy</code> to the URI <code>/real</code> onto the same server (clearly in a real environment you would generally proxy onto another server):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty pipeline for Logbook</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.async.publisher.Publishers;
import io.micronaut.core.util.StringUtils;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.MutableHttpResponse;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.client.ProxyHttpClient;
import io.micronaut.http.filter.*;
import io.micronaut.http.filter.ServerFilterChain;
import io.micronaut.runtime.server.EmbeddedServer;
import org.reactivestreams.Publisher;

@Filter("/proxy/**")
public class ProxyFilter extends OncePerRequestHttpServerFilter { <b class="conum">(1)</b>
    private final ProxyHttpClient client;
    private final EmbeddedServer embeddedServer;

    public ProxyFilter(ProxyHttpClient client, EmbeddedServer embeddedServer) { <b class="conum">(2)</b>
        this.client = client;
        this.embeddedServer = embeddedServer;
    }

    @Override
    protected Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilterOnce(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        return Publishers.map(client.proxy( <b class="conum">(3)</b>
                request.mutate() <b class="conum">(4)</b>
                        .uri(b -&gt; b <b class="conum">(5)</b>
                                .scheme("http")
                                .host(embeddedServer.getHost())
                                .port(embeddedServer.getPort())
                                .replacePath(StringUtils.prependUri(
                                        "/real",
                                        request.getPath().substring("/proxy".length())
                                ))
                        )
                        .header("X-My-Request-Header", "XXX") <b class="conum">(6)</b>
        ), response -&gt; response.header("X-My-Response-Header", "YYY"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty pipeline for Logbook</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.async.publisher.Publishers
import io.micronaut.core.util.StringUtils
import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.ProxyHttpClient
import io.micronaut.http.filter.*
import io.micronaut.http.filter.ServerFilterChain
import io.micronaut.http.uri.UriBuilder
import io.micronaut.runtime.server.EmbeddedServer
import org.reactivestreams.Publisher


@Filter("/proxy/**")
class ProxyFilter extends OncePerRequestHttpServerFilter { <b class="conum">(1)</b>
    private final ProxyHttpClient client
    private final EmbeddedServer embeddedServer

    ProxyFilter(ProxyHttpClient client, EmbeddedServer embeddedServer) { <b class="conum">(2)</b>
        this.client = client
        this.embeddedServer = embeddedServer
    }

    @Override
    protected Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilterOnce(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        return Publishers.map(client.proxy( <b class="conum">(3)</b>
                request.mutate() <b class="conum">(4)</b>
                        .uri { UriBuilder b -&gt; <b class="conum">(5)</b>
                            b.with {
                                scheme("http")
                                host(embeddedServer.getHost())
                                port(embeddedServer.getPort())
                                replacePath(StringUtils.prependUri(
                                                "/real",
                                                request.getPath().substring("/proxy".length())
                                ))
                            }
                        }
                        .header("X-My-Request-Header", "XXX") <b class="conum">(6)</b>
        ), { MutableHttpResponse&lt;?&gt; response -&gt; response.header("X-My-Response-Header", "YYY")})
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty pipeline for Logbook</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.async.publisher.Publishers
import io.micronaut.core.util.StringUtils
import io.micronaut.http.*
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.ProxyHttpClient
import io.micronaut.http.filter.*
import io.micronaut.http.uri.UriBuilder
import io.micronaut.runtime.server.EmbeddedServer
import org.reactivestreams.Publisher
import java.util.function.Function

@Filter("/proxy/**")
class ProxyFilter(
        private val client: ProxyHttpClient, <b class="conum">(2)</b>
        private val embeddedServer: EmbeddedServer) : OncePerRequestHttpServerFilter() { <b class="conum">(1)</b>
    override fun doFilterOnce(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
        return Publishers.map(client.proxy( <b class="conum">(3)</b>
                request.mutate() <b class="conum">(4)</b>
                        .uri { b: UriBuilder -&gt; <b class="conum">(5)</b>
                            b.apply {
                                scheme("http")
                                host(embeddedServer.host)
                                port(embeddedServer.port)
                                replacePath(StringUtils.prependUri(
                                        "/real",
                                        request.path.substring("/proxy".length)
                                ))
                            }
                        }
                        .header("X-My-Request-Header", "XXX") <b class="conum">(6)</b>
        ), Function { response: MutableHttpResponse&lt;*&gt; -&gt; response.header("X-My-Response-Header", "YYY") })
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The filter extends <a href="../api/io/micronaut/http/filter/OncePerRequestHttpServerFilter.html">OncePerRequestHttpServerFilter</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/client/ProxyHttpClient.html">ProxyHttpClient</a> is injected into the constructor.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>proxy</code> method is used to proxy the request</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The request is mutated to modify the URI and include an additional header</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Here the <a href="../api/io/micronaut/http/uri/UriBuilder.html">UriBuilder</a> API is used to rewrite the URI</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Additional request and response headers are included</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/http/client/ProxyHttpClient.html">ProxyHttpClient</a> API is a low level API that can be used to build a higher level abstraction such as an API Gateway.
</td>
</tr>
</table>
</div>

<h2 id="clientAnnotation"><a class="anchor" href="#clientAnnotation"></a>7.3 Declarative HTTP Clients with @Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that you have gathered an understanding of the workings of the lower level HTTP client, it is time to take a look at Micronaut&#8217;s support for declarative clients via the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>Essentially, the <code>@Client</code> annotation can be declared on any interface or abstract class and through the use of <a href="#introductionAdvice">Introduction Advice</a> the abstract methods will be implemented for you at compile time, greatly simplifying the creation of HTTP clients.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example. Given the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Pet {
    private String name;
    private int age;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class Pet {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class Pet {
    var name: String? = null
    var age: Int = 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a common interface for saving new <code>Pet</code> instances:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;
import io.reactivex.Single;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@Validated
public interface PetOperations {
    @Post
    Single&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import io.reactivex.Single

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Validated
interface PetOperations {
    @Post
    Single&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import io.reactivex.Single

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank


@Validated
interface PetOperations {
    @Post
    fun save(@NotBlank name: String, @Min(1L) age: Int): Single&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the interface uses Micronaut&#8217;s HTTP annotations which are usable on both the server and client side. Also, as you can see you can use <code>javax.validation</code> constraints to validate arguments.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Be aware that some annotations, such as <a href="../api/io/micronaut/http/client/annotation/Produces.html">Produces</a> and <a href="../api/io/micronaut/http/client/annotation/Consumes.html">Consumes</a>, have different semantics between server and client side usage. For example, <code>@Produces</code> on a controller method (server side) indicates how the method&#8217;s <strong>return value</strong> is formatted, while <code>@Produces</code> on a client indicates how the method&#8217;s <strong>parameters</strong> are formatted when sent to the server. While this may seem a little confusing at first, it is actually logical considering the different semantics between a server producing/consuming vs a client: A server consumes an argument and <strong>returns</strong> a response to the client, whereas a client consumes an argument and <strong>sends</strong> output to a server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, to use the <code>javax.validation</code> features you should have the <code>validation</code> module on your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>On the server-side of Micronaut you can implement the <code>PetOperations</code> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.reactivex.Single;

@Controller("/pets")
public class PetController implements PetOperations {

    @Override
    public Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet();
        pet.setName(name);
        pet.setAge(age);
        // save to database or something
        return Single.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.reactivex.Single

@Controller("/pets")
class PetController implements PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet()
        pet.setName(name)
        pet.setAge(age)
        // save to database or something
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.reactivex.Single


@Controller("/pets")
open class PetController : PetOperations {

    override fun save(name: String, age: Int): Single&lt;Pet&gt; {
        val pet = Pet()
        pet.name = name
        pet.age = age
        // save to database or something
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then define a declarative client in <code>src/test/java</code> that uses <code>@Client</code> to automatically, at compile time, implement a client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.client.annotation.Client;
import io.reactivex.Single;

@Client("/pets") <b class="conum">(1)</b>
public interface PetClient extends PetOperations { <b class="conum">(2)</b>

    @Override
    Single&lt;Pet&gt; save(String name, int age); <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.client.annotation.Client
import io.reactivex.Single

@Client("/pets") <b class="conum">(1)</b>
interface PetClient extends PetOperations { <b class="conum">(2)</b>

    @Override
    Single&lt;Pet&gt; save(String name, int age) <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.client.annotation.Client
import io.reactivex.Single


@Client("/pets") <b class="conum">(1)</b>
interface PetClient : PetOperations { <b class="conum">(2)</b>

    override fun save(name: String, age: Int): Single&lt;Pet&gt;  <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is used with a value relative to the current server. In this case <code>/pets</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The interface extends from <code>PetOperations</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>save</code> method is overridden. See warning below.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Notice in the above example we override the <code>save</code> method. This is necessary if you compile without the <code>-parameters</code> option since Java does not retain parameters names in the byte code otherwise. If you compile with <code>-parameters</code> then overriding is not necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined a client you can simply <code>@Inject</code> it wherever you may need it.</p>
</div>
<div class="paragraph">
<p>Recall that the value of <code>@Client</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An absolute URI. Example <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the server targeted will be the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a production deployment you would typically use a service ID and <a href="#serviceDiscovery">Service Discovery</a> to discover services automatically.</p>
</div>
<div class="paragraph">
<p>Another important thing to notice regarding the <code>save</code> method in the example above is that is returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> type.</p>
</div>
<div class="paragraph">
<p>This is a non-blocking reactive type and typically you want your HTTP clients not to block. There are cases where you may want to write an HTTP client that does block (such as in unit test cases), but this are rare.</p>
</div>
<div class="paragraph">
<p>The following table illustrates common return types usable with <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single&lt;HttpResponse&lt;String&gt;&gt; hello()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> implementation that emits a POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;Book&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A blocking native type. Such as <code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Generally, any reactive type that can be converted to the <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> interface is supported as a return type including (but not limited to) the reactive types defined by RxJava 1.x, RxJava 2.x and Reactor 3.x.</p>
</div>
<div class="paragraph">
<p>Returning <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> instances is also supported. Note that returning any other type <em>will result in a blocking request</em> and is not recommended other than for testing.</p>
</div>

<h2 id="clientParameters"><a class="anchor" href="#clientParameters"></a>7.3.1 Customizing Parameter Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/clientParameters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous example presented a trivial example that uses the parameters of a method to represent the body of a <code>POST</code> request:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post
Single&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>save</code> method when called will perform an HTTP <code>POST</code> with the following JSON by default:</p>
</div>
<div class="listingblock">
<div class="title">Example Produced JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"name":"Dino", "age":10}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may however want to customize what is sent as the body, the parameters, URI variables and so on. The <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation is very flexible in this regard and supports the same <a href="../api/io/micronaut/http/annotation/package-summary.html">HTTP Annotations</a> as Micronaut&#8217;s HTTP server.</p>
</div>
<div class="paragraph">
<p>For example, the following defines a URI template and the <code>name</code> parameter is used as part of the URI template, whilst <a href="../api/io/micronaut/http/annotation/Body.html">@Body</a> is used declare that the contents to send to the server are represented by the <code>Pet</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post("/{name}")
Single&lt;Pet&gt; save(
    @NotBlank String name, <i class="conum" data-value="1"></i><b>(1)</b>
    @Body @Valid Pet pet) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name parameter, included as part of the URI, and declared <code>@NotBlank</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>pet</code> parameter, used to encode the body and declared <code>@Valid</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table summarizes the parameter annotations, their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to specify the parameter that is the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be sent as cookies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be sent as HTTP headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String contentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows customizing the name of the URI parameter to bind from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryValue("userAge") Integer age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/PathVariable.html">@PathVariable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to bind a parameter exclusively from a <a href="#routing">Path Variable</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathVariable Long id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@RequestAttribute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be set as request attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestAttribute Integer locationId</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_type_based_binding_parameters">Type Based Binding Parameters</h4>
<div class="paragraph">
<p>Some parameters are recognized by their type instead of their annotation. The following table summarizes the parameter types, their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/BasicAuth.html">BasicAuth</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows binding of basic authorization credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuth basicAuth</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_custom_binding">Custom Binding</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/bind/ClientArgumentRequestBinder.html">ClientArgumentRequestBinder</a> API is what is responsible for binding client arguments to the request. Custom binder classes registered as beans will automatically be used during the binding process. Annotation based binders are searched for first, with type based binders being searched if a binder was not found.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an experimental feature in 2.1 and subject to change! One limitation of binding is that binders many not manipulate or set the request URI because it can be a combination of many arguments.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_binding_by_annotation">Binding By Annotation</h5>
<div class="paragraph">
<p>To control how an argument is bound to the request based on the annotation applied to the argument, create a bean of type <a href="../api/io/micronaut/http/client/bind/AnnotatedClientArgumentRequestBinder.html">AnnotatedClientArgumentRequestBinder</a>. Any custom annotations must be annotated with <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a>.</p>
</div>
<div class="paragraph">
<p>In this example, see the following client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With @Metadata Argument</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/")
public interface MetadataClient {

    @Get("/client/bind")
    String get(@Metadata Map&lt;String, Object&gt; metadata);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With @Metadata Argument</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/")
interface MetadataClient {

    @Get("/client/bind")
    String get(@Metadata Map metadata)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With @Metadata Argument</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/")
interface MetadataClient {

    @Get("/client/bind")
    operator fun get(@Metadata metadata: Map&lt;String, Any&gt;): String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The argument is annotated with the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Metadata Annotation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.bind.annotation.Bindable;
import java.lang.annotation.*;

@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.PARAMETER)
@Bindable
public @interface Metadata {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Metadata Annotation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.bind.annotation.Bindable
import java.lang.annotation.*

@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.PARAMETER)
@Bindable
@interface Metadata {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Metadata Annotation</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.bind.annotation.Bindable

@MustBeDocumented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.VALUE_PARAMETER)
@Bindable
annotation class Metadata</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without any additional code, the client will attempt to convert the metadata to a string and append it as a query parameter. In this case that isn&#8217;t the desired effect so a custom binder must be created.</p>
</div>
<div class="paragraph">
<p>The following binder will handle arguments passed to clients that are annotated with the <code>@Metadata</code> annotation and then mutate the request to contain the desired headers. The implementation could be modified to accept more types of data other than <code>Map</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Argument Binder</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import edu.umd.cs.findbugs.annotations.NonNull;
import io.micronaut.core.convert.ArgumentConversionContext;
import io.micronaut.core.naming.NameUtils;
import io.micronaut.core.util.StringUtils;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.client.bind.AnnotatedClientArgumentRequestBinder;
import io.micronaut.http.client.bind.ClientRequestUriContext;
import org.jetbrains.annotations.NotNull;

import javax.inject.Singleton;
import java.util.Map;

@Singleton
public class MetadataClientArgumentBinder implements AnnotatedClientArgumentRequestBinder&lt;Metadata&gt; {

    @NotNull
    @Override
    public Class&lt;Metadata&gt; getAnnotationType() {
        return Metadata.class;
    }


    @Override
    public void bind(@NotNull ArgumentConversionContext&lt;Object&gt; context,
                     @NonNull ClientRequestUriContext uriContext,
                     @NotNull Object value,
                     @NotNull MutableHttpRequest&lt;?&gt; request) {
        if (value instanceof Map) {
            for (Map.Entry&lt;?, ?&gt; entry: ((Map&lt;?, ?&gt;) value).entrySet()) {
                String key = NameUtils.hyphenate(StringUtils.capitalize(entry.getKey().toString()), false);
                request.header("X-Metadata-" + key, entry.getValue().toString());
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Argument Binder</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.naming.NameUtils
import io.micronaut.core.util.StringUtils
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.AnnotatedClientArgumentRequestBinder
import io.micronaut.http.client.bind.ClientRequestUriContext
import org.jetbrains.annotations.NotNull

import javax.inject.Singleton

@Singleton
class MetadataClientArgumentBinder implements AnnotatedClientArgumentRequestBinder&lt;Metadata&gt; {

    Class&lt;Metadata&gt; annotationType = Metadata

    @Override
    void bind(@NotNull ArgumentConversionContext&lt;Object&gt; context,
              @NonNull ClientRequestUriContext uriContext,
              @NotNull Object value,
              @NotNull MutableHttpRequest&lt;?&gt; request) {
        if (value instanceof Map) {
            for (def entry: ((Map) value).entrySet()) {
                String key = NameUtils.hyphenate(StringUtils.capitalize(entry.key.toString()), false)
                request.header("X-Metadata-" + key, entry.value.toString())
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Argument Binder</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.naming.NameUtils
import io.micronaut.core.util.StringUtils
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.AnnotatedClientArgumentRequestBinder
import io.micronaut.http.client.bind.ClientRequestUriContext
import javax.inject.Singleton

@Singleton
class MetadataClientArgumentBinder : AnnotatedClientArgumentRequestBinder&lt;Metadata&gt; {

    override fun getAnnotationType(): Class&lt;Metadata&gt; {
        return Metadata::class.java
    }

    override fun bind(context: ArgumentConversionContext&lt;Any&gt;,
                      uriContext: ClientRequestUriContext,
                      value: Any,
                      request: MutableHttpRequest&lt;*&gt;) {
        if (value is Map&lt;*, *&gt;) {
            for ((key1, value1) in value) {
                val key = NameUtils.hyphenate(StringUtils.capitalize(key1.toString()), false)
                request.header("X-Metadata-$key", value1.toString())
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_binding_by_type">Binding By Type</h5>
<div class="paragraph">
<p>To bind to the request based on the type of the argument, create a bean of type <a href="../api/io/micronaut/http/client/bind/TypedClientArgumentRequestBinder.html">TypedClientArgumentRequestBinder</a>.</p>
</div>
<div class="paragraph">
<p>In this example, see the following client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Metadata Argument</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/")
public interface MetadataClient {

    @Get("/client/bind")
    String get(Metadata metadata);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Metadata Argument</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/")
interface MetadataClient {

    @Get("/client/bind")
    String get(Metadata metadata)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Metadata Argument</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/")
interface MetadataClient {
    @Get("/client/bind")
    operator fun get(metadata: Metadata?): String?
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without any additional code, the client will attempt to convert the metadata to a string and append it as a query parameter. In this case that isn&#8217;t the desired effect so a custom binder must be created.</p>
</div>
<div class="paragraph">
<p>The following binder will handle arguments passed to clients that are of the <code>Metadata</code> type and then mutate the request to contain the desired headers.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Typed Argument Binder</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import edu.umd.cs.findbugs.annotations.NonNull;
import io.micronaut.core.convert.ArgumentConversionContext;
import io.micronaut.core.type.Argument;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.client.bind.ClientRequestUriContext;
import io.micronaut.http.client.bind.TypedClientArgumentRequestBinder;

import javax.inject.Singleton;

@Singleton
public class MetadataClientArgumentBinder implements TypedClientArgumentRequestBinder&lt;Metadata&gt; {

    @Override
    @NonNull
    public Argument&lt;Metadata&gt; argumentType() {
        return Argument.of(Metadata.class);
    }

    @Override
    public void bind(@NonNull ArgumentConversionContext&lt;Metadata&gt; context,
                     @NonNull ClientRequestUriContext uriContext,
                     @NonNull Metadata value,
                     @NonNull MutableHttpRequest&lt;?&gt; request) {
        request.header("X-Metadata-Version", value.getVersion().toString());
        request.header("X-Metadata-Deployment-Id", value.getDeploymentId().toString());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Typed Argument Binder</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import edu.umd.cs.findbugs.annotations.NonNull
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.ClientRequestUriContext
import io.micronaut.http.client.bind.TypedClientArgumentRequestBinder

import javax.inject.Singleton

@Singleton
class MetadataClientArgumentBinder implements TypedClientArgumentRequestBinder&lt;Metadata&gt; {

    @Override
    @NonNull
    Argument&lt;Metadata&gt; argumentType() {
        return Argument.of(Metadata)
    }

    @Override
    void bind(@NonNull ArgumentConversionContext&lt;Metadata&gt; context,
              @NonNull ClientRequestUriContext uriContext,
              @NonNull Metadata value,
              @NonNull MutableHttpRequest&lt;?&gt; request) {
        request.header("X-Metadata-Version", value.version.toString())
        request.header("X-Metadata-Deployment-Id", value.deploymentId.toString())
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Typed Argument Binder</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.ClientRequestUriContext
import io.micronaut.http.client.bind.TypedClientArgumentRequestBinder
import javax.inject.Singleton

@Singleton
class MetadataClientArgumentBinder : TypedClientArgumentRequestBinder&lt;Metadata?&gt; {

    override fun argumentType(): Argument&lt;Metadata?&gt; {
        return Argument.of(Metadata::class.java)
    }

    override fun bind(context: ArgumentConversionContext&lt;Metadata?&gt;,
                      uriContext: ClientRequestUriContext,
                      value: Metadata,
                      request: MutableHttpRequest&lt;*&gt;) {
        request.header("X-Metadata-Version", value.version.toString())
        request.header("X-Metadata-Deployment-Id", value.deploymentId.toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="clientAnnotationStreaming"><a class="anchor" href="#clientAnnotationStreaming"></a>7.3.2 Streaming with @Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/clientAnnotationStreaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/Client.html">@Client</a> annotation can also handle streaming HTTP responses.</p>
</div>
<div class="sect2">
<h3 id="_streaming_json_with_client">Streaming JSON with @Client</h3>
<div class="paragraph">
<p>For example to write a client that streams data from the controller defined in the <a href="#clientStreaming">JSON Streaming</a> section of the documentation you can simply define a client that returns an unbound <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> such as a RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> or Reactor <code>Flux</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Flowable;

@Client("/streaming")
public interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines(); <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Flowable

@Client("/streaming")
interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines() <b class="conum">(2)</b>

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Flowable


@Client("/streaming")
interface HeadlineClient {

    @Get(value = "/headlines", processes = [MediaType.APPLICATION_JSON_STREAM]) <b class="conum">(1)</b>
    fun streamHeadlines(): Flowable&lt;Headline&gt;  <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Get</code> method is defined as processing responses of type <code>APPLICATION_JSON_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is used as the return type</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how the previously defined <code>HeadlineClient</code> can be invoked from a JUnit test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void testClientAnnotationStreaming() throws Exception {
        try( EmbeddedServer embeddedServer = ApplicationContext.run(EmbeddedServer.class) ) {
            HeadlineClient headlineClient = embeddedServer
                                                .getApplicationContext()
                                                .getBean(HeadlineClient.class); <b class="conum">(1)</b>

            Maybe&lt;Headline&gt; firstHeadline = headlineClient.streamHeadlines().firstElement(); <b class="conum">(2)</b>

            Headline headline = firstHeadline.blockingGet(); <b class="conum">(3)</b>

            assertNotNull( headline );
            assertTrue( headline.getText().startsWith("Latest Headline") );
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    void "test client annotation streaming"() throws Exception {
        when:
        HeadlineClient headlineClient = embeddedServer.getApplicationContext()
                                            .getBean(HeadlineClient.class) <b class="conum">(1)</b>

        Maybe&lt;Headline&gt; firstHeadline = headlineClient.streamHeadlines().firstElement() <b class="conum">(2)</b>

        Headline headline = firstHeadline.blockingGet() <b class="conum">(3)</b>

        then:
        null != headline
        headline.getText().startsWith("Latest Headline")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "test client annotation streaming" {
            val headlineClient = embeddedServer
                    .applicationContext
                    .getBean(HeadlineClient::class.java) <b class="conum">(1)</b>

            val firstHeadline = headlineClient.streamHeadlines().firstElement() <b class="conum">(2)</b>

            val headline = firstHeadline.blockingGet() <b class="conum">(3)</b>

            headline shouldNotBe null
            headline.text shouldStartWith "Latest Headline"
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The client is retrieved from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>firstElement</code> method is used to return the first emitted item from the <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> as a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Maybe.html">Maybe</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>blockingGet()</code> is used in the test to retrieve the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_clients_and_response_types">Streaming Clients and Response Types</h3>
<div class="paragraph">
<p>The example defined in the previous section expects the server to respond with a stream of JSON objects and the content type to be <code>application/x-json-stream</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">A JSON Stream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"title":"The Stand"}
{"title":"The Shining"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason for this is simple, a sequence of JSON object is not, in fact, valid JSON and hence the response content type cannot be <code>application/json</code>. For the JSON to be valid it would have to return an array:</p>
</div>
<div class="listingblock">
<div class="title">A JSON Array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {"title":"The Stand"},
    {"title":"The Shining"}
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s client does however support streaming of both individual JSON objects via <code>application/x-json-stream</code> and also JSON arrays defined with <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>If the server returns <code>application/json</code> and a non-single <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> is returned (such as an <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> or a Reactor <code>Flux</code>) then the client with stream the array elements as they become available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_clients_and_read_timeout">Streaming Clients and Read Timeout</h3>
<div class="paragraph">
<p>When streaming responses from servers, the underlying HTTP client will not apply the default <code>readTimeout</code> setting (which defaults to 10 seconds) of the <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> since the delay between reads for streaming responses may differ from normal reads.</p>
</div>
<div class="paragraph">
<p>Instead the <code>read-idle-timeout</code> setting (which defaults to 60 seconds) is used to dictate when a connection should be closed after becoming idle.</p>
</div>
<div class="paragraph">
<p>If you are streaming data from a server that defines a longer delay than 60 seconds between items being sent to the client you should adjust the <code>readIdleTimeout</code>. The following configuration in <code>application.yml</code> demonstrates how:</p>
</div>
<div class="listingblock">
<div class="title">Adjusting the readIdleTimeout</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-idle-timeout: 5m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example sets the <code>readIdleTimeout</code> to 5 minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_server_sent_events">Streaming Server Sent Events</h3>
<div class="paragraph">
<p>Micronaut features a native client for Server Sent Events (SSE) defined by the interface <a href="../api/io/micronaut/http/client/sse/SseClient.html">SseClient</a>.</p>
</div>
<div class="paragraph">
<p>You can use this client to stream SSE events from any server that emits them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although SSE streams are typically consumed by a browser <code>EventSource</code>, there are a few cases where you may wish to consume a SSE stream via <a href="../api/io/micronaut/http/client/sse/SseClient.html">SseClient</a> such as in unit testing or when a Micronaut service acts as a gateway for another service.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/Client.html">@Client</a> annotation also supports consuming SSE streams. For example, consider the following controller method that produces a stream of SSE events:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Event&lt;Headline&gt;&gt; streamHeadlines() {
        return Flowable.&lt;Event&lt;Headline&gt;&gt;create((emitter) -&gt; {  <b class="conum">(2)</b>
            Headline headline = new Headline();
            headline.setText("Latest Headline at " + ZonedDateTime.now());
            emitter.onNext(Event.of(headline));
            emitter.onComplete();
        }, BackpressureStrategy.BUFFER).repeat(100) <b class="conum">(3)</b>
          .delay(1, TimeUnit.SECONDS); <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Event&lt;Headline&gt;&gt; streamHeadlines() {
        Flowable.&lt;Event&lt;Headline&gt;&gt;create( { emitter -&gt; <b class="conum">(2)</b>
            Headline headline = new Headline()
            headline.setText("Latest Headline at " + ZonedDateTime.now())
            emitter.onNext(Event.of(headline))
            emitter.onComplete()
        }, BackpressureStrategy.BUFFER).repeat(100) <b class="conum">(3)</b>
         .delay(1, TimeUnit.SECONDS) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get(value = "/headlines", processes = [MediaType.TEXT_EVENT_STREAM]) <b class="conum">(1)</b>
    internal fun streamHeadlines(): Flowable&lt;Event&lt;Headline&gt;&gt; {
        return Flowable.create&lt;Event&lt;Headline&gt;&gt;( {  <b class="conum">(2)</b>
            emitter -&gt;
            val headline = Headline()
            headline.text = "Latest Headline at " + ZonedDateTime.now()
            emitter.onNext(Event.of(headline))
            emitter.onComplete()
        }, BackpressureStrategy.BUFFER).repeat(100) <b class="conum">(3)</b>
                .delay(1, TimeUnit.SECONDS) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller defines a <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation that produces a <code>MediaType.TEXT_EVENT_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method itself uses Reactor to emit a hypothetical <code>Headline</code> object</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>repeat</code> method is used to repeat the emission 100 times</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>With a delay of 1 second between each item emitted.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that the return type of the controller is also <a href="../api/io/micronaut/http/sse/Event.html">Event</a> and that the <code>Event.of</code> method is used to create events to stream to the client.</p>
</div>
<div class="paragraph">
<p>To define a client that consumes the events you simply have to define a method that processes <code>MediaType.TEXT_EVENT_STREAM</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/streaming/sse")
public interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM)
    Flowable&lt;Event&lt;Headline&gt;&gt; streamHeadlines();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/streaming/sse")
interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM)
    Flowable&lt;Event&lt;Headline&gt;&gt; streamHeadlines()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/streaming/sse")
interface HeadlineClient {

    @Get(value = "/headlines", processes = [MediaType.TEXT_EVENT_STREAM])
    fun streamHeadlines(): Flowable&lt;Event&lt;Headline&gt;&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic type of the <code>Flux</code> or <code>Flowable</code> can be either an <a href="../api/io/micronaut/http/sse/Event.html">Event</a>, in which case you will receive the full event object, or a POJO, in which case you will receive only the data contained within the event converted from JSON.</p>
</div>
</div>

<h2 id="clientError"><a class="anchor" href="#clientError"></a>7.3.3 Error Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/clientError.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If an HTTP response is returned with a code of 400 or above, an <a href="../api/io/micronaut/http/client/exceptions/HttpClientResponseException.html">HttpClientResponseException</a> is created. The exception contains the original response. How that exception gets thrown depends on the return type of the method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For reactive response types, the exception is passed through the publisher as an error.</p>
</li>
<li>
<p>For blocking response types, the exception is thrown and should be caught and handled by the caller.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The one exception to this rule is HTTP Not Found (404) responses. This exception only applies to the declarative client.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HTTP Not Found (404) responses for blocking return types is <strong>not</strong> considered an error condition and the client exception will <strong>not</strong> be thrown. That behavior includes methods that return <code>void</code>.</p>
</div>
<div class="paragraph">
<p>If the method returns an <code>HttpResponse</code>, the original response will be returned. If the return type is <code>Optional</code>, an empty optional will be returned. For all other types, <code>null</code> will be returned.</p>
</div>

<h2 id="clientHeaders"><a class="anchor" href="#clientHeaders"></a>7.3.4 Customizing Request Headers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/clientHeaders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Customizing the request headers deserves special mention as there are several ways that can be accomplished.</p>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_configuration">Populating Headers Using Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation can be declared at the type level and is repeatable such that it is possible to drive the request headers sent via configuration using annotation metadata.</p>
</div>
<div class="paragraph">
<p>The following example serves to illustrate this:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/pets")
@Header(name="X-Pet-Client", value="${pet.client.id}")
public interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age);

    @Get("/{name}")
    Single&lt;Pet&gt; get(String name);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/pets")
@Header(name="X-Pet-Client", value='${pet.client.id}')
interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age)

    @Get("/{name}")
    Single&lt;Pet&gt; get(String name)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/pets")
@Header(name = "X-Pet-Client", value = "\${pet.client.id}")
interface PetClient : PetOperations {

    override fun save(name: String, age: Int): Single&lt;Pet&gt;

    @Get("/{name}")
    operator fun get(name: String): Single&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation on the <code>PetClient</code> interface that reads a property using property placeholder configuration called <code>pet.client.id</code>.</p>
</div>
<div class="paragraph">
<p>In your application configuration you then set the following in <code>application.yml</code> to populate the value:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Headers in YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">pet:
    client:
        id: foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can supply a <code>PET_CLIENT_ID</code> environment variable and the value will be populated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_an_client_filter">Populating Headers using an Client Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alternatively if you need the ability to dynamically populate headers an alternative is to use a <a href="#clientFilter">Client Filter</a>.</p>
</div>
<div class="paragraph">
<p>For more information on writing client filters see the <a href="#clientFilter">Client Filters</a> section of the guide.</p>
</div>
</div>
</div>

<h2 id="clientJackson"><a class="anchor" href="#clientJackson"></a>7.3.5 Customizing Jackson Settings</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/clientJackson.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Jackson is used for message encoding to JSON. A default Jackson <code>ObjectMapper</code> is configured and used by Micronaut HTTP clients.</p>
</div>
<div class="paragraph">
<p>You can override the settings used to construct the <code>ObjectMapper</code> using the properties defined by the <a href="../api/io/micronaut/jackson/JacksonConfiguration.html">JacksonConfiguration</a> class in <code>application.yml</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following configuration enabled indented output for Jackson:</p>
</div>
<div class="listingblock">
<div class="title">Example Jackson Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
    serialization:
        indentOutput: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, these settings apply globally and impact both how the HTTP server renders JSON and how JSON is sent from the HTTP client. Given that sometimes it useful to provide client specific Jackson settings which can be done with the <a href="../api/io/micronaut/jackson/annotation/JacksonFeatures.html">@JacksonFeatures</a> annotation on any client:</p>
</div>
<div class="paragraph">
<p>As an example, the following snippet is taken from Micronaut&#8217;s native Eureka client (which, of course, is built using Micronaut&#8217;s HTTP client):</p>
</div>
<div class="listingblock">
<div class="title">Example of JacksonFeatures</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(id = EurekaClient.SERVICE_ID, path = "/eureka", configuration = EurekaConfiguration.class)
@JacksonFeatures(
    enabledSerializationFeatures = WRAP_ROOT_VALUE,
    disabledSerializationFeatures = WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED,
    enabledDeserializationFeatures = {UNWRAP_ROOT_VALUE, ACCEPT_SINGLE_VALUE_AS_ARRAY}
)
public interface EurekaClient {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Eureka serialization format for JSON uses the <code>WRAP_ROOT_VALUE</code> serialization feature of Jackson, hence it is enabled just for that client.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the customization offered by <code>JacksonFeatures</code> is not enough, you can also write a <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> for the <code>ObjectMapper</code> and add whatever customizations you need.
</td>
</tr>
</table>
</div>

<h2 id="clientRetry"><a class="anchor" href="#clientRetry"></a>7.3.6 Retry and Circuit Breaker</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/clientRetry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Being able to recover from failure is critical for HTTP clients, and that is where the integrated <a href="#retry">Retry Advice</a> included as part of Micronaut comes in really handy.</p>
</div>
<div class="paragraph">
<p>You can declare the <a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a> or <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">@CircuitBreaker</a> annotations on any <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> interface and the retry policy will be applied, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/pets")
@Retryable
public interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/pets")
@Retryable
interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/pets")
@Retryable
interface PetClient : PetOperations {

    override fun save(name: String, age: Int): Single&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on customizing retry, see the section on <a href="#retry">Retry Advice</a>.</p>
</div>

<h2 id="clientFallback"><a class="anchor" href="#clientFallback"></a>7.3.7 Client Fallbacks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/clientFallback.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems, failure happens and it is best to be prepared for it and handle it in as graceful a manner possible.</p>
</div>
<div class="paragraph">
<p>In addition, when developing Microservices it is quite common to work on a single Microservice without other Microservices the project requires being available.</p>
</div>
<div class="paragraph">
<p>With that in mind Micronaut features a native fallback mechanism that is integrated into <a href="#retry">Retry Advice</a> that allows falling back to another implementation in the case of failure.</p>
</div>
<div class="paragraph">
<p>Using the <a href="../api/io/micronaut/retry/annotation/Fallback.html">@Fallback</a> annotation you can declare a fallback implementation of a client that will be picked up and used once all possible retries have been exhausted.</p>
</div>
<div class="paragraph">
<p>In fact the mechanism is not strictly linked to Retry, you can declare any class as <a href="../api/io/micronaut/retry/annotation/Recoverable.html">@Recoverable</a> and if a method call fails (or, in the case of reactive types, an error is emitted) a class annotated with <code>@Fallback</code> will be searched for.</p>
</div>
<div class="paragraph">
<p>To illustrate this consider again the <code>PetOperations</code> interface declared earlier. You can define a <code>PetFallback</code> class that will be called in the case of failure:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Fallback
public class PetFallback implements PetOperations {
    @Override
    public Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet();
        pet.setAge(age);
        pet.setName(name);
        return Single.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Fallback
class PetFallback implements PetOperations {
    @Override
    public Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet()
        pet.setAge(age)
        pet.setName(name)
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Fallback
open class PetFallback : PetOperations {
    override fun save(name: String, age: Int): Single&lt;Pet&gt; {
        val pet = Pet()
        pet.age = age
        pet.name = name
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you purely want to use fallbacks to help with testing against external Microservices you can define fallbacks in the <code>src/test/java</code> directory so they are not included in production code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see the fallback does not perform any network operations and is quite simple, hence will provide a successful result in the case of an external system being down.</p>
</div>
<div class="paragraph">
<p>Of course, the actual behaviour of the fallback is down to you. You could for example implement a fallback that pulls data from a local cache when the real data is not available, and sends alert emails to operations about downtime or whatever.</p>
</div>

<h2 id="netflixHystrix"><a class="anchor" href="#netflixHystrix"></a>7.3.8 Netflix Hystrix Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientAnnotation/netflixHystrix.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>netflix-hystrix</code> feature to configure Hystrix in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features netflix-hystrix</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/Netflix/Hystrix">Netflix Hystrix</a> is a fault tolerance library developed by the Netflix team and designed to improve resilience of inter process communication.</p>
</div>
<div class="paragraph">
<p>Micronaut features integration with Hystrix through the <code>netflix-hystrix</code> module, which you can add to your <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.netflix:micronaut-netflix-hystrix")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.netflix&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-netflix-hystrix&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="sect1">
<h2 id="_using_the_hystrixcommand_annotation">Using the @HystrixCommand Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the above dependency declared you can annotate any method (including methods defined on <code>@Client</code> interfaces) with the <a href="../api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a> annotation and it will wrap the methods execution in a Hystrix command. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @HystrixCommand</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@HystrixCommand
String hello(String name) {
    return "Hello $name"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This works for reactive return types such as <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> etc. as well and the reactive type will be wrapped in a <code>HystrixObservableCommand</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a> annotation also integrates with Micronauts support for <a href="#retry">Retry Advice</a> and <a href="#clientFallback">Fallbacks</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For information on how to customize the Hystrix thread pool, group and properties see the javadoc for <a href="../api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_hystrix_stream_dashboard">Enabling Hystrix Stream &amp; Dashboard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can enable a Server Sent Event stream to feed into the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> by setting the <code>hystrix.stream.enabled</code> setting to <code>true</code> in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Hystrix Stream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hystrix:
    stream:
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This exposes a <code>/hystrix.stream</code> endpoint with the format the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> expects.</p>
</div>
</div>
</div>

<h2 id="clientFilter"><a class="anchor" href="#clientFilter"></a>7.4 HTTP Client Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientFilter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when calling another Microservice.</p>
</div>
<div class="paragraph">
<p>To simplify this, Micronaut includes the ability to define <a href="../api/io/micronaut/http/filter/HttpClientFilter.html">HttpClientFilter</a> classes that are applied to all matching HTTP client requests.</p>
</div>
<div class="paragraph">
<p>As an example say you want to build a client to communicate with the <a href="https://bintray.com/docs/api/">Bintray REST API</a>. It would be terribly tedious to have to specify authentication for every single HTTP call.</p>
</div>
<div class="paragraph">
<p>To resolve this burden you can define a filter. The following is an example <code>BintrayService</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
class BintrayService {
    final RxHttpClient client;
    final String org;

    BintrayService(
            @Client(BintrayApi.URL) RxHttpClient client,           <b class="conum">(1)</b>
            @Value("${bintray.organization}") String org ) {
        this.client = client;
        this.org = org;
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchRepositories() {
        return client.exchange(HttpRequest.GET("/repos/" + org), String.class); <b class="conum">(2)</b>
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchPackages(String repo) {
        return client.exchange(HttpRequest.GET("/repos/" + org + "/" + repo + "/packages"), String.class); <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
class BintrayService {
    final RxHttpClient client
    final String org

    BintrayService(
            @Client(BintrayApi.URL) RxHttpClient client,           <b class="conum">(1)</b>
            @Value('${bintray.organization}') String org ) {
        this.client = client
        this.org = org
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchRepositories() {
        return client.exchange(HttpRequest.GET("/repos/$org"), String) <b class="conum">(2)</b>
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchPackages(String repo) {
        return client.exchange(HttpRequest.GET("/repos/${org}/${repo}/packages"), String) <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
internal class BintrayService(
        @param:Client(BintrayApi.URL) val client: RxHttpClient, <b class="conum">(1)</b>
        @param:Value("\${bintray.organization}") val org: String) {

    fun fetchRepositories(): Flowable&lt;HttpResponse&lt;String&gt;&gt; {
        return client.exchange(HttpRequest.GET&lt;Any&gt;("/repos/$org"), String::class.java) <b class="conum">(2)</b>
    }

    fun fetchPackages(repo: String): Flowable&lt;HttpResponse&lt;String&gt;&gt; {
        return client.exchange(HttpRequest.GET&lt;Any&gt;("/repos/$org/$repo/packages"), String::class.java) <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> is injected for the Bintray API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The organization is configurable via configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Bintray API is secured. To authenticate you need to add an <code>Authorization</code> header for every request. You could modify <code>fetchRepositories</code> and <code>fetchPackages</code> methods to include the necessary HTTP Header for each request. Using a filter is much simpler though:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Filter("/repos/**") <b class="conum">(1)</b>
class BintrayFilter implements HttpClientFilter {

    final String username;
    final String token;

    BintrayFilter(
            @Value("${bintray.username}") String username, <b class="conum">(2)</b>
            @Value("${bintray.token}") String token ) { <b class="conum">(2)</b>
        this.username = username;
        this.token = token;
    }

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        return chain.proceed(
                request.basicAuth(username, token) <b class="conum">(3)</b>
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Filter('/repos/**') <b class="conum">(1)</b>
class BintrayFilter implements HttpClientFilter {


    final String username
    final String token

    BintrayFilter(
            @Value('${bintray.username}') String username, <b class="conum">(2)</b>
            @Value('${bintray.token}') String token ) { <b class="conum">(2)</b>
        this.username = username
        this.token = token
    }

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        return chain.proceed(
                request.basicAuth(username, token) <b class="conum">(3)</b>
        )
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Filter("/repos/**") <b class="conum">(1)</b>
internal class BintrayFilter(
        @param:Value("\${bintray.username}") val username: String, <b class="conum">(2)</b>
        @param:Value("\${bintray.token}") val token: String)<b class="conum">(2)</b>
    : HttpClientFilter {

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;&gt; {
        return chain.proceed(
                request.basicAuth(username, token) <b class="conum">(3)</b>
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can match only a subset of paths with a Client filter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>username</code> and <code>token</code> are injected via configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>basicAuth</code> method is used include the HTTP BASIC credentials</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, whenever you invoke the <code>bintrayService.fetchRepositories()</code> method, the <code>Authorization</code> HTTP header is included in the request.</p>
</div>
<div class="sect2">
<h3 id="_injecting_another_client_into_a_httpclientfilter">Injecting Another Client into a HttpClientFilter</h3>
<div class="paragraph">
<p>It should be noted that in order to create a <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> Micronaut needs to resolve all of the <code>HttpClientFilter</code> instances which creates a circular dependency in the case where you need to inject another <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> or a <code>@Client</code> bean into an instance of a <code>HttpClientFilter</code>.</p>
</div>
<div class="paragraph">
<p>To resolve this issue you should use the <code>javax.inject.Provider</code> interface to inject another <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> or a <code>@Client</code> bean into an instance of <code>HttpClientFilter</code>.</p>
</div>
<div class="paragraph">
<p>The following example which implements a filter that allows <a href="https://cloud.google.com/run/docs/authenticating/service-to-service">authentication between services on Google Cloud Run</a> demonstrates how to use <code>Provider</code> to inject another client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.micronaut.http.*;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.client.RxHttpClient;
import io.micronaut.http.filter.ClientFilterChain;
import io.micronaut.http.filter.HttpClientFilter;
import io.reactivex.Flowable;
import org.reactivestreams.Publisher;
import javax.inject.Provider;
import java.io.UnsupportedEncodingException;
import java.net.URI;
import java.net.URLEncoder;

@Requires(env = Environment.GOOGLE_COMPUTE)
@Filter(patterns = "/google-auth/api/**")
public class GoogleAuthFilter implements HttpClientFilter {
    private final Provider&lt;RxHttpClient&gt; authClientProvider;

    public GoogleAuthFilter(Provider&lt;RxHttpClient&gt; httpClientProvider) { <b class="conum">(1)</b>
        this.authClientProvider = httpClientProvider;
    }

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        Flowable&lt;String&gt; token = Flowable.fromCallable(() -&gt; encodeURI(request))
                .flatMap(authURI -&gt; authClientProvider.get().retrieve(HttpRequest.GET(authURI).header( <b class="conum">(2)</b>
                        "Metadata-Flavor", "Google"
                )));

        return token.flatMap(t -&gt; chain.proceed(request.bearerAuth(t)));
    }

    private String encodeURI(MutableHttpRequest&lt;?&gt; request) throws UnsupportedEncodingException {
        URI fullURI = request.getUri();
        String receivingURI = fullURI.getScheme() + "://" + fullURI.getHost();
        return "http://metadata/computeMetadata/v1/instance/service-accounts/default/identity?audience=" +
                URLEncoder.encode(receivingURI, "UTF-8");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import io.reactivex.Flowable
import org.reactivestreams.Publisher

import javax.inject.Provider

@Requires(env = Environment.GOOGLE_COMPUTE)
@Filter(patterns = "/google-auth/api/**")
class GoogleAuthFilter implements HttpClientFilter {
    private final Provider&lt;RxHttpClient&gt; authClientProvider

    GoogleAuthFilter(Provider&lt;RxHttpClient&gt; httpClientProvider) { <b class="conum">(1)</b>
        this.authClientProvider = httpClientProvider
    }

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        Flowable&lt;String&gt; token = Flowable.fromCallable(() -&gt; encodeURI(request))
                .flatMap(authURI -&gt; authClientProvider.get().retrieve(HttpRequest.GET(authURI).header( <b class="conum">(2)</b>
                        "Metadata-Flavor", "Google"
                )))

        return token.flatMap(t -&gt; chain.proceed(request.bearerAuth(t)))
    }

    private static String encodeURI(MutableHttpRequest&lt;?&gt; request) {
        String receivingURI = "$request.uri.scheme://$request.uri.host"
        return "http://metadata/computeMetadata/v1/instance/service-accounts/default/identity?audience=" +
                URLEncoder.encode(receivingURI, "UTF-8")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import io.reactivex.Flowable
import org.reactivestreams.Publisher
import java.net.URLEncoder
import javax.inject.Provider

@Requires(env = [Environment.GOOGLE_COMPUTE])
@Filter(patterns = ["/google-auth/api/**"])
class GoogleAuthFilter (
        private val authClientProvider: Provider&lt;RxHttpClient&gt;) : HttpClientFilter { <b class="conum">(1)</b>
    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;?&gt; {
        val token = Flowable.fromCallable { encodeURI(request) }
                .flatMap { authURI: String -&gt;
                    authClientProvider.get().retrieve(HttpRequest.GET&lt;Any&gt;(authURI).header( <b class="conum">(2)</b>
                            "Metadata-Flavor", "Google"
                    ))
                }
        return token.flatMap { t -&gt; chain.proceed(request.bearerAuth(t)) }
    }

    private fun encodeURI(request: MutableHttpRequest&lt;*&gt;): String {
        val receivingURI = "${request.uri.scheme}://${request.uri.host}"
        return "http://metadata/computeMetadata/v1/instance/service-accounts/default/identity?audience=" +
                URLEncoder.encode(receivingURI, "UTF-8")
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>javax.inject.Provider</code> interface is used to inject another client, avoiding a circular reference</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>get()</code> method of the <code>Provider</code> interface is used to obtain the client instance.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_filter_matching_by_annotation">Filter Matching By Annotation</h3>
<div class="paragraph">
<p>For cases where a filter should be applied to a client, regardless of the URL, filters can be matched by the presence of an annotation applied to both the filter and the client. Given the following client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;

@BasicAuth <b class="conum">(1)</b>
@Client("/message")
public interface BasicAuthClient {

    @Get
    String getMessage();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client

@BasicAuth <b class="conum">(1)</b>
@Client("/message")
interface BasicAuthClient {

    @Get
    String getMessage()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client

@BasicAuth <b class="conum">(1)</b>
@Client("/message")
interface BasicAuthClient {

    @Get
    fun getMessage(): String
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@BasicAuth</code> annotation is applied to the client</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following filter will filter the client requests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.filter.ClientFilterChain;
import io.micronaut.http.filter.HttpClientFilter;
import org.reactivestreams.Publisher;

import javax.inject.Singleton;

@BasicAuth <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
public class BasicAuthClientFilter implements HttpClientFilter {

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        return chain.proceed(request.basicAuth("user", "pass"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

import javax.inject.Singleton

@BasicAuth <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
class BasicAuthClientFilter implements HttpClientFilter {

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        chain.proceed(request.basicAuth("user", "pass"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

import javax.inject.Singleton

@BasicAuth <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
class BasicAuthClientFilter : HttpClientFilter {

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;&gt; {
        return chain.proceed(request.basicAuth("user", "pass"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The same annotation, <code>@BasicAuth</code>, is applied to the filter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Normally the <code>@Filter</code> annotation makes filters singletons by default. Because the <code>@Filter</code> annotation is not used, the desired scope must be applied</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@BasicAuth</code> annotation is just an example and can be replaced with your own custom annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.FilterMatcher;

import java.lang.annotation.*;

@FilterMatcher <b class="conum">(1)</b>
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.TYPE, ElementType.PARAMETER})
public @interface BasicAuth {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.FilterMatcher

import java.lang.annotation.*

@FilterMatcher <b class="conum">(1)</b>
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.TYPE, ElementType.PARAMETER])
@interface BasicAuth {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.FilterMatcher

@FilterMatcher <b class="conum">(1)</b>
@MustBeDocumented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.CLASS, AnnotationTarget.VALUE_PARAMETER)
annotation class BasicAuth</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The only requirement for custom annotations is that the <a href="../api/io/micronaut/http/annotation/HttpFilterStereotype.html">@HttpFilterStereotype</a> annotation must be present</td>
</tr>
</table>
</div>
</div>

<h2 id="clientSample"><a class="anchor" href="#clientSample"></a>7.5 HTTP Client Sample</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/httpClient/clientSample.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the HTTP Client Guide (<a href="http://guides.micronaut.io/micronaut-http-client/guide/index.html">Java</a>,
<a href="http://guides.micronaut.io/micronaut-http-client-groovy/guide/index.html">Groovy</a>,
<a href="http://guides.micronaut.io/micronaut-http-client-kotlin/guide/index.html">Kotlin</a>), a step-by-step tutorial, to learn more.
</td>
</tr>
</table>
</div>

<h1 id="cloud"><a class="anchor" href="#cloud"></a>8 Cloud Native Features</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The majority of frameworks in use today on the JVM were designed before the rise of cloud deployments and microservice architectures. Applications built with these frameworks were intended to be deployed to traditional Java containers. As a result, cloud support in these frameworks typically comes as an add-on rather than as core design features.</p>
</div>
<div class="paragraph">
<p>Micronaut was designed from the ground up for building microservices for the cloud. As a result, many key features that typically require external libraries or services are available within your application itself.  To override one of the industry&#8217;s current favorite buzzwords, Micronaut applications are "natively cloud-native".</p>
</div>
<div class="paragraph">
<p>The following are some of the cloud-specific features that are integrated directly into the Micronaut runtime:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed Configuration</p>
</li>
<li>
<p>Service Discovery</p>
</li>
<li>
<p>Client-Side Load-Balancing</p>
</li>
<li>
<p>Distributed Tracing</p>
</li>
<li>
<p>Serverless Functions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many of the features in Micronaut and heavily inspired by features from Spring and Grails. This is by design and helps developers who are already familiar with systems such as Spring Cloud.</p>
</div>
<div class="paragraph">
<p>The following sections cover these features and how to use them.</p>
</div>

<h2 id="cloudConfiguration"><a class="anchor" href="#cloudConfiguration"></a>8.1 Cloud Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/cloudConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Applications that are built for the Cloud often need adapt to running in a Cloud environment, read and share configuration in a distributed manner and externalize configuration to the environment where necessary.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="#environments">Environment</a> concept is by default Cloud platform aware and will make a best effort to detect the underlying active environment.</p>
</div>
<div class="paragraph">
<p>You can then use the <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation to <a href="#conditionalBeans">conditionally load bean definitions</a>.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the constants provided by the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Environment Detection</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Constant</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requires Example</th>
<th class="tableblock halign-left valign-top">Environment name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#ANDROID">ANDROID</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running as an Android application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.ANDROID)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>android</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running within a JUnit or Spock test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.TEST)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD">CLOUD</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running in a Cloud environment (present for all other cloud platform types)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloud</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AMAZON_EC2">AMAZON_EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://aws.amazon.com/ec2">Amazon EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AMAZON_EC2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ec2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#GOOGLE_COMPUTE">GOOGLE_COMPUTE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://cloud.google.com/compute/">Google Compute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.GOOGLE_COMPUTE)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#KUBERNETES">KUBERNETES</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.kubernetes.io">Kubernetes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.KUBERNETES)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k8s</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#HEROKU">HEROKU</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://heroku.com">Heroku</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.HEROKU)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>heroku</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD_FOUNDRY">CLOUD_FOUNDRY</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.cloudfoundry.org">Cloud Foundry</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD_FOUNDRY)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pcf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AZURE">AZURE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://azure.microsoft.com">Microsoft Azure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AZURE)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#IBM">IBM</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.ibm.com/cloud/">IBM Cloud</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.IBM)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ibm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#DIGITAL_OCEAN">DIGITAL_OCEAN</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.digitalocean.com/">Digital Ocean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.DIGITAL_OCEAN)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>digitalocean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#ORACLE_CLOUD">ORACLE_CLOUD</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://cloud.oracle.com/">Oracle Cloud</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.ORACLE_CLOUD)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oraclecloud</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that it may be the case that you have multiple active environment names since you may run Kubernetes on AWS for example.</p>
</div>
<div class="paragraph">
<p>In addition, using the value of the constants defined in the table above you can create environment specific configuration files. For example if you create a <code>src/main/resources/application-gcp.yml</code> file then that configuration will only be loaded when running on Google Compute.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Any configuration property in the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> can also be set via an environment variable. For example, setting the <code>CONSUL_CLIENT_HOST</code> environment variable will override the <code>host</code> property in <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_using_cloud_instance_metadata">Using Cloud Instance Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Micronaut detects it is running on any of the cloud platforms listed above, such as Google Compute or AWS EC2, upon startup Micronaut will populate the interface <a href="../api/io/micronaut/discovery/cloud/ComputeInstanceMetadata.html">ComputeInstanceMetadata</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As of Micronaut 2.1.x this logic depends on the presence of the appropriate core Cloud module for Oracle Cloud, AWS or GCP.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All of this data is merged together into the <code>metadata</code> property for the running <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>If you need to access the metadata for your application instance you can use the interface <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a>, and call <code>getMetadata()</code> which will get a map of all of the metadata.</p>
</div>
<div class="paragraph">
<p>If you are connecting remotely via client, the instance metadata can be referenced once you have retrieved a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> from either the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> or <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Netflix Ribbon client side load balancer can be configured to use the metadata to do zone aware client side load balancing. See <a href="#clientSideLoadBalancing">Client Side Load Balancing</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To obtain metadata for a service via <a href="#serviceDiscovery">Service Discovery</a> use the <a href="../api/io/micronaut/http/client/LoadBalancerResolver.html">LoadBalancerResolver</a> interface to resolve a <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> and obtain a reference to a service by identifier:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Service instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoadBalancer loadBalancer = loadBalancerResolver.resolve("some-service");
Flowable.fromPublisher(
    loadBalancer.select()
).subscribe((instance) -&gt;
    ConvertibleValues&lt;String&gt; metaData = instance.getMetadata();
    ...
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a> is available through event listeners that listen for the <a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a>. The <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation makes it easy to listen for the event inside one of your existing beans.</p>
</div>
<div class="paragraph">
<p>To obtain metadata for the locally running server use an <a href="#events">EventListener</a> for the <a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a>:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Local Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EventListener
void onServiceStarted(ServiceReadyEvent event) {
    ServiceInstance serviceInstance = event.getSource()
    ConvertibleValues&lt;String&gt; metadata = serviceInstance.metadata
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="distributedConfiguration"><a class="anchor" href="#distributedConfiguration"></a>8.1.1 Distributed Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As you can see, Micronaut features a robust system for externalizing and adapting configuration to the environment inspired by similar approaches found in Grails and Spring Boot.</p>
</div>
<div class="paragraph">
<p>However, what if you want two Microservices to share configuration? Micronaut comes with built in APIs for doing distributed configuration.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> interface has a single method called <code>getPropertySources</code> that can be implemented to read and resolve configuration from distributed sources.</p>
</div>
<div class="paragraph">
<p>The <code>getPropertySources</code> returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits zero or many <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances.</p>
</div>
<div class="paragraph">
<p>The default implementation is <a href="../api/io/micronaut/discovery/config/DefaultCompositeConfigurationClient.html">DefaultCompositeConfigurationClient</a> which merges all registered <code>ConfigurationClient</code> beans into a single bean.</p>
</div>
<div class="paragraph">
<p>You can either implement your own <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> implementation or you can use one of the ones already built into Micronaut. The following sections cover those.</p>
</div>

<h2 id="distributedConfigurationConsul"><a class="anchor" href="#distributedConfigurationConsul"></a>8.1.2 HashiCorp Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native <a href="../api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install/index.html">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_distributed_configuration_with_consul">Enabling Distributed Configuration with Consul</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>config-consul</code> feature to enable Consul&#8217;s distributed configuration in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features config-consul</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable distributed configuration, similar to Spring Boot and Grails, you need to create a <code>src/main/resources/bootstrap.yml</code> configuration file and configure Consul as well as enable the configuration client:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: hello-world
    config-client:
        enabled: true
consul:
    client:
        defaultZone: "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have enabled distributed configuration you need to store the configuration you wish to share in Consul&#8217;s Key/Value store.</p>
</div>
<div class="paragraph">
<p>There are a number of different ways to do that.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_key_value_pairs">Storing Configuration as Key/Value Pairs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One way is to store each key and value directly in Consul. In this case by default Micronaut will look for configuration in the <code>/config</code> folder of Consul.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can alter the path searched for by setting <code>consul.client.config.path</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Within the <code>/config</code> folder Micronaut will search values within the following folders in order of precedence:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application,prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for the <code>prod</code> <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration, example <code>/config/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME],prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration for an active <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The value of <code>APPLICATION_NAME</code> is whatever your have configured <code>micronaut.application.name</code> to be in <code>bootstrap.yml</code>.</p>
</div>
<div class="paragraph">
<p>To see this in action use the following curl command to store a property called <code>foo.bar</code> with a value of <code>myvalue</code> in the folder <code>/config/application</code>.</p>
</div>
<div class="listingblock">
<div class="title">Using curl to Write a Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X PUT -d @- localhost:8500/v1/kv/config/application/foo.bar &lt;&lt;&lt; myvalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you now define a <code>@Value("${foo.bar}")</code> or call <code>environment.getProperty(..)</code> the value <code>myvalue</code> will be resolved from Consul.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_in_yaml_json_etc">Storing Configuration in YAML, JSON etc.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some Consul users prefer storing configuration in blobs of a certain format, such as YAML. Micronaut supports this mode and supports storing configuration in either YAML, JSON or Java properties format.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/discovery/config/ConfigDiscoveryConfiguration.html">ConfigDiscoveryConfiguration</a> has a number of configuration options for configuring how distributed configuration is discovered.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can set the <code>consul.client.config.format</code> option to configure the format with which properties are read.</p>
</div>
<div class="paragraph">
<p>For example, to configure JSON:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">consul:
    client:
        config:
            format: JSON</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now write your configuration in JSON format to Consul:</p>
</div>
<div class="listingblock">
<div class="title">Using curl write JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X PUT  localhost:8500/v1/kv/config/application \
-d @- &lt;&lt; EOF
{ "foo": {  "bar": "myvalue" } }
EOF</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_file_references">Storing Configuration as File References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another popular option is <a href="https://github.com/breser/git2consul">git2consul</a> which mirrors the contents of a Git repository to Consul&#8217;s Key/Value store.</p>
</div>
<div class="paragraph">
<p>You can setup a Git repository that contains files like <code>application.yml</code>, <code>hello-world-test.json</code> etc. and the contents of these files are cloned to Consul.</p>
</div>
<div class="paragraph">
<p>In this case each key in consul represents a file with an extension. For example <code>/config/application.yml</code> and you must configure the <code>FILE</code> format:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">consul:
    client:
        config:
            format: FILE</code></pre>
</div>
</div>
</div>
</div>

<h2 id="distributedConfigurationVault"><a class="anchor" href="#distributedConfigurationVault"></a>8.1.3 HashiCorp Vault Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationVault.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features support for integration with <a href="https://www.vaultproject.io/">HashiCorp Vault</a> as a distributed configuration source.</p>
</div>
<div class="paragraph">
<p>To enable support for Vault Configuration simply add the following configuration to your <code>bootstrap.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Integrating with HashiCorp Vault</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: hello-world
    config-client:
        enabled: true

vault:
    client:
        config:
            enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/guide/configurationreference.html#io.micronaut.discovery.vault.config.VaultClientConfiguration">configuration reference</a> for all configuration options.</p>
</div>
<div class="paragraph">
<p>Micronaut will use the configured <code>micronaut.application.name</code> to lookup property sources for the application from Vault.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/application/[ENV_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for an active environment name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/[APPLICATION_NAME]/[ENV_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration for an active environment name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="https://www.vaultproject.io/api/secret/kv/index.html">Documentation for HashiCorp Vault</a> for more information on how to setup the server.</p>
</div>

<h2 id="distributedConfigurationSpringCloud"><a class="anchor" href="#distributedConfigurationSpringCloud"></a>8.1.4 Spring Cloud Config Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationSpringCloud.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.1, Micronaut features a native <a href="https://spring.io/projects/spring-cloud-config">Spring Cloud Configuration</a> for those who have not switched to a dedicated more complete solution like Consul.</p>
</div>
<div class="paragraph">
<p>To enable support for Spring Cloud Configuration simply add the following configuration to your <code>bootstrap.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Integrating with Spring Cloud Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: hello-world
    config-client:
        enabled: true
spring:
    cloud:
        config:
            enabled: true
            uri: http://localhost:8888/
            retry-attempts: 4 # optional, number of times to retry
            retry-delay: 2s # optional, delay between retries</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will use the configured <code>micronaut.application.name</code> to lookup property sources for the application from Spring Cloud config server configured via <code>spring.cloud.config.uri</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://spring.io/projects/spring-cloud-config#learn">Documentation for Spring Cloud Config Server</a> for more information on how to setup the server.</p>
</div>

<h2 id="distributedConfigurationAwsParameterStore"><a class="anchor" href="#distributedConfigurationAwsParameterStore"></a>8.1.5 AWS Parameter Store Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationAwsParameterStore.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports configuration sharing via AWS System Manager Parameter Store. You will need the following dependencies configured:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.aws:micronaut-aws-parameter-store")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-parameter-store&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>To enable distributed configuration a <code>src/main/resources/bootstrap.yml</code> configuration file must be created and configured to use Parameter Store:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: hello-world
    config-client:
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/guide/configurationreference.html#io.micronaut.discovery.aws.parameterstore.AWSParameterStoreConfiguration">configuration reference</a> for all configuration options.</p>
</div>
<div class="paragraph">
<p>You can configure shared properties by going into the AWS Console &#8594; System Manager &#8594; Parameter Store</p>
</div>
<div class="paragraph">
<p>Micronaut will use a hierarchy to read the configuration values, and supports <code>String</code>, <code>StringList</code>, and <code>SecureString</code> types.</p>
</div>
<div class="paragraph">
<p>You can make environment specific configurations as well by including the environment name after an underscore <code>_</code>. For example if your <code>micronaut.application.name</code> setting is set to <code>helloworld</code> then providing configuration values under <code>helloworld_test</code> will be applied only to the <code>test</code> environment.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration, example <code>/config/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application_prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for the <code>prod</code> <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]_prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration for an active <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, if the configuration name <code>/config/application_test/server.url</code> is configured in AWS Parameter Store, then any application connecting to that parameter store can retrieve the value using <code>server.url</code>. If the application has <code>micronaut.application.name</code> configured to be <code>myapp</code>, then a value with the name <code>/config/myapp_test/server.url</code> will override the value just for that application.</p>
</div>
<div class="paragraph">
<p>Each level of the tree can be composed of key=value pairs. If you want multiple key value pairs, set the type to 'StringList'.</p>
</div>
<div class="paragraph">
<p>For special secure information, like keys or passwords, use the type "SecureString". KMS will be automatically invoked when you
add and retrieve values and decrypt them with the default key store for your account. If you set the configuration to not use secure strings, they will be returned to you encrypted and you must manually decrypt them.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/micronaut-projects/micronaut-examples/aws" class="bare">https://github.com/micronaut-projects/micronaut-examples/aws</a> repository showcases a sample application using this feature.</p>
</div>

<h2 id="distributedConfigurationOracleCloudVault"><a class="anchor" href="#distributedConfigurationOracleCloudVault"></a>8.1.6 Oracle Cloud Vault Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationOracleCloudVault.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports loading configuration values stored in Oracle Cloud Vaults. To use this feature, add the following dependencies:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>build.gradle</code> for Oracle Cloud Vault</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut:micronaut-discovery-client"
compile group: 'com.oracle.oci.sdk', name: 'oci-java-sdk-vault', version: '1.15.4'
compile group: 'com.oracle.oci.sdk', name: 'oci-java-sdk-secrets', version: '1.15.4'
compile group: 'com.oracle.oci.sdk', name: 'oci-java-sdk-common', version: '1.15.4'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable distributed configuration a <code>src/main/resources/bootstrap.yml</code> configuration file must be created and configured to use one or more Oracle Cloud Vaults:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: vault-test
  config-client:
    enabled: true
oraclecloud:
  vault:
    config:
      enabled: true
    vaults:
      - ocid: ocid1.vault.oc1.phx...
        compartment-ocid: ocid1.compartment.oc1...
    use-instance-principal: false
    path-to-config: ~/.oci/config
    profile: DEFAULT
    region: US-PHOENIX-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/guide/configurationreference.html#io.micronaut.discovery.oraclecloud.vault.config.OracleCloudVaultClientConfiguration">configuration reference</a> for all configuration options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can learn more about Oracle Cloud Vault Secrets by <a href="https://blogs.oracle.com/developers/protect-your-sensitive-data-with-secrets-in-the-oracle-cloud">reading this blog post</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each configured vault will be read and all of the secrets within the vault will be retrieved and set into configuration variables with the exact same name as the secret in the Oracle Cloud Vault.</p>
</div>
<div class="paragraph">
<p>For example, if you create a secret with the name of <code>SECRET_ONE</code> in your Oracle Cloud Vault, then it will be available to use in your application like any standard configuration variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Value("${SECRET_ONE}") String secretOne</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>@PropertyName</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(name = "SECRET_ONE") String secretOne</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another option is to inject your variables in to your configuration files which gives you the ability to store things like database passwords and API keys in your vault:</p>
</div>
<div class="listingblock">
<div class="title">application.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
  default:
    password: ${DB_PASSWORD}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vault retrieved values are always <code>String</code>, but you can use <code>@ConfigurationProperties</code> on a bean in conjunction with your <code>application.yml</code> file to provide properly typed configuration variables.</p>
</div>
<div class="paragraph">
<p>So if you where to create secrets in your Oracle Cloud Vault like so:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECRET_ONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value One</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECRET_TWO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECRET_THREE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECRET_FOUR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECRET_FIVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.16</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>And then added the following to your <code>application.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">secrets:
  one: ${SECRET_ONE}
  two: ${SECRET_TWO}
  three: ${SECRET_THREE}
  four: ${SECRET_FOUR}
  five: ${SECRET_FIVE}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could add a config bean like so:</p>
</div>
<div class="listingblock">
<div class="title">Config.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigurationProperties("secrets")
public class Config {
    private String one;
    private String two;
    private boolean three;
    private int four;
    private Double five;

    /* getters/setters removed for brevity */
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could then inject and use this bean in your application with properly typed values.</p>
</div>
<div class="listingblock">
<div class="title">HelloController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/hello")
public class HelloController {

    private Config config;

    public HelloController(
            Config config
    ) {
        this.config = config;
    }

    @Get("/")
    public HttpStatus index() {
        return HttpStatus.OK;
    }

    @Get("/secret")
    public HttpResponse getSecret() {
        return HttpResponse.ok(config);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling the <code>/hello/secret</code> endpoint would return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "one": "Value One",
  "two": "value two",
  "three": true,
  "four": 42,
  "five": 3.16
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need support for different configurations per environment, you can create an environment specific <code>bootstrap.yml</code> file and utilize a different vault(s) configuration per environment.
</td>
</tr>
</table>
</div>

<h2 id="serviceDiscovery"><a class="anchor" href="#serviceDiscovery"></a>8.2 Service Discovery</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/serviceDiscovery.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Service Discovery enables the ability for Microservices to find each other without necessarily knowing the physical location or IP address of associated services.</p>
</div>
<div class="paragraph">
<p>Micronaut provides integration with different tools and libraries. Check
<a href="https://micronaut-projects.github.io/micronaut-discovery-client/lastest/guide/index.html">Micronaut Service Discovery documentation</a>
for more details.</p>
</div>

<h2 id="serviceDiscoveryConsul"><a class="anchor" href="#serviceDiscoveryConsul"></a>8.2.1 Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Check <a href="https://micronaut-projects.github.io/micronaut-discovery-client/lastest/guide/index.html#serviceDiscoveryConsul">Micronaut Consul documentation</a>.</p>
</div>

<h2 id="serviceDiscoveryEureka"><a class="anchor" href="#serviceDiscoveryEureka"></a>8.2.2 Eureka Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryEureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Check <a href="https://micronaut-projects.github.io/micronaut-discovery-client/lastest/guide/index.html#serviceDiscoveryEureka">Micronaut Eureka documentation</a>.</p>
</div>

<h2 id="serviceDiscoveryKubernetes"><a class="anchor" href="#serviceDiscoveryKubernetes"></a>8.2.3 Kubernetes Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryKubernetes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Kubernetes is a container runtime which has a whole bunch of features including integrated Service Discovery and Distributed Configuration.</p>
</div>
<div class="paragraph">
<p>Micronaut have a first-class integration with Kubernetes. Check the <a href="https://micronaut-projects.github.io/micronaut-kubernetes/latest/guide/index.html">Micronaut Kubernetes documentation</a> for more details.</p>
</div>

<h2 id="serviceDiscoveryRoute53"><a class="anchor" href="#serviceDiscoveryRoute53"></a>8.2.4 AWS Route 53 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryRoute53.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use the <a href="https://aws.amazon.com/route53/">Route 53 Service Discovery</a>, you must meet the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run EC2 instances of some type</p>
</li>
<li>
<p>Have a domain name hosted in Route 53</p>
</li>
<li>
<p>Have a newer version of AWS-CLI (such as 14+)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assuming you have those things, you are ready. It is not as fancy as Consul or Eureka, but other than some initial setup
with the AWS-CLI, there is no other software running to go wrong. You can even support health checks
if you add a custom health check to your service. If you would like to test if your account can create and use Service Discovery see the Integration Test section.
More information can be found at <a href="https://docs.aws.amazon.com/Route53/latest/APIReference/overview-service-discovery.html" class="bare">https://docs.aws.amazon.com/Route53/latest/APIReference/overview-service-discovery.html</a>.</p>
</div>
<div class="paragraph">
<p>Here are the steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use AWS-CLI to create a namespace. You can make either a public or private one depending on what IPs or subnets
you are using</p>
</li>
<li>
<p>Create a service with DNS Records with AWS-CLI command</p>
</li>
<li>
<p>Add health checks or custom health checks (optional)</p>
</li>
<li>
<p>Add Service ID to your application configuration file like so:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Sample application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">aws:
    route53:
        registration
            enabled: true
            aws-service-id: srv-978fs98fsdf
            namespace: micronaut.io
micronaut:
    application:
        name: something</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you have the following dependencies included in your build file:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.aws:micronaut-aws-route53")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-route53&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the client side, you will need the same dependencies and less configuration options:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Sample application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">aws:
    route53:
        discovery:
            client:
                enabled: true
                aws-service-id: srv-978fs98fsdf
                namespace-id: micronaut.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> API to find other services registered via Route 53. For example:</p>
</div>
<div class="listingblock">
<div class="title">Sample code for client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DiscoveryClient discoveryClient = embeddedServer.applicationContext.getBean(DiscoveryClient);
List&lt;String&gt; serviceIds = Flowable.fromPublisher(discoveryClient.getServiceIds()).blockingFirst();
List&lt;ServiceInstance&gt; instances = Flowable.fromPublisher(discoveryClient.getInstances(serviceIds.get(0))).blockingFirst();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_namespace">Creating the Namespace</h4>
<div class="paragraph">
<p>Namespaces are similar to a regular Route53 hosted zone, and they appear in the Route53 console but the console doesn&#8217;t support
 modifying them. You must use the AWS-CLI at this time for any Service Discovery functionality.</p>
</div>
<div class="paragraph">
<p>First decide if you are creating a public facing namespace or a private one, as the commands are different:</p>
</div>
<div class="listingblock">
<div class="title">Creating Namespace</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws servicediscovery create-public-dns-namespace --name micronaut.io --create-request-id create-1522767790 --description adescrptionhere

or

$ aws servicediscovery create-private-dns-namespace --name micronaut.internal.io --create-request-id create-1522767790 --description adescrptionhere --vpc yourvpcID</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run this you will get an operation ID. You can check the status with the <code>get-operation</code> CLI command:</p>
</div>
<div class="listingblock">
<div class="title">Get Operation Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws servicediscovery get-operation --operation-id asdffasdfsda</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this command to get the status of any call you make that returns an operation id.</p>
</div>
<div class="paragraph">
<p>The result of the command will tell you the ID of the namespace. Write that down, you&#8217;ll need it for the next steps. If you get an error it will say what the error was.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_service_dns_records">Creating the Service &amp; DNS Records</h4>
<div class="paragraph">
<p>The next step is creating the Service and DNS records.</p>
</div>
<div class="listingblock">
<div class="title">Create Service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws create-service --name yourservicename --create-request-id somenumber --description someservicedescrption --dns-config NamespaceId=yournamespaceid,RoutingPolicy=WEIGHTED,DnsRecords=[{Type=A,TTL=1000},{Type=A,TTL=1000}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DnsRecord</code> type can be <code>A</code>(ipv4),<code>AAAA</code>(ipv6),<code>SRV</code>, or <code>CNAME</code>. <code>RoutingPolicy</code> can be <code>WEIGHTED</code> or <code>MULTIVALUE</code>. Keep in mind <code>CNAME</code> must use weighted routing type, <code>SRV</code> must have a valid port configured.</p>
</div>
<div class="paragraph">
<p>If you want to add a health check, you can use the following syntax on the CLI:</p>
</div>
<div class="listingblock">
<div class="title">Specifying a Health Check</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Type=string,ResourcePath=string,FailureThreshold=integer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Type can be 'HTTP','HTTPS', or 'TCP'. You can only use a standard health check on a public namespace. See Custom Health Checks for private namespaces. Resource path should be a url that returns 200 OK if it&#8217;s healthy.</p>
</div>
<div class="paragraph">
<p>For a custom health check, you only need to specify <code>--health-check-custom-config FailureThreshold=integer</code> which will work on private namespaces as well.</p>
</div>
<div class="paragraph">
<p>This is also good because Micronaut will send out pulsation commands to let AWS know the instance is still healthy.</p>
</div>
<div class="paragraph">
<p>For more help run 'aws discoveryservice create-service help'.</p>
</div>
<div class="paragraph">
<p>You will get a service ID and an ARN back from this command if successful. Write that down, it&#8217;s going to go into the Micronaut configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_the_configuration_in_micronaut">Setting up the configuration in Micronaut</h4>

</div>
<div class="sect3">
<h4 id="_auto_naming_registration">Auto Naming Registration</h4>
<div class="paragraph">
<p>You will need to add the configuration to make your applications register with Route 53 Auto-discovery:</p>
</div>
<div class="listingblock">
<div class="title">Registration Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">aws:
    route53:
        registration:
            enabled: true
            aws-service-id=&lt;enter the service id you got after creation on aws cli&gt;
        discovery:
            namespace-id=&lt;enter the namespace id you got after creating the namespace&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discovery_client_configuration">Discovery Client Configuration</h4>
<div class="listingblock">
<div class="title">Discovery Properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">aws:
    route53:
        discovery:
            client
                enabled: true
                aws-service-id: &lt;enter the service id you got after creation on aws cli&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also call the following methods by getting the bean "Route53AutoNamingClient":</p>
</div>
<div class="listingblock">
<div class="title">Discovery Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if serviceId is null it will use property "aws.route53.discovery.client.awsServiceId"
Publisher&lt;List&lt;ServiceInstance&gt;&gt; getInstances(String serviceId)
// reads property "aws.route53.discovery.namespaceId"
Publisher&lt;List&lt;String&gt;&gt; getServiceIds()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integration_tests">Integration Tests</h4>
<div class="paragraph">
<p>If you set the environment variable AWS_SUBNET_ID and have credentials configured in your home directory that are valid (in <code>~/.aws/credentials</code>)
you can run the integration tests. You will still need a domain hosted on route53 as well. This test will create a t2.nano instance, a namespace, service, and register that instance to service discovery.
When the test completes it will remove/terminate all resources it spun up.</p>
</div>
</div>

<h2 id="serviceDiscoveryManual"><a class="anchor" href="#serviceDiscoveryManual"></a>8.2.5 Manual Service Discovery Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryManual.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you do not wish to involve a service discovery server like Consul or you are interacting with a third-party service that cannot register with Consul you can instead manually configure services that are available via Service discovery.</p>
</div>
<div class="paragraph">
<p>To do this you should use the <code>micronaut.http.services</code> setting. The following is an example configuration:</p>
</div>
<div class="listingblock">
<div class="title">Manually configuring services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        services:
            foo:
                urls:
                    - http://foo1
                    - http://foo2</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then inject a client with <code>@Client("foo")</code> and it will use the above configuration to load balance between the two configured servers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can override this configuration in production by specifying an environment variable such as <code>MICRONAUT_HTTP_SERVICES_FOO_URLS=http://prod1,http://prod2</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that by default no health checking will happen to assert that the referenced services are operational. You can alter that by enabling health checking and optionally specifying a health check path (the default is <code>/health</code>):</p>
</div>
<div class="listingblock">
<div class="title">Enabling Health Checking</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        services:
            foo:
                ...
                health-check: true <i class="conum" data-value="1"></i><b>(1)</b>
                health-check-interval: 15s <i class="conum" data-value="2"></i><b>(2)</b>
                health-check-uri: /health <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Whether to health check the service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The interval to wait between checks</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The URI to send the health check request to</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut will start a background thread to check the health status of the service and if any of the configured services respond with an error code, they will be removed from the list of available services.</p>
</div>

<h2 id="clientSideLoadBalancing"><a class="anchor" href="#clientSideLoadBalancing"></a>8.3 Client Side Load Balancing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/clientSideLoadBalancing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When <a href="#serviceDiscovery">discovering services</a> from Consul, Eureka or other Service Discovery servers the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> will emit a list of available <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut by default will automatically perform Round Robin client-side load balancing using the servers in this list. This combined with <a href="#retry">Retry Advice</a> adds extra resiliency to your Microservice infrastructure.</p>
</div>
<div class="paragraph">
<p>The load balancing itself is handled by the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface which defines a  <a href="../api/io/micronaut/http/client/LoadBalancer.html#select--">LoadBalancer.select()</a> method that returns a <code>Publisher</code> that emits a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> is returned because the process for selecting a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> may result in a network operation depending on the <a href="#serviceDiscovery">Service Discovery</a> strategy employed.</p>
</div>
<div class="paragraph">
<p>The default implementation of the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface is <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientRoundRobinLoadBalancer.html">DiscoveryClientRoundRobinLoadBalancer</a>. You can replace this strategy for another implementation if you wish to customize how client side load balancing is handled in Micronaut since there are many different ways you may wish to optimize load balancing.</p>
</div>
<div class="paragraph">
<p>For example, you may wish to load balance between services in a particular zone or you may wish to load balance between servers that have the best overall response time.</p>
</div>
<div class="paragraph">
<p>To replace the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> used you should define a bean that <a href="#replaces">replaces</a> the <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientLoadBalancerFactory.html">DiscoveryClientLoadBalancerFactory</a>.</p>
</div>
<div class="paragraph">
<p>In fact that is exactly what the Netflix Ribbon support does, described in the next section.</p>
</div>

<h2 id="netflixRibbon"><a class="anchor" href="#netflixRibbon"></a>8.3.1 Netflix Ribbon Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/clientSideLoadBalancing/netflixRibbon.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>netflix-ribbon</code> feature to configure Netflix Ribbon in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features netflix-ribbon</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/Netflix/ribbon">Netflix Ribbon</a> is a inter-process communication library used at Netflix that has support for customizable load balancing strategies.</p>
</div>
<div class="paragraph">
<p>If you need more flexibility in how your application performs client-side load balancing then you may wish use Micronaut&#8217;s Netflix Ribbon support.</p>
</div>
<div class="paragraph">
<p>To add Ribbon support to your application add the <code>netflix-ribbon</code> configuration to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.netflix:micronaut-netflix-ribbon"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> implementations will now be <a href="../api/io/micronaut/configuration/ribbon/RibbonLoadBalancer.html">RibbonLoadBalancer</a> instances.</p>
</div>
<div class="paragraph">
<p>Ribbon&#8217;s <a href="http://netflix.github.io/ribbon/ribbon-core-javadoc/com/netflix/client/config/CommonClientConfigKey.html">Configuration options</a> can be set using the <code>ribbon</code> namespace in configuration. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Ribbon</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ribbon:
    VipAddress: test
    ServerListRefreshInterval: 2000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each discovered client can also be configured under <code>ribbon.clients</code>. For example given a <code>@Client(id = "hello-world")</code> you can configure Ribbon settings with:</p>
</div>
<div class="listingblock">
<div class="title">Per Client Ribbon Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ribbon:
    clients:
        hello-world:
            VipAddress: test
            ServerListRefreshInterval: 2000</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut registers a <a href="../api/io/micronaut/configuration/ribbon/DiscoveryClientServerList.html">DiscoveryClientServerList</a> for each client that integrates Ribbon with Micronaut&#8217;s <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a>.</p>
</div>

<h2 id="distributedTracing"><a class="anchor" href="#distributedTracing"></a>8.4 Distributed Tracing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/distributedTracing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When operating Microservices in production it can be challenging to troubleshoot interactions between Microservices in a distributed architecture.</p>
</div>
<div class="paragraph">
<p>To solve this problem a way to visualize interactions between Microservices in a distributed manner can be critical. Currently, there are various distributed tracing solutions, the most popular of which are <a href="https://zipkin.io">Zipkin</a> and <a href="https://www.jaegertracing.io/">Jaeger</a> both of which provide different levels of support for the <a href="http://opentracing.io">Open Tracing</a> API.</p>
</div>
<div class="paragraph">
<p>Micronaut features integration with both Zipkin and Jaeger (via the Open Tracing API).</p>
</div>
<div class="paragraph">
<p>To enable tracing you should add the <code>tracing</code> module to your <code>build.gradle</code> or <code>pom.xml</code> file:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-tracing")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-tracing&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="sect1">
<h2 id="_tracing_annotations">Tracing Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/tracing/annotation/package-summary.html">io.micronaut.tracing.annotation</a> package contains annotations that can be declared on methods to create new spans or continue existing spans.</p>
</div>
<div class="paragraph">
<p>The available annotations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/NewSpan.html">@NewSpan</a> annotation will create a new span, wrapping the method call or reactive type.</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/ContinueSpan.html">@ContinueSpan</a> annotation will continue an existing span, wrapping the method call or reactive type.</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/SpanTag.html">@SpanTag</a> annotation can be used on method arguments to include the value of each argument within a Span&#8217;s tags. When you use <code>@SpanTag</code> on a method argument, you need either to annotate the method with <code>@NewSpan</code> or <code>@ContinueSpan</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following snippet presents an example of using the annotations:</p>
</div>
<div class="listingblock">
<div class="title">Using Trace Annotations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
class HelloService {

    @NewSpan("hello-world") <i class="conum" data-value="1"></i><b>(1)</b>
    public String hello(@SpanTag("person.name") String name) { <i class="conum" data-value="2"></i><b>(2)</b>
        return greet("Hello " + name);
    }

    @ContinueSpan <i class="conum" data-value="3"></i><b>(3)</b>
    public String greet(@SpanTag("hello.greeting") String greet) {
        return greet;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/tracing/annotation/NewSpan.html">@NewSpan</a> annotation is used to start a new span</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <a href="../api/io/micronaut/tracing/annotation/SpanTag.html">@SpanTag</a> to include arguments of methods as tags for the span</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/tracing/annotation/ContinueSpan.html">@ContinueSpan</a> annotation can be used to continue as existing span and incorporate additional tags using <code>@SpanTag</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_tracing_instrumentation">Tracing Instrumentation</h3>
<div class="paragraph">
<p>In addition to explicit tracing tags, Micronaut includes a number of instrumentations to ensure that the Span context is propagated between threads and across Microservice boundaries.</p>
</div>
<div class="paragraph">
<p>These instrumentations are found in the <a href="../api/io/micronaut/tracing/instrument/package-summary.html">io.micronaut.tracing.instrument</a> package and include HTTP <a href="#clientFilter">Client Filters</a> and <a href="#filters">Server Filters</a> to propagate the necessary headers via HTTP.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_beans">Tracing Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the Tracing annotations and existing instrumentations are not enough, Micronaut&#8217;s tracing integration registers a <code>io.opentracing.Tracer</code> bean that can be injected into any class and exposes the Open Tracing API.</p>
</div>
<div class="paragraph">
<p>Depending on the implementation you choose there are also additional beans. For example for Zipkin <code>brave.Tracing</code> and <code>brave.SpanCustomizer</code> beans are available too.</p>
</div>
</div>
</div>

<h2 id="zipkin"><a class="anchor" href="#zipkin"></a>8.4.1 Tracing with Zipkin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/distributedTracing/zipkin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://zipkin.io">Zipkin</a> is a distributed tracing system. It helps gather timing data needed to troubleshoot latency problems in microservice architectures. It manages both the collection and lookup of this data.</p>
</div>
<div class="sect1">
<h2 id="_running_zipkin">Running Zipkin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to get up and started with Zipkin is with Docker:</p>
</div>
<div class="listingblock">
<div class="title">Running Zipkin with Docker</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -d -p 9411:9411 openzipkin/zipkin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then open a browser tab to the location <code><a href="http://localhost:9411" class="bare">http://localhost:9411</a></code> to view traces.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_traces_to_zipkin">Sending Traces to Zipkin</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>tracing-zipkin</code> feature to include Zipkin tracing in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features tracing-zipkin</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To send tracing spans to Zipkin the minimal configuration requires you add the following dependencies to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Adding Zipkin Dependencies</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">runtime 'io.zipkin.brave:brave-instrumentation-http'
runtime 'io.zipkin.reporter2:zipkin-reporter'
compile 'io.opentracing.brave:brave-opentracing'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to enable ZipKin tracing in your configuration (potentially only your production configuration):</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tracing:
    zipkin:
        enabled: true</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Or alternatively if you have the Micronaut CLI installed you can configure Zipkin when creating your service with: <code>mn create-app hello-world --features tracing-zipkin</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_zipkin_sender">Customizing the Zipkin Sender</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to send spans you need to configure a Zipkin sender. You can configure a <a href="../api/io/micronaut/tracing/brave/sender/HttpClientSender.html">HttpClientSender</a> that sends Spans asynchronously using Micronaut&#8217;s native HTTP client using the <code>tracing.zipkin.http.url</code> setting:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Multiple Zipkin Servers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tracing:
    zipkin:
        enabled: true
        http:
            url: http://localhost:9411</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is unlikely that sending spans to localhost will be suitable for production deployment so you generally will want to configure the location of one or many Zipkin servers for production:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Multiple Zipkin Servers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tracing:
    zipkin:
        enabled: true
        http:
            urls:
                - http://foo:9411
                - http://bar:9411</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In production, setting <code>TRACING_ZIPKIN_HTTP_URLS</code> environment variable with a comma separated list of URLs will also work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively if you wish to use a different <code>zipkin2.reporter.Sender</code> implementation, you can simply define a bean that is of type <code>zipkin2.reporter.Sender</code> and it will be picked up.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zipkin_configuration">Zipkin Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many configuration options available for the Brave client that sends Spans to Zipkin and they are generally exposed via the <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> class. You can refer to the javadoc for all the available options.</p>
</div>
<div class="paragraph">
<p>Below is an example of customizing Zipkin configuration:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Zipkin Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tracing:
    zipkin:
        enabled: true
        traceId128Bit: true
        sampler:
            probability: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also optionally dependency inject common configuration classes into <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> such as <code>brave.sampler.Sampler</code> just by defining them as beans. See the API for <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> for available injection points.</p>
</div>
</div>
</div>

<h2 id="jaeger"><a class="anchor" href="#jaeger"></a>8.4.2 Tracing with Jaeger</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cloud/distributedTracing/jaeger.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.jaegertracing.io">Jaeger</a> is another distributed tracing system developed at Uber that is more or less the reference implementation for <a href="http://opentracing.io">Open Tracing</a>.</p>
</div>
<div class="sect1">
<h2 id="_running_jaeger">Running Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to get started with Jaeger is to run Jaeger via Docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -d \
  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.6</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then navigate to <code><a href="http://localhost:16686" class="bare">http://localhost:16686</a></code> to access the Jaeger UI.</p>
</div>
<div class="paragraph">
<p>See <a href="https://www.jaegertracing.io/docs/getting-started/">Getting Started with Jaeger</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_traces_to_jaeger">Sending Traces to Jaeger</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>tracing-jaeger</code> feature to include Jaeger tracing in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features tracing-jaeger</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To send tracing spans to Jaeger the minimal configuration requires you add the following dependencies to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Adding Jaeger Dependencies</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile 'io.jaegertracing:jaeger-thrift:0.31.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to enable Jaeger tracing in your configuration (potentially only your production configuration):</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tracing:
    jaeger:
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Jaeger will be configured to send traces to a locally running Jaeger agent.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Or alternatively if you have the Micronaut CLI installed you can configure Jaeger when creating your service with: <code>mn create-app hello-world --features tracing-jaeger</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jaeger_configuration">Jaeger Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many configuration options available for the Jaeger client that sends Spans to Jaeger and they are generally exposed via the <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> class. You can refer to the javadoc for all the available options.</p>
</div>
<div class="paragraph">
<p>Below is an example of customizing JaegerConfiguration configuration:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Jaeger Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tracing:
    jaeger:
        enabled: true
        sampler:
            probability: 0.5
        sender:
            agentHost: foo
            agentPort: 5775
        reporter:
            flushInterval: 2000
            maxQueueSize: 200</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also optionally dependency inject common configuration classes into <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> such as <code>io.jaegertracing.Configuration.SamplerConfiguration</code> just by defining them as beans. See the API for <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> for available injection points.</p>
</div>
</div>
</div>

<h1 id="serverlessFunctions"><a class="anchor" href="#serverlessFunctions"></a>9 Serverless Functions</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/serverlessFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Server-less architectures where as a developer you deploy functions that are fully managed by the Cloud environment and are executed in ephemeral processes require a unique approach.</p>
</div>
<div class="paragraph">
<p>Traditional frameworks like Grails and Spring are not really suitable since low memory consumption and fast startup time are critical, since the Function as a Service (FaaS) server will typically spin up your function for a period using a cold start and then keep it warm.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s compile-time approach, fast startup time and low-memory footprint make it a great candidate for using as a framework for developing functions and in fact Micronaut features dedicated support for developing and deploying functions to AWS Lambda, Google Cloud Function, Azure Function and any FaaS system that supports running functions as containers (such as OpenFaaS, Rift or Fn).</p>
</div>
<div class="paragraph">
<p>There are generally 2 approaches to writing functions with Micronaut:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Low-level functions that are written using the native API of the function platform</p>
</li>
<li>
<p>Higher-level functions where you simply define controllers as you would normally do in a typical Micronaut application and deploy to the function platform.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first approach has marginally less startup time overhead and is typically used for non-HTTP functions such as functions that listen to an event or background functions.</p>
</div>
<div class="paragraph">
<p>The second approach is only for HTTP functions and is useful for users who want to take a slice of an existing application and deploy it as a serverless function. If cold start performance is a concern it is recommended that you consider building a native image with GraalVM for this option.</p>
</div>

<h2 id="awsLambda"><a class="anchor" href="#awsLambda"></a>9.1 AWS Lambda</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/serverlessFunctions/awsLambda.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Support for AWS Lambda is implemented in the <a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#whatsNew">Micronaut AWS</a> subproject.</p>
</div>
<div class="sect3">
<h4 id="_simple_functions_with_aws_lambda">Simple Functions with AWS Lambda</h4>
<div class="paragraph">
<p>You can implement AWS Request Handlers with Micronaut that implement directly the AWS Lambda SDK API. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#requestHandlers">Micronaut Request Handlers</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create an AWS Lambda Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-function-app my-app --features aws-lambda</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/create/function/example\?features\=aws-lambda -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_http_functions_with_aws_lambda">HTTP Functions with AWS Lambda</h4>
<div class="paragraph">
<p>You can deploy regular Micronaut applications that use <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> etc. using Micronaut&#8217;s support for AWS API Gateway. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-aws/snapshot/guide/#apiProxy">AWS API Gateway Support</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create an AWS API Gateway Proxy application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features aws-lambda</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=aws-lambda -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>

<h2 id="gcpFunction"><a class="anchor" href="#gcpFunction"></a>9.2 Google Cloud Function</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/serverlessFunctions/gcpFunction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Support for Google Cloud Function is implemented in the <a href="https://micronaut-projects.github.io/micronaut-gcp/2.0.x/guide/#cloudFunction">Micronaut GCP</a> subproject.</p>
</div>
<div class="sect3">
<h4 id="_simple_functions_with_cloud_function">Simple Functions with Cloud Function</h4>
<div class="paragraph">
<p>You can implement Cloud Functions with Micronaut that implement directly the <a href="https://github.com/GoogleCloudPlatform/functions-framework-java">Cloud Function Framework API</a>. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-gcp/2.0.x/guide/#simpleFunctions">Simple Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create a Google Cloud Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-function-app my-app --features google-cloud-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/create/function/example\?features\=google-cloud-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_http_functions_with_cloud_function">HTTP Functions with Cloud Function</h4>
<div class="paragraph">
<p>You can deploy regular Micronaut applications that use <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> etc. using Micronaut&#8217;s support for HTTP Functions. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-gcp/2.0.x/guide/#httpFunctions">Google Cloud HTTP Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create a Google Cloud HTTP Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features google-cloud-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=google-cloud-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>

<h2 id="gcpCloudRun"><a class="anchor" href="#gcpCloudRun"></a>9.3 Google Cloud Run</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/serverlessFunctions/gcpCloudRun.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy to <a href="https://cloud.google.com/run">Google Cloud Run</a> we recommend using <a href="https://github.com/GoogleContainerTools/jib">JIB</a> to containerize your application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>Creating an application with JIB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jib</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=jib -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With JIB setup to deploy your application to Google Container Registry you can simple run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew jib</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are now ready to deploy your application :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ gcloud run deploy --image gcr.io/[PROJECT ID]/example --platform=managed --allow-unauthenticated</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>[PROJECT ID]</code> is replaced for your project ID. You should be asked to specify a region and see output like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Service name: (example):
Deploying container to Cloud Run service [example] in project [PROJECT_ID] region [us-central1]

 Deploying... Done.
   Creating Revision...
   Routing traffic...
   Setting IAM Policy...
Done.
Service [example] revision [example-00004] has been deployed and is serving 100 percent of traffic at https://example-9487r97234-uc.a.run.app</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL is the URL of your Cloud Run application.</p>
</div>

<h2 id="azureFunction"><a class="anchor" href="#azureFunction"></a>9.4 Azure Function</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/serverlessFunctions/azureFunction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Support for Azure Function is implemented in the <a href="https://micronaut-projects.github.io/micronaut-azure/1.0.x/guide/index.html#azureFunction">Micronaut Azure</a> subproject.</p>
</div>
<div class="sect3">
<h4 id="_simple_functions_with_azure_function">Simple Functions with Azure Function</h4>
<div class="paragraph">
<p>You can implement Azure Functions with Micronaut that implement directly the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-java?tabs=consumption">Azure Function Java SDK</a>. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-azure/1.0.x/guide/index.html#azureFunction">Azure Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create an Azure Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-function-app my-app --features azure-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/create/function/example\?features\=azure-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_http_functions_with_azure_function">HTTP Functions with Azure Function</h4>
<div class="paragraph">
<p>You can deploy regular Micronaut applications that use <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> etc. using Micronaut&#8217;s support for Azure HTTP Functions. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-azure/1.0.x/guide/index.html#azureFunction">Azure HTTP Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create a Azure HTTP Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features azure-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=azure-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>

<h1 id="messaging"><a class="anchor" href="#messaging"></a>10 Message-Driven Microservices</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/messaging.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In the past, with monolithic applications, message listeners that listened to messages from messaging systems would frequently be embedded in the same application unit.</p>
</div>
<div class="paragraph">
<p>In Microservice architectures it is common to have individual Microservice applications that are driven by a message system such as RabbitMQ or Kafka.</p>
</div>
<div class="paragraph">
<p>In fact a Message-driven Microservice may not even feature an HTTP endpoint or HTTP server (although this can be valuable from a health check and visibility perspective).</p>
</div>

<h2 id="kafka"><a class="anchor" href="#kafka"></a>10.1 Kafka Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/messaging/kafka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://kafka.apache.org">Apache Kafka</a> is a distributed stream processing platform that can be used for a range of messaging requirements in addition to stream processing and real-time data handling.</p>
</div>
<div class="paragraph">
<p>Micronaut features dedicated support for defining both Kafka <code>Producer</code> and <code>Consumer</code> instances. Micronaut applications built with Kafka can be deployed with or without the presence of an HTTP server.</p>
</div>
<div class="paragraph">
<p>With Micronaut&#8217;s efficient compile-time AOP and cloud native features, writing efficient Kafka consumer applications that use very little resources is a breeze.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-kafka/latest/guide">Micronaut Kafka</a> for more information on how to build Kafka applications with Micronaut.</p>
</div>

<h2 id="rabbitmq"><a class="anchor" href="#rabbitmq"></a>10.2 RabbitMQ Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/messaging/rabbitmq.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.rabbitmq.com">RabbitMQ</a> is the most widely deployed open source message broker.</p>
</div>
<div class="paragraph">
<p>Micronaut features dedicated support for defining both RabbitMQ publishers and consumers. Micronaut applications built with RabbitMQ can be deployed with or without the presence of an HTTP server.</p>
</div>
<div class="paragraph">
<p>With Micronaut&#8217;s efficient compile-time AOP, using RabbitMQ has never been easier. Support has been added for publisher confirms and RPC through reactive streams.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-rabbitmq/latest/guide">Micronaut RabbitMQ</a> for more information on how to build RabbitMQ applications with Micronaut.</p>
</div>

<h2 id="nats"><a class="anchor" href="#nats"></a>10.3 Nats.io Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/messaging/nats.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://nats.io/">Nats.io</a> is a simple, secure and high performance open source messaging system for cloud native applications, IoT messaging, and microservices architectures.</p>
</div>
<div class="paragraph">
<p>Micronaut features dedicated support for defining both Nats.io publishers and consumers. Micronaut applications built with Nats.io can be deployed with or without the presence of an HTTP server.</p>
</div>
<div class="paragraph">
<p>With Micronaut&#8217;s efficient compile-time AOP, using Nats.io has never been easier. Support has been added for publisher confirms and RPC through reactive streams.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-nats/latest/guide/">Micronaut Nats</a> for more information on how to build Nats.io applications with Micronaut.</p>
</div>

<h1 id="commandLineApps"><a class="anchor" href="#commandLineApps"></a>11 Standalone Command Line Applications</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/commandLineApps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In certain cases you may wish to create standalone command-line (CLI) applications that interact with your Microservice infrastructure.</p>
</div>
<div class="paragraph">
<p>Examples of applications like this include scheduled tasks, batch applications and general command line applications.</p>
</div>
<div class="paragraph">
<p>In this case having a robust way to parse command line options and positional parameters is important.</p>
</div>

<h2 id="picocli"><a class="anchor" href="#picocli"></a>11.1 Picocli Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/commandLineApps/picocli.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/remkop/picocli">Picocli</a> is a command line parser that supports usage help with ANSI colors, autocomplete and nested subcommands. It has an annotations API to create command line applications with almost no code, and a programmatic API for dynamic uses like creating Domain Specific Languages.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-picocli/latest/guide/">documentation for the Picocli integration</a> for more information.</p>
</div>

<h1 id="configurations"><a class="anchor" href="#configurations"></a>12 Configurations</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features several built-in configurations that enable integration with common databases and other servers.</p>
</div>

<h2 id="reactiveConfigs"><a class="anchor" href="#reactiveConfigs"></a>12.1 Configurations for Reactive Programming</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/reactiveConfigs.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>RxJava 2 is the default reactive programming library used by Micronaut, however individual modules for other reactive libraries have been added.</p>
</div>

<h2 id="rxjava3"><a class="anchor" href="#rxjava3"></a>12.1.1 RxJava 3 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/reactiveConfigs/rxjava3.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To add support for RxJava 3 add the following module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava3:micronaut-rxjava3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava3&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava3&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>To use the RxJava 3 HTTP client add the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava3:micronaut-rxjava3-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava3&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava3-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For more information see the documentation for <a href="https://micronaut-projects.github.io/micronaut-rxjava3/latest/guide/">Micronaut RxJava 3</a>.</p>
</div>

<h2 id="reactor"><a class="anchor" href="#reactor"></a>12.1.2 Reactor Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/reactiveConfigs/reactor.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To add support for Reactor add the following module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.reactor:micronaut-reactor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.reactor&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-reactor&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>To use the RxJava 3 HTTP client add the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.reactor:micronaut-reactor-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.reactor&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-reactor-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For more information see the documentation for <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/guide/">Micronaut Reactor</a>.</p>
</div>

<h2 id="rxjava1"><a class="anchor" href="#rxjava1"></a>12.1.3 RxJava 1 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/reactiveConfigs/rxjava1.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Legacy support for RxJava 1 can be added with the following module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava1:micronaut-rxjava1")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava1&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava1&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-rxjava1/latest/guide/">Micronaut RxJava1</a> documentation.</p>
</div>

<h2 id="dataAccess"><a class="anchor" href="#dataAccess"></a>12.2 Configurations for Data Access</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The table summarizes the configuration modules and the dependencies you should add to your build to enable them.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Data Access Configuration Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-jdbc-dbcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> instances using <a href="https://commons.apache.org/proper/commons-dbcp/">Commons DBCP</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-jdbc-hikari</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> instances using <a href="https://brettwooldridge.github.io/HikariCP/">Hikari Connection Pool</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-jdbc-tomcat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> instances using <a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html">Tomcat Connection Pool</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-hibernate-jpa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures Hibernate/JPA EntityManagerFactory beans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-hibernate-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/hibernate/manual">GORM for Hibernate</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.mongodb:micronaut-mongo-reactive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="http://mongodb.github.io/mongo-java-driver-reactivestreams">MongoDB Reactive Driver</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-mongo-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/mongodb/manual">GORM for MongoDB</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.neo4j:micronaut-neo4j-bolt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/neo4j/neo4j-java-driver">Bolt Java Driver</a> for <a href="https://neo4j.com">Neo4j</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-neo4j-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/neo4j/manual">GORM for Neo4j</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-vertx-mysql-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/eclipse-vertx/vertx-sql-client/tree/master/vertx-mysql-client">Reactive MySQL Client</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-vertx-pg-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/eclipse-vertx/vertx-sql-client/tree/master/vertx-pg-client">Reactive Postgres Client</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.redis:micronaut-redis-lettuce</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://lettuce.io">Lettuce</a> driver for <a href="https://redis.io">Redis</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.cassandra:micronaut-cassandra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/datastax/java-driver">Datastax Java Driver</a> for <a href="http://cassandra.apache.org">Cassandra</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, to add support for MongoDB you define the following dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.mongodb:micronaut-mongo-reactive"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Groovy users, Micronaut provides special support for <a href="http://gorm.grails.org">GORM</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
For GORM for Hibernate you should not have both the <code>hibernate-jpa</code> and <code>hibernate-gorm</code> dependency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections go into more detail about configuration options and the exposed beans for each implementation.</p>
</div>

<h2 id="sqlSupport"><a class="anchor" href="#sqlSupport"></a>12.2.1 Configuring a SQL Data Source</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/sqlSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Java data sources can be configured for one of three currently provided implementations. Apache DBCP2, Hikari, and Tomcat are supported by default.</p>
</div>
<div class="sect1">
<h2 id="_configuring_a_jdbc_datasource">Configuring a JDBC DataSource</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply one of the <code>jdbc-tomcat</code>, <code>jdbc-hikari</code>, or <code>jdbc-dbcp</code> features to preconfigure a simple JDBC connection in your project, along with a default H2 database driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jdbc-tomcat</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get started, simply add a dependency to one of the JDBC configurations that corresponds to the implementation you would like to use. Choose one of the following:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-tomcat")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-tomcat&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-hikari")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-hikari&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-dbcp")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-dbcp&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-ucp")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-ucp&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You also need to add a JDBC driver dependency to your classpath. For example to add the <a href="http://www.h2database.com">H2 In-Memory Database</a>:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"com.h2database:h2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#jdbc">Configuring JDBC</a> section of the <a href="https://github.com/micronaut-projects/micronaut-sql">Micronaut SQL libraries</a> project.</p>
</div>
</div>
</div>

<h2 id="hibernateSupport"><a class="anchor" href="#hibernateSupport"></a>12.2.2 Configuring Hibernate</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/hibernateSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_a_hibernate_jpa_entitymanager">Setting up a Hibernate/JPA EntityManager</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>hibernate-jpa</code> feature to include a Hibernate JPA configuration in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features hibernate-jpa</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut features built in support for configuring a <a href="http://hibernate.org">Hibernate</a> / JPA <code>EntityManager</code> that builds on the <a href="#sqlSupport">SQL DataSource support</a>.</p>
</div>
<div class="paragraph">
<p>Once you have <a href="#sqlSupport">configured one or many DataSources</a> to use Hibernate, you will need to add the <code>hibernate-jpa</code> dependency to your build configuration:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-hibernate-jpa")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#hibernate">Configuring Hibernate</a> section of the <a href="https://github.com/micronaut-projects/micronaut-sql">Micronaut SQL libraries</a> project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_gorm_for_hibernate">Using GORM for Hibernate</h4>
<div class="paragraph">
<p>For Groovy users and users familiar with the Grails framework, special support for <a href="http://gorm.grails.org">GORM for Hibernate</a> is available. To use GORM for Hibernate you <strong>should not</strong> include Micronaut&#8217;s built in <a href="#sqlSupport">SQL Support</a> or the <code>hibernate-jpa</code> dependency since GORM itself takes responsibility for creating the <code>DataSource</code>, <code>SessionFactory</code> etc.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>hibernate-gorm</code> feature to include GORM, a basic connection pool configuration, and a default H2 database driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features hibernate-gorm</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-groovy/latest/guide/#gorm">GORM Modules</a> section of the <a href="https://github.com/micronaut-projects/micronaut-groovy">Micronaut for Groovy </a> user guide.</p>
</div>
</div>

<h2 id="mongoSupport"><a class="anchor" href="#mongoSupport"></a>12.2.3 Configuring MongoDB</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/mongoSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_the_native_mongodb_driver">Setting up the Native MongoDB Driver</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>mongo-reactive</code> feature to configure the native MongoDB driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features mongo-reactive</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut includes a configuration to automatically configure the native MongoDB Java driver. To use this configuration, add the following dependency to your application:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.mongodb:micronaut-mongo-reactive")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.mongodb&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-mongo-reactive&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Then configure the URI of the MongoDB server in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring a MongoDB server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mongodb:
    uri: mongodb://username:password@localhost:27017/databaseName</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>mongodb.uri</code> follows the <a href="https://docs.mongodb.com/manual/reference/connection-string">MongoDB Connection String</a> format.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A non-blocking Reactive Streams <a href="http://mongodb.github.io/mongo-java-driver-reactivestreams/1.8/javadoc/com/mongodb/reactivestreams/client/MongoClient.html">MongoClient</a> is then available for dependency injection.</p>
</div>
<div class="paragraph">
<p>To use the blocking driver, add a dependency to your application to the mongo-java-driver.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "org.mongodb:mongo-java-driver"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the blocking <a href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/MongoClient.html">MongoClient</a> will be available for injection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-mongodb/latest/guide/">Micronaut MongoDB</a> documentation for further information on configuring and using MongoDB within Micronaut.</p>
</div>
</div>

<h2 id="neo4jSupport"><a class="anchor" href="#neo4jSupport"></a>12.2.4 Configuring Neo4j</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/neo4jSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features dedicated support for automatically configuring the <a href="https://neo4j.com/docs/developer-manual/current/drivers/">Neo4j Bolt Driver</a> for the popular <a href="https://neo4j.com/">Neo4j</a> Graph Database.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>neo4j-bolt</code> feature to configure the Neo4j Bolt driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features neo4j-bolt</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Neo4j Bolt driver you should first add the <code>neo4j-bolt</code> module to your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-neo4j-bolt")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-neo4j-bolt&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You should then configure the URI of the Neo4j server you wish to communicate with in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring <code>neo4j.uri</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">neo4j:
    uri: bolt://localhost</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>neo4j.uri</code> setting should be in the format as described in the <a href="https://neo4j.com/docs/developer-manual/current/drivers/client-applications/#driver-connection-uris">Connection URIs</a> section of the Neo4j documentation
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have the above configuration in place you can inject an instance of the <code>org.neo4j.driver.v1.Driver</code> bean, which features both a synchronous blocking API and a non-blocking API based on <code>CompletableFuture</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-neo4j/latest/guide/">Micronaut Neo4j</a> documentation for further information on configuring and using Neo4j within Micronaut.</p>
</div>

<h2 id="postgresSupport"><a class="anchor" href="#postgresSupport"></a>12.2.5 Configuring Postgres</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/postgresSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports reactive and non-blocking client to connect to Postgres using <a href="https://github.com/eclipse-vertx/vertx-sql-client/tree/master/vertx-pg-client">vertx-pg-client</a>, allowing to handle many database connections with a single thread.</p>
</div>
<div class="sect1">
<h2 id="_configuring_the_reactive_postgres_client">Configuring the Reactive Postgres Client</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>vertx-pg-client</code> feature to configure the Reactive Postgres client in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features vertx-pg-client</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Reactive Postgres client you should first add <code>vertx-pg-client</code> module to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.sql:micronaut-vertx-pg-client"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#pgclient">Configuring Reactive Postgres</a> section of the <a href="https://github.com/micronaut-projects/micronaut-sql">Micronaut SQL libraries</a> project.</p>
</div>
</div>
</div>

<h2 id="redisSupport"><a class="anchor" href="#redisSupport"></a>12.2.6 Configuring Redis</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/redisSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features automatic configuration of the <a href="https://lettuce.io">Lettuce</a> driver for <a href="https://redis.io">Redis</a> via the <code>redis-lettuce</code> module.</p>
</div>
<div class="sect1">
<h2 id="_configuring_lettuce">Configuring Lettuce</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>redis-lettuce</code> feature to configure the Lettuce driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features redis-lettuce</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Lettuce driver you should first add the <code>redis-lettuce</code> module to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.redis:micronaut-redis-lettuce"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should then configure the URI of the Redis server you wish to communicate with in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring <code>redis.uri</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">redis:
    uri: redis://localhost</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>redis.uri</code> setting should be in the format as described in the <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details">Connection URIs</a> section of the Lettuce wiki
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also specify multiple Redis URIs using <code>redis.uris</code> in which case a <code>RedisClusterClient</code> is created instead.</p>
</div>
<div class="paragraph">
<p>For more information and further documentation see the <a href="https://micronaut-projects.github.io/micronaut-redis/latest/guide">Micronaut Redis</a> documentation.</p>
</div>
</div>
</div>

<h2 id="cassandraSupport"><a class="anchor" href="#cassandraSupport"></a>12.2.7 Configuring Cassandra</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/cassandraSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>cassandra</code> feature to include Cassandra configuration in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features cassandra</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-cassandra/latest/guide/">Micronaut Cassandra Module</a> documentation.</p>
</div>

<h2 id="liquibaseSupport"><a class="anchor" href="#liquibaseSupport"></a>12.2.8 Configuring Liquibase</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/liquibaseSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure Micronaut integration with <a href="http://www.liquibase.org">Liquibase</a>, please follow
<a href="https://micronaut-projects.github.io/micronaut-liquibase/latest/guide/index.html">these instructions</a>.</p>
</div>

<h2 id="flywaySupport"><a class="anchor" href="#flywaySupport"></a>12.2.9 Configuring Flyway</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/configurations/dataAccess/flywaySupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure Micronaut integration with <a href="https://flywaydb.org/">Flyway</a>, please follow
<a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/index.html">these instructions</a></p>
</div>

<h1 id="languageSupport"><a class="anchor" href="#languageSupport"></a>13 Language Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports any JVM language that implements the <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/package-summary.html">Java Annotation Processor</a> API.</p>
</div>
<div class="paragraph">
<p>Although Groovy, does not in fact support this API, special support has been built via an AST transformation. The current list of supported languages is: Java, Groovy and Kotlin (via the kapt tool).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Theoretically any language that supports a way to analyze the AST at compile time could be supported. The <a href="../api/io/micronaut/inject/writer/package-summary.html">io.micronaut.inject.writer</a> package includes classes that are language neutral and are used to build <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> classes at compile time using the ASM tool.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections cover language specific features and considerations for using Micronaut.</p>
</div>

<h2 id="java"><a class="anchor" href="#java"></a>13.1 Micronaut for Java</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/java.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For Java, Micronaut uses a Java <a href="../api/io/micronaut/annotation/processing/BeanDefinitionInjectProcessor.html">BeanDefinitionInjectProcessor</a> annotation processor to process classes at compile time and produce <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> classes.</p>
</div>
<div class="paragraph">
<p>The major advantage here is that you pay a slight cost at compile time, but at runtime Micronaut is largely reflection-free, fast and consumes very little memory.</p>
</div>

<h2 id="java9"><a class="anchor" href="#java9"></a>13.1.1 Using Micronaut with Java 9+</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/java/java9.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is built with Java 8, however works fine with Java 9/10 and above as well. The classes that Micronaut generates sit alongside existing classes within the same package, hence do not violate anything regarding the Java module system.</p>
</div>
<div class="paragraph">
<p>There are some considerations to take into account when using Java 9/10 with Micronaut.</p>
</div>
<div class="sect2">
<h3 id="_the_javax_annotation_package">The javax.annotation package</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, the <code>javax.annotation</code> dependency will be added to your project automatically if you are using Java 9+.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>javax.annotation</code>, which includes <code>@PostConstruct</code>, <code>@PreDestroy</code> etc. is no longer part of the core JDK but instead a module. If you run under Java 9+ you will need to import the module or add the dependency to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">Adding the <code>javax.annotation</code> dependency</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">implementation 'javax.annotation:javax.annotation-api:1.3.2'</code></pre>
</div>
</div>
</div>

<h2 id="incrementalannotationgradle"><a class="anchor" href="#incrementalannotationgradle"></a>13.1.2 Incremental Annotation Processing with Gradle</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/java/incrementalannotationgradle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports <a href="https://docs.gradle.org/current/userguide/java_plugin.html#sec:incremental_annotation_processing">Gradle incremental annotation processing</a> which helps speed up builds by compiling only classes that have changed avoiding a full recompilation.</p>
</div>
<div class="paragraph">
<p>However, the support is disabled by default since Micronaut allows the definition of custom meta-annotations (to for example define <a href="#aop">custom AOP advice</a>) that need to be configured for processing.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to enable and configure incremental annotation processing for annotations you have defined under the <code>com.example</code> package:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Incremental Annotation Processing</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">tasks.withType(JavaCompile) {
    options.compilerArgs = [
        '-Amicronaut.processing.incremental=true',
        '-Amicronaut.processing.annotations=com.example.*',
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you do not enable processing for custom annotations you define these annotations will simple be ignored by Micronaut which may break your application.
</td>
</tr>
</table>
</div>

<h2 id="lombok"><a class="anchor" href="#lombok"></a>13.1.3 Using Project Lombok</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/java/lombok.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://projectlombok.org">Project Lombok</a> is a popular java library that adds a number of useful AST transformations to the Java language via annotation processors.</p>
</div>
<div class="paragraph">
<p>Since both Micronaut and Lombok use annotation processors, special care needs to be taken when configuring Lombok to ensure that the Lombok processor runs <strong>before</strong> Micronaut&#8217;s processor.</p>
</div>
<div class="paragraph">
<p>For example in Gradle adding the following dependencies to the <code>dependencies</code> block:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Lombok in Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compileOnly 'org.projectlombok:lombok:1.18.12'
annotationProcessor "org.projectlombok:lombok:1.18.12"
...
// Micronaut processor define after Lombok
annotationProcessor "io.micronaut:micronaut-inject-java"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or when using Maven:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Lombok in Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;version&gt;1.18.12&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
...
&lt;annotationProcessorPaths&gt;
  &lt;path&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;version&gt;1.18.12&lt;/version&gt;
  &lt;/path&gt;
  &lt;path&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-inject-java&lt;/artifactId&gt;
    &lt;version&gt;${micronaut.version}&lt;/version&gt;
  &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In both cases (Gradle and Maven) the Micronaut processor should be configured after the Lombok processor, reversing the order of the declared dependencies will not work.
</td>
</tr>
</table>
</div>

<h2 id="ide"><a class="anchor" href="#ide"></a>13.1.4 Configuring an IDE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/java/ide.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can use any IDE to develop Micronaut applications, if you depend on your configured build tool (Gradle or Maven) to build the application.</p>
</div>
<div class="paragraph">
<p>However, if you wish to run tests within the IDE that is currently possible with <a href="http://jetbrains.com/idea">IntelliJ IDEA</a> or Eclipse 4.9 M2 or above.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#ideSetup">IDE Setup</a> in the Quick start for more information on how to configure IntelliJ or Eclipse.</p>
</div>

<h2 id="retainparameternames"><a class="anchor" href="#retainparameternames"></a>13.1.5 Retaining Parameter Names</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/java/retainparameternames.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default with Java, the parameter name data for method parameters is not retained at compile time. This can be a problem for Micronaut if you do not define parameter names explicitly and depend on an external JAR that is already compiled.</p>
</div>
<div class="paragraph">
<p>Consider this interface:</p>
</div>
<div class="listingblock">
<div class="title">Client Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface HelloOperations {
    @Get("/hello/{name}")
    String hello(String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At compile time the parameter name <code>name</code> is lost and becomes simply <code>arg0</code> when compiled against or read via reflection later. To avoid this problem you have two options. You can either declare the parameter name explicitly:</p>
</div>
<div class="listingblock">
<div class="title">Client Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface HelloOperations {
    @Get("/hello/{name}")
    String hello(@QueryValue("name") String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively it is recommended that you compile all byte code with <code>-parameters</code> flag to <code>javac</code>. See <a href="https://docs.oracle.com/javase/tutorial/reflect/member/methodparameterreflection.html">Obtaining Names of Method Parameters</a>. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compileJava.options.compilerArgs += '-parameters'</code></pre>
</div>
</div>

<h2 id="groovy"><a class="anchor" href="#groovy"></a>13.2 Micronaut for Groovy</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/groovy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="http://groovy-lang.org">Groovy language</a> has first class support in Micronaut.</p>
</div>
<div class="sect1">
<h2 id="_groovy_specific_modules">Groovy Specific Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additional modules exist specific to Groovy that improve the overall experience. These are detailed in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Groovy Specific Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:micronaut-inject-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes AST transformations to generate bean definitions. Should be <code>compileOnly</code> on your classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:micronaut-runtime-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds the ability to specify configuration placed in <code>src/main/resources</code> in Groovy format (i.e. <code>application.groovy</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:micronaut-function-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes AST transforms that make it easier to write <a href="#serverlessFunctions">Functions</a> for AWS Lambda</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The most common module you will need is <code>micronaut-inject-groovy</code>, which enables DI and AOP for classes written in Groovy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_support_in_the_cli">Groovy Support in the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="#cli">Command Line Interface</a> for Micronaut includes special support for Groovy. To create a Groovy application use the <code>groovy</code> lang option. For example:</p>
</div>
<div class="listingblock">
<div class="title">Create a Micronaut Groovy application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world --lang groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will generate a Groovy project, built with Gradle. You can use the <code>-build maven</code> flag to generate a project built with Maven instead.</p>
</div>
<div class="paragraph">
<p>Once you have created an application with the <code>groovy</code> feature commands like <code>create-controller</code>, <code>create-client</code> etc. will generate Groovy files instead of Java. The following example demonstrates this action when using interactive mode of the CLI:</p>
</div>
<div class="listingblock">
<div class="title">Create a bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;

create-bean          create-client        create-controller
create-job           help

mn&gt; create-bean helloBean
| Rendered template Bean.groovy to destination src/main/groovy/hello/world/HelloBean.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example demonstrates creating a Groovy bean that looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package hello.world

import javax.inject.Singleton

@Singleton
class HelloBean {

}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Groovy automatically imports <code>groovy.lang.Singleton</code> which can be confusing as it conflicts with <code>javax.inject.Singleton</code>. Make sure you use <code>javax.inject.Singleton</code> when declaring a Micronaut singleton bean to avoid surprising behavior.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can also create a client - don&#8217;t forget Micronaut can act as a client or a server!</p>
</div>
<div class="listingblock">
<div class="title">Create a client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-client helloClient
| Rendered template Client.groovy to destination src/main/groovy/hello/world/HelloClient.groovy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Micronaut Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package hello.world

import io.micronaut.http.client.annotation.Client
import io.micronaut.http.annotation.Get
import io.micronaut.http.HttpStatus

@Client("hello")
interface HelloClient {

    @Get
    HttpStatus index()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create a controller:</p>
</div>
<div class="listingblock">
<div class="title">Create a controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-controller helloController
| Rendered template Controller.groovy to destination src/main/groovy/hello/world/HelloController.groovy
| Rendered template ControllerSpec.groovy to destination src/test/groovy/hello/world/HelloControllerSpec.groovy
mn&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Micronaut Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package hello.world

import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.HttpStatus


@Controller("/hello")
class HelloController {

    @Get
    HttpStatus index() {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the output from the CLI a <a href="http://spockframework.org">Spock</a> test was also generated for you demonstrating how to test the controller:</p>
</div>
<div class="listingblock">
<div class="title">HelloControllerSpec.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">...
    void "test index"() {
        given:
        HttpResponse response = client.toBlocking().exchange("/hello")

        expect:
        response.status == HttpStatus.OK
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how you use Micronaut both as client and as a server to test itself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programmatic_routes_with_groovyrouterbuilder">Programmatic Routes with GroovyRouterBuilder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you prefer to build your routes programmatically (similar to Grails <code>UrlMappings</code>) then a special <code>io.micronaut.web.router.GroovyRouteBuilder</code> exists that has some enhancements to make the DSL better.</p>
</div>
<div class="paragraph">
<p>The following example shows <code>GroovyRouteBuilder</code> in act:</p>
</div>
<div class="listingblock">
<div class="title">Using GroovyRouteBuilder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
static class MyRoutes extends GroovyRouteBuilder {

    MyRoutes(ApplicationContext beanContext) {
        super(beanContext)
    }

    @Inject
    void bookResources(BookController bookController, AuthorController authorController) {
        GET(bookController) {
            POST("/hello{/message}", bookController.&amp;hello) <i class="conum" data-value="1"></i><b>(1)</b>
        }
        GET(bookController, ID) { <i class="conum" data-value="2"></i><b>(2)</b>
            GET(authorController)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can use injected controllers to create routes by convention and Groovy method references to create routes to methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>ID</code> property can be used to reference include an <code>{id}</code> URI variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example results in the following routes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/book</code> - Maps to <code>BookController.index()</code></p>
</li>
<li>
<p><code>/book/hello/{message}</code> - Maps to <code>BookController.hello(String)</code></p>
</li>
<li>
<p><code>/book/{id}</code> - Maps to <code>BookController.show(String id)</code></p>
</li>
<li>
<p><code>/book/{id}/author</code> - Maps to <code>AuthorController.index</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_gorm_in_a_groovy_application">Using GORM in a Groovy application</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://gorm.grails.org">GORM</a> is a data access toolkit originally created as part of Grails framework. It supports multiple database types. The following table summarizes the modules needed to use GORM and links to documentation.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. GORM Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-hibernate-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/hibernate/manual">GORM for Hibernate</a> for Groovy applications. See the <a href="#hibernateSupport">Hibernate Support</a> docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-mongo-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/mongodb/manual">GORM for MongoDB</a> for Groovy applications. See the <a href="#mongoSupport">Mongo Support</a> docs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-neo4j-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/neo4j/manual">GORM for Neo4j</a> for Groovy applications. See the <a href="#neo4jSupport">Neo4j Support</a> docs.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once you have configured a GORM implementation per the instructions linked in the table above you can use all features of GORM.</p>
</div>
<div class="paragraph">
<p><a href="http://gorm.grails.org/latest/hibernate/manual/index.html#dataServices">GORM Data Services</a> can also participate in dependency injection and life cycle methods:</p>
</div>
<div class="listingblock">
<div class="title">GORM Data Service VehicleService.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Service(Vehicle)
abstract class VehicleService {
    @PostConstruct
    void init() {
       // do something on initialization

    }

    abstract Vehicle findVehicle(@NotBlank String name)

    abstract Vehicle saveVehicle(@NotBlank String name)

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define the service as an interface instead of an abstract class if you want GORM to do all of the work and you don&#8217;t want to add your own behaviors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_functions_with_groovy">Serverless Functions with Groovy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A microservice application is just one way to use Micronaut. You can also use it for serverless functions like on AWS Lambda.</p>
</div>
<div class="paragraph">
<p>With the <code>function-groovy</code> module, Micronaut features enhanced support for functions written in Groovy.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#serverlessFunctions">Serverless Functions</a> for more information.</p>
</div>
</div>
</div>

<h2 id="kotlin"><a class="anchor" href="#kotlin"></a>13.3 Micronaut for Kotlin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/kotlin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="#cli">Command Line Interface</a> for Micronaut includes special support for Kotlin. To create a Kotlin application use the <code>kotlin</code> lang option. For example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Create a Micronaut Kotlin application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world --lang kotlin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Support for Kotlin in Micronaut is built upon the <a href="https://kotlinlang.org/docs/reference/kapt.html">Kapt</a> compiler plugin, which includes support for Java annotation processors. To use Kotlin in your Micronaut application, you will simply need to add the proper dependencies to configure and run kapt on your <code>kt</code> source files. Kapt will create Java "stub" classes for each of your Kotlin classes, which can then be processed by Micronaut&#8217;s Java annotation processor. The stubs are not included in the final compiled application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Learn more about kapt and its features from the <a href="https://kotlinlang.org/docs/reference/kapt.html">official documentation.</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Micronaut annotation processors are declared in the <code>kapt</code> scope when using Gradle. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion" <i class="conum" data-value="1"></i><b>(1)</b>
    compile "org.jetbrains.kotlin:kotlin-reflect:$kotlinVersion"
    kapt "io.micronaut:micronaut-inject-java" <i class="conum" data-value="2"></i><b>(2)</b>

    kaptTest "io.micronaut:micronaut-inject-java" <i class="conum" data-value="3"></i><b>(3)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the Kotlin standard libraries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the <code>micronaut-inject-java</code> dependency under the <code>kapt</code> scope, so classes in <code>src/main</code> are processed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the <code>micronaut-inject-java</code> dependency under the <code>kaptTest</code> scope, so classes in <code>src/test</code> are processed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With a <code>build.gradle</code> file similar to the above, you can now run your Micronaut application using the <code>run</code> task (provided by the Application plugin):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example controller written in Kotlin can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/HelloController.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package example

import io.micronaut.http.annotation.*

@Controller("/")
class HelloController {

    @Get("/hello/{name}")
    fun hello(name: String): String {
        return "Hello $name"
    }
}</code></pre>
</div>
</div>

<h2 id="kaptintellij"><a class="anchor" href="#kaptintellij"></a>13.3.1 Kotlin, Kapt and IntelliJ</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/kotlin/kaptintellij.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As of this writing IntelliJ&#8217;s built-in compiler does not directly support Kapt and annotation processing. You must instead configure Intellij to run Gradle (or Maven) compilation as a build step before running your tests or application class.</p>
</div>
<div class="paragraph">
<p>First edit the run configuration for tests or for the application and select "Run Gradle task" as a build step:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/kotlin-run-1.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>Then add the <code>classes</code> task as task to execute for the application or for tests the <code>testClasses</code> task:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/kotlin-run-2.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>Now whenever you run tests or the application Micronaut classes will be generated at compilation time.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can <a href="https://www.jetbrains.com/help/idea/gradle.html#delegate_build_gradle">delegate IntelliJ build/run actions to Gradle</a> completely:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/delegatetogradle.png" alt="delegatetogradle">
</div>
</div>

<h2 id="gradlekapt"><a class="anchor" href="#gradlekapt"></a>13.3.2 Incremental Annotation Processing with Gradle and Kapt</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/kotlin/gradlekapt.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To enable gradle incremental annotation processing with Kapt the arguments as specified <a href="#incrementalannotationgradle">Incremental Annotation Processing with Gradle</a> must be sent to Kapt</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to enable and configure incremental annotation processing for annotations you have defined under the <code>com.example</code> and <code>io.example</code> packages:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Incremental Annotation Processing in Kapt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">kapt {
    arguments {
        arg("micronaut.processing.incremental", true)
        arg("micronaut.processing.annotations", "com.example.*,io.example.*")
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you do not enable processing for custom annotations you define these annotations will simple be ignored by Micronaut which may break your application.
</td>
</tr>
</table>
</div>

<h2 id="openandaop"><a class="anchor" href="#openandaop"></a>13.3.3 Kotlin and AOP Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/kotlin/openandaop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut provides a compile-time AOP API that does not use reflection. When you use any Micronaut&#8217;s <a href="#aop">AOP Advice</a>,
it creates a subclass at compile-time to provide the AOP behaviour. This can be a problem because Kotlin classes are final by default. If the application was created with the Micronaut CLI, then the Kotlin <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#all-open-compiler-plugin">all-open</a> plugin is configured for you to automatically change your classes to <code>open</code> when an AOP annotation is used. To configure it yourself, simply add the <a href="../api/io/micronaut/aop/Around.html">Around</a> class to the list of supported annotations.</p>
</div>
<div class="paragraph">
<p>If you prefer not to or cannot use the <code>all-open</code> plugin, you must declare the classes that are annotated with an AOP annotation to be open:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.HttpStatus
import io.micronaut.validation.Validated
import javax.validation.constraints.NotBlank

@Validated
@Controller("/email")
open class EmailController { <i class="conum" data-value="1"></i><b>(1)</b>

    @Get("/send")
    fun index(@NotBlank recipient: String, <i class="conum" data-value="1"></i><b>(1)</b>
                   @NotBlank subject: String): HttpStatus {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if you use <code>@Validated</code> AOP Advice, you need to use <code>open</code> at class and method level.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>all-open</code> plugin does not handle methods. If you declare an AOP annotation on a method, you must manually declare it as open.
</td>
</tr>
</table>
</div>

<h2 id="kotlinretainparamnames"><a class="anchor" href="#kotlinretainparamnames"></a>13.3.4 Kotlin and Retaining Parameter Names</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/kotlin/kotlinretainparamnames.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like with Java, the parameter name data for method parameters is not retained at compile time when using Kotlin. This can be a problem for Micronaut if you do not define parameter names explicitly and depend on an external JAR that is already compiled.</p>
</div>
<div class="paragraph">
<p>To enable the retention of parameter name data with Kotlin you should set the <code>javaParameters</code> option to <code>true</code> in your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compileTestKotlin {
	kotlinOptions {
	    jvmTarget = '1.8'
	    javaParameters = true
	}
}</code></pre>
</div>
</div>

<h2 id="coroutines"><a class="anchor" href="#coroutines"></a>13.3.5 Coroutines Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/kotlin/coroutines.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Kotlin coroutines allow you to create asynchronous applications with imperative style code. A Micronaut&#8217;s controller
action can be a <code>suspend</code> function:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/simple", produces = [MediaType.TEXT_PLAIN])
    suspend fun simple(): String { <b class="conum">(1)</b>
        return "Hello"
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The function is marked as <code>suspend</code>, though in reality it won&#8217;t be suspended.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/delayed", produces = [MediaType.TEXT_PLAIN])
    suspend fun delayed(): String { <b class="conum">(1)</b>
        delay(1) <b class="conum">(2)</b>
        return "Delayed"
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The function is marked as <code>suspend</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>delay</code> is called to make sure that a function is suspended and the response is returned from a different thread.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Status(HttpStatus.CREATED) <b class="conum">(1)</b>
    @Get("/status")
    suspend fun status(): Unit {
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>suspend</code> function also works when all we want is to return a status.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Status(HttpStatus.CREATED)
    @Get("/statusDelayed")
    suspend fun statusDelayed(): Unit {
        delay(1)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>Flow</code> type for streaming server and client. A streaming controller can return <code>Flow</code>, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server with Flow</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get(value = "/headlinesWithFlow", processes = [MediaType.APPLICATION_JSON_STREAM])
    internal fun streamHeadlinesWithFlow(): Flow&lt;Headline&gt; = <b class="conum">(1)</b>
        flow { <b class="conum">(2)</b>
            repeat(100) { <b class="conum">(3)</b>
                with (Headline()) {
                    text = "Latest Headline at " + ZonedDateTime.now()
                    emit(this) <b class="conum">(4)</b>
                    delay(1_000) <b class="conum">(5)</b>
                }
            }
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method <code>streamHeadlinesWithFlow</code> is defined that produces <code>application/x-json-stream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>Flow</code> is created using <code>flow</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This <code>Flow</code> will emit 100 messages</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Emitting will happend with <code>emit</code> <code>suspend</code> function</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>There will be a 1 second <em>delay</em> between messages</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A streaming client can simply return a <code>Flow</code>, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming client with Flow</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import kotlinx.coroutines.flow.Flow


@Client("/streaming")
interface HeadlineFlowClient {

    @Get(value = "/headlinesWithFlow", processes = [MediaType.APPLICATION_JSON_STREAM]) <b class="conum">(1)</b>
    fun streamFlow(): Flow&lt;Headline&gt; <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Get</code> method is defined as processing responses of type <code>APPLICATION_JSON_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>Flow</code> is used as the return type</td>
</tr>
</table>
</div>

<h2 id="graal"><a class="anchor" href="#graal"></a>13.4 Micronaut for GraalVM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/graal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.graalvm.org">GraalVM</a> is a new universal virtual machine from Oracle that supports a polyglot runtime environment and the ability to compile Java applications down to native machine code.</p>
</div>
<div class="paragraph">
<p>Any Micronaut application can be run using the GraalVM JVM, however special support has been added to Micronaut to support running Micronaut applications using <a href="https://www.graalvm.org/docs/reference-manual/aot-compilation/">GraalVM&#8217;s <code>native-image</code> tool</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut currently supports GraalVM 20.2.0 version and the team is improving the support in every new release. Don&#8217;t
hesitate to <a href="https://github.com/micronaut-projects/micronaut-core/issues">report issues</a> however if you find any problem.</p>
</div>
<div class="paragraph">
<p>A lot of Micronaut&#8217;s modules and third party libraries have been verified to work with GraalVM: HTTP server, HTTP client,
Function support, Micronaut Data JDBC and JPA, Service Discovery, RabbitMQ, Views, Security, Zipkin,&#8230;&#8203; Support for other
modules is still evolving and will improve over time.</p>
</div>
<div class="sect2">
<h3 id="_getting_started">Getting Started</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use of GraalVM&#8217;s <code>native-image</code> tool is only supported in Java or Kotlin projects. Groovy relies heavily on
reflection which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start using GraalVM you should first install the GraalVM SDK via the <a href="https://www.graalvm.org/docs/getting-started/">Getting Started</a>
or using <a href="https://sdkman.io/">Sdkman!</a>.</p>
</div>
</div>

<h2 id="graalServices"><a class="anchor" href="#graalServices"></a>13.4.1 Microservices as GraalVM native images</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/graal/graalServices.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_getting_started_with_micronaut_and_graal">Getting Started with Micronaut and Graal</h3>
<div class="paragraph">
<p>To get started creating a Microservice that can be compiled into a native image, use the <code>graalvm</code> feature when creating the application with the CLI:</p>
</div>
<div class="listingblock">
<div class="title">Creating a Graal Native Microservice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world --features graalvm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>graalvm</code> feature adds three important items:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>svm</code> and <code>graal</code> dependencies to your <code>build.gradle</code> (or <code>pom.xml</code> if <code>--build maven</code> is used).</p>
</li>
<li>
<p>A <code>Dockerfile</code> which can be used to construct the native image using Docker and a script <code>docker-build.sh</code> to run it.</p>
</li>
<li>
<p>A <code>native-image.properties</code> configuration file <code>src/main/resources/META-INF/native-image</code> to simplify building the image.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>native-image.properties</code> file that is generated looks something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">Args = -H:Name=example \ <i class="conum" data-value="1"></i><b>(1)</b>
       -H:Class=example.Application <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>-H:Name</code> argument specifies the name of the native image that will be generated.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>-H:Class</code> argument specifies the entry point of your application (the class that defines a <code>static void main</code> method.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_building_a_native_image_using_docker">Building a Native Image Using Docker</h4>
<div class="paragraph">
<p>To build your native image using Docker simply run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew assemble # or ./mvnw package if using Maven
$ docker build . -t hello-world
$ docker run -p 8080:8080 hello-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or use the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew assemble # or ./mvnw package if using Maven
$ ./docker-build.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provided <code>Dockerfile</code> is a multi-stage dockerfile which builds the project in two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A GraalVM official image will build the native image.</p>
</li>
<li>
<p>A typical dockerfile structure will build the final image which is smaller due to layering.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_building_a_native_image_without_using_docker">Building a Native Image Without Using Docker</h4>
<div class="paragraph">
<p>To build your native image without using Docker you need to install GraalVM SDK via the <a href="https://www.graalvm.org/docs/getting-started/">Getting Started</a> instructions or using <a href="https://sdkman.io/">Sdkman!</a>:</p>
</div>
<div class="listingblock">
<div class="title">Installing GraalVM 20.2.0 with SDKman</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sdk install java 20.2.0.r8-grl # or 20.2.0.r11-grl if you want to use JDK 11
$ sdk use java 20.2.0.r8-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>native-image</code> tool was extracted from the base GraalVM distribution. Currently it is available as an early adopter plugin. To install it, run:</p>
</div>
<div class="listingblock">
<div class="title">Installing <code>native-image</code> tool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ gu install native-image</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Creating native image with Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew assemble
$ native-image -cp build/libs/hello-world-0.1-all.jar</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Creating native image with Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw package
$ native-image -cp target/hello-world-0.1-all.jar</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run native image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./hello-world</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_micronaut_and_graal">Understanding Micronaut and Graal</h3>
<div class="paragraph">
<p>Micronaut itself does not rely on reflection or dynamic classloading so works automatically with GraalVM native, however certain third party libraries used by Micronaut may require additional input about uses of reflection.</p>
</div>
<div class="paragraph">
<p>Micronaut includes an annotation processor that helps to handle generating the <code>reflection-config.json</code> and <code>resource-config.json</code>
metadata files that are automatically picked up by the <code>native-image</code> tool:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-graal")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-graal&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>This processor will generate:
- A <code>reflection-config.json</code> file in the <code>META-INF/native-image</code> directory in your build classes directory (<code>target/classes</code> with Maven and typically <code>build/classes/java/main</code> with Gradle).
- A <code>native-image.properties</code> file to read this configuration for all classes annotated with either <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> or <a href="../api/io/micronaut/core/annotation/TypeHint.html">@TypeHint</a>.
- A <code>resource-config.json</code> file also in the <code>META-INF/native-image</code> directory in your build classes directory containing
all the files in the <code>src/main/resources</code> file.</p>
</div>
<div class="paragraph">
<p>For example the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;
import io.micronaut.core.annotation.*;

@Introspected
class Test {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will result in the public methods and declared constructors of <code>example.Test</code> being included in <code>reflection-config.json</code>.</p>
</div>
<div class="paragraph">
<p>If you have more advanced requirements and only wish to include certain fields or methods, you can use <a href="../api/io/micronaut/core/annotation/ReflectiveAccess.html">@ReflectiveAccess</a> instead which can be present on any constructor, field or method to include only the specific field, constructor or method.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you wish to provide your own <code>reflect.json</code> you can add one to <code>src/main/graal/reflect.json</code> and it will be automatically picked up.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Stating with Micronaut 2.0, as the framework generates automatically the file <code>resource-config.json</code>, if you want to
include your own additional resources you can provide them in <code>src/main/graal/resource-config.json</code> and they will
automatically added to the generated file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_additional_classes_for_reflective_access">Adding Additional Classes for Reflective Access</h3>
<div class="paragraph">
<p>To inform Micronaut of additional classes that should be included in the generated <code>reflect.json</code> file at compilation time you can either annotate a class with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> or <a href="../api/io/micronaut/core/annotation/TypeHint.html">@TypeHint</a>.</p>
</div>
<div class="paragraph">
<p>The former will generate a compile time introspection as well as allowing reflective access and the latter will only allow reflective access and is typically used on a module or <code>Application</code> class to include classes that are needed reflectively. For example, the following is taken from Micronaut&#8217;s Jackson module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TypeHint(
        value = { <i class="conum" data-value="1"></i><b>(1)</b>
                PropertyNamingStrategy.UpperCamelCaseStrategy.class,
                ArrayList.class,
                LinkedHashMap.class,
                HashSet.class
        },
        accessType = TypeHint.AccessType.ALL_DECLARED_CONSTRUCTORS <i class="conum" data-value="2"></i><b>(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>value</code> member is used to specify which classes require reflection.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>accessType</code> member specifies if only classloading access is needed or whether full reflection on all public members is needed.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_generating_native_images">Generating Native Images</h3>
<div class="paragraph">
<p>GraalVM&#8217;s <code>native-image</code> command is used to generate native images. You can use this command manually to generate your native image. An example can be seen below.</p>
</div>
<div class="listingblock">
<div class="title">The <code>native-image</code> command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">native-image --class-path build/libs/hello-world-0.1-all.jar <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>class-path</code> argument is used to refer to the Micronaut shaded JAR</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the image has been built you can run the application using the native image name:</p>
</div>
<div class="listingblock">
<div class="title">Running the Native Application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./hello-world
15:15:15.153 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 14ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the advantage of having a native image is startup completes in milliseconds and memory consumption does not include the overhead of the JVM (a native Micronaut application runs with just 20mb of memory).</p>
</div>
</div>

<h2 id="graalFAQ"><a class="anchor" href="#graalFAQ"></a>13.4.2 GraalVM and Micronaut FAQ</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/languageSupport/graal/graalFAQ.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_how_does_micronaut_manage_to_run_on_graalvm">How does Micronaut manage to run on GraalVM?</h4>
<div class="paragraph">
<p>Micronaut features a Dependency Injection and Aspect-Oriented Programming runtime that uses no reflection. This makes it easier for Micronaut applications to run on GraalVM since there are <a href="https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md">limitations</a> particularly around <a href="https://github.com/oracle/graal/blob/master/substratevm/REFLECTION.md">reflection</a> on SubstrateVM.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_can_i_make_a_micronaut_application_that_uses_picocli_run_on_graalvm">How can I make a Micronaut application that uses picocli run on GraalVM?</h4>
<div class="paragraph">
<p>Picocli provides a <code>picocli-codegen</code> module with a tool for generating a GraalVM reflection configuration file. The tool can be run <a href="https://picocli.info/picocli-on-graalvm.html">manually</a> or automatically as part of the build. The module&#8217;s <a href="https://github.com/remkop/picocli/tree/master/picocli-codegen">README</a> has usage instructions with code snippets for configuring Gradle and Maven to generate a <code>cli-reflect.json</code> file automatically as part of the build. Add the generated file to the <code>-H:ReflectionConfigurationFiles</code> option when running the <code>native-image</code> tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_about_other_third_party_libraries">What about other Third-Party Libraries?</h4>
<div class="paragraph">
<p>Micronaut cannot guarantee that third-party libraries work on GraalVM SubstrateVM, that is down to each individual library to implement support.</p>
</div>
</div>
<div class="sect3">
<h4 id="_i_get_a_class_xxx_is_instantiated_reflectively_exception_what_do_i_do">I Get a "Class XXX is instantiated reflectively&#8230;&#8203;" Exception. What do I do?</h4>
<div class="paragraph">
<p>If you get an error such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Class myclass.Foo[] is instantiated reflectively but was never registered. Register the class by using org.graalvm.nativeimage.RuntimeReflection</pre>
</div>
</div>
<div class="paragraph">
<p>You may need to manually tweak the generated <code>reflect.json</code> file. For regular classes you need to add an entry into the array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        "name" : "myclass.Foo",
        "allDeclaredConstructors" : true
    },
    ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For arrays this needs to use the Java JVM internal array representation. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        "name" : "[Lmyclass.Foo;",
        "allDeclaredConstructors" : true
    },
    ...
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_what_if_i_want_to_set_the_heap_s_maximum_size_with_code_xmx_code_but_i_get_an_code_outofmemoryerror_code">What if I want to set the heap&#8217;s maximum size with <code>-Xmx</code>, but I get an <code>OutOfMemoryError</code>?</h4>
<div class="paragraph">
<p>If you set heap&#8217;s maximum size in the Dockerfile that you use to build your native image, you will probably get runtime an error like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.OutOfMemoryError: Direct buffer memory</pre>
</div>
</div>
<div class="paragraph">
<p>The problem is that Netty is trying to allocate 16MiB of memory per chunk with its default settings for <code>io.netty.allocator.pageSize</code> and <code>io.netty.allocator.maxOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">int defaultChunkSize = DEFAULT_PAGE_SIZE &lt;&lt; DEFAULT_MAX_ORDER; // 8192 &lt;&lt; 11 = 16MiB</code></pre>
</div>
</div>
<div class="paragraph">
<p>The simplest solution is to specify <code>io.netty.allocator.maxOrder</code> explicitly in your Dockerfile&#8217;s entrypoint. A working example with <code>-Xmx64m</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">ENTRYPOINT ["/app/application", "-Xmx64m", "-Dio.netty.allocator.maxOrder=8"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to go further, you can also experiment with <code>io.netty.allocator.numHeapArenas</code> or <code>io.netty.allocator.numDirectArenas</code>. You can find more information about Netty&#8217;s <code>PooledByteBufAllocator</code> in the <a href="https://netty.io/4.1/api/io/netty/buffer/PooledByteBufAllocator.html">official documentation</a>.</p>
</div>
</div>

<h1 id="management"><a class="anchor" href="#management"></a>14 Management & Monitoring</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>management</code> feature to configure the management endpoints in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features management</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Inspired by Spring Boot and Grails, the Micronaut <code>management</code> dependency adds support for monitoring of your application via <strong>endpoints</strong>: special URIs that return details about the health and state of your application. The <code>management</code> endpoints are also integrated with Micronaut&#8217;s <code>security</code> dependency, allowing for sensitive data to be restricted to authenticated users in your security system (see <a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/#builtInEndpointsAccess">Built-in Endpoints Access</a> in the Security section).</p>
</div>
<div class="paragraph">
<p>To use the <code>management</code> features described in this section, add the dependency on your classpath.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-management")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-management&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>

<h2 id="buildingEndpoints"><a class="anchor" href="#buildingEndpoints"></a>14.1 Creating Endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/buildingEndpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to the <a href="#providedEndpoints">Built-In Endpoints</a>, the <code>management</code> dependency also provides support for creating custom endpoints.  Custom endpoints can be enabled and configured identically to the built-in endpoints, and can be used to retrieve and return any metrics or other application data that you require.</p>
</div>

<h2 id="endpointAnnotation"><a class="anchor" href="#endpointAnnotation"></a>14.1.1 The Endpoint Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/buildingEndpoints/endpointAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>An Endpoint can be created by annotating a class with the <a href="../api/io/micronaut/management/endpoint/Endpoint.html">Endpoint</a> annotation, and supplying it with (at minimum) an endpoint id.</p>
</div>
<div class="listingblock">
<div class="title">FooEndpoint.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Endpoint("foo")
class FooEndpoint {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a single <code>String</code> argument is supplied to the annotation, it will be used as the endpoint id.</p>
</div>
<div class="paragraph">
<p>It is possible to supply additional (named) arguments to the annotation. Other possible arguments to <code>@Endpoint</code> are described in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Endpoint Arguments</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Endpoint Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint id (or name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(id = "foo")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix used for configuring the endpoint (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(prefix = "foo")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean defaultEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the endpoint is enabled when no configuration is set (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(defaultEnabled = false)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean defaultSensitive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the endpoint is sensitive if no configuration is set (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(defaultSensitive = false)</code></p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_example_of_custom_endpoint">Example of custom Endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following example <code>Endpoint</code> class will create an endpoint accessible at <code>/date</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
public class CurrentDateEndpoint {

    //.. endpoint methods

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
class CurrentDateEndpoint {

    //.. endpoint methods

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

    //.. endpoint methods

}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="endpointMethod"><a class="anchor" href="#endpointMethod"></a>14.1.2 Endpoint Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/buildingEndpoints/endpointMethod.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoints respond to <code>GET</code> ("read"), <code>POST</code> ("write") and <code>DELETE</code> ("delete") requests. To return a response from an endpoint, annotate its public method/s with one of following annotations:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Endpoint Method Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/Read.html">Read</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>GET</code> requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/Write.html">Write</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>POST</code> requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/Delete.html">Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>DELETE</code> requests</p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_read_methods">Read Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/annotation/Read.html">Read</a> annotation will cause it to respond to <code>GET</code> requests.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Read;

@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
public class CurrentDateEndpoint {

    private Date currentDate;

    @Read
    public Date currentDate() {
        return currentDate;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
class CurrentDateEndpoint {

    Date currentDate

    @Read
    Date currentDate() {
        return currentDate
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

    private var currentDate: Date? = null

    @Read
    fun currentDate(): Date? {
        return currentDate
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X GET localhost:55838/date

1526085903689</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/Read.html">Read</a> annotation accepts an optional <code>produces</code> argument, which sets the media type returned from the method (default is <code>application/json</code>):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Read;

import io.micronaut.http.MediaType;
import io.micronaut.management.endpoint.annotation.Selector;

@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
public class CurrentDateEndpoint {

    private Date currentDate;

    @Read(produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    public String currentDatePrefix(@Selector String prefix) {
        return prefix + ": " + currentDate;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector


@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
class CurrentDateEndpoint {

    Date currentDate

    @Read(produces = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    String currentDatePrefix(@Selector String prefix) {
        return "${prefix}: ${currentDate}"
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector


@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

    private var currentDate: Date? = null

    @Read(produces = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    fun currentDatePrefix(@Selector prefix: String): String {
        return "$prefix: $currentDate"
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Supported media types are represented by <a href="../api/io/micronaut/http/MediaType.html">MediaType</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X GET localhost:8080/date/the_date_is

the_date_is: Fri May 11 19:24:21 CDT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_write_methods">Write Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/Write.html">Write</a> annotation will cause it to respond to <code>POST</code> requests.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Write;

import io.micronaut.http.MediaType;
import io.micronaut.management.endpoint.annotation.Selector;

@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
public class CurrentDateEndpoint {

    private Date currentDate;

    @Write
    public String reset() {
        currentDate = new Date();

        return "Current date reset";
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector


@Endpoint(id = "date",
        prefix = "custom",
        defaultEnabled = true,
        defaultSensitive = false)
class CurrentDateEndpoint {

    Date currentDate

    @Write
    String reset() {
        currentDate = new Date()

        return "Current date reset"
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector


@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

    private var currentDate: Date? = null

    @Write
    fun reset(): String {
        currentDate = Date()

        return "Current date reset"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:39357/date

Current date reset</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/Write.html">Write</a> annotation accepts an optional <code>consumes</code> argument, which sets the media type accepted by the method (default is <code>application/json</code>):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Write;

import io.micronaut.http.MediaType;

@Endpoint(id = "message", defaultSensitive = false)
public class MessageEndpoint {

    String message;

    @Write(consumes = MediaType.APPLICATION_FORM_URLENCODED, produces = MediaType.TEXT_PLAIN)
    public String updateMessage(String newMessage) {
        this.message = newMessage;

        return "Message updated";
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

    String message

    @Write(consumes = MediaType.APPLICATION_FORM_URLENCODED, produces = MediaType.TEXT_PLAIN)
    String updateMessage(String newMessage) {  <b class="conum">(1)</b>
        message = newMessage

        return "Message updated"
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

    internal var message: String? = null

    @Write(consumes = [MediaType.APPLICATION_FORM_URLENCODED], produces = [MediaType.TEXT_PLAIN])
    fun updateMessage(newMessage: String): String {  <b class="conum">(1)</b>
        this.message = newMessage

        return "Message updated"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:65013/message -H 'Content-Type: application/x-www-form-urlencoded' -d $'newMessage=A new message'

Message updated</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delete_methods">Delete Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/Delete.html">Delete</a> annotation will cause it to respond to <code>DELETE</code> requests.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Delete;

@Endpoint(id = "message", defaultSensitive = false)
public class MessageEndpoint {

    String message;

    @Delete
    public String deleteMessage() {
        this.message = null;

        return "Message deleted";
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Delete

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

    String message

    @Delete
    String deleteMessage() {
        message = null

        return "Message deleted"
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Delete

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

    internal var message: String? = null

    @Delete
    fun deleteMessage(): String {
        this.message = null

        return "Message deleted"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X DELETE http://localhost:65013/message

Message deleted</code></pre>
</div>
</div>
</div>
</div>

<h2 id="endpointSensitivity"><a class="anchor" href="#endpointSensitivity"></a>14.1.3 Endpoint Sensitivity</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/buildingEndpoints/endpointSensitivity.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoint sensitivity can be controlled for the entire endpoint through the endpoint annotation and configuration. Individual methods can be configured independently from the endpoint as a whole, however. The <a href="../api/io/micronaut/management/endpoint/annotation/Sensitive.html">@Sensitive</a> annotation can be applied to methods to control their sensitivity.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AlertsEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.MediaType;
import io.micronaut.management.endpoint.annotation.*;

import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

@Endpoint(id = "alerts", defaultSensitive = false) <b class="conum">(1)</b>
public class AlertsEndpoint {

    private final List&lt;String&gt; alerts = new CopyOnWriteArrayList&lt;&gt;();

    @Read
    List&lt;String&gt; getAlerts() {
        return alerts;
    }

    @Delete
    @Sensitive(true)  <b class="conum">(2)</b>
    void clearAlerts() {
        alerts.clear();
    }

    @Write(consumes = MediaType.TEXT_PLAIN)
    @Sensitive(property = "add.sensitive", defaultValue = true)  <b class="conum">(3)</b>
    void addAlert(String alert) {
        alerts.add(alert);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AlertsEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.MediaType;
import io.micronaut.management.endpoint.annotation.*;

import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

@Endpoint(id = "alerts", defaultSensitive = false) <b class="conum">(1)</b>
class AlertsEndpoint {

    private final List&lt;String&gt; alerts = new CopyOnWriteArrayList&lt;&gt;();

    @Read
    List&lt;String&gt; getAlerts() {
        alerts
    }

    @Delete
    @Sensitive(true)  <b class="conum">(2)</b>
    void clearAlerts() {
        alerts.clear()
    }

    @Write(consumes = MediaType.TEXT_PLAIN)
    @Sensitive(property = "add.sensitive", defaultValue = true)  <b class="conum">(3)</b>
    void addAlert(String alert) {
        alerts.add(alert)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AlertsEndpoint</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.*
import java.util.concurrent.CopyOnWriteArrayList

@Endpoint(id = "alerts", defaultSensitive = false) <b class="conum">(1)</b>
class AlertsEndpoint {

    private val alerts: MutableList&lt;String&gt; = CopyOnWriteArrayList()

    @Read
    fun getAlerts(): List&lt;String&gt; {
        return alerts
    }

    @Delete
    @Sensitive(true)  <b class="conum">(2)</b>
    fun clearAlerts() {
        alerts.clear()
    }

    @Write(consumes = [MediaType.TEXT_PLAIN])
    @Sensitive(property = "add.sensitive", defaultValue = true)  <b class="conum">(3)</b>
    fun addAlert(alert: String) {
        alerts.add(alert)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The endpoint is not sensitive by default and the default prefix of <code>endpoints</code> is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method is always sensitive, regardless of any other factors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>property</code> value is appended to the prefix and id to lookup a configuration value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the configuration key <code>endpoints.alerts.add.sensitive</code> is set, that value will determine the sensitivity of the <code>addAlert</code> method.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>endpoint</code> is the first token because that is the default value for <code>prefix</code> in the endpoint annotation and is not set explicity in this example.</p>
</li>
<li>
<p><code>alerts</code> is the next token because that is the endpoint id</p>
</li>
<li>
<p><code>add.sensitive</code> is the next token because that is the value set to the <code>property</code> member of the <a href="../api/io/micronaut/management/endpoint/annotation/Sensitive.html">@Sensitive</a> annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the configuration key is not set, the <code>defaultValue</code> will be used (defaults to <code>true</code>).</p>
</div>

<h2 id="endpointConfiguration"><a class="anchor" href="#endpointConfiguration"></a>14.1.4 Endpoint Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/buildingEndpoints/endpointConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoints with the <code>endpoints</code> prefix can be configured through their default endpoint id. If an endpoint exists with the id of <code>foo</code>, it can be configured through <code>endpoints.foo</code>. In addition, default values can be provided through the <code>all</code> prefix.</p>
</div>
<div class="paragraph">
<p>For example, consider the following endpoint.</p>
</div>
<div class="listingblock">
<div class="title">FooEndpoint.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Endpoint("foo")
class FooEndpoint {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the endpoint will be enabled. To disable the endpoint, set <code>endpoints.foo.enabled</code> to false. If <code>endpoints.foo.enabled</code> is not set at all and <code>endpoints.all.enabled</code> is set to false, the endpoint will be disabled.</p>
</div>
<div class="paragraph">
<p>The configuration values for the endpoint override the ones for <code>all</code>. If <code>endpoints.foo.enabled</code> is explicitly set to <code>true</code> and <code>endpoints.all.enabled</code> is explicitly set to <code>false</code>, the endpoint will be enabled.</p>
</div>
<div class="paragraph">
<p>For all endpoints, the following configuration values can be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    &lt;any endpoint id&gt;:
        enabled: Boolean
        sensitive: Boolean</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The base path for all endpoints is <code>/</code> by default. If you prefer the endpoints to be available under a different base path, configure <code>endpoints.all.path</code>. For example, if the value is set to <code>/endpoints</code>, the foo endpoint will be accessible at <code>/endpoints/foo</code>.
</td>
</tr>
</table>
</div>

<h2 id="providedEndpoints"><a class="anchor" href="#providedEndpoints"></a>14.2 Built-In Endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the <code>management</code> dependency is added to your project, the following built-in endpoints are enabled by default:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Default Endpoints</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/beans/BeansEndpoint.html">BeansEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/beans</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the loaded bean definitions in the application (see <a href="#beansEndpoint">BeansEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/health/HealthEndpoint.html">HealthEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the "health" of the application (see <a href="#healthEndpoint">HealthEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/info/InfoEndpoint.html">InfoEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns static information from the state of the application (see <a href="#infoEndpoint">InfoEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/loggers/LoggersEndpoint.html">LoggersEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/loggers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about available loggers and permits changing the configured log level (see <a href="#loggersEndpoint">LoggersEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/configuration/metrics/management/endpoint/MetricsEndpoint.html">MetricsEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the <a href="#metricsEndpoint">application metrics</a>. Requires the <code>micrometer-core</code> configuration on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/refresh/RefreshEndpoint.html">RefreshEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/refresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refreshes the application state (see <a href="#refreshEndpoint">RefreshEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/routes/RoutesEndpoint.html">RoutesEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/routes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about URIs available to be called for your application (see <a href="#routesEndpoint">RoutesEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/env/EnvironmentEndpoint.html">EnvironmentEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the environment and its property sources (see <a href="#environmentEndpoint">EnvironmentEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/threads/ThreadDumpEndpoint.html">ThreadDumpEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/threaddump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the current threads in the application.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, the following built-in endpoint(s) are provided by the <code>management</code> dependency but are not enabled by default:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Disabled Endpoints</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/caches/CachesEndpoint.html">CachesEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/caches</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the caches and permits invalidating them (see <a href="#cachesEndpoint">CachesEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/stop/ServerStopEndpoint.html">ServerStopEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shuts down the application server (see <a href="#stopEndpoint">ServerStopEndpoint</a>)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is possible to open all endpoints for unauthenticated access defining <code>endpoints.all.sensitive: false</code> but
this should be used with care because private and sensitive information will be exposed.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_management_port">Management Port</h3>
<div class="paragraph">
<p>By default all management endpoints are exposed over the same port as the application. You can alter this behaviour by specifying the <code>endpoints.all.port</code> setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    all:
        port: 8085</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the management endpoints will be exposed only over port 8085.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jmx">JMX</h3>
<div class="paragraph">
<p>Micronaut provides functionality to register endpoints with JMX. See the section on <a href="#jmx">JMX</a> to get started.</p>
</div>
</div>

<h2 id="beansEndpoint"><a class="anchor" href="#beansEndpoint"></a>14.2.1 The Beans Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/beansEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The beans endpoint returns information about the loaded bean definitions in the application. The bean data returned by default is an object where the key is the bean definition class name and the value is an object of properties about the bean.</p>
</div>
<div class="paragraph">
<p>To execute the beans endpoint, send a GET request to /beans.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the beans endpoint, supply configuration through <code>endpoints.beans</code>.</p>
</div>
<div class="listingblock">
<div class="title">Beans Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    beans:
        enabled: Boolean
        sensitive: Boolean</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The beans endpoint is composed of a bean definition data collector and a bean data implementation. The bean definition data collector (<a href="../api/io/micronaut/management/endpoint/beans/BeanDefinitionDataCollector.html">BeanDefinitionDataCollector</a>) is responsible for returning a publisher that will return the data used in the response. The bean definition data (<a href="../api/io/micronaut/management/endpoint/beans/BeanDefinitionData.html">BeanDefinitionData</a>) is responsible for returning data about an individual bean definition.</p>
</div>
<div class="paragraph">
<p>To override the default behavior for either of the helper classes, either extend the default implementations (<a href="../api/io/micronaut/management/endpoint/beans/impl/RxJavaBeanDefinitionDataCollector.html">RxJavaBeanDefinitionDataCollector</a>, <a href="../api/io/micronaut/management/endpoint/beans/impl/DefaultBeanDefinitionData.html">DefaultBeanDefinitionData</a>), or implement the relevant interface directly. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the default implementation.</p>
</div>
</div>
</div>

<h2 id="infoEndpoint"><a class="anchor" href="#infoEndpoint"></a>14.2.2 The Info Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/infoEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The info endpoint returns static information from the state of the application. The info exposed can be provided by any number of "info sources".</p>
</div>
<div class="paragraph">
<p>To execute the info endpoint, send a GET request to /info.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the info endpoint, supply configuration through <code>endpoints.info</code>.</p>
</div>
<div class="listingblock">
<div class="title">Info Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    info:
        enabled: Boolean
        sensitive: Boolean</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The info endpoint consists of an info aggregator and any number of info sources. To add an info source, simply create a bean class that implements <a href="../api/io/micronaut/management/endpoint/info/InfoSource.html">InfoSource</a>.  If your info source needs to retrieve data from Java properties files, you can extend the <a href="../api/io/micronaut/management/endpoint/info/source/PropertiesInfoSource.html">PropertiesInfoSource</a> interface which provides a helper method for this purpose.</p>
</div>
<div class="paragraph">
<p>All of the info source beans will be collected together with the info aggregator. To provide your own implementation of the info aggregator, create a class that implements <a href="../api/io/micronaut/management/endpoint/info/InfoAggregator.html">InfoAggregator</a> and register it as a bean. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the <a href="../api/io/micronaut/management/endpoint/info/impl/RxInfoAggregator.html">default implementation</a>.</p>
</div>
<div class="paragraph">
<p>The default info aggregator returns map containing the combined properties returned by all the info sources. This map is returned as JSON from the /info endpoint.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provided_info_sources">Provided Info Sources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configuration_info_source">Configuration Info Source</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/info/source/ConfigurationInfoSource.html">ConfigurationInfoSource</a> will return configuration properties under the <code>info</code> key. In addition to string, integer and boolean values, more complex properties can be exposed as maps in the JSON output (if the configuration format supports it).</p>
</div>
<div class="listingblock">
<div class="title">Info Source Example (<code>application.groovy</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">info.demo.string = "demo string"
info.demo.number = 123
info.demo.map = [key: 'value', other_key: 123]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above config will result in the following JSON response from the info endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "demo": {
    "string": "demo string",
    "number": 123,
    "map": {
      "key": "value",
      "other_key": 123
    }
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2">Configuration</h4>
<div class="paragraph">
<p>The configuration info source can be disabled using the <code>endpoints.info.config.enabled</code> property.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_git_info_source">Git Info Source</h3>
<div class="paragraph">
<p>If a <code>git.properties</code> file is available on the classpath, the <a href="../api/io/micronaut/management/endpoint/info/source/GitInfoSource.html">GitInfoSource</a> will expose the values in that file under the <code>git</code> key. Generating of a <code>git.properties</code> file will need to be configured as part of your build. One easy option for Gradle users is the <a href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties">Gradle Git Properties Plugin</a>. Maven users can look at the <a href="https://github.com/git-commit-id/maven-git-commit-id-plugin">Maven Git Commit Id Plugin</a>.</p>
</div>
<div class="sect3">
<h4 id="_configuration_3">Configuration</h4>
<div class="paragraph">
<p>To specify an alternate path/name of the properties file, you can supply a custom value in the <code>endpoints.info.git.location</code> property.</p>
</div>
<div class="paragraph">
<p>The git info source can be disabled using the <code>endpoints.info.git.enabled</code> property.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_info_source">Build Info Source</h3>
<div class="paragraph">
<p>If a <code>META-INF/build-info.properties</code> file is available on the classpath, the <a href="../api/io/micronaut/management/endpoint/info/source/BuildInfoSource.html">BuildInfoSource</a> will expose the values in that file under the <code>build</code> key. Generating of a <code>build-info.properties</code> file will need to be configured as part of your build. One easy option for Gradle users is the <a href="https://plugins.gradle.org/plugin/com.pasam.gradle.buildinfo">Gradle Build Info Plugin</a>. Another option for Maven users is the <a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/examples/build-info.html">Spring Boot Maven Plugin</a></p>
</div>
<div class="sect3">
<h4 id="_configuration_4">Configuration</h4>
<div class="paragraph">
<p>To specify an alternate path/name of the properties file, you can supply a custom value in the <code>endpoints.info.build.location</code> property.</p>
</div>
<div class="paragraph">
<p>The build info source can be disabled using the <code>endpoints.info.build.enabled</code> property.</p>
</div>
</div>
</div>
</div>
</div>

<h2 id="healthEndpoint"><a class="anchor" href="#healthEndpoint"></a>14.2.3 The Health Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/healthEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The health endpoint returns information about the "health" of the application. The application health is determined by any number of "health indicators".</p>
</div>
<div class="paragraph">
<p>To execute the health endpoint, send a GET request to /health. Additionally the health endpoint exposes /health/liveness and /health/readiness health indicators.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the health endpoint, supply configuration through <code>endpoints.health</code>.</p>
</div>
<div class="listingblock">
<div class="title">Health Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    health:
        enabled: Boolean
        sensitive: Boolean
        details-visible: String <i class="conum" data-value="1"></i><b>(1)</b>
        status:
            http-mapping: Map&lt;String, HttpStatus&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>One of <a href="../api/io/micronaut/management/endpoint/health/DetailsVisibility.html">DetailsVisibility</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>details-visible</code> setting is used to control whether health detail should be exposed to users who are not authenticated.</p>
</div>
<div class="paragraph">
<p>For example setting:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>details-visible</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    health:
        details-visible: ANONYMOUS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will expose detailed information read from the various health indicators about the health status of the application to anonymous unauthenticated users.</p>
</div>
<div class="paragraph">
<p>The <code>endpoints.health.status.http-mapping</code> setting can be used to control what status codes are returned for each health status. The defaults are described in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">HTTP Code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/health/HealthStatus.html#UP">UP</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpStatus.html#OK">OK</a> (200)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/health/HealthStatus.html#UNKNOWN">UNKNOWN</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpStatus.html#OK">OK</a> (200)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/health/HealthStatus.html#DOWN">DOWN</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpStatus.html#SERVICE_UNAVAILABLE">SERVICE_UNAVAILABLE</a> (503)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can provide custom mappings in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Custom Health Status Codes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    health:
        status:
            http-mapping:
                DOWN: 200</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will return <a href="../api/io/micronaut/http/HttpStatus.html#OK">OK</a> (200) even when the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> is <a href="../api/io/micronaut/health/HealthStatus.html#DOWN">DOWN</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The health endpoint consists of a health aggregator and any number of health indicators. To add a health indicator, simply create a bean class that implements <a href="../api/io/micronaut/management/health/indicator/HealthIndicator.html">HealthIndicator</a>. It is recommended to also use either <a href="../api/io/micronaut/health/indicator/annotation/Liveness.html">@Liveness</a> or <a href="../api/io/micronaut/health/indicator/annotation/Readiness.html">@Readiness</a> qualifier. If no qualifier is used then the health incidator is part of /health and /health/readiness endpoints. A base class <a href="../api/io/micronaut/management/health/indicator/AbstractHealthIndicator.html">AbstractHealthIndicator</a> has been provided for you to extend to make the process easier.</p>
</div>
<div class="paragraph">
<p>All of the health indicator beans will be collected together with the health aggregator. To provide your own implementation of the health aggregator, create a class that implements <a href="../api/io/micronaut/management/health/aggregator/HealthAggregator.html">HealthAggregator</a> and register it as a bean. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the <a href="../api/io/micronaut/management/health/aggregator/RxJavaHealthAggregator.html">default implementation</a>.</p>
</div>
<div class="paragraph">
<p>The default health aggregator returns an overall status that is calculated based on the health statuses of the indicators. A <a href="../api/io/micronaut/health/HealthStatus.html">health status</a> consists of several pieces of information.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the functionality the indicator represents is functional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How severe the status is. A higher number is more severe</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The "worst" status will be returned as the overall status. A non operational status will be selected over an operational status. A higher severity will be selected over a lower severity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provided_indicators">Provided Indicators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All micronaut provided health indicators are exposed on /health and /health/readiness endpoints.</p>
</div>
<div class="sect2">
<h3 id="_disk_space">Disk Space</h3>
<div class="paragraph">
<p>A health indicator is provided that determines the health of the application based on the amount of free disk space. Configuration for the disk space health indicator can be provided under the <code>endpoints.health.disk-space</code> key.</p>
</div>
<div class="listingblock">
<div class="title">Disk Space Indicator Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    health:
        disk-space:
            enabled: Boolean
            path: String #The file path used to determine the disk space
            threshold: String | Long #The minimum amount of free space</code></pre>
</div>
</div>
<div class="paragraph">
<p>The threshold can be provided as a string like "10MB" or "200KB", or the number of bytes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jdbc">JDBC</h3>
<div class="paragraph">
<p>The JDBC health indicator determines the health of your application based on the ability to successfully create connections to datasources in the application context. The only configuration option supported is to enable or disable the indicator by the <code>endpoints.health.jdbc.enabled</code> key.</p>
</div>
</div>
<div class="sect2">
<h3 id="_discovery_client">Discovery Client</h3>
<div class="paragraph">
<p>If your application is using service discovery, a health indicator will be included to monitor the health of the discovery client. The data returned can include a list of the services available.</p>
</div>
</div>
</div>
</div>

<h2 id="metricsEndpoint"><a class="anchor" href="#metricsEndpoint"></a>14.2.4 The Metrics Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/metricsEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut includes the ability to expose Metrics via integration with <a href="http://micrometer.io">Micrometer</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply one of the micrometer features to enable metrics and preconfigure the selected registery in your project. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features micrometer-atlas</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The metrics endpoint returns information about the "metrics" of the application. To execute the metrics endpoint, send a GET request to <code>/metrics</code>. This will return a list of availble metric names.</p>
</div>
<div class="paragraph">
<p>You can get specific metrics by using <code>/metrics/[name]</code> such as <code>/metrics/jvm.memory.used</code>.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-micrometer/latest/guide/">Micronaut Micrometer</a> for a list of registries and information on how to configure, expose and customize metrics output.</p>
</div>

<h2 id="refreshEndpoint"><a class="anchor" href="#refreshEndpoint"></a>14.2.5 The Refresh Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/refreshEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The refresh endpoint will refresh the application state, causing all <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">Refreshable</a> beans in the context to be destroyed and reinstantiated upon further requests. This is accomplished by publishing a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> in the Application Context.</p>
</div>
<div class="paragraph">
<p>To execute the refresh endpoint, send a POST request to /refresh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:8080/refresh</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executed without a body, the endpoint will first refresh the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> and perform a diff to detect any changes, and will then only perform the refresh if changes are detected. To skip this check and refresh all <code>@Refreshable</code> beans regardless of environment changes (e.g., to force refresh of cached responses from third-party services), you can supply a <code>force</code> parameter in the POST request body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:8080/refresh -H 'Content-Type: application/json' -d '{"force": true}'</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the refresh endpoint, supply configuration through <code>endpoints.refresh</code>.</p>
</div>
<div class="listingblock">
<div class="title">Beans Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    refresh:
        enabled: Boolean
        sensitive: Boolean</code></pre>
</div>
</div>
</div>
</div>

<h2 id="routesEndpoint"><a class="anchor" href="#routesEndpoint"></a>14.2.6 The Routes Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/routesEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The routes endpoint returns information about URIs available to be called for your application. By default the data returned includes the URI, allowed method, content types produced, and information about the method that would be executed.</p>
</div>
<div class="paragraph">
<p>To execute the routes endpoint, send a GET request to /routes.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the routes endpoint, supply configuration through <code>endpoints.routes</code>.</p>
</div>
<div class="listingblock">
<div class="title">Routes Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    routes:
        enabled: Boolean
        sensitive: Boolean</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The routes endpoint is composed of a route data collector and a route data implementation. The route data collector (<a href="../api/io/micronaut/management/endpoint/routes/RouteDataCollector.html">RouteDataCollector</a>) is responsible for returning a publisher that will return the data used in the response. The route data (<a href="../api/io/micronaut/management/endpoint/routes/RouteData.html">RouteData</a>) is responsible for returning data about an individual route.</p>
</div>
<div class="paragraph">
<p>To override the default behavior for either of the helper classes, either extend the default implementations (<a href="../api/io/micronaut/management/endpoint/routes/impl/RxJavaRouteDataCollector.html">RxJavaRouteDataCollector</a>, <a href="../api/io/micronaut/management/endpoint/routes/impl/DefaultRouteData.html">DefaultRouteData</a>), or implement the relevant interface directly. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the default implementation.</p>
</div>
</div>
</div>

<h2 id="loggersEndpoint"><a class="anchor" href="#loggersEndpoint"></a>14.2.7 The Loggers Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/loggersEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The loggers endpoint returns information about the available loggers in the application and
permits configuring the their log level.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The loggers endpoint is disabled by default and needs to be explicitly enabled with the setting <code>endpoints.loggers.enabled=true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get a collection of all loggers by name with their configured and effective log levels,
send a GET request to /loggers. This will also provide a list of the available log levels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:8080/loggers

{
    "levels": [
        "ALL", "TRACE", "DEBUG", "INFO", "WARN", "ERROR", "OFF", "NOT_SPECIFIED"
    ],
    "loggers": {
        "ROOT": {
            "configuredLevel": "INFO",
            "effectiveLevel": "INFO"
        },
        "io": {
            "configuredLevel": "NOT_SPECIFIED",
            "effectiveLevel": "INFO"
        },
        "io.micronaut": {
            "configuredLevel": "NOT_SPECIFIED",
            "effectiveLevel": "INFO"
        },
        // etc...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the log levels of a particular logger, include the logger name in your GET request. For
example, to access the log levels of the logger 'io.micronaut.http':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:8080/loggers/io.micronaut.http

{
    "configuredLevel": "NOT_SPECIFIED",
    "effectiveLevel": "INFO"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the named logger does not exist, it will be created with an unspecified (i.e. <code>NOT_SPECIFIED</code>)
configured log level. (It&#8217;s effective log level will usually be that of the root logger.)</p>
</div>
<div class="paragraph">
<p>To update the log level of a single logger, send a POST request to the named logger URL and include
a body providing the log level to configure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -i -X POST \
       -H "Content-Type: application/json" \
       -d '{ "configuredLevel": "ERROR" }' \
       http://localhost:8080/loggers/ROOT

HTTP/1.1 200 OK

$ curl http://localhost:8080/loggers/ROOT

{
    "configuredLevel": "ERROR",
    "effectiveLevel": "ERROR"
}</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the loggers endpoint, supply configuration through <code>endpoints.loggers</code>.</p>
</div>
<div class="listingblock">
<div class="title">Loggers Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    loggers:
        enabled: Boolean
        sensitive: Boolean</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default the endpoint doesn&#8217;t allow to change the log level by unauthorized users (even if <code>sensitive</code> is set to
<code>false</code>). To allow it is necessary set <code>endpoints.loggers.write-sensitive</code> to <code>false</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The loggers endpoint is composed of two customizable parts: a loggers manager and a logging system.</p>
</div>
<div class="paragraph">
<p>The loggers manager
(<a href="../api/io/micronaut/management/endpoint/loggers/LoggersManager.html">LoggersManager</a>)
is responsible for returning a Publisher that will return data collected and transformed for the response,
and it is also responsible for updating a logger with a new log level.</p>
</div>
<div class="paragraph">
<p>To override the default behavior for the loggers manager, either extend the default implementation
(<a href="../api/io/micronaut/management/endpoint/loggers/impl/DefaultLoggersManager.html">DefaultLoggersManager</a>)
or implement the <a href="../api/io/micronaut/management/endpoint/loggers/LoggersManager.html">LoggersManager</a>
interface directly. To ensure your implementation is used instead of the default, add the
<a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the
value being the default implementation.</p>
</div>
<div class="paragraph">
<p>The logging system
(<a href="../api/io/micronaut/management/endpoint/loggers/LoggingSystem.html">LoggingSystem</a>)
is responsible for processing requests from the loggers manager against a particular logging
library (e.g. logback, log4j, etc.)</p>
</div>
<div class="paragraph">
<p>The current default implementation for the logging system is
<a href="../api/io/micronaut/management/endpoint/loggers/impl/LogbackLoggingSystem.html">LogbackLoggingSystem</a>,
which works with the <a href="https://logback.qos.ch/">logback</a> logging framework. Additional logging systems will
be implemented in future revisions of Micronaut. For custom logging system behavior, implement
the <a href="../api/io/micronaut/management/endpoint/loggers/LoggingSystem.html">LoggingSystem</a> interface directly.
To ensure your implementation is used instead of the default, add the
<a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the
value being the default implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(LogbackLoggingSystem.class)
public class CustomLoggingSystem implements LoggingSystem {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="cachesEndpoint"><a class="anchor" href="#cachesEndpoint"></a>14.2.8 The Caches Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/cachesEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The caches endpoint documentation is available at the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/guide/index.html#endpoint">micronaut-cache project</a>.</p>
</div>

<h2 id="stopEndpoint"><a class="anchor" href="#stopEndpoint"></a>14.2.9 The Server Stop Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/stopEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The stop endpoint shuts down the application server.</p>
</div>
<div class="paragraph">
<p>To execute the stop endpoint, send a POST request to /stop.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the stop endpoint, supply configuration through <code>endpoints.stop</code>.</p>
</div>
<div class="listingblock">
<div class="title">Stop Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    stop:
        enabled: Boolean
        sensitive: Boolean</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the stop endpoint is disabled and needs to be explicitly enabled to be used.
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="environmentEndpoint"><a class="anchor" href="#environmentEndpoint"></a>14.2.10 The Environment Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/management/providedEndpoints/environmentEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The environment endpoint returns information about the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> and its <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a>s.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Properties that may contain sensitive data will be masked.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the environment endpoint, supply configuration through <code>endpoints.env</code>.</p>
</div>
<div class="listingblock">
<div class="title">Environment Endpoint Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    env:
        enabled: Boolean    # default: true
        sensitive: Boolean  # default: true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_information_about_the_environment">Getting information about the environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To execute the endpoint, send a <code>GET</code> request to <code>/env</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_information_about_a_particular_code_propertysource_code">Getting information about a particular <code>PropertySource</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To execute the endpoint, send a <code>GET</code> request to <code>/env/{propertySourceName}</code>.</p>
</div>
</div>
</div>

<h1 id="security"><a class="anchor" href="#security"></a>15 Security</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/security.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut has a full featured security solution for all of the common security patterns.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-security/latest/guide">Micronaut Security</a> for more information on how to secure your applications.</p>
</div>

<h1 id="multitenancy"><a class="anchor" href="#multitenancy"></a>16 Multi-Tenancy</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/multitenancy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Multi-Tenancy, as it relates to software development, is when a single instance of an application is used to service multiple clients (tenants) in a way that each tenant&#8217;s data is isolated from the other.</p>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s multitenancy capabilities you must have the <code>multitenancy</code> dependency on your classpath.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-multitenancy")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-multitenancy&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>A common requirement for supporting Multi-tenancy is the ability to resolve the current tenant. Micronaut ships with the following built-in <a href="../api/io/micronaut/multitenancy/tenantresolver/TenantResolver.html">TenantResolver</a>s:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/tenantresolver/CookieTenantResolver.html">CookieTenantResolver</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves the current tenant from an HTTP cookie. See <a href="configurationreference.html#io.micronaut.multitenancy.tenantresolver.CookieTenantResolverConfigurationProperties">CookieTenantResolver Configuration Properties</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/tenantresolver/FixedTenantResolver.html">FixedTenantResolver</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves against a fixed tenant id. See <a href="configurationreference.html#io.micronaut.multitenancy.tenantresolver.FixedTenantResolverConfigurationProperties">FixTenantResolver Configuration Properties</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/tenantresolver/HttpHeaderTenantResolver.html">HttpHeaderTenantResolver</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves the current tenant from the request HTTP Header. See <a href="configurationreference.html#io.micronaut.multitenancy.tenantresolver.HttpHeaderTenantResolverConfigurationProperties">FixTenantResolver Configuration Properties</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/tenantresolver/PrincipalTenantResolver.html">PrincipalTenantResolver</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves the current tenant from the authenticated username. See <a href="configurationreference.html#io.micronaut.multitenancy.tenantresolver.PrincipalTenantResolverConfigurationProperties">PrincipalTenantResolver Configuration Properties</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/tenantresolver/SessionTenantResolver.html">SessionTenantResolver</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves the current tenant from the HTTP session. See <a href="configurationreference.html#io.micronaut.multitenancy.tenantresolver.SessionTenantResolverConfigurationProperties">SessionTenantResolver Configuration Properties</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/tenantresolver/SubdomainTenantResolver.html">SubdomainTenantResolver</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves the tenant id from the subdomain. See <a href="configurationreference.html#io.micronaut.multitenancy.tenantresolver.SubdomainTenantResolverConfigurationProperties">SubdomainTenantResolver Configuration Properties</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/tenantresolver/SystemPropertyTenantResolver.html">SystemPropertyTenantResolver</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves the tenant id from a system property. See <a href="configurationreference.html#io.micronaut.multitenancy.tenantresolver.SystemPropertyTenantResolverConfigurationProperties">SystemPropertyTenantResolver Configuration Properties</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Micronaut supports tenant propagation. As an example, take the following scenario:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../img/multitenancy.svg" alt="multitenancy"></span></p>
</div>
<div class="paragraph">
<p>You want incoming requests to the <code>gateway</code> microservice to resolve the tenant id via subdomain. However, you want
your requests to other internal microservices to include the <code>tenant Id</code> as an HTTP Header.</p>
</div>
<div class="paragraph">
<p>Your configuration in the <code>gateway</code> microservice will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  multitenancy:
    propagation:
      enabled: true
      service-id-regex: 'catalogue'
    tenantresolver:
      subdomain:
        enabled: true
    tenantwriter:
      httpheader:
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>catalogue</code> microservice the configuration will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  multitenancy:
    tenantresolver:
      httpheader:
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To propagate the tenant you will need to write the resolved tenant ID to the outgoing requests.</p>
</div>
<div class="paragraph">
<p>Currently, Micronaut ships with two built-in implementations for <a href="../api/io/micronaut/multitenancy/writer/TenantWriter.html">TenantWriter</a>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/writer/CookieTenantWriter.html">CookieTenantWriter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes the current tenant to a Cookie in your outgoing requests. See <a href="configurationreference.html#io.micronaut.multitenancy.writer.CookieTenantWriterConfigurationProperties">CookieTenantWriter Configuration Properties</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/multitenancy/writer/HttpHeaderTenantWriter.html">HttpHeaderTenantWriter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes the current tenant to a HTTP Header. See <a href="configurationreference.html#io.micronaut.multitenancy.writer.HttpHeaderTenantWriterConfigurationProperties">HttpHeaderTenantWriter Configuration Properties</a>.</p></td>
</tr>
</tbody>
</table>

<h2 id="multitenancyGorm"><a class="anchor" href="#multitenancyGorm"></a>16.1 Multi-Tenancy GORM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/multitenancy/multitenancyGorm.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://gorm.grails.org">GORM</a> supports Multi-tenancy and integrates with Micronaut Multi-tenancy support.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-groovy/latest/guide/index.html#multitenancyGorm">Micronaut Groovy module</a> for more information.</p>
</div>

<h1 id="cli"><a class="anchor" href="#cli"></a>17 Micronaut CLI</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut CLI is the recommended way to create new Micronaut projects. The CLI includes commands for generating specific categories of projects, allowing you to choose between build tools, test frameworks, and even pick the language you wish to use in your application. The CLI also provides commands for generating artifacts such as controllers, client interfaces, and serverless functions.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We have a website that can be used to generate projects instead of the CLI. Check out <a href="https://micronaut.io/launch">Micronaut Launch</a> to get started!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <a href="#buildCLI">Micronaut is installed on your computer</a>, you can call the CLI with the <code>mn</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Micronaut CLI project can be identified by the <code>micronaut-cli.yml</code> file, which will be included at the root of the project (if it was generated via the CLI). This file will include the project&#8217;s profile, default package, and other variables. The project&#8217;s default package is evaluated based on the project name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will result in the default package being <code>my.demo.app</code>.</p>
</div>
<div class="paragraph">
<p>You can supply your own default package when creating the application by prefixing the application name with the package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app example.my-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will result in the default package being <code>example</code>.</p>
</div>
<div class="sect1">
<h2 id="_interactive_mode">Interactive Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you run <code>mn</code> without any arguments, the Micronaut CLI will launch in interactive mode. This is a shell-like mode which allows you to run multiple CLI commands without re-initializing the CLI runtime, and is especially suitable when you are making use of code-generation commands (such as <code>create-controller</code>), creating multiple projects, or simply exploring the features included in the CLI. Tab-completion is enabled in the CLI, enabling you to hit the <code>TAB</code> key to see possible options for a given command or flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_help_and_info">Help and Info</h2>
<div class="sectionbody">
<div class="paragraph">
<p>General usage information can be viewed using the <code>help</code> flag on a command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-app -h
Usage: mn create-app [-hivVx] [--list-features] [-b=BUILD-TOOL] [--jdk=&lt;javaVersion&gt;] [-l=LANG]
                     [-t=TEST] [-f=FEATURE[,FEATURE...]]... [NAME]
Creates an application
      [NAME]               The name of the application to create.
  -b, --build=BUILD-TOOL   Which build tool to configure. Possible values: gradle, maven.
  -f, --features=FEATURE[,FEATURE...]
  -h, --help               Show this help message and exit.
  -i, --inplace            Create a service using the current directory
      --jdk, --java-version=&lt;javaVersion&gt;
                           The JDK version the project should target
  -l, --lang=LANG          Which language to use. Possible values: java, groovy, kotlin.
      --list-features      Output the available features and their descriptions
  -t, --test=TEST          Which test framework to use. Possible values: junit, spock, kotlintest.</code></pre>
</div>
</div>
<div class="paragraph">
<p>A list of available features can be viewed using the <code>--list-features</code> flag on any of the create commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-app --list-features
Available Features
(+) denotes the feature is included by default
  Name                             Description
  -------------------------------  ---------------
  Cache
  cache-caffeine                   Adds support for cache using Caffeine (https://github.com/ben-manes/caffeine)
  cache-ehcache                    Adds support for cache using EHCache (https://www.ehcache.org/)
  cache-hazelcast                  Adds support for cache using Hazelcast (https://hazelcast.org/)
  cache-infinispan                 Adds support for cache using Infinispan (https://infinispan.org/)</code></pre>
</div>
</div>
</div>
</div>

<h2 id="createProject"><a class="anchor" href="#createProject"></a>17.1 Creating a Project</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/createProject.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Creating a project is the primary usage of the CLI. There primary command for creating a new project is <code>create-app</code>. That will create a standard server application that communicates over HTTP. For other types of applications, see the documentation below.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut CLI Project Creation Commands</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a basic Micronaut application.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-app my-project --features
 mongo-reactive,security-jwt --build maven</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-cli-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a command-line Micronaut application.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-cli-app my-project --features
 http-client,jdbc-hikari --build maven
 --lang kotlin --test kotlintest</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-function-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut serverless function, using AWS by default.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-function-app my-lambda-function
 --lang groovy --test spock</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-messaging-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut application that only communicates via a messaging protocol. Uses Kafka by default but can be switched to RabbitMQ with <code>--features rabbitmq</code>.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-messaging-app my-broker
 --lang groovy --test spock</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-grpc-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut application that uses gRPC.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-grpc-app my-grpc-app
 --lang groovy --test spock</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_create_command_flags">Create Command Flags</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The create-* commands will generate a basic Micronaut project, with optional flags to specify features, language, test framework, and build tool. All projects except functions will include a default <code>Application</code> class for starting the application.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Flags</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language to use for the project (one of <code>java</code>, <code>groovy</code>, <code>kotlin</code> - default is <code>java</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code>, <code>--test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test framework to use for the project (one of <code>junit</code>, <code>spock</code> - default is <code>junit</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--test spock</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-b</code>, <code>--build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build tool (one of <code>gradle</code>, <code>maven</code> - default is <code>gradle</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--build maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--features</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features to use for the project, comma-separated</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--features security-jwt,mongo-gorm</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-f security-jwt -f mongo-gorm</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code>, <code>--inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, generates the project in the current directory (project name is optional if this flag is set)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--inplace</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once created, the application can be started using the <code>Application</code> class, or the appropriate build tool task.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Gradle project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Starting a Maven project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_language_test_features">Language/Test Features</h3>
<div class="paragraph">
<p>By default, the create commands will generate a Java application, with JUnit configured as the test framework. All of the options chosen and features applied are stored as properties in the <code>micronaut-cli.yml</code> file, as shown below:</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">applicationType: default
defaultPackage: com.example
testFramework: junit
sourceLanguage: java
buildTool: gradle
features: [annotation-api, app-name, application, gradle, http-client, java, junit, logback, netty-server, shade, yaml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some commands rely on the data in this file in order to determine if they should be executable. For example, the <code>create-kafka-listener</code> command requires <code>kafka</code> to be one of the features in the list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The values in <code>micronaut-cli.yml</code> are used by the CLI for code generation purposes. After a project has been generated, you can edit these values to change the project defaults, however you will still need to supply the required dependencies and/or configuration in order to use your chosen language/framework. E.g, you could edit the <code>testFramework</code> property to <code>spock</code> to cause the CLI to generate Spock tests when running commands (such as <code>create-controller</code>), but you will still need to add the Spock dependency to your project.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_groovy">Groovy</h4>
<div class="paragraph">
<p>To create an app with Groovy support (which comes with Spock by default), supply the appropriate language via the <code>lang</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-groovy-app --lang groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will include the Groovy &amp; Spock dependencies in your project, and write the appropriates values in <code>micronaut-cli.yml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kotlin">Kotlin</h4>
<div class="paragraph">
<p>To create an app with Kotlin support (which comes with Kotlintest by default), supply the appropriate language via the <code>lang</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-kotlin-app --lang kotlin</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will include the Kotlin &amp; Kotlintest dependencies in your project, and write the appropriates values in <code>micronaut-cli.yml</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_tool">Build Tool</h3>
<div class="paragraph">
<p>By default <code>create-app</code> will create a Gradle project, with a <code>build.gradle</code> file at the root of the project directory. To create an app using the Maven build tool, supply the appropriate option via the <code>build</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-maven-app --build maven</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_cli_app">Create-Cli-App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-cli-app</code> command will generate a <a href="#commandLineApps">Micronaut command line application</a> project,
with optional flags to specify language, test framework, features, profile, and build tool.
By default the project will have the <code>picocli</code> feature to support command line option parsing.
The project will include a <code>*Command</code> class (based on the project name - e.g., <code>hello-world</code> will generate <code>HelloWorldCommand</code>),
and an associated test which will instantiate the command and verify that it can parse command line options.</p>
</div>
<div class="paragraph">
<p>Once created, the application can be started using the <code>*Command</code> class, or the appropriate build tool task.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Gradle project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Starting a Maven project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_function_app">Create Function App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-function-app</code> command will generate a <a href="#serverlessFunctions">Micronaut function</a> project, optimized for serverless environments, with optional flags to specify language, test framework, features and build tool. The project will include a <code>*Function</code> class (based on the project name - e.g., <code>hello-world</code> will generate <code>HelloWorldFunction</code>), and an associated test which will instantiate the function and verify that it can receive requests.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Currently AWS Lambda, Micronaut Azure, and Google Cloud are the supported cloud providers for Micronaut functions. To use other providers, add one in the features: <code>--features azure-function</code> or <code>--features google-cloud-function</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contribute">Contribute</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CLI&#8217;s source code is at <a href="https://github.com/micronaut-projects/micronaut-starter" class="bare">https://github.com/micronaut-projects/micronaut-starter</a>. Information about how to contribute and other resources are there.</p>
</div>
</div>
</div>

<h2 id="profiles"><a class="anchor" href="#profiles"></a>17.2 Profiles</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/profiles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Profiles are project templates, consisting of a "skeleton" project structure with default configuration, build dependencies and other assets, along with a set of commands for generating application-appropriate artifacts (such as controllers, client interfaces, etc).</p>
</div>
<div class="paragraph">
<p>Profiles can inherit from other profiles, augmenting/overriding defaults set in their parent. All profiles inherit from the <code>base</code> profile, which provides the bare minimum required to set up a Micronaut application.</p>
</div>
<div class="paragraph">
<p>Many Micronaut apps will use the <code>service</code> profile, which augments the <code>base</code> profile to add HTTP client/server libraries, <code>create-controller</code> and <code>create-client</code> commands, and other features that are appropriate for web service applications. This is the default profile used when running the <code>create-app</code> command.</p>
</div>
<div class="paragraph">
<p>Other Micronaut apps will be better served by the <code>cli</code> profile, which adds the <code>create-command</code> command and the <a href="https://picocli.info/">picocli</a> library for parsing command line input. This is the default profile used when running the <code>create-cli-app</code> command.</p>
</div>
<div class="paragraph">
<p>You can view all of the built-in profiles using the CLI command <code>list-profiles</code>.</p>
</div>
<div class="paragraph">
<p>Profiles can be chosen using the <code>profile</code> flag on the <code>create-app</code>, <code>create-cli-app</code>, and <code>create-federation</code> commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-project --profile rabbitmq</code></pre>
</div>
</div>

<h2 id="comparingVersions"><a class="anchor" href="#comparingVersions"></a>17.2.1 Comparing Versions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/profiles/comparingVersions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The easiest way to see version dependency updates and other changes for a new version of Micronaut, is to produce one clean application using the older and one using the newer version of the <code>mn</code> CLI, and then comparing those directories.</p>
</div>

<h2 id="features"><a class="anchor" href="#features"></a>17.3 Features</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/features.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Features consist of additional dependencies and configuration to enable specific functionality in your application. The Micronaut profiles define a large number of features, including features for many of the configurations provided by Micronaut, such as the <a href="#dataAccess">Data Access Configurations</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-demo-app --features mongo-reactive</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add the necessary dependencies and configuration for the <a href="http://mongodb.github.io/mongo-java-driver-reactivestreams">MongoDB Reactive Driver</a> in your application. You can view all the available features using the <code>profile-info</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn profile-info service</code></pre>
</div>
</div>

<h2 id="commands"><a class="anchor" href="#commands"></a>17.4 Commands</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/commands.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Profiles can include commands for generating common code artifacts. Not all commands are supported by all profiles; the available commands for a given profile can be viewed using the <code>profile-info</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn profile-info service
Profile: service
------------------
The service profile

Provided Commands:
--------------------
  create-bean              Creates a singleton bean
  create-client            Creates a client interface
  create-controller        Creates a controller and associated test
  create-job               Creates a job with scheduled method
  create-test              Creates a simple test for the project's testing framework
  create-websocket-client  Creates a Websocket client
  create-websocket-server  Creates a Websocket server
  help                     Prints help information for a specific command


Provided Features:
------------------
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the code-generation commands will honor the values written in <code>micronaut-cli.yml</code>. For example, assume the following <code>micronaut-cli.yml</code> file.</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">profile: service
defaultPackage: example
---
testFramework: spock
sourceLanguage: java</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above settings, the <code>create-controller</code> command will (by default) generate Java controllers with an associated Spock test, under the <code>example</code> package. Commands accept arguments and these defaults can be overriden on a per-command basis.</p>
</div>
<div class="sect1">
<h2 id="_base_profile_commands">Base Profile Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Commands in the base profile are inherited by all other profiles and are always available.</p>
</div>
<div class="sect2">
<h3 id="_create_bean">Create-Bean</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Create-Bean Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the bean class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-bean</code> command generates a simple <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">Singleton</a> class. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-bean EmailService
| Rendered template Bean.java to destination src/main/java/example/EmailService.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_job">Create-Job</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Create-Job Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the job class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-job</code> command generates a simple <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> class. It follows a <code>*Job</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-job UpdateFeeds --lang groovy
| Rendered template Job.groovy to destination src/main/groovy/example/UpdateFeedsJob.groovy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_profile_commands">Service Profile Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The service profile includes commands that are dependent upon the HTTP server and client dependencies (which are not included in the base profile).</p>
</div>
<div class="sect2">
<h3 id="_create_controller">Create-Controller</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Create-Controller Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-controller</code> command generates a <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> class. It follows a <code>*Controller</code> convention for generating the class name. It creates an associated test that will run the application and instantiate an HTTP client, which can make requests against the controller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-controller Book
| Rendered template Controller.java to destination src/main/java/example/BookController.java
| Rendered template ControllerTest.java to destination src/test/java/example/BookControllerTest.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_client">Create-Client</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Create-Client Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-client</code> command generates a simple <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> interface. It follows a <code>*Client</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-client Book
| Rendered template Client.java to destination src/main/java/example/BookClient.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_websocket_server">Create-Websocket-Server</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Create-Websocket-Server Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-websocket-server</code> command generates a simple <a href="../api/io/micronaut/websocket/WebSocketServer.html">WebSocketServer</a> class. It follows a <code>*Server</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-websocket-server MyChat
| Rendered template WebsocketServer.java to destination src/main/java/example/MyChatServer.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_websocket_client">Create-Websocket-Client</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Create-Websocket-Client Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-websocket-client</code> command generates a simple <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> abstract class. It follows a <code>*Client</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-websocket-client MyChat
| Rendered template WebsocketClient.java to destination src/main/java/example/MyChatClient.java</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cli_profile_commands">CLI Profile Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cli profile lets you generate CLI commands to control your application.</p>
</div>
<div class="sect2">
<h3 id="_create_command">Create-Command</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Create-Command Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-command</code> command generates a standalone application that can be executed as a
<a href="http://picocli.info">picocli</a> <a href="http://picocli.info/apidocs/picocli/CommandLine.Command.html">Command</a>.
It follows a <code>*Command</code> convention for generating the class name.
It creates an associated test that will run the application and verify that a command line option was set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-command print
| Rendered template Command.java to destination src/main/java/example/PrintCommand.java
| Rendered template CommandTest.java to destination src/test/java/example/PrintCommandTest.java</code></pre>
</div>
</div>
</div>
</div>
</div>

<h2 id="reloading"><a class="anchor" href="#reloading"></a>17.5 Reloading</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/reloading.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Reloading (or "hot-loading") refers to the framework reinitializing classes (and parts of the application) when changes to the source files are detected.</p>
</div>
<div class="paragraph">
<p>Since Micronaut prioritizes startup time and most Micronaut apps can start up within seconds, a productive workflow can often be had by restarting the application as changes are made; for example, by running a test class within an IDE.</p>
</div>
<div class="paragraph">
<p>However, if you wish to have your changes automatically reloaded Micronaut does support automatic restart or the use of third-party reloading agents.</p>
</div>

<h2 id="automaticRestart"><a class="anchor" href="#automaticRestart"></a>17.5.1 Automatic Restart</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/reloading/automaticRestart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are various ways to achieve reloading of classes on the JVM, all have their advantages and disadvantages. The following are possible ways to achieve reloading without restarting the JVM:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>JVM Agents</strong> - A JVM agent like JRebel can be used, however these can produce unusual errors, may not support all JDK versions and can result in cached / stale classes.</p>
</li>
<li>
<p><strong>ClassLoader Reloading</strong> - Class Loader based reloading is a popular solution used by most JVM frameworks, however it once again can lead to cached / stale classes, memory leaks and weird errors if the incorrect classloader is used at any moment.</p>
</li>
<li>
<p><strong>Debugger HotSwap</strong> - The Java debugger supports hotswapping of changes at runtime, but only supports a few use cases.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given the problems with existing solutions and a lack of a way built into the JVM to reload changes, the safest and best solution to reloading, and the one recommended by the Micronaut team, is to use automatic application restart via third-party tool.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s startup time is fast and automatic restart leads to a clean slate without potential hard to debug problems cropping up or memory leaks.</p>
</div>
<div class="sect2">
<h3 id="_maven_restart">Maven Restart</h3>
<div class="paragraph">
<p>To have automatic application restarts with Maven use the Micronaut Maven plugin (including by default when creating new Maven projects) and run the following command:</p>
</div>
<div class="listingblock">
<div class="title">Using the Micronaut Maven Plugin</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every time you change a class Micronaut&#8217;s plugin will automatically restart the server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gradle_restart">Gradle Restart</h3>
<div class="paragraph">
<p>For Gradle restart you can create a new application with the <code>file-watch</code> feature already configured using the CLI with the command <code>mn create-app myapp --features file-watch</code></p>
</div>
<div class="paragraph">
<p>This essentially introduces the following configuration to <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">File Watch Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    io:
        watch:
            paths: src/main
            restart: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By setting <code>micronaut.io.watch.paths</code> what happens is that Micronaut will fire a <a href="../api/io/micronaut/scheduling/io/watch/event/FileChangedEvent.html">FileChangedEvent</a> if any file is changed. Setting <code>micronaut.io.watch.restart</code> tells Micronaut to stop the server if a file is changed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>micronaut.io.watch.paths</code> setting can be used for more than just automatic restart, you can use this setting to monitor for file changes within your production application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once this is in place to have Gradle automatically restart on any change add run the following command:</p>
</div>
<div class="listingblock">
<div class="title">Using Gradle for Automatic Restart</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew run --continuous</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every time you make a change to class or resources Gradle will recompile and restart the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_file_watch_and_mac_os_x">File Watch and Mac OS X</h3>
<div class="paragraph">
<p>The native JVM implementation of the <code>WatchService</code> interface for Mac OS X using polling which is slow. To improve file watch performance add the following dependencies to your build if you are using OS X:</p>
</div>
<div class="listingblock">
<div class="title">Gradle - Configuring Native File Watch on Mac OS X</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">configurations {
    developmentOnly
}
dependencies {
    // Automatically added with the 'file-watch' feature in the CLi
    developmentOnly "io.micronaut:micronaut-runtime-osx"
    ...
    developmentOnly "net.java.dev.jna:jna"
    developmentOnly "io.methvin:directory-watcher"

}
run.classpath += configurations.developmentOnly</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A custom <code>developmentOnly</code> configuration is used to ensure the dependencies don&#8217;t go into the production JAR.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or with Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.methvin&lt;/groupId&gt;
  &lt;artifactId&gt;directory-watcher&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;net.java.dev.jna&lt;/groupId&gt;
  &lt;artifactId&gt;jna&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>provided</code> scope is used to ensure the dependencies don&#8217;t go into the production JAR.
</td>
</tr>
</table>
</div>
</div>

<h2 id="jrebel"><a class="anchor" href="#jrebel"></a>17.5.2 JRebel</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/reloading/jrebel.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://zeroturnaround.com/software/jrebel/">JRebel</a> is a proprietary reloading solution that involves an agent library, as well as sophisticated IDE support. The JRebel documentation includes detailed steps for IDE integration and usage of the tool. In this section, we will simply show how to install and configure the agent for Maven and Gradle projects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>jrebel</code> feature to preconfigure JRebel reloading in your project. Please note that you will still need to install JRebel and supply the correct path to the agent in the <code>gradle.properties</code> file (for Gradle) or <code>pom.xml</code> (for Maven). The steps necessary are described below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jrebel</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_install_configure_jrebel_agent">Install/configure JRebel Agent</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest way to install JRebel is to download the "standalone" installation package from the <a href="https://zeroturnaround.com/software/jrebel/download">JRebel download page</a>. Unzip the downloaded file to a convenient location within your user&#8217;s directory - for example, <code>~/bin/jrebel</code></p>
</div>
<div class="paragraph">
<p>The installation directory will contain a <code>lib</code> directory containing the agent files. The appropriate agent based on your operating system, following the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. JRebel Agent</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">Agent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows 64-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]\lib\jrebel64.dll</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows 32-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]\lib\jrebel32.dll</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mac OS X 64-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel64.dylib</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mac OS X 32-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel32.dylib</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux 64-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel64.so</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux 32-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel32.so</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note the path to the appropriate agent, and add the value to your project build.</p>
</div>
<div class="sect2">
<h3 id="_gradle">Gradle</h3>
<div class="paragraph">
<p>Add the path to <code>gradle.properties</code> (create the file if necessary), as the <code>rebelAgent</code> property.</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">#Assuming installation path of ~/bin/jrebel/
rebelAgent= -agentpath:~/bin/jrebel/lib/libjrebel64.dylib</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the appropriate JVM arg to <code>build.gradle</code> (not necessary if using the CLI feature)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">run.dependsOn(generateRebel)
if (project.hasProperty('rebelAgent')) {
    run.jvmArgs += rebelAgent
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can start the application with <code>./gradlew run</code>, and it will include the agent. See the section on <a href="#gradleReload">Gradle Reloading</a> or <a href="#ideReload">IDE Reloading</a> to set up the recompilation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maven">Maven</h3>
<div class="paragraph">
<p>Add the path to <code>pom.xml</code> as a build profile (if using the CLI feature, the profile <code>jrebel</code> is already provided - simply update the path to the agent JAR).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
&lt;!-- ... --&gt;
    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;jrebel&lt;/id&gt;
            &lt;build&gt;
                &lt;plugins&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                        &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
                        &lt;version&gt;1.6.0&lt;/version&gt;
                        &lt;configuration&gt;
                            &lt;executable&gt;java&lt;/executable&gt;
                            &lt;arguments&gt;
                                &lt;argument&gt;-noverify&lt;/argument&gt;
                                &lt;argument&gt;-XX:TieredStopAtLevel=1&lt;/argument&gt;
                                &lt;argument&gt;-agentpath:~/bin/jrebel/lib/jrebel6/lib/libjrebel64.dylib&lt;/argument&gt;
                                &lt;argument&gt;-classpath&lt;/argument&gt;
                                &lt;classpath/&gt;
                                &lt;argument&gt;${exec.mainClass}&lt;/argument&gt;
                            &lt;/arguments&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;
                &lt;/plugins&gt;
            &lt;/build&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>

<h2 id="gradleReload"><a class="anchor" href="#gradleReload"></a>17.5.3 Recompiling with Gradle</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/reloading/gradleReload.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Gradle supports <a href="https://docs.gradle.org/current/userguide/command_line_interface.html#sec:continuous_build">continuous builds</a>, allowing you to run a task that will be rerun every time the source files change. In order to make use of this with a reloading agent (configured as described above), you will run the application normally (with the agent), and then run a recompilation task in a separate terminal with continuous mode enabled.</p>
</div>
<div class="listingblock">
<div class="title">Run the app</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run the recompilation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew -t classes</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>classes</code> task will be rerun every time a source file is modified, allowing the reloading agent to pick up the change.</p>
</div>

<h2 id="ideReload"><a class="anchor" href="#ideReload"></a>17.5.4 Recompiling with an IDE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/reloading/ideReload.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you are using a build tool such as Maven, which does not support automatic recompilation on file changes, you may choose to use your IDE to recompile classes in combination with a reloading agent (as configured in the above sections).</p>
</div>
<div class="sect2">
<h3 id="_intellij">IntelliJ</h3>
<div class="paragraph">
<p>IntelliJ unfortunately does not have an automatic rebuild option that works for a running application. However, you can trigger a "rebuild" of the project with <code>CMD-F9</code> (Mac) or <code>CTRL-F9</code> (Windows).</p>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse">Eclipse</h3>
<div class="paragraph">
<p>Under the <code>Project</code> menu, check the <code>Build Automatically</code> option. This will trigger a recompilation of the project whenever file changes are saved to disk.</p>
</div>
</div>

<h2 id="proxy"><a class="anchor" href="#proxy"></a>17.6 Proxy Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/cli/proxy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure the CLI to use an HTTP proxy there are two steps. Configuration options can be passed to the cli through the <code>MN_OPTS</code> environment variable.</p>
</div>
<div class="paragraph">
<p>For example on *nix systems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export MN_OPTS="-Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=3128 -Dhttp.proxyUser=test -Dhttp.proxyPassword=test"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The profile dependencies are resolved over HTTPS so the proxy port and host are configured with <code>https.</code>, however the user and password are specified with <code>http.</code>.</p>
</div>
<div class="paragraph">
<p>For Windows systems the environment variable can be configured under <code>My Computer/Advanced/Environment Variables</code>.</p>
</div>

<h1 id="i18n"><a class="anchor" href="#i18n"></a>18 Internationalization</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/i18n.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="bundle"><a class="anchor" href="#bundle"></a>18.1 Resource Bundles</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/i18n/bundle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A resource bundle is a Java .properties file that contains locale-specific data.</p>
</div>
<div class="paragraph">
<p>Given this Resource Bundle:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/io/micronaut/docs/i18n/messages_en.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">hello=Hello</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/resources/io/micronaut/docs/i18n/messages_es.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">hello=Hola</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <a href="../api/io/micronaut/context/i18n/ResourceBundleMessageSource.html">ResourceBundleMessageSource</a>, an implementation of <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> which eases accessing <a href="https://docs.oracle.com/javase/8/docs/api//java/util/ResourceBundle.html">Resource Bundles</a> and provides cache functionality, to access the previous messages:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ResourceBundleMessageSource Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ResourceBundleMessageSource ms = new ResourceBundleMessageSource("io.micronaut.docs.i18n.messages");
        assertEquals("Hola", ms.getMessage("hello", MessageSource.MessageContext.of(new Locale("es"))).get());
        assertEquals("Hello", ms.getMessage("hello", MessageSource.MessageContext.of(Locale.ENGLISH)).get());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ResourceBundleMessageSource Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        given:
        ResourceBundleMessageSource ms = new ResourceBundleMessageSource("io.micronaut.docs.i18n.messages")

        expect:
        ms.getMessage("hello", MessageSource.MessageContext.of(new Locale("es"))).get() == 'Hola'

        and:
        ms.getMessage("hello", MessageSource.MessageContext.of(Locale.ENGLISH)).get() == 'Hello'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ResourceBundleMessageSource Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val ms = ResourceBundleMessageSource("io.micronaut.docs.i18n.messages")
        Assertions.assertEquals("Hola", ms.getMessage("hello", MessageSource.MessageContext.of(Locale("es"))).get())
        Assertions.assertEquals("Hello", ms.getMessage("hello", MessageSource.MessageContext.of(Locale.ENGLISH)).get())</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You should not instantiate a new <code>ResourceBundleMessageSource</code> each time you retrieve a message. Instantiate it once, maybe in a <code>javax.inject.Singleton</code>, and reuse it.
</td>
</tr>
</table>
</div>

<h1 id="appendix"><a class="anchor" href="#appendix"></a>19 Appendices</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/appendix.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="faq"><a class="anchor" href="#faq"></a>19.1 Frequently Asked Questions (FAQ)</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/appendix/faq.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following section covers frequently asked questions that you may find yourself asking while considering to use or using Micronaut.</p>
</div>
<div class="sect3">
<h4 id="_does_micronaut_modify_my_byte_code">Does Micronaut modify my byte code?</h4>
<div class="paragraph">
<p>No. Your classes are your classes. Micronaut does not transform classes or modify the Java byte code you write. Micronaut at compile will produce an additional set of classes that sit next to your original untouched classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_doesn_t_micronaut_use_spring">Why Doesn&#8217;t Micronaut use Spring?</h4>
<div class="paragraph">
<p>When asking why Micronaut doesn&#8217;t use Spring, it is typically in reference to the Spring Dependency Injection container.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Spring ecosystem is very broad and there are many Spring libraries you can use directly in Micronaut without requiring the Spring container.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason Micronaut features its own native <a href="https://www.jcp.org/en/jsr/detail?id=330">JSR-330</a> compliant dependency injection is that the cost of these features in Spring (and any reflection based DI/AOP container) is too great in terms of memory consumption and the impact on startup time. In order to support dependency injection at runtime Spring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-projects/spring-framework/tree/master/spring-core/src/main/java/org/springframework/core/type/classreading">Reads the byte code</a> of every bean it finds at runtime.</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-framework/blob/a691065d05741a4f1ca17925c8a5deec0f378c8b/spring-core/src/main/java/org/springframework/core/annotation/AnnotationUtils.java#L1465">Synthesizes new annotations</a> for each annotation on each bean method, constructor, field etc. to support Annotation metadata.</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-beans/src/main/java/org/springframework/beans/CachedIntrospectionResults.java">Builds Reflective Metadata</a> for each bean for every method, constructor, field etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The result is a progressive degradation of startup time and memory consumption as your application incorporates more features.</p>
</div>
<div class="paragraph">
<p>For Microservices and Serverless functions where it is critical that startup time and memory consumption remain low the above behaviour is an undesirable reality of using the Spring container, hence the designers of Micronaut chose not to use Spring.</p>
</div>
</div>
<div class="sect3">
<h4 id="_does_micronaut_support_scala">Does Micronaut support Scala?</h4>
<div class="paragraph">
<p>Micronaut supports any JVM language that supports the Annotation Processor API. Scala currently does not support this API. However, Groovy also doesn&#8217;t support this API and special support has been built that processes the Groovy AST. It may be technically possible to support Scala in the future if a module similar to <code>inject-groovy</code> is built, but as of this writing Scala is not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_can_micronaut_be_used_for_purposes_other_than_microservices">Can Micronaut be used for purposes other than Microservices?</h4>
<div class="paragraph">
<p>Yes. Micronaut is very modular and you can choose to use just the Dependency Injection and AOP implementation if you want simply by including only the <code>micronaut-inject-java</code> (or <code>micronaut-inject-groovy</code> for Groovy) dependency in your application.</p>
</div>
<div class="paragraph">
<p>In fact Micronaut&#8217;s support for <a href="#serverlessFunctions">Serverless Computing</a> uses this exact approach.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_are_the_advantages_of_micronaut_s_dependency_injection_and_aop_implementation">What are the advantages of Micronaut&#8217;s Dependency Injection and AOP implementation?</h4>
<div class="paragraph">
<p>Micronaut processes your classes at compile time and produces all metadata at compile time. This eliminates the need for reflection, cached reflective metadata and the requirement to analyze your classes at runtime all of which leads to slower startup performance and greater memory consumption.</p>
</div>
<div class="paragraph">
<p>In addition, Micronaut will build AOP proxies at compile time that are completely reflection free, which improves performances, reduces stack trace sizes and reduces memory consumption.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_does_micronaut_have_its_own_consul_and_eureka_client_implementations">Why does Micronaut have its own Consul and Eureka client implementations?</h4>
<div class="paragraph">
<p>The majority of Consul and Eureka clients that exist are blocking and include a mountain of external dependencies that inflate your JAR files.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> uses Micronaut&#8217;s native HTTP client thus greatly reducing the need for external dependencies and providing a reactive API onto both discovery servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_am_i_encountering_a_nosuchmethoderror_occurs_loading_my_beans_groovy">Why am I encountering a NoSuchMethodError occurs loading my beans (Groovy)?</h4>
<div class="paragraph">
<p>Groovy by default imports the <code>groovy.lang</code> package which includes a class called <code>@Singleton</code> that is an AST transformation that makes your class a singleton (adding a private constructor and static retrieval method). This annotation is easily confused with the <code>javax.inject.Singleton</code> annotation used to define singleton beans in Micronaut. Make sure you are using the correct annotation in your Groovy classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_is_it_taking_much_longer_than_it_should_to_start_the_application">Why is it taking much longer than it should to start the application</h4>
<div class="paragraph">
<p>Micronaut&#8217;s startup time is typically very fast. At the application level, however, it is possible to block startup time so if you are seeing slow startup, review if you have any application startup listeners or <code>@Context</code> scope beans that are slowing startup.</p>
</div>
<div class="paragraph">
<p>Some network issues can, also cause slow startup. On the Mac for example misconfiguration of your <code>/etc/hosts</code> file can cause issues. See the following <a href="https://stackoverflow.com/a/39698914/1264846">stackoverflow answer</a>.</p>
</div>
</div>

<h2 id="usingsnapshots"><a class="anchor" href="#usingsnapshots"></a>19.2 Using Snapshots</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/appendix/usingsnapshots.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut milestone and stable releases are distributed to <a href="https://bintray.com/micronaut">Bintray</a>.</p>
</div>
<div class="paragraph">
<p>The following snippet shows how to use Micronaut <code>BUILD-SNAPSHOT</code> with Gradle. The latest snapshot will always be the next patch version plus 1 with <code>.BUILD-SNAPSHOT</code> appended. For example if the latest release is "1.0.1", the current snapshot would be "1.0.2.BUILD-SNAPSHOT".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ext {
  micronautVersion = '1.0.2.BUILD-SNAPSHOT'
}
repositories {
  jcenter() <i class="conum" data-value="1"></i><b>(1)</b>
  maven { url "https://oss.jfrog.org/oss-snapshot-local" } <i class="conum" data-value="2"></i><b>(2)</b>
}
dependencyManagement {
  imports {
      mavenBom "io.micronaut:micronaut-bom:$micronautVersion"
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Micronaut releases are available on JCenter and Maven Central</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Micronaut snapshots are available on JFrog OSS</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the case of Maven, edit <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
  ...

  &lt;properties&gt;
    &lt;micronaut.version&gt;1.0.2.BUILD-SNAPSHOT&lt;/micronaut.version&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  &lt;/properties&gt;

  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;jcenter.bintray.com&lt;/id&gt;
      &lt;url&gt;https://jcenter.bintray.com&lt;/url&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/repository&gt;
    &lt;repository&gt;
      &lt;id&gt;jfrog-snapshots&lt;/id&gt;
      &lt;url&gt;https://oss.jfrog.org/oss-snapshot-local&lt;/url&gt; <i class="conum" data-value="3"></i><b>(3)</b>
    &lt;/repository&gt;
  &lt;/repositories&gt;

  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-bom&lt;/artifactId&gt;
        &lt;version&gt;${micronaut.version}&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;

  ...
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the snapshot version.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Micronaut releases are available on JCenter and Maven Central</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Micronaut snapshots are available on JFrog OSS Snapshots</td>
</tr>
</table>
</div>

<h2 id="problems"><a class="anchor" href="#problems"></a>19.3 Common Problems</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/appendix/problems.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following section covers common problems folks stumble upon when using Micronaut.</p>
</div>
<div class="sect3">
<h4 id="_dependency_injection_is_not_working">Dependency injection is not working</h4>
<div class="paragraph">
<p>The most common reason that Dependency Injection fails to work is when you either don&#8217;t have the appropriate annotation processor configured or your IDE is incorrectly configured. See the section on <a href="#languageSupport">Language Support</a> for how to get setup in your language.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_nosuchmethoderror_occurs_loading_beans_groovy">A NoSuchMethodError occurs loading beans (Groovy)</h4>
<div class="paragraph">
<p>Groovy by default imports the <code>groovy.lang</code> package which includes a class called <code>@Singleton</code> that is an AST transformation that makes your class a singleton (adding a private constructor and static retrieval method). This annotation is easily confused with the <code>javax.inject.Singleton</code> annotation used to define singleton beans in Micronaut. Make sure you are using the correct annotation in your Groovy classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_it_is_taking_much_longer_to_start_my_application_than_it_should_nix_os">It is taking much longer to start my application than it should (*nix OS)</h4>
<div class="paragraph">
<p>This is likely due to a bug that has to do with executions of <code>java.net.InetAddress.getLocalHost()</code> causing a long delay. The solution is to edit your <code>/etc/hosts</code> file to add an entry that contains your host name. To find your host name, simply enter <code>hostname</code> in the terminal and the value will be output. Then edit your <code>/etc/hosts</code> file to add or change entries like the example below, replacing <code>&lt;hostname&gt;</code> with your host name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>127.0.0.1       localhost &lt;hostname&gt;
::1             localhost &lt;hostname&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about this issue, see this <a href="https://stackoverflow.com/a/39698914/1264846">stackoverflow answer</a></p>
</div>
</div>

<h2 id="breaks"><a class="anchor" href="#breaks"></a>19.4 Breaking Changes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/2.1.x/src/main/docs/guide/appendix/breaks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This section will document breaking changes between Micronaut 1.0 and Micronaut 2.0</p>
</div>
<div class="sect2">
<h3 id="_thread_pool_selection_now_manual">Thread Pool Selection Now Manual</h3>
<div class="paragraph">
<p>In Micronaut 1.x, Micronaut would attempt to automatically deduce the thread pool to use based on the return type of the controller method.</p>
</div>
<div class="paragraph">
<p>This approach caused some confusion and created a false association between reactive types and blocking operations.</p>
</div>
<div class="paragraph">
<p>Micronaut 2.x now leaves it up to the user to specify the thread pool to schedule operations on, including blocking operations.</p>
</div>
<div class="paragraph">
<p>If you are upgrading from Micronaut 1.x and have a controller that executes blocking I/O operations (such as JDBC or JPA) it is recommended that you add the <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation to execute the blocking operations on a different thread.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.*;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;

@Controller("/executeOn/people")
public class PersonController {

    private final PersonService personService;

    PersonController(
            PersonService personService) {
        this.personService = personService;
    }

    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) <b class="conum">(1)</b>
    Person byName(String name) {
        return personService.findByName(name);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.*
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn

@Controller("/executeOn/people")
class PersonController {

    private final PersonService personService

    PersonController(
            PersonService personService) {
        this.personService = personService
    }

    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) <b class="conum">(1)</b>
    Person byName(String name) {
        return personService.findByName(name)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.*
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn

@Controller("/executeOn/people")
class PersonController (private val personService: PersonService) {
    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) <b class="conum">(1)</b>
    fun byName(name: String): Person {
        return personService.findByName(name)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation is used to execute the operation on the I/O thread pool</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you wish to return to the previous behaviour as defined in Micronaut 1.x you can set <code>micronaut.server.thread-selection</code> to <code>AUTO</code> in configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_cache_removed_from_core">Micronaut Cache Removed from Core</h3>
<div class="paragraph">
<p>The <code>micronaut-runtime</code> module in Micronaut 1.x included support for caching AOP with the <code>@Cache</code> annotation. The core caching library and a default implementation based on caffeine were included.</p>
</div>
<div class="paragraph">
<p>If you are using the caffeine backed cache support, you must add a dependency to continue doing so. Add <code>io.micronaut.cache:micronaut-cache-caffeine</code> to your build to maintain the existing functionality. The new caffeine cache module no longer uses the internal shadowed caffeine version and declares its own normal dependency on caffeine. You may need to exclude the transitive dependency in order to prevent conflicts with other versions that may be being pulled in.</p>
</div>
<div class="paragraph">
<p>The management endpoint for caches is no longer included by default in the <code>micronaut-management</code> module. If you would like to use the caches endpoint, add a dependency on <code>io.micronaut.cache:micronaut-cache-management</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_rxjava_1_x_removed_from_core">Support for RxJava 1.x Removed from Core</h3>
<div class="paragraph">
<p>RxJava 1.x support is no longer included in core by default. You can re-enable support by adding the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava1:micronaut-rxjava1")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava1&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava1&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_reactor_removed_from_core">Support for Reactor Removed from Core</h3>
<div class="paragraph">
<p>Reactor support is no longer included in core by default. You can re-enable support by adding the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.reactor:micronaut-reactor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.reactor&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-reactor&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
</div>
<div class="sect2">
<h3 id="_loggers_endpoint_modifications_now_sensitive">Loggers Endpoint Modifications Now Sensitive</h3>
<div class="paragraph">
<p>The method on the loggers endpoint to modify logging is now sensitive by default. To revert to the previous behavior, apply the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
    loggers:
        write-sensitive: false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_side_content_negotiation_may_require_test_changes">Server Side Content Negotiation May Require Test Changes</h3>
<div class="paragraph">
<p>The new support for server side content negotiation may require changes to tests. For example a test that that makes a call such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String result = client.toBlocking().retrieve(
    HttpRequest.GET('/test')
        .accept("text/plain"), String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the server implementation does not declare the route as <code>@Produces("text/plain")</code> the request will be rejected with a <code>NOT_ACCEPTABLE</code> HTTP status code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_server_filter_ordering">Server Filter Ordering</h3>
<div class="paragraph">
<p>In Micronaut 1.x almost all built in filters operated on order 0, meaning the order was non deterministic. That caused some compatibility issues with the metrics and security modules. A new class has been added <a href="../api/io/micronaut/http/filter/ServerFilterPhase.html">ServerFilterPhase</a> that defines the phases of server filtering and sets an order. Many filters have been updated to now have their order reflect the phase they participate in.</p>
</div>
</div>
<div class="sect2">
<h3 id="_heartbeat_events_no_longer_published_if_no_discovery_clients_present">Heartbeat Events No Longer Published if no Discovery Clients present</h3>
<div class="paragraph">
<p>A <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> is no longer published automatically if there are no <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> instances present.</p>
</div>
<div class="paragraph">
<p>This behaviour can be changed by setting <code>micronaut.heartbeat.enabled</code> to <code>true</code> explicitly in configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_several_typeconverters_are_no_longer_beans">Several TypeConverters Are No Longer Beans</h3>
<div class="paragraph">
<p>Many <code>TypeConverter</code> instances that were previously beans are no longer beans and are deprecated including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/http/MediaTypeConverter.html">MediaTypeConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/convext/converters/StringToClassConverter.html">StringToClassConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/convext/converters/StringArrayToClassArrayConverter.html">StringArrayToClassArrayConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/http/client/converters/SocketAddressConverter.html">SocketAddressConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/reactive/reactor/converters/PublisherToMonoConverter.html">PublisherToMonoConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/reactive/reactor/converters/PublisherToFluxConverter.html">PublisherToFluxConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/reactive/reactor/converters/ObjectToFluxConverter.html">ObjectToFluxConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/reactive/reactor/converters/ObjectToMonoConverter.html">ObjectToMonoConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/jackson/convert/JsonNodeToObjectConverter.html">JsonNodeToObjectConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/jackson/convert/MapToObjectConverter.html">MapToObjectConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/jackson/convert/ObjectToJsonNodeConverter.html">ObjectToJsonNodeConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/jackson/convert/ArrayNodeToArrayConverter.html">ArrayNodeToArrayConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/jackson/convert/ArrayNodeToIterableConverter.html">ArrayNodeToIterableConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/jackson/convert/ObjectNodeToConvertibleValuesConverter.html">ObjectNodeToConvertibleValuesConverter</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/runtime/http/converters/HttpStatusConverter.html">HttpStatusConverter</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These should not be injected directly but instead used through the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_executable_no_longer_stereotype_of_around">@Executable No Longer Stereotype of @Around</h3>
<div class="paragraph">
<p>In Micronaut 1.x the <a href="../api/io/micronaut/context/annotation/Executable.html">@Executable</a> annotation was a meta-annotation specified on the <a href="../api/io/micronaut/aop/Around.html">@Around</a> and <a href="../api/io/micronaut/aop/Introduction.html">@Introduction</a> annotations. This meant that an <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a> reference was generated for every usage of AOP advice which consumed additional memory unnecessarily.</p>
</div>
<div class="paragraph">
<p>In Micronaut 2.x and above this is no longer the case and if you need an <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a> generated you should add the <a href="../api/io/micronaut/context/annotation/Executable.html">@Executable</a> annotation to any custom AOP advice you specify otherwise the method will not be available via the <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> interface (using for example the <a href="../api/io/micronaut/BeanDefinition/getExecutableMethods.html">getExecutableMethods</a> method).</p>
</div>
</div>
<div class="sect2">
<h3 id="_spot_bugs_instead_of_jsr_305_nullable_nonnull_annotations">Spot Bugs Instead of JSR-305 Nullable/NonNull Annotations</h3>
<div class="paragraph">
<p>The JSR-305 annotations library (<code>com.google.code.findbugs:jsr305</code>) is no longer a dependency (replaced by <code>spotbugs-annotations</code>). If you need this library you will need to add it manually.</p>
</div>
</div>
<div class="sect2">
<h3 id="_events_renamed">Events Renamed</h3>
<div class="paragraph">
<p>The following events were renamed to avoid confusion with other events of similar names:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old Name</th>
<th class="tableblock halign-left valign-top">New Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.discovery.event.ServiceStartedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.discovery.event.ServiceShutdownEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceStoppedEvent.html">ServiceStoppedEvent</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_new_package_for_netty_specific_classes_of_http_client">New Package for Netty Specific Classes of HTTP Client</h3>
<div class="paragraph">
<p>The HTTP client implementation classes including <a href="../api/io/micronaut/http/client/netty/DefaultHttpClient.html">DefaultHttpClient</a> (considered internal in Micronaut 1.x) have been moved to a sub-package called <code>io.micronaut.http.client.netty</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_http_clients_no_longer_named_beans">HTTP Clients No Longer Named Beans</h3>
<div class="paragraph">
<p>HTTP clients declared with <code>micronaut.http.services</code> (see <a href="#serviceDiscoveryManual">Manual Service Discovery Configuration</a>) are no longer named beans in the context and cannot be injected with <code>javax.inject.Named</code>, for example given the configuration:</p>
</div>
<div class="listingblock">
<div class="title">Manually configuring services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        services:
            foo:
                urls:
                    - http://foo1
                    - http://foo2</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can no longer inject an HTTP client with <code>@Named("foo")</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Named("foo")
RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead you should always use <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Client("foo")
RxHttpClient httpClient;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_retention_annotations_no_longer_retained_in_runtime_metadata">Source Retention Annotations No Longer Retained in Runtime Metadata</h3>
<div class="paragraph">
<p>In Micronaut 1.x annotations specified as source retention were still retained in the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> interface. As of Micronaut 2.x this is no longer the case with source retention annotations only available within the compiler APIs.</p>
</div>
<div class="paragraph">
<p>If you wish to retain a particular source level annotation when upgrading you can write an <a href="../api/io/micronaut/inject/annotation/AnnotationTransformer.html">AnnotationTransformer</a> that alters the <code>RetentionPolicy</code> of the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_iterable_beans_no_longer_have_an_implicit_primary">Iterable Beans No Longer Have An Implicit Primary</h3>
<div class="paragraph">
<p>In Micronaut 1.x injecting a single instance of an iterable bean without qualifiers would inject the first bean. An iterable bean is typically anything annotated with <code>@EachProperty</code> or <code>@EachBean</code>. Those beans typically are referenced from configuration. The first bean in this context is the first item in configuration that matches what the annotation expects.</p>
</div>
<div class="paragraph">
<p>For example if you created a bean with <code>@EachProperty("cars")</code>, then specified the following in your config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cars:
    ford:
        cylinders: 8
    subaru:
        cylinders: 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Requesting a single instance of that bean would result in the "ford" instance being injected. Because that behavior is surprising and inconsistent with other types of beans, that is no longer the case and a <code>NonUniqueBeanException</code> will be thrown.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This change does not apply to an explicit primary defined in the annotation (<code>@EachProperty(value = "cars", primary = "ford")</code>), nor requesting the instance by a qualifier (<code>@Named("ford") CarConfig carConfig</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_no_longer_possible_to_return_null_to_disable_a_bean">No Longer Possible to Return Null to Disable a Bean</h3>
<div class="paragraph">
<p>It is no longer possible to return <code>null</code> from a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> bean method to disable the bean. You should now throw <a href="../api/io/micronaut/context/exceptions/DisabledBeanException.html">DisabledBeanException</a> instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_invalid_configuration_file_locations">Invalid Configuration File Locations</h3>
<div class="paragraph">
<p>Specifying a file with <code>micronaut.config.files</code>, either through the system property or environment variable, that does not exist or cannot be read will now result in the application failing to startup. In previous versions of Micronaut a warning would be logged and the file would be ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_propertysourceloader_changes">PropertySourceLoader Changes</h3>
<div class="paragraph">
<p>Some default interface methods are no longer default and require implementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deprecation_removal">Deprecation Removal</h3>
<div class="paragraph">
<p>Most if not all deprecated classes and methods have been removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_map_property_binding">Map Property Binding</h3>
<div class="paragraph">
<p>In Micronaut 1.x <code>java.util.Map</code> properties being bound from config were inconsistently bound as either a nested or flat. Now maps are bound as nested by default and the <a href="../api/io/micronaut/core/convert/format/MapFormat.html">@MapFormat</a> annotation&#8217;s default value for <code>transformation</code> has been changed to reflect that.</p>
</div>
<div class="paragraph">
<p>For example given the config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">persons:
  joe:
    age: 30
  sally:
    age: 25</code></pre>
</div>
</div>
<div class="paragraph">
<p>A map property injected via <code>@Property(name ="persons")</code> may have been injected flat or nested depending on a couple factors.</p>
</div>
<div class="listingblock">
<div class="title">Flat</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"joe.age": 30, "sally.age": 25}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Nested</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"joe": {"age": 30}, "sally": {"age": 25}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To bind to a map with flat keys, add the <a href="../api/io/micronaut/core/convert/format/MapFormat.html">@MapFormat</a> annotation and set the <code>transformation</code> member.</p>
</div>
</div>
<div class="sect2">
<h3 id="_graalvm_bom_entry">GraalVM BOM Entry</h3>
<div class="paragraph">
<p>The no longer used group for Graal is no longer part of the bom. While upgrading if you depend on Graal you may see <code>Could not find com.oracle.substratevm:svm:.</code>. To resolve the issue, change the dependency group to <code>org.graalvm.nativeimage</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_code_retryable_code_and_code_circuitbreaker_code_exception_handling"><code>@Retryable</code> and <code>@CircuitBreaker</code> Exception Handling</h3>
<div class="paragraph">
<p><code>@Retryable</code> and <code>@CircuitBreaker</code> in previous versions of Micronaut resolved <code>includes</code> and <code>excludes</code> explicitly. Any exception thrown had to exactly match one of the exceptions specified. This has been changed to now also include subclasses of the exception types specified.</p>
</div>
</div>
<div class="sect2">
<h3 id="_messagesource_api_changes">MessageSource API Changes</h3>
<div class="paragraph">
<p>The semantics of the <code>getMessage</code> method have been changed to also interpolate the message with any provided variables. In previous versions of Micronaut, the raw message was returned from the bundle. To support reading the raw message, a new method <code>getRawMessage</code> has been added.</p>
</div>
<div class="paragraph">
<p>In addition, escaping of messages with single quotes is now implemented in accordance with the standard Java <a href="https://docs.oracle.com/javase/8/docs/api/java/text/MessageFormat.html">MessageFormat</a> class. Messages that contain a single quote will now need escaping in order for the quote to output as it did previously. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">my.message=We love Micronaut's documentation</code></pre>
</div>
</div>
<div class="paragraph">
<p>Would now be output as <code>We love Micronauts documentation</code>. To achieve the desired result, escape the single quote with another single quote.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">my.message=We love Micronaut''s documentation</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This change also applies to messages in custom constraint annotations, which interpolate the message via the message source api.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_environment_order_bugfix">Environment Order Bugfix</h3>
<div class="paragraph">
<p>Environments specified through the application context builder have priority over environments deduced or supplied through the MICRONAUT_ENVIRONMENTS environment variable, or the equivalent system property. A bug in the logic however did not change the order of a specified environment if it previously was found or deduced. This issue manifested itself with <code>@MicronautTest(environments = "test")</code>. The <code>test</code> environment is already deduced for tests, so it retained the order of other deduced environments, and was able to be overriden by <code>MICRONAUT_ENVIRONMENTS=dev</code>. In Micronaut 1.x configuration for <code>dev</code> would have overridden <code>test</code>. In Micronaut 2.x <code>test</code> will override <code>dev</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_introspections_and_inner_classes">Introspections and Inner Classes</h3>
<div class="paragraph">
<p>A bug in Micronaut 1.x caused bean introspections to be generated for inner classes of classes annotated with <code>@Introspected</code>. That also applies to classes where <code>@Introspection</code> is a meta annotation, like <code>@Entity</code>. This may have an impact for GraalVM users that rely on accesses to those classes without using reflection. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@Entity
public class Pet {
    ...
    private PetType type = PetType.DOG;
    // getters &amp; setters

    public enum PetType {
        DOG,
        CAT
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Previously a bean introspection would have been generated for <code>PetType</code>. That is no longer the case. If the type should be introspected, simply add the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_executable_methods">Executable Methods</h3>
<div class="paragraph">
<p>A bug in Micronaut 1.x caused bean definitions to be created for classes that only declared executable annotations on one or more methods. Classes with executable methods must now be explicitly declared as a bean with a scope annotation in order for a bean definition to be created.</p>
</div>
</div>
<div class="sect2">
<h3 id="_super_interfaces_no_longer_searched_for_fallbacks">Super interfaces No Longer Searched for Fallbacks</h3>
<div class="paragraph">
<p>If the <a href="../api/io/micronaut/retry/annotation/Fallback.html">@Fallback</a> annotation is used to specify a fallback for a <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> interface, the super interfaces of the client will no longer be traversed to lookup the fallback to invoke.</p>
</div>
<div class="paragraph">
<p>In this case it may be necessary to specify the <code>api</code> member of the <a href="../api/io/micronaut/retry/annotation/Recoverable.html">@Recoverable</a> annotation to ensure the fallback can be looked up. For example:</p>
</div>
<div class="listingblock">
<div class="title">Specifying the <code>api</code> to recover from</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("/Books")
@Recoverable(api = BookApi)
interface BookClient extends BookApi {
    @Override
    Book get(Long id);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aws_functionclient_moved_to_aws_module">AWS FunctionClient Moved to AWS Module</h3>
<div class="paragraph">
<p>The AWS based function client has been made part of the <a href="https://github.com/micronaut-projects/micronaut-aws/">Micronaut AWS</a> project. If you need this functionality add the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.aws:micronaut-function-client-aws")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-function-client-aws&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
</div>
<div class="sect2">
<h3 id="_loglevel_enum_moved_to_io_micronaut_logging">LogLevel Enum Moved to io.micronaut.logging</h3>
<div class="paragraph">
<p><code>io.micronaut.management.endpoint.loggers.LogLevel</code> enum has moved to package <code>io.micronaut.logging</code></p>
</div>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>