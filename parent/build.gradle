group projectGroupId
version projectVersion

ext.startPomInfo = {
    delegate.parent {
        groupId projectGroupId
        artifactId "micronaut-bom"
        delegate.version projectVersion
    }
}
ext.extraPomInfo = {
    delegate.properties {
        "micronaut.version"(projectVersion)
    }
    delegate.build {
        delegate.pluginManagement {
            delegate.plugins {
                delegate.plugin {
                    groupId "io.micronaut.build"
                    artifactId "micronaut-maven-plugin"
                    delegate.version micronautMavenPluginVersion
                }
                delegate.plugin {
                    groupId "com.github.os72"
                    artifactId "protoc-jar-maven-plugin"
                    delegate.version "3.11.4"
                    delegate.executions {
                        execution {
                            phase('generate-sources')
                            goals {
                                goal("run")
                            }
                            delegate.configuration {
                                addProtoSources('all')
                                includeMavenTypes('direct')
                                inputDirectories {
                                    include('src/main/proto')
                                }
                                outputTargets {
                                    outputTarget {
                                        type("java")
                                    }
                                    outputTarget {
                                        type("grpc-java")
                                        pluginArtifact('io.grpc:protoc-gen-grpc-java:${grpc.version}')
                                    }
                                }
                            }
                        }
                    }
                }
                delegate.plugin {
                    groupId "org.codehaus.mojo"
                    artifactId "exec-maven-plugin"
                    delegate.version "1.6.0"
                    delegate.configuration {
                        executable("java")
                        arguments {
                            argument("-classpath")
                            classpath()
                            argument("-XX:TieredStopAtLevel=1")
                            argument("-Dcom.sun.management.jmxremote")
                            argument('${exec.mainClass}')
                        }
                    }
                }
                delegate.plugin {
                    groupId "com.google.cloud.functions"
                    artifactId "function-maven-plugin"
                    delegate.version "0.9.3"
                }
                delegate.plugin {
                    groupId "com.google.cloud.tools"
                    artifactId "jib-maven-plugin"
                    delegate.version "2.4.0"
                }
                delegate.plugin {
                    groupId "com.microsoft.azure"
                    artifactId "azure-functions-maven-plugin"
                    delegate.version "1.5.0"
                }
                delegate.plugin {
                    groupId "org.apache.maven.plugins"
                    artifactId "maven-resources-plugin"
                    delegate.version "3.1.0"
                }
                delegate.plugin {
                    groupId "org.apache.maven.plugins"
                    artifactId "maven-compiler-plugin"
                    delegate.version "3.8.1"
                    delegate.configuration {
                        compilerArgs {
                            arg("-parameters")
                        }
                    }
                    delegate.executions {
                        execution {
                            delegate.id "test-compile"
                            goals {
                                goal "testCompile"
                            }
                            delegate.configuration {
                                compilerArgs {
                                    arg("-parameters")
                                }
                            }
                        }
                    }
                }
                delegate.plugin {
                    groupId "org.apache.maven.plugins"
                    artifactId "maven-shade-plugin"
                    delegate.version "3.1.0"
                    delegate.executions {
                        execution {
                            delegate.phase "package"
                            goals {
                                goal "shade"
                            }
                            delegate.configuration {
                                createDependencyReducedPom(false)
                                transformers {
                                    transformer(implementation:'org.apache.maven.plugins.shade.resource.ManifestResourceTransformer') {
                                        mainClass('${exec.mainClass}')
                                    }
                                    transformer(implementation:'org.apache.maven.plugins.shade.resource.ServicesResourceTransformer')
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

apply plugin: "io.micronaut.build.publishing"